<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[2020å¹´7æœˆå‰ç«¯é¢è¯•æ€»ç»“]]></title>
    <url>%2F2020%2F07%2F28%2F2020-07-interview%2F</url>
    <content type="text"><![CDATA[å†™åœ¨å‰é¢&emsp;&emsp;æ„Ÿè§‰å¾ˆä¹…æ²¡æœ‰æ›´æ–°åšå®¢äº†ï¼Œè¿™æ®µæ—¶é—´æˆ‘ä¹Ÿæ²¡é—²ç€ã€‚æ•´ä¸ªä¸ƒæœˆæ„Ÿè§‰å°±æ²‰æµ¸åœ¨é¢è¯•çš„æµ·æ´‹é‡Œï¼Œè®©äººä¸æ•¢å»å›æƒ³ï¼Œå› ä¸ºçœŸçš„æ˜¯å¤ªç´¯äº†ã€‚å¤§æ¦‚ç»Ÿè®¡äº†ä¸€ä¸‹ï¼Œåœ¨è¿™ä¸ªæœˆå†…æ€»å…±é¢è¯•äº†28è½®ï¼Œé¢è¯•çš„å…¬å¸æœ‰58åŒåŸã€CSDNã€è‡ªå¦‚ã€äº¬ä¸œã€Bossç›´è˜ã€ç¾å›¢ã€å­—èŠ‚è·³åŠ¨ã€ç™¾åº¦ç­‰ï¼ˆæ’åæŒ‰é¢è¯•æ—¶é—´æ’ï¼‰ï¼Œæœ‰çš„é¢è¯•æµç¨‹æ²¡ç»“æŸï¼Œæ‹’ç»äº†é˜¿é‡Œå’Œæ»´æ»´çš„é¢è¯•æœºä¼šï¼Œå› ä¸ºæ—¶é—´å®åœ¨æ¥ä¸åŠï¼Œåˆ°æœ€åæ‹¿äº†å‡ ä¸ªOfferï¼Œå…·ä½“å“ªäº›å°±ä¸è¯´äº†ã€‚ é¢è¯•é¢˜é‡åˆ°çš„é¢è¯•é¢˜è¿˜ä¸å°‘ï¼Œä»¥ä¸‹é¢è¯•é¢˜æ˜¯æ‰€æœ‰é¢è¯•æ‚ç³…åœ¨ä¸€èµ·çš„ï¼Œå°±ä¸åˆ†å…¬å¸äº†ï¼Œéƒ¨åˆ†æ˜¯æœ‰çš„æ˜¯æœ‰é‡å¤çš„å“ˆã€‚ è™šæ‹ŸDomå¥½å¤„ æ€ä¹ˆåˆ¤æ–­æ•°æ®ç±»å‹ vueæ€ä¹ˆå¼ºåˆ¶æ›´æ–°è§†å›¾ for ofå’Œfor inçš„åŒºåˆ« let const var è¯´ä¸€è¯´bfc remå’ŒemåŒºåˆ« è¯´ä¸€ä¸‹åƒåœ¾å›æ”¶æœºåˆ¶ è¾“å…¥urlå‘ç”Ÿäº†ä»€ä¹ˆ vueç”Ÿå‘½å‘¨æœŸ vue2.0å’Œ3.0å®ç°åŒºåˆ« å¯¹è±¡å’Œmapçš„åŒºåˆ« è·¨åŸŸ æœ‰å“ªäº›æ•°ç»„æ–¹æ³• æ€§èƒ½ä¼˜åŒ– æµ·æŠ¥å›¾æ€ä¹ˆä¼˜åŒ– ssré‡åˆ°çš„é—®é¢˜ vueè·¯ç”±é’©å­ç”¨é€” é”™è¯¯ç›‘æ§ æ€§èƒ½ç›‘æ§ 301å’Œ302çš„åŒºåˆ« async awaitåŸç† è¯´ä¸€è¯´cdn cdnçš„å›æºæœºåˆ¶ æœç´¢æ¡†è”æƒ³å¦‚ä½•ä¼˜åŒ– vueåŒå‘æ•°æ®ç»‘å®šåŸç† ç»“åˆlodashè¯´ä¸‹æŸ¯é‡ŒåŒ–å‡½æ•°ï¼Ÿï¼ˆä»¥ä¸‹æœ‰å‡ é“é¢˜çœ‹æ ·å­éƒ½æ˜¯å¦‚ä½•é€šè¿‡é¥¿äº†ä¹ˆNodeé¢è¯•çš„é¢˜ï¼‰ é—­åŒ…åº”ç”¨çš„åœºæ™¯ï¼Ÿclassã€symbolæ˜¯å¦å¯ä»¥å®ç°ç§æœ‰ï¼Ÿé—­åŒ…ä¸­çš„æ•°æ®/ç§æœ‰åŒ–çš„æ•°æ®çš„å†…å­˜ä»€ä¹ˆæ—¶å€™é‡Šæ”¾ï¼Ÿ promiseå®ç°åŸç†ï¼Ÿasync/awaitçš„åŒºåˆ«ï¼Ÿ æ ‡å‡†çš„ JavaScript é”™è¯¯å¸¸è§æœ‰å“ªäº›ï¼ŸNode.js ä¸­é”™è¯¯å¤„ç†å‡ ç§æ–¹æ³•ï¼Ÿæ€ä¹ˆå¤„ç†æœªé¢„æ–™çš„å‡ºé”™? ç”¨ try/catch , è¿˜æ˜¯å…¶å®ƒä»€ä¹ˆ? ç°åœ¨è¦ä½ å®Œæˆä¸€ä¸ªå…¬ç”¨çš„Dialogç»„ä»¶ï¼Œè¯´è¯´ä½ å°è£…çš„æ€è·¯ Vue3.0/React Hooks äº†è§£ä¹ˆç®€å•è¯´ä¸‹ï¼Ÿ Require åŸç†ï¼Ÿ Es6å¦‚ä½•è½¬Es5? é™¤äº†babelè¿˜æœ‰å…¶ä»–æ–¹æ³•å— è¯´ä¸‹æ¸è¿›å¼æ¡†æ¶çš„ç†è§£ï¼Ÿä»¥åŠæ›¾å¼€å‘è¿‡çš„ç»„ä»¶åº“/å·¥å…·åº“/è„šæ‰‹æ¶çš„æ¶æ„è®¾è®¡æ–¹æ¡ˆï¼Ÿ æ€§èƒ½è°ƒä¼˜ï¼Ÿwebpackå¯¹é¡¹ç›®è¿›è¡Œä¼˜åŒ–ï¼Ÿ reactå’Œvueçš„åŒºåˆ« corsè·¨åŸŸï¼Œç®€å•è¯·æ±‚å’Œéç®€å•è¯·æ±‚ï¼Œè¯·æ±‚å‘ç”Ÿåˆ°æœåŠ¡å™¨äº†æ²¡æœ‰ webpackçš„ä¼˜åŒ–chunkç±»å‹çš„åŒºåˆ« vueçˆ¶å­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåº httpç¼“å­˜ promiseé“¾å¼è°ƒç”¨åŸç† webpackå†™è¿‡æ’ä»¶æ²¡æœ‰ çŸ¥ä¸çŸ¥é“tree shakingå’ŒåŸç† ç®­å¤´å‡½æ•°èƒ½ä¸èƒ½å½“æ„é€ å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨callç»‘å®šå— letå˜é‡ä¼šä¸ä¼šåˆ°windowä¸‹ vueçš„keep-alive computedå’Œmethodsçš„åŒºåˆ« async awaitï¼Œé”™è¯¯å¤„ç† ç™½å±é—®é¢˜æ’æŸ¥ æ ˆå’Œå †çš„åŒºåˆ« toStringå’ŒtoNumberæ–¹æ³• æœ‰å“ªäº›å…¨å±€å¯¹è±¡ å·¥å‚æ¨¡å¼ çŸ¥é“åƒåœ¾å›æ”¶æœºåˆ¶å— æ€ä¹ˆç†è§£é—­åŒ… æœ€è¿‘ä¸€å¹´çš„æˆé•¿ cookieã€sessionã€localstorage http2.0å’Œ1.1æ¯”è¾ƒï¼Œå¤šè·¯å¤ç”¨çš„åŸç† åŒå‘æ•°æ®ç»‘å®šçš„åŸç† èŒä¸šè§„åˆ’ nodeæ€ä¹ˆåˆ›å»ºè¿›ç¨‹ï¼Œæ€ä¹ˆè§£å†³ç«¯å£å†²çªé—®é¢˜ å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ å°ç¨‹åºå°è±¡æœ€æ·±åˆ»çš„é—®é¢˜ å°ç¨‹åºé¦–å±ä¼˜åŒ– å°ç¨‹åºç‰ˆæœ¬æ›´æ–°å¦‚ä½•æ§åˆ¶ å°ç¨‹åºé¡µé¢å€¼ä¼ é€’ cssåŠ¨ç”»ç”¨çš„å¤šå—ï¼Œæœ‰ä»€ä¹ˆè§‰å¾—åšå¾—ç‰¹åˆ«å¥½çš„ é•¿åˆ—è¡¨å®ç°è™šæ‹Ÿæ»šåŠ¨ é‡æ’å’Œé‡ç»˜ httpsåŸç† http1.1å’Œ2.0 æ€§èƒ½ä¼˜åŒ– å‰ç«¯åŠ å¯† vueå“åº”å¼åŸç† vuexåŸç† vue2.0å’Œ3.0æ¯”è¾ƒ vueåŒ…æ‡’åŠ è½½çš„åŸç† babel-plugin-component ä½¿ç”¨è¿‡è‡ªåŠ¨åŒ–éƒ¨ç½²å— å‰ç«¯æ€ä¹ˆæ§åˆ¶25%è·³è½¬åˆ°ä¸€ä¸ªé¡µé¢75%è·³è½¬åˆ°å¦å¤–ä¸€ä¸ª ç»„ä»¶é€šä¿¡ï¼Œçˆ¶å­ï¼Œç»„ä»¶ä¸ç»„ä»¶ reactçš„hookså¥½å¤„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ä»– é«˜é˜¶ç»„ä»¶ httpç¼“å­˜ Nodeæ€ä¹ˆè§£å†³å¤šè¿›ç¨‹ç«¯å£å†²çªçš„é—®é¢˜ IPC pm2åŸç† event loopå’Œå®é™…åº”ç”¨ nodeæœåŠ¡é«˜å¯ç”¨ koaæ´‹è‘±æ¨¡å‹ ä¸ºä»€ä¹ˆè¦è®¾è®¡æˆæ´‹è‘±æ¨¡å‹ rsp å‡½æ•°å¼ç»„ä»¶ é˜…è¯»æºç çš„æ€è·¯ æœ€è¿‘åœ¨å…³æ³¨å“ªäº›æŠ€æœ¯ è·¨åŸŸCORSä»¥åŠç®€å•è¯·æ±‚å’Œéç®€å•è¯·æ±‚ è·¨åŸŸé¢„æ£€è¯·æ±‚ä¼šæ¯æ¬¡éƒ½å‘é€å— è·¨åŸŸæ€ä¹ˆè‡ªåŠ¨æºå¸¦cookie promise.raceåŸç† webpackæ€§èƒ½ä¼˜åŒ– webpackçš„loaderæ‰§è¡Œé¡ºåºä»¥åŠä¸ºä»€ä¹ˆï¼Ÿ è¯´ä¸€è¯´loaderå’Œplugin å†™è¿‡loaderå’Œpluginå— è¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³» jsæ˜¯å•çº¿ç¨‹çš„ï¼Œnodeä¸ºä»€ä¹ˆé€‰æ‹© è¯´ä¸€ä¸‹mixin nuxtæ¸²æŸ“åŸç† nuxtæ¸²æŸ“ä¼šé‡æ–°ç”Ÿæˆè™šæ‹Ÿdomå— nuxtçš„QPS nuxtæ¸²æŸ“æ—¶é—´ vueçš„computedåŸç† vueç»„ä»¶é€šä¿¡ æ€ä¹ˆåšæ€§èƒ½ç›‘æ§çš„ æ€ä¹ˆåšé”™è¯¯å¤„ç†å’Œä¸ŠæŠ¥çš„ çŸ¥é“å…¬å¸å…·ä½“ç”¨æˆ·æ•°æ®å— æ€ä¹ˆå‘ç°æŸäº›bugå½±å“åˆ°äº†ç”¨æˆ·ä½¿ç”¨ï¼Œç„¶åå¦‚ä½•è§£å†³çš„ åç«¯å¦‚æœç©ºæŒ‡é’ˆä½ æ€ä¹ˆå¤„ç†çš„ ç™½å±é—®é¢˜æ€ä¹ˆè§£å†³çš„ ä½ æ˜¯å¦‚ä½•ç¦æ­¢æ»šåŠ¨æ¡çš„ æ€ä¹ˆåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ä¸€æ · webpackç†Ÿæ‚‰å—ï¼Ÿloaderå’Œpluginä½ æ€ä¹ˆç†è§£çš„ æ€ä¹ˆåšåˆ°äº§å“é«˜å¯ç”¨ ä»»ä½•è¡¡é‡ç”¨æˆ·ä½“éªŒæŒ‡æ ‡ ä½ åœ¨å…¬å¸å°è±¡æœ€æ·±åˆ»çš„é—®é¢˜æˆ–è€…è‡ªè±ªçš„åœ°æ–¹ ä½ æœ‰ä»€ä¹ˆæƒ³é—®æˆ‘çš„ï¼Ÿ è¯´ä¸€è¯´ç»§æ‰¿ å¦‚ä½•è®¾è®¡ä¸‹æ‹‰æ¡† å¦‚ä½•æé«˜é¦–å±æ•ˆç‡ webpackä¼˜åŒ– git mergeå’Œgit rebaseåŒºåˆ« gitæ€ä¹ˆå›æ»šä»£ç  æµå¼å¸ƒå±€ remåŸç† æ€»ç»“ä¸€ä¸‹ï¼š HTTPçš„å¿…é—®ï¼Œä½†æ˜¯ä¸‰æ¬¡æ¡æ‰‹è¿™ç§æ²¡é—®è¿‡ï¼Œä¼šé—®HTTPç¼“å­˜ã€HTTPSã€1.0 1.1 2.0åŒºåˆ«å’Œéƒ¨åˆ†åŸç† webpackå¿…é—®ï¼Œä¸ä»…é™ ç†è§£å’Œå†™loaderå’Œpluginã€webpackä¼˜åŒ– å¦‚æœä½ æ˜¯VueæŠ€æœ¯æ ˆï¼Œé‚£åŒå‘æ•°æ®ç»‘å®šçš„åŸç†ã€è™šæ‹ŸDOMã€Diffç®—æ³•ã€ç»„ä»¶é€šä¿¡ã€conputedåŸç†ã€å°è£…ç»„ä»¶å¤§æ¦‚ç‡éƒ½ä¼šé—® promiseå‡ºåœºç‡ä¹Ÿå¾ˆé«˜ï¼Œæœ‰å¯èƒ½éœ€è¦ä½ æ‰‹å†™ æµè§ˆå™¨æ¸²æŸ“åŸç†å»ºè®®å¤šçœ‹çœ‹ï¼Œç»å¸¸é—®è¾“å…¥URLå‘ç”Ÿäº†ä»€ä¹ˆ å¦‚æœæåˆ°Nodeï¼Œé‚£å»ºè®®ä½ å»çœ‹çœ‹Nodeæ·±å…¥æµ…å‡ºNode.jsï¼Œå¯èƒ½æ¶‰åŠåˆ°é”™è¯¯å¤„ç†ã€requireåŸç†ã€pm2åŸç†ã€æ€ä¹ˆå¼€å¤šè¿›ç¨‹ã€å¤šè¿›ç¨‹ç«¯å£å†²çªé—®é¢˜ å¦‚æœæåˆ°Koaï¼Œé‚£å¿…ç„¶ä¼šè¯´åˆ°æ´‹è‘±æ¨¡å‹ï¼Œæ‰§è¡Œé¡ºåº å®æ“é¢˜ ç¼–å†™ä»£ç ï¼šæ‰‹å†™ä¸€ä¸ªé‡è¯•å‡½æ•°ï¼Œretry(fnPromise,count);counté‡è¯•æ¬¡æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„promise æ‰‹å†™es5ã€es6ç»§æ‰¿ æ‰‹å†™æ·±æ‹·è´ æ‰‹å†™é˜²æŠ– æ‰‹å†™promise flexå¸ƒå±€ï¼Œæœ‰ä¸‰ä¸ªdivï¼Œ1é å·¦ 3 é æœ€å³ 2 åœ¨1çš„ä¸‹é¢ æ‰‹å†™å°è£…Vueç»„ä»¶ csså®ç°ç¯å½¢è¿›åº¦æ¡ æå–queryå‚æ•°å¹¶è§£æ è¿˜æœ‰å¥½å‡ ä¸ªæœ‰ç‚¹å¿˜è®°äº† ç®—æ³•é¢˜ 50ä¸ªäººï¼Œ30ä¸ªä¼šjava 40ä¸ªä¼šå‰ç«¯ï¼Œ38ä¸ªä¼šappï¼Œé—®å­˜åœ¨ä¸‰ä¸ªéƒ½ä¼šçš„æƒ…å†µå—ï¼Ÿ 100ä¸ªçƒï¼Œä¸¤ä¸ªäººæ‹¿ï¼Œæœ€å¤šä¸€æ¬¡æ‹¿1-5ä¸ªï¼Œä½ å…ˆæ‹¿ï¼Œæ€ä¹ˆæ§åˆ¶ä½ æœ€åæ‹¿ ç®—æ³•é¢˜ï¼Œabc acb åˆ¤æ–­æ˜¯å¦ä¸€æ ·ï¼Œå¯ä»¥äº¤æ¢ä½ç½®ï¼Œå¤æ‚åº¦åˆ†æ é“¾è¡¨åè½¬ æ±‚é“¾è¡¨çš„å€’æ•°ç¬¬Kä¸ªå€¼ å¤§æ•°ç›¸åŠ  ç”¨é€’å½’å®ç°æ•°ç»„åè½¬ï¼Œä¸èƒ½ä½¿ç”¨é¢å¤–å‚æ•°å’Œå˜é‡ é¢ï¼Œæ„Ÿè§‰è‡ªå·±åˆ·äº†ä¸€æ®µæ—¶é—´çš„LeetcodeåŸºæœ¬æ²¡ç”¨ä¸Šå•Šï¼ŒäºŒå‰æ ‘ä¸€ä¸ªæ²¡è€ƒå“ˆå“ˆğŸ˜„ğŸ˜„ï¼Œå‰‘æŒ‡offerå’ŒåŠ¨æ€è§„åˆ’ä¹Ÿåˆ·äº†ä¸å°‘ã€‚æ€»ç»“ä¸€ä¸‹é“¾è¡¨å¯èƒ½ä¼šè€ƒçš„ï¼š åè½¬é“¾è¡¨ æ±‚é“¾è¡¨çš„å€’æ•°ç¬¬Kä¸ªå€¼ åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Kä¸ªå€¼ åˆ¤æ–­é“¾è¡¨æ˜¯å¦æœ‰ç¯ åæ§½å’Œæ€è€ƒåæ§½&emsp;&emsp;ç¾å›¢ä¸€äºŒé¢éƒ½é¢äº†å¿«ä¸€ä¸ªåŠå°æ—¶ï¼ŒèŠå¾—ä¹Ÿå¾ˆæ„‰å¿«ï¼Œé¢è¯•å®˜çš„åé¦ˆä¹Ÿä¸é”™ï¼Œç¾å›¢ä¸‰é¢åªé¢è¯•äº†20-30åˆ†é’Ÿï¼ŒèŠå¾—ä¸æ˜¯å¾ˆæ„‰å¿«ï¼Œæ„Ÿè§‰é¢è¯•å®˜æœ‰ç‚¹å…ˆå…¥ä¸ºä¸»ï¼Œå¯èƒ½å› ä¸ºæˆ‘ä¸æ˜¯ç§‘ç­å‡ºèº«å§ï¼Œé—®äº†å‡ ä¸ªé—®é¢˜æ„Ÿè§‰åƒèµ°è¿‡åœºï¼Œæœ‰ç‚¹ä¸ºéš¾äººï¼Œåé¢è¿˜è·Ÿæˆ‘è¯´å‰ç«¯å…¥é—¨å®¹æ˜“ï¼Œå§å•¦å§å•¦ã€‚ã€‚ã€‚è¿™æˆ‘ä¸åé©³ï¼Œä¸»è¦æ˜¯ç»™æˆ‘çš„æ„Ÿè§‰å°±åƒæœ‰ç‚¹ç§ä¸èµ·äººï¼Ÿè¯´å®Œé—®æˆ‘JSæœ€å¤§å€¼æ˜¯å¤šå°‘ï¼Œæˆ‘è¯´2^53-1ï¼Œä»–è¯´ä¸ºä»€ä¹ˆï¼Œæˆ‘è§£é‡Šäº†å› ä¸ºIEEE754æµ®ç‚¹æ•°äºŒè¿›åˆ¶è¡¨ç¤ºæ³•ï¼Œä½¿ç”¨çš„æ˜¯åŒç²¾åº¦ï¼Œç„¶åç»§ç»­é—®æˆ‘è¿™äº›çŸ¥è¯†æ˜¯ä»å“ªå­¦çš„ï¼Œå•Šè¿™ï¼Œé˜¿sirä¸æ˜¯å§ï¼Œæ„Ÿè§‰æˆ‘ç»™äººæ„Ÿè§‰å°±åº”è¯¥ä¸çŸ¥é“å‘—ï¼Œé¢å®Œç»™æˆ‘çš„æ„Ÿè§‰çœŸçš„å¾ˆå·®åŠ²ï¼ï¼ï¼ æ€è€ƒ&emsp;&emsp;å‰ç«¯ç®—æ³•é¢˜è€ƒçš„è¿˜æ˜¯æ¯”è¾ƒå°‘çš„ï¼Œé¢è¯•é™¤äº†è€ƒåŸºç¡€ä¹‹å¤–ï¼Œæ›´åŠ å…³å¿ƒä½ æ€ä¹ˆå¤„ç†é”™è¯¯ï¼Œæ€ä¹ˆæ”¶é›†è¿™ä¸ªè¿‡ç¨‹ï¼Œæ€ä¹ˆè¡¡é‡æŒ‡æ ‡å¯¹äº§å“çš„å½±å“ï¼Œå¦å¤–æ•°æ®å¾ˆé‡è¦ï¼Œéœ€è¦æœ‰æ•°æ®æ¥æ”¯æ’‘ä½ çš„ç»“è®ºï¼Œè€Œä¸æ˜¯è‚‰çœ¼æ„Ÿå®˜çš„ã€‚å¦å¤–é¢è¯•å·²ç»å¼€å§‹é—®Vue3.0äº†ï¼Œä¸€æ–¹é¢é¢è¯•å®˜è€ƒå¯Ÿä½ æ˜¯å¦çƒ­è¡·æŠ€æœ¯ï¼Œè¿½æ±‚æ–°æŠ€æœ¯ï¼Œå¦ä¸€æ–¹é¢è€ƒå¯Ÿä½ çš„ç†è§£èƒ½åŠ›ï¼Œä¸ºä»€ä¹ˆè¦ç”¨å®ƒï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚&emsp;&emsp;ç®€å†ä¸Šå°½å¯èƒ½å†™ä½ ä¼šçš„ï¼Œä¸è¦å­¦äº†ä¸€ç‚¹è¿è¡Œäº†ä¸€ä¸‹Demoå°±å¾€ä¸Šå†™ï¼Œé¢è¯•å®˜ä¸äº†è§£ä½ ï¼Œåªèƒ½ä»ç®€å†ä¸Šå»æ·±æŒ–ä½ çš„æŠ€æœ¯èƒ½åŠ›ï¼Œæœ€å¥½ä¸è¦æŠŠæ²¡æœ‰åšçš„äº‹æƒ…è¯´è‡ªå·±åšäº†ï¼Œåˆ°æ—¶å€™é—®åˆ°ä½ å¤§å®¶éƒ½å¾ˆå°´å°¬ï¼Œå°½å¯èƒ½æŠŠé¢è¯•å®˜å¼•å¯¼åˆ°ä½ æ“…é•¿çš„åœ°æ–¹ï¼Œæ¯”å¦‚ä½ çœ‹äº†Vueçš„æºç ï¼Œé‚£ä½ å¯ä»¥ç§€ä¸€ä¸‹ã€‚å°½å¯èƒ½çš„å¤šè¯´ï¼Œä¸€ä¸ªå°çš„é—®é¢˜ä½ çœ‹å¾—æ¯”åˆ«äººè¿œï¼Œè¿™å°±æ˜¯ä½ çš„ä¼˜åŠ¿ï¼Œæ¯”å¦‚é¢è¯•å®˜é—®ä½ ï¼šå¦‚æœåˆ¤æ–­ä¸€ä¸ªå˜é‡çš„ç±»å‹ï¼Œé¢ğŸ¤”ï¼Œç›´æ¥ Object.prototype.toString.call() ï¼Œå¥½åƒæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ä½ å¯ä»¥æ¥ç€è¯´ï¼Œå¦‚æœæƒ³åˆ¤æ–­æ•°ç»„å¯ä»¥ä½¿ç”¨Array.isArray()ï¼Œè¿˜æœ‰å°±æ˜¯ä¹‹å‰åˆ¤æ–­ç±»å‹æ˜¯ä¸å‡†çš„ï¼Œä½¿ç”¨Object.prototype.toString.callé€šå¸¸å¯ä»¥è·å–åˆ°ç‰¹å®šçš„ç±»å‹æ ‡ç­¾ï¼Œä¸ºä»€ä¹ˆèƒ½è®¿é—®ï¼Œæ˜¯å› ä¸ºjså†…ç½®äº†toStringTagï¼ˆSymbol.toStringTagï¼‰ï¼Œå³ä¾¿æ²¡æœ‰ toStringTag å±æ€§ï¼Œä¹Ÿèƒ½è¢« toString() æ–¹æ³•è¯†åˆ«å¹¶è¿”å›ç‰¹å®šçš„ç±»å‹æ ‡ç­¾ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ªé€ ï¼š12let obj = &#123;[Symbol.toStringTag]: 'foo', a: 1&#125;Object.prototype.toString.call(obj); // [object foo] ç„¶åä½ å¯ä»¥ç»§ç»­è¯´ä½ æ˜¯é€šè¿‡çœ‹Koaçš„æºç å­¦ä¹ åˆ°çš„ï¼Œé‡Œé¢ä¾èµ–äº†ä¸€ä¸ªåŒ… is-generator-function åšäº†ç‰¹æ®Šçš„å¤„ç†ï¼Œä½ çœ‹è¿™æ ·å›ç­”ä¸‹æ¥è¿™ä¸ªé—®é¢˜æ˜¯ä¸æ˜¯æ›´å¥½ä¸€ç‚¹ï¼Ÿï¼ˆå½“ç„¶è¿™æ˜¯æˆ‘çš„ç»å†ï¼‰è™½ç„¶å ç”¨ä¸€ç‚¹æ—¶é—´ï¼Œä½†æ˜¯è®©é¢è¯•å®˜è§‰å¾—ä½ æ˜¯ä¸€ä¸ªå¥½å­¦çš„äººï¼Œèƒ½åšå¾—æ›´å¥½ä¸æ˜¯ï¼Ÿ æœ€åæœ€åæ‹¾äººç‰™æ…§ä¸€æ³¢ï¼Œè¦æœ‰æ•¬ç•ä¹‹å¿ƒï¼Œè¦æŠŠè‡ªå·±å‘å¾®åˆ°å°˜åŸƒï¼Œå¹¿ç§¯ç²®ã€é«˜ç­‘å¢™ã€ç¼“ç§°ç‹ã€‚é€‰æ‹©ä¸€ä¸ªæ–¹å‘ï¼Œå†²å°±å®Œäº‹äº†ï¼ï¼ï¼]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>é¢è¯•</tag>
        <tag>åŸåˆ›</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç¼–å†™ä¸€ä¸ªè¾ƒä¸ºå¼ºå¤§çš„Vue]]></title>
    <url>%2F2020%2F05%2F26%2Fwrite-euv%2F</url>
    <content type="text"><![CDATA[ç¼–å†™ä¸€ä¸ªè¾ƒä¸ºå¼ºå¤§çš„Vueï¼Œæ”¯æŒè™šæ‹ŸDOMã€diffæ›´æ–°ä»¥åŠåŸºæœ¬çš„APIï¼Œé¡¹ç›®åœ°å€ï¼šhttps://github.com/wclimb/euvdemoåœ°å€ï¼šhttp://www.wclimb.site/euv/ euvwhy euv? because:1'vue'.split('').sort().join('') // euv source:1'node'.split('').sort().join('') // deno Quick Startå®‰è£…123git clone https://github.com/wclimb/euv.gitcd euvnpm install è¿è¡Œ1npm run dev ç›®å‰æ”¯æŒåŠŸèƒ½ âœ… è™šæ‹ŸDOM âœ… Diffæ›´æ–° âœ… {{data}} or {{data + 'test'}} or {{fn(a)}} âœ… v-for // v-for=&quot;(item, index) in list&quot; or v-for=&quot;(item, index) in 10&quot; or v-for=&quot;(item, index) in &#39;string&#39;&quot; âœ… v-if v-else-if v-else âœ… v-show âœ… v-html âœ… v-model âœ… @click v-on:click äº‹ä»¶(æ”¯æŒç»‘å®šå…¶ä»–äº‹ä»¶) @click=&quot;fn(&#39;a&#39;,$event)&quot; @click=&quot;fn&quot; @click=&quot;show = false&quot; @click=&quot;function(){console.log(1)}&quot; âœ… methods æ–¹æ³• âœ… computed è®¡ç®—å±æ€§ âœ… watch ç›‘å¬ âœ… beforeCreateã€createdã€beforeMountã€mountedã€beforeUpdateã€updated âœ… :class âœ… :style âœ… $nextTick è¡¥å……è™šæ‹Ÿdom ä¸æ‡‚çš„å¯ä»¥çœ‹çœ‹æˆ‘ä¹‹å‰å‘çš„æ–‡ç« (ç›¸å…³ä»£ç ç›¸æ¯”ç°åœ¨æœ‰éƒ¨åˆ†æ”¹åŠ¨)ï¼šhttp://www.wclimb.site/2020/03/19/simple-virtual-dom/]]></content>
      <categories>
        <category>javascript</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>vue</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç¼–å†™ä¸€ä¸ªwebpack]]></title>
    <url>%2F2020%2F04%2F22%2Fsimple-webpack%2F</url>
    <content type="text"><![CDATA[å®ç°åŠŸèƒ½ æ”¯æŒ esModule æ”¯æŒ import() å¼‚æ­¥åŠ è½½æ–‡ä»¶ æ”¯æŒ loader å‡†å¤‡å·¥ä½œæˆ‘ä»¬éœ€è¦å€ŸåŠ© babel æ¥è§£æï¼Œå…ˆ npm init -y1npm i @babel/parser @babel/traverse @babel/core @babel/preset-env -D æœ€ç»ˆçš„æ–‡ä»¶ç›®å½•ç»“æ„12345678910111213141516|-- dist // æ‰“åŒ…ç›®æ ‡æ–‡ä»¶å¤¹ | |-- 0.bundle.js | |-- 1.bundle.js | |-- result.js |-- src // é¡¹ç›®æµ‹è¯•ä»£ç  | |-- entry.js | |-- messgae.js | |-- name.js | |-- a.js | |-- b.js |-- index.html // åŠ è½½æ–‡ä»¶æ‰“åŒ…å‡ºçš„æ–‡ä»¶ |-- app.js // å¯åŠ¨æ–‡ä»¶ |-- init.js // æ‰“åŒ…é¡¹ç›®éœ€è¦çš„åˆå§‹åŒ–ä»£ç |-- babel-plugin.js // babelæ’ä»¶|-- loader.js // loader|-- package.json æ–‡ä»¶å†…å®¹entry.js12345import message from "./message.js";console.log(message);import("./a.js").then(() =&gt; &#123; console.log("a done");&#125;); message.js12345import &#123; name &#125; from "./name.js";export default `hello $&#123;name&#125;!`;import("./a.js").then(() =&gt; &#123; console.log("copy a done");&#125;); name.js1234export const name = "world";import("./b.js").then(() =&gt; &#123; console.log("b done");&#125;); a.js1234console.log("import a");setTimeout(() =&gt; &#123; document.body.style = "background:red;";&#125;, 3000); b.js1console.log("import b"); ç¼–å†™æˆ‘åœ¨ä¹‹å‰å†™çš„ webpackç³»åˆ—ä¹‹è¾“å‡ºæ–‡ä»¶åˆ†æ æ–‡ç« è¯´è¿‡ï¼Œwebpackæ‰“åŒ…å‡ºæ¥çš„ä»£ç å¤§è‡´çš„æ ·å­æ˜¯ğŸ‘‡1234567891011(function(modules) &#123; function __webpack_require__(moduleId) &#123; ... &#125; ... return __webpack_require__(__webpack_require__.s = "./src/main.js");&#125;)(&#123; "./src/a.js": (function(module, __webpack_exports__, __webpack_require__) &#123;&#125; "./src/b.js": (function(module, __webpack_exports__, __webpack_require__) &#123;&#125; "./src/main.js": (function(module, __webpack_exports__, __webpack_require__) &#123;&#125;&#125;) å€Ÿé‰´ä»–çš„æ€è·¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå¿«å†™å‡ºæ¥ä¸€ä¸ªç®€å•çš„ webpackï¼Œé¦–å…ˆ (function(modules) {...}) å†…éƒ¨çš„ä»£ç åŸºæœ¬ä¸Šå¯ä»¥å†™æ­»ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç­‰ä¼šéœ€è¦å†™çš„ init.jsï¼Œæ¥ç€çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªè‡ªæ‰§è¡Œçš„å‡½æ•°ï¼Œ ä¼ å…¥çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé¦–å…ˆæ‰§è¡Œçš„æ˜¯ä¸»å…¥å£çš„æ–‡ä»¶ï¼Œç„¶åå†åˆ†åˆ«å»æ‰¾ä»–ä»¬çš„ä¾èµ–å»æ‰§è¡Œç›¸åº”çš„æ–‡ä»¶ã€‚ çƒ­èº«æˆ‘ä»¬è¿™é‡Œå€ŸåŠ©bableæ¥ç¼–è¯‘ä»£ç å…ˆç®€å•çœ‹ä¸€ä¸‹ğŸ‘‡è¿™ä¸ªç¤ºä¾‹1234567891011121314151617181920212223242526272829303132333435const fs = require("fs");const path = require("path");const parser = require("@babel/parser");const traverse = require("@babel/traverse").default;const babel = require("@babel/core");let id = 0;const resolve = function(filename) &#123; let content = ""; content = fs.readFileSync(path.resolve(__dirname, filename), "utf-8"); // è½¬astæ ‘ const ast = parser.parse(content, &#123; sourceType: "module", &#125;); // ä¾èµ– const dependencies = []; traverse(ast, &#123; ImportDeclaration(&#123; node &#125;) &#123; // import '' from '' dependencies.push(node.source.value); &#125;, &#125;); // ES6è½¬æˆES5 const &#123; code &#125; = babel.transformFromAstSync(ast, null, &#123; presets: ["@babel/preset-env"], &#125;); return &#123; id: id++, dependencies, filename, code, &#125;;&#125;;const result = resolve("./src/entry.js");console.log(result); æ‰“å°ç»“æœ12345&#123; id: 0, dependencies: [ './message.js' ], filename: './src/entry.js', code: '"use strict";\n\nvar _message = _interopRequireDefault(require( ....."&#125; æˆ‘ä»¬è¿™é‡Œè§£æäº†ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ babel è½¬æˆ astï¼ŒImportDeclaration æ‹¦æˆªåˆ° importï¼Œå°†å®ƒæ·»åŠ åˆ° dependencies ä¾èµ–å†…ï¼Œå¤„ç†å®Œ importåæŠŠä»£ç è½¬æˆ es5ï¼Œæœ€åè¾“å‡ºå¯¹è±¡ï¼ŒåŒ…å«å½“å‰çš„æ–‡ä»¶çš„idï¼Œä¾èµ–å…³ç³»ï¼Œæ–‡ä»¶åï¼Œä»¥åŠç¼–è¯‘åçš„æºä»£ç ã€‚è¿™æ®µä»£ç æ˜¯æ•´ç¯‡çš„ç²¾é«“ï¼Œä¸è¿‡ç°åœ¨åªå¤„ç†äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬åˆšåˆšæ‰¾åˆ°äº†å½“å‰æ–‡ä»¶çš„ä¾èµ–ï¼Œæ¥ç€éœ€è¦é€’å½’æŸ¥æ‰¾ä¸‹ä¸€ä¸ªæ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼Œæœ€åæŠŠä»–ä»¬ç»„åˆèµ·æ¥ï¼Œè·Ÿä¹‹å‰çœ‹ webpack è¾“å‡ºçš„æ–‡ä»¶æ€æƒ³å·®ä¸å¤šã€‚ é€’å½’æŸ¥æ‰¾æ‰€æœ‰ä¾èµ–åœ¨ä¸‹é¢æ·»åŠ ä»¥ä¸‹ä»£ç ğŸ‘‡ï¼Œé¡ºä¾¿åˆ é™¤æœ€åä¸¤è¡Œ const result = resolve(&quot;./src/entry.js&quot;); console.log(result);1234567891011121314151617const start = function(filename) &#123; const entry = resolve(filename); const queue = [entry]; for (const asset of queue) &#123; const dependencies = asset.dependencies; const dirname = path.dirname(asset.filename); asset.mapping = &#123;&#125;; dependencies.forEach((val) =&gt; &#123; const result = resolve(path.join(dirname, val)); asset.mapping[val] = result.id; queue.push(result); &#125;); &#125; return queue;&#125;;const fileDependenceList = start("./src/entry.js");console.log(fileDependenceList); æ‰§è¡Œåç»“æœï¼Œæˆ‘ä»¬æ‹ä¸€æ‹å…¥å£ entry.js import ğŸ‘‰ message.jsmessage.js import ğŸ‘‰ name.jsname.js æ²¡æœ‰ import åˆ«çš„æ–‡ä»¶æ‰€ä»¥ä¾èµ–æ˜¯ç©ºçš„1234567891011121314151617181920[ &#123; id: 0, dependencies: [ './message.js' ], filename: './src/entry.js', code: '"use strict";\n\nvar _message = _interopRequireDefault(require( ....."' &#125;, &#123; id: 1, dependencies: [ './name.js' ], filename: 'src/message.js', code: '"..."' &#125;, &#123; id: 2, dependencies: [], filename: 'src/name.js', code: '"..."' &#125;,] ç»“æœæˆ‘ä»¬å¾—åˆ°äº†ï¼Œç›®å‰è¿˜ä¸æ˜¯ä¹‹å‰æƒ³è¦çš„é‚£ä¸ªç»“æ„ï¼Œç»§ç»­æ·»åŠ ä»¥ä¸‹ä»£ç 1234567891011let moduleStr = "";fileDependenceList.forEach((value) =&gt; &#123; moduleStr += `$&#123;value.id&#125;:[ function(require, module, exports) &#123; $&#123;value.code&#125;; &#125;, $&#123;JSON.stringify(value.mapping)&#125; ],`;&#125;);const result = `($&#123;fs.readFileSync("./init.js", "utf-8")&#125;)(&#123;$&#123;moduleStr&#125;&#125;)`;fs.writeFileSync("./dist/result.js", result); // æ³¨æ„è¿™é‡Œéœ€è¦æœ‰distæ–‡ä»¶å¤¹ è¿™é‡ŒæŠŠ init.js å¼•å…¥äº†ï¼Œå†…å®¹å¦‚ä¸‹12345678910111213function init(modules) &#123; function require(id) &#123; var [fn, mapping] = modules[id]; function localRequire(relativePath) &#123; return require(mapping[relativePath]); &#125; var module = &#123; exports: &#123;&#125; &#125;; fn(localRequire, module, module.exports); return module.exports; &#125; //æ‰§è¡Œå…¥å£æ–‡ä»¶ï¼Œ return require(0);&#125; æ‰§è¡Œä¹‹ååœ¨ dist/ ä¸‹æœ‰ä¸€ä¸ª result æ–‡ä»¶ï¼Œæˆ‘ä»¬æ”¾åˆ°æµè§ˆå™¨å»æ‰§è¡Œï¼Œindex.html åŠ è½½ 1234567891011&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt; &lt;head&gt; &lt;meta charset="UTF-8" /&gt; &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt; &lt;title&gt;webpack&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;script src="./dist/result.js"&gt;&lt;/script&gt; &lt;/body&gt;&lt;/html&gt; ä¸å‡ºæ„å¤–æ§åˆ¶å°è¾“å‡º hello worldï¼Œæ¥ç€ä¼šæœ‰ä¸‰ä¸ªæŠ¥é”™ï¼Œæ²¡é”™ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å¤„ç† import().then() è¿™ç§ä»£ç ï¼Œè¿™ä¸ªéœ€è¦å•ç‹¬å¤„ç†ï¼Œå¦‚æœä½ æƒ³æŠŠé”™è¯¯å»æ‰ï¼Œå» src æ–‡ä»¶å¤¹æŠŠ import() éƒ½æ³¨é‡Šå°±å®Œäº‹äº†ã€‚ ä½ å»çœ‹ result çš„ä»£ç å†…å®¹ï¼Œä¼šå‘ç°ä»£ç æˆ‘ä»¬é¦–å…ˆæ‰§è¡Œ require(0)ï¼Œä»å…¥å£è§¦å‘ï¼Œç„¶åé€’å½’è°ƒç”¨ require æ¥å®Œæˆæ•´ä¸ªæµç¨‹ï¼Œçœ‹æˆ‘ä»¬ä¹‹å‰ moduleStr è¾“å‡ºçš„ä»£ç ï¼Œç»“æ„è·Ÿ webpack è¾“å…¥çš„æœ‰ç‚¹åŒºåˆ«ï¼Œæ€è·¯å·®ä¸å¤š1234567891011121314&#123; 0: [ function(require, module, exports) &#123; var _message = _interopRequireDefault(require("./message.js")); function _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;; &#125; console.log(_message["default"]); &#125;, &#123; "./message.js": 1 &#125;, ], 1: [function(require, module, exports) &#123; ... &#125;, &#123; "./name.js": 2 &#125;], 2: [function(require, module, exports) &#123; ... &#125;, &#123;&#125;],&#125; æˆ‘ä»¬ require éƒ½æ˜¯å½“å‰æ–‡ä»¶çš„ idï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹å†…éƒ¨æœ‰ä¸€æ®µ require(&quot;./message.js&quot;) ï¼Œå…¶å®å®ƒæ‰§è¡Œçš„æ˜¯ localRequire æ–¹æ³•ï¼Œé€šè¿‡å½“å‰æ–‡ä»¶æ•°ç»„çš„ç¬¬äºŒä¸ªå€¼ { &quot;./message.js&quot;: 1 } æ¥å®šä½å®ƒè¦æ‰§è¡Œçš„ id æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œçš„ id æ˜¯1ï¼Œä¸‹é¢å°±æ˜¯å®ƒçš„é€»è¾‘ï¼Œé€šè¿‡æ–‡ä»¶åfilenameï¼Œå»æŸ¥æ‰¾ mapping å¯¹åº”çš„ idã€‚1234var [fn, mapping] = modules[id];function localRequire(relativePath) &#123; return require(mapping[relativePath]);&#125; æ”¯æŒ import() å¼‚æ­¥åŠ è½½é¦–å…ˆå…ˆæ¥è§£é‡Šä»¥ä¸‹å¦‚ä½•å¼‚æ­¥åŠ è½½ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç”Ÿæˆ 0.bundle.js 1.bundle.jsè¿™æ ·çš„æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ document.createElement(&quot;script&quot;) æŠŠå®ƒ push åˆ°é¡µé¢çš„ head å†…å®ŒæˆåŠ è½½ã€‚ä¿®æ”¹babeléƒ¨åˆ†123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354....+ let bundleId = 0;+ const installedChunks = &#123;&#125;;const resolve = function(filename) &#123; let content = ""; content = fs.readFileSync(path.resolve(__dirname, filename), "utf-8"); const ast = parser.parse(content, &#123; sourceType: "module", &#125;); const dependencies = []; traverse(ast, &#123; ImportDeclaration(&#123; node &#125;) &#123; // import '' from '' dependencies.push(node.source.value); &#125;,+ CallExpression(&#123; node &#125;) &#123;+ // import()+ if (node.callee.type === "Import") &#123;+ const realPath = path.join(+ path.dirname(filename),+ node.arguments[0].value+ );+ if (installedChunks[realPath] !== undefined) return;+ let sourse = fs.readFileSync(realPath, "utf-8");+ // è½¬es5+ const &#123; code &#125; = babel.transform(sourse, &#123;+ presets: ["@babel/preset-env"]+ &#125;);+ sourse = `jsonp.load([$&#123;bundleId&#125;, function()&#123;$&#123;code&#125;&#125;])`;+ fs.writeFileSync(`./dist/$&#123;bundleId&#125;.bundle.js`, sourse);+ installedChunks[realPath] = bundleId;+ bundleId++;+ process.installedChunks = &#123;+ nowPath: path.dirname(filename),+ ...installedChunks,+ &#125;;+ &#125;+ &#125;, &#125;); // ES6è½¬æˆES5 const &#123; code &#125; = babel.transformFromAstSync(ast, null, &#123;+ plugins: ["./babel-plugin.js"], presets: ["@babel/preset-env"], &#125;); return &#123; id: id++, dependencies, filename, code, &#125;;&#125;;... æˆ‘ä»¬çœ‹åˆ°ä¸Šé¢æˆ‘ä»¬æ–°å¢ä½¿ç”¨ babel æ’ä»¶ plugins: [&quot;./babel-plugin.js&quot;]ï¼Œä¸æ‡‚çš„å¯ä»¥çœ‹babel-handbook babel-plugin.js123456789101112131415161718192021222324252627282930const nodePath = require("path");module.exports = function(&#123; types: t &#125;) &#123; return &#123; visitor: &#123; CallExpression(path) &#123; if (path.node.callee.type === "Import") &#123; path.replaceWith( t.callExpression( t.memberExpression( t.identifier("require"), t.identifier("import") ), [ t.numericLiteral( process.installedChunks[ nodePath.join( process.installedChunks["nowPath"], path.node.arguments[0].value ) ] ), ] ) ); &#125; &#125;, &#125;, &#125;;&#125;; ä¸Šé¢æ’ä»¶çš„åŠŸèƒ½å°±æ˜¯æŠŠ import(&#39;./a.js&#39;) è½¬æˆ require.import(0) ä¿®æ”¹ init.jsï¼Œä¸»è¦æ˜¯æ–°å¢ import æ–¹æ³•ï¼Œå€Ÿé‰´è‡ª webpack12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879function init(modules) &#123; function require(id) &#123; var [fn, mapping] = modules[id]; function localRequire(relativePath) &#123; return require(mapping[relativePath]); &#125; var module = &#123; exports: &#123;&#125; &#125;; localRequire.import = require.import; // æ–°å¢ fn(localRequire, module, module.exports); return module.exports; &#125; var installedChunks = &#123;&#125;; // å½“å‰æ–°å¢ require.import = function(chunkId) &#123; // å½“å‰æ–°å¢ var promises = []; var installedChunkData = installedChunks[chunkId]; // å¦‚æœæ²¡æœ‰åŠ è½½ if (installedChunkData !== 0) &#123; if (installedChunkData) &#123; promises.push(installedChunkData[2]); &#125; else &#123; var promise = new Promise(function(resolve, reject) &#123; installedChunkData = installedChunks[chunkId] = [resolve, reject]; &#125;); promises.push((installedChunkData[2] = promise)); // start chunk loading var script = document.createElement("script"); var onScriptComplete; script.charset = "utf-8"; script.src = "dist/" + chunkId + ".bundle.js"; var error = new Error(); onScriptComplete = function(event) &#123; // avoid mem leaks in IE. script.onerror = script.onload = null; clearTimeout(timeout); var chunk = installedChunks[chunkId]; if (chunk !== 0) &#123; if (chunk) &#123; var errorType = event &amp;&amp; (event.type === "load" ? "missing" : event.type); var realSrc = event &amp;&amp; event.target &amp;&amp; event.target.src; error.message = "Loading chunk " + chunkId + " failed.\n(" + errorType + ": " + realSrc + ")"; error.name = "ChunkLoadError"; error.type = errorType; error.request = realSrc; chunk[1](error); &#125; installedChunks[chunkId] = undefined; &#125; &#125;; var timeout = setTimeout(function() &#123; onScriptComplete(&#123; type: "timeout", target: script &#125;); &#125;, 120000); script.onerror = script.onload = onScriptComplete; document.head.appendChild(script); &#125; &#125; return Promise.all(promises); &#125;; window.jsonp = &#123;&#125;; // å½“å‰æ–°å¢ jsonp.load = function(bundle) &#123; // å½“å‰æ–°å¢ var chunkId = bundle[0]; var fn = bundle[1]; var resolve = installedChunks[chunkId][0]; installedChunks[chunkId] = 0; // æ‰§è¡Œå¼‚æ­¥åŠ è½½æ–‡ä»¶ä»£ç  fn(); // æ‰§è¡Œresolve resolve(); &#125;; //æ‰§è¡Œå…¥å£æ–‡ä»¶ï¼Œ return require(0);&#125; æˆ‘ä»¬å¼‚æ­¥åŠ è½½çš„æ–‡ä»¶éƒ½ä¼šæ‰§è¡Œ jsonp.load æ–¹æ³•ï¼Œï¼Œåœ¨ç”Ÿæˆæ–‡ä»¶ *.bunnd.js ä¹‹å‰éƒ½ä¼šæŠŠä»£ç æ”¹è£…ä¸€ä¸‹ï¼Œå¾—åˆ°ä¸‹é¢çš„ç»“æ„ï¼Œè¿™æ ·å°±å¯ä»¥æ§åˆ¶æ‰§è¡Œæºä»£ç åŠ .then() .catch() ç­‰æ“ä½œäº†123456jsonp.load([ 0, function() &#123; // åŸæ–‡ä»¶ä»£ç  &#125;,]); ç„¶åæ‰§è¡Œï¼Œä½ ä¼šå‘ç° dist å¤šäº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œ0.bundle.js 1.bundle.jsï¼Œå‰ææ˜¯ä½ æ²¡æœ‰æ³¨é‡Šä¹‹å‰ import() å†™çš„ä»£ç ï¼Œç„¶åå»æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹ï¼Œåˆ†åˆ«æ‰“å°ä»¥ä¸‹ï¼Œæ¥ç€3ç§’åé¡µé¢èƒŒæ™¯å˜ä¸ºçº¢è‰²123456hello world!import bb doneimport acopy a donea done ç­‰ç­‰ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸‰ä¸ª importï¼Œä¸ºä»€ä¹ˆåªæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œå› ä¸ºæœ‰ä¸€ä¸ª import(&#39;./a.js&#39;) ä½¿ç”¨äº†ä¸¤æ¬¡ï¼Œè¿™é‡Œæˆ‘åšäº†ç¼“å­˜ï¼Œæ‰€ä»¥é‡å¤å¼‚æ­¥å¼•å…¥çš„æ–‡ä»¶ä¼šç¼“å­˜åˆ©ç”¨ æ”¯æŒloaderloader æ”¯æŒå¾ˆç®€å•ï¼Œå…¶å®å°±æ˜¯æŠŠæ–‡ä»¶çš„å†…å®¹äº¤ç»™å®ƒå•ç‹¬å¤„ç†è¿”å›æ–°çš„ç»“æœï¼Œæˆ‘ä»¬æ–°å»ºæ–‡ä»¶ loader.jsï¼Œå†…å®¹å¦‚ä¸‹ï¼š123module.exports = function(content) &#123; return content + "; console.log('loader')";&#125;; åœ¨æ¯ä¸ªjsæ–‡ä»¶åéƒ½åŠ ä¸Šæ‰“å°loaderçš„ä»£ç  æ¥ç€ä¿®æ”¹resolveæ–¹æ³•å†…çš„ä»£ç 12345678910+ const loader = require("./loader");const resolve = function(filename) &#123; let content = ""; content = fs.readFileSync(path.resolve(__dirname, filename), "utf-8");+ content = loader(content); const ast = parser.parse(content, &#123; sourceType: "module", &#125;); ....&#125; ç„¶åè¿è¡Œä»£ç ï¼Œæµè§ˆå™¨æ§åˆ¶å°ä¼šæ‰“å°æ˜¯ä¸‰ä¸ª loader æœ€åè‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº† esModule çš„æ”¯æŒï¼Œæ–‡ä»¶å¼‚æ­¥åŠ è½½çš„æ”¯æŒã€loader çš„æ”¯æŒï¼Œæˆ‘ä»¬é¡ºä¾¿è¿˜å†™äº†ä¸€ä¸ª babel æ’ä»¶ï¼Œæ•´ä¸ªæµç¨‹æ²¡æœ‰ä»€ä¹ˆéš¾ç†è§£çš„åœ°æ–¹ï¼Œä¸€ä¸ª webpack å°±è¿™æ ·å®Œæˆäº†ï¼Œå½“ç„¶è¿˜å¯ä»¥å†æŠŠåŠŸèƒ½å®Œå–„ã€‚æ”¯æŒæ’ä»¶ï¼ŸæŠŠ tapable åŠ å…¥ï¼Ÿç­‰ç­‰ï¼Œæ—¶é—´æœ‰é™ï¼Œç‚¹åˆ°ä¸ºæ­¢ï¼Œå¦‚æœ‰é”™è¯¯è¿˜æœ›æŒ‡æ­£ æœ¬ç« ä»£ç éƒ¨åˆ†å€Ÿé‰´ webpack è¾“å‡ºçš„ bundle åŠ You Gotta Love Frontend çš„è§†é¢‘ Ronen Amiel - Build Your Own Webpack ä»£ç å·²ä¸Šä¼ è‡³ GitHubï¼š https://github.com/wclimb/my-webpack æœ¬æ–‡åœ°å€ http://www.wclimb.site/2020/04/22/simple-webpack/ å…¬ä¼—å·]]></content>
      <categories>
        <category>javascript</category>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nodejsä¹‹è¿›ç¨‹]]></title>
    <url>%2F2020%2F04%2F15%2Fnode-process%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ¬æ–‡å¤§éƒ¨åˆ†å€Ÿé‰´è‡ªæ·±å…¥æµ…å‡ºNode.js æœ¬æ–‡å¼€å§‹è®²ä¸€ä¸‹ Node çš„è¿›ç¨‹ï¼ŒNode æ˜¯å»ºç«‹åœ¨ V8 å¼•æ“ä¹‹ä¸Šçš„ï¼Œç¨‹åºåŸºæœ¬ä¸Šæ˜¯è¿è¡Œåœ¨å•è¿›ç¨‹çš„å•çº¿ç¨‹ä¸Šçš„ï¼Œé‚£ä¹ˆè¿™æ ·å°±ä¼šå¯¼è‡´æœºå™¨çš„èµ„æºæ²¡æœ‰è¢«åˆç†çš„åˆ©ç”¨ï¼ŒCPU ä½¿ç”¨ç‡ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¤šå¼€è¿›ç¨‹ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸ CPU æœåŠ¡å™¨ï¼Œä½†æ˜¯å¤šå¼€è¿›ç¨‹åˆä¼šé¢ä¸´è¿›ç¨‹ç®¡ç†æ–¹é¢çš„é—®é¢˜ã€‚ä¸‹é¢æˆ‘ä»¬æ¥å…·ä½“è¯´è¯´ã€‚ å•çº¿ç¨‹ï¼Ÿæˆ‘ä»¬çŸ¥é“ JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼ŒNode ä¹Ÿæ˜¯ï¼Ÿï¼ŒNode å…¶å®ä¸æ˜¯ï¼ŒNode å¹¶éçœŸæ­£çš„å•çº¿ç¨‹æ¶æ„ï¼ŒNode è‡ªèº«è¿˜æœ‰ ä¸€å®šçš„ I/O çº¿ç¨‹å­˜åœ¨ï¼Œè¿™äº› I/O çº¿ç¨‹ç”±åº•å±‚ libuv å¤„ç†ï¼Œè¿™éƒ¨åˆ†çº¿ç¨‹å¯¹äº JavaScript å¼€å‘è€…è€Œè¨€æ˜¯é€æ˜çš„ï¼Œåªåœ¨ C++ æ‰©å±•å¼€å‘æ—¶æ‰ä¼šå…³æ³¨åˆ°ã€‚JavaScript ä»£ç æ°¸è¿œè¿è¡Œåœ¨ V8 ä¸Šï¼Œæ˜¯å•çº¿ç¨‹çš„ã€‚ åˆ›å»ºå¤šè¿›ç¨‹Node æä¾›äº†åˆ›å»ºè¿›ç¨‹çš„æ–¹æ³•ï¼Œchild_processï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ fork æ–¹æ³•ï¼Œå®ƒè¿˜æœ‰å…¶ä»–å‡ ä¸ªæ–¹æ³•è¿™é‡Œå°±ä¸ä½œä»‹ç»äº†master.js12345const fork = require("child_process").forkconst cpus = require('os').cpus();for (var i = 0; i &lt; cpus.length; i++) &#123; fork('./worker.js'); &#125; å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è·å–å½“å‰æœºå™¨çš„ cpu æ•°é‡ï¼Œç„¶åæ‰¹é‡åˆ›å»ºå­è¿›ç¨‹ï¼Œæˆ‘ä»¬æ–°å»º worker.jsï¼Œå†…å®¹å¦‚ä¸‹123456789const http = require("http");process.title = "worker";console.log(process.pid)http .createServer(function(req, res) &#123; res.writeHead(200, &#123; "Content-Type": "text/plain" &#125;); res.end("Hello World\n"); &#125;) .listen(Math.round((1 + Math.random()) * 1000); å¯åŠ¨1node master.js æ§åˆ¶å°æ‰“å°çš„pid1234567351153511635117351183511935120... 1234567891011 +--------+ | Master | &lt;------ master.js +--------+ / | \ / | \ / | \ &lt;----å¤åˆ¶ / | \ v v v+--------+ +--------+ +---------+| å·¥ä½œè¿›ç¨‹ | | å·¥ä½œè¿›ç¨‹ | | å·¥ä½œè¿›ç¨‹ | &lt;------ worker.js+--------+ +--------+ +---------+ å¤šè¿›ç¨‹é€šä¿¡è¿›ç¨‹é€šä¿¡ä½¿ç”¨ send è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚ä¸‹master -&gt; worker ä¼ é€’ä¿¡æ¯123456var fork = require("child_process").fork;var cpus = require("os").cpus();for (var i = 0; i &lt; cpus.length; i++) &#123; const worker = fork("./worker.js"); worker.send("helloï¼ŒI'm from master")&#125; workerå­è¿›ç¨‹æ¥æ”¶123process.on("message", function(message) &#123; console.log("worker accept:", message);&#125;); è¿è¡Œç»“æœå¦‚ä¸‹ï¼š123worker accept: helloï¼ŒI&apos;m from masterworker accept: helloï¼ŒI&apos;m from masterworker accept: helloï¼ŒI&apos;m from master worker -&gt; masterä¼ é€’ä¿¡æ¯worker å­è¿›ç¨‹å‘é€æ¶ˆæ¯1process.send("helloï¼ŒI'm from worker"); masteræ¥æ”¶12345678var fork = require("child_process").fork;var cpus = require("os").cpus();for (var i = 0; i &lt; cpus.length; i++) &#123; const worker = fork("./worker.js"); worker.on('message',function()&#123; console.log("master accept:", message); &#125;)&#125; ä¸»è¿›ç¨‹masteræ”¶åˆ°æ¶ˆæ¯ï¼Œæ‰“å°å¦‚ä¸‹123master accept: helloï¼ŒI&apos;m from workermaster accept: helloï¼ŒI&apos;m from workermaster accept: helloï¼ŒI&apos;m from worker è¿›ç¨‹é—´é€šä¿¡åŸç†IPC çš„å…¨ç§°æ˜¯Inter-Process Communicationï¼Œå³è¿›ç¨‹é—´é€šä¿¡ã€‚è¿›ç¨‹é—´é€šä¿¡çš„ç›®çš„æ˜¯ä¸ºäº†è®©ä¸åŒçš„è¿›ç¨‹èƒ½å¤Ÿäº’ç›¸è®¿é—®èµ„æºå¹¶è¿›è¡Œåè°ƒå·¥ä½œã€‚å®ç°è¿›ç¨‹é—´é€šä¿¡çš„æŠ€æœ¯æœ‰å¾ˆå¤šï¼Œå¦‚å‘½åç®¡é“ã€åŒ¿åç®¡ é“ã€socketã€ä¿¡å·é‡ã€å…±äº«å†…å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€Domain Socketç­‰ã€‚Node ä¸­å®ç° IPC é€šé“çš„æ˜¯ç®¡é“(pipe) æŠ€æœ¯ã€‚ä½†æ­¤ç®¡é“éå½¼ç®¡é“ï¼Œåœ¨ Node ä¸­ç®¡é“æ˜¯ä¸ªæŠ½è±¡å±‚é¢çš„ç§°å‘¼ï¼Œå…·ä½“ç»†èŠ‚å®ç°ç”± libuv æä¾›ï¼Œåœ¨ Windowsä¸‹ç”±å‘½åç®¡é“(named pipe)å®ç°ï¼Œ*nix ç³»ç»Ÿåˆ™é‡‡ç”¨ Unix Domain Socket å®ç°ã€‚è¡¨ç°åœ¨åº”ç”¨å±‚ä¸Šçš„è¿›ç¨‹é—´é€šä¿¡åªæœ‰ç®€å•çš„ message äº‹ä»¶å’Œ send() æ–¹æ³•ï¼Œæ¥å£ååˆ†ç®€æ´å’Œæ¶ˆæ¯åŒ– 1234567891011121314151617181920 IPCåˆ›å»ºå’Œå®ç°ç¤ºæ„å›¾+--------+ +--------+ | çˆ¶è¿›ç¨‹ | &lt;---- IPC ----&gt; | å­è¿›ç¨‹ | +--------+ | +--------+ | | v +--------+ | libuv | | ç®¡é“ | +--------+ / \ / \ / \ / \ v v +--------+ +----------------+ | windows | | *nix | | å‘½åç®¡é“ | | Domain Scocket | +--------+ +----------------+ çˆ¶è¿›ç¨‹åœ¨å®é™…åˆ›å»ºå­è¿›ç¨‹ä¹‹å‰ï¼Œä¼šåˆ›å»º IPC é€šé“å¹¶ç›‘å¬å®ƒï¼Œç„¶åæ‰çœŸæ­£åˆ›å»ºå‡ºå­è¿›ç¨‹ï¼Œå¹¶é€šè¿‡ç¯å¢ƒå˜é‡(NODE_CHANNEL_FD)å‘Šè¯‰å­è¿›ç¨‹è¿™ä¸ª IPC é€šé“çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å­è¿›ç¨‹åœ¨å¯åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®æ–‡ä»¶æè¿°ç¬¦å»è¿æ¥è¿™ä¸ªå·²å­˜åœ¨çš„ IPC é€šé“ï¼Œä»è€Œå®Œæˆçˆ¶å­è¿›ç¨‹ä¹‹é—´çš„è¿æ¥ã€‚ 123456789101112 åˆ›å»ºIPCç®¡é“çš„æ­¥éª¤ç¤ºæ„å›¾+--------+ +--------+ | çˆ¶è¿›ç¨‹ | ------ç”Ÿæˆ-----&gt; | å­è¿›ç¨‹ | +--------+ +--------+ \ / \ / ç›‘å¬/æ¥å— è¿æ¥ \ / \ / \ +--------+ / &gt; | IPC | &lt; +--------+ å»ºç«‹è¿æ¥ä¹‹åçš„çˆ¶å­è¿›ç¨‹å°±å¯ä»¥è‡ªç”±åœ°é€šä¿¡äº†ã€‚ç”±äº IPC é€šé“æ˜¯ç”¨å‘½åç®¡é“æˆ– Domain Socket åˆ›å»ºçš„ï¼Œå®ƒä»¬ä¸ç½‘ç»œ socket çš„è¡Œä¸ºæ¯”è¾ƒç±»ä¼¼ï¼Œå±äºåŒå‘é€šä¿¡ã€‚ä¸åŒçš„æ˜¯å®ƒä»¬åœ¨ç³»ç»Ÿå†…æ ¸ä¸­å°±å®Œæˆäº†è¿›ç¨‹é—´çš„é€šä¿¡ï¼Œè€Œä¸ç”¨ç»è¿‡å®é™…çš„ç½‘ç»œå±‚ï¼Œéå¸¸é«˜æ•ˆã€‚åœ¨ Node ä¸­ï¼ŒIPC é€šé“è¢«æŠ½è±¡ä¸º Stream å¯¹è±¡ï¼Œåœ¨è°ƒç”¨ send() æ—¶å‘é€æ•°æ®(ç±»ä¼¼äºwrite())ï¼Œæ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¼šé€šè¿‡ message äº‹ä»¶(ç±»ä¼¼äº data ) è§¦å‘ç»™åº”ç”¨å±‚ã€‚ å¥æŸ„ä¼ é€’æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å°±ä¼šéšæœºç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½è®©ä»–ä»¬éƒ½ç›‘å¬ä¸€ä¸ªç«¯å£ï¼Ÿæˆ‘ä»¬è¯•è¯•ï¼ŒæŠŠ Math.round((1 + Math.random()) * 1000 æ”¹ä¸º3000ï¼Œè®©ä»–ä»¬éƒ½ç›‘å¬3000ç«¯å£è¿è¡Œç»“æœå¦‚ä¸‹ï¼ŒæŠ¥3000ç«¯å£å ç”¨ï¼Œåªèƒ½å¼€å¯ä¸€ä¸ª3000ç«¯å£çš„è¿›ç¨‹1234events.js:183 throw er; // Unhandled 'error' event ^Error: listen EADDRINUSE :::3000 å¦‚æœæˆ‘ä»¬åƒä¹‹å‰ä¸€æ ·éšæœºåˆ†é…ç«¯å£ï¼Œç„¶åä¸»è¿›ç¨‹ç›‘å¬80ç«¯å£ï¼Œå°†è¯·æ±‚åˆ†åˆ«ä»£ç†åˆ°ä¸åŒç«¯å£çš„è¿›ç¨‹ä¸Šï¼Œè¿™æ ·åšå½“ç„¶å¯ä»¥ï¼Œç”šè‡³å¯ä»¥åšé€‚å½“çš„è´Ÿè½½å‡è¡¡ï¼Œä½†æ˜¯è¿›ç¨‹æ¯æ¥æ”¶åˆ°ä¸€ä¸ªè¿æ¥ï¼Œå°±ä¼šç”¨æ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦(fd)ï¼Œè€Œåä»£ç†è¿›ç¨‹åˆè¿æ¥åˆ°å­è¿›ç¨‹åˆä¼šæ¶ˆè€—æ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦æ˜¯æœ‰é™çš„ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å‘é€å¥æŸ„åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½åœ¨ç‰ˆæœ¬ v0.5.9 å¼•å…¥ã€‚send() æ–¹æ³•é™¤äº†èƒ½é€šè¿‡ IPC å‘é€æ•°æ®å¤–ï¼Œè¿˜èƒ½å‘é€å¥æŸ„ï¼Œç¬¬äºŒä¸ªå¯é€‰å‚æ•°å°±æ˜¯å¥æŸ„ï¼Œå¦‚ä¸‹æ‰€ç¤º1worker.send(message, [sendHandle]) é‚£ä»€ä¹ˆæ˜¯å¥æŸ„ï¼Ÿå¥æŸ„æ˜¯ä¸€ç§å¯ä»¥ç”¨æ¥æ ‡è¯†èµ„æºçš„å¼•ç”¨ï¼Œå®ƒçš„å†…éƒ¨åŒ…å«äº†æŒ‡å‘å¯¹è±¡çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ¯”å¦‚å¥æŸ„å¯ä»¥ç”¨æ¥æ ‡è¯†ä¸€ä¸ªæœåŠ¡å™¨ç«¯ socket å¯¹è±¡ã€ä¸€ä¸ªå®¢æˆ·ç«¯ socket å¯¹è±¡ã€ä¸€ä¸ª UDP å¥—æ¥å­—ã€ ä¸€ä¸ªç®¡é“ç­‰ã€‚ ä¿®æ”¹ä¸»è¿›ç¨‹ä»£ç  master12345678const child = require("child_process").fork("worker.js");const server = require("net").createServer();server.on("connection", function(socket) &#123; socket.end("handled by parent\n");&#125;);server.listen(3000, function() &#123; child.send("server", server);&#125;); å­è¿›ç¨‹ä»£ç worker1234567process.on("message", function(message, server) &#123; if (message === "server") &#123; server.on("connection", function(socket) &#123; socket.end("handled by child\n"); &#125;); &#125;&#125;); å¯åŠ¨æœåŠ¡1node master.js ç„¶åæ–°å»ºä¸€ä¸ªå‘½ä»¤è¡Œçª—å£è¯·æ±‚åˆšåˆšçš„æœåŠ¡123456âœ curl &quot;http://127.0.0.1:3000/&quot;handled by parentâœ curl &quot;http://127.0.0.1:3000/&quot;handled by childâœ curl &quot;http://127.0.0.1:3000/&quot;handled by parent ä½ ä¼šå‘ç°ç¨‹åºéšæœºè¢«ä¸»è¿›ç¨‹æˆ–è€…å­è¿›ç¨‹å¤„ç† æˆ‘ä»¬å†å¤š fork å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œåˆšåˆšåª fork äº†ä¸€ä¸ªï¼Œä¿®æ”¹ä»£ç master.js1234567891011const cp = require('child_process'); const child1 = cp.fork('worker.js'); const child2 = cp.fork('worker.js');const server = require('net').createServer(); server.on('connection', function (socket) &#123; socket.end('handled by parent\n'); &#125;);server.listen(3000, function () &#123; child1.send('server', server); child2.send('server', server);&#125;); worker.js123456789101112const http = require("http");const server = http.createServer(function(req, res) &#123; res.writeHead(200, &#123; "Content-Type": "text/plain" &#125;); res.end("handled by child, pid is " + process.pid + "\n");&#125;);process.on("message", function(message, tcp) &#123; if (message === "server") &#123; tcp.on("connection", function(socket) &#123; server.emit("connection", socket); &#125;); &#125;&#125;); å†ç”¨ curl æµ‹è¯•æˆ‘ä»¬çš„æœåŠ¡ï¼Œç»“æœå¦‚ä¸‹12345678910âœ curl &quot;http://127.0.0.1:3000/&quot;handled by child, pid is 35851âœ curl &quot;http://127.0.0.1:3000/&quot;handled by child, pid is 35852âœ curl &quot;http://127.0.0.1:3000/&quot;handled by parentâœ curl &quot;http://127.0.0.1:3000/&quot;handled by child, pid is 35852âœ curl &quot;http://127.0.0.1:3000/&quot;handled by child, pid is 35851 æµ‹è¯•çš„ç»“æœæ˜¯æ¯æ¬¡å‡ºç°çš„ç»“æœéƒ½å¯èƒ½ä¸åŒï¼Œç»“æœå¯èƒ½è¢«çˆ¶è¿›ç¨‹å¤„ç†ï¼Œä¹Ÿå¯èƒ½è¢«ä¸åŒçš„å­è¿›ç¨‹å¤„ç†ã€‚å¹¶ä¸”è¿™æ˜¯åœ¨ TCP å±‚é¢ä¸Šå®Œæˆçš„äº‹æƒ…ï¼Œæˆ‘ä»¬å°è¯•å°†å…¶è½¬åŒ–åˆ° HTTP å±‚é¢æ¥è¯•è¯•ã€‚å¯¹äºä¸»è¿›ç¨‹è€Œè¨€ï¼Œæˆ‘ä»¬ç”šè‡³æƒ³è¦å®ƒæ›´è½»é‡ä¸€ç‚¹ï¼Œé‚£ä¹ˆæ˜¯å¦å°†æœåŠ¡å™¨å¥æŸ„å‘é€ç»™å­è¿›ç¨‹ä¹‹åï¼Œå°±å¯ä»¥å…³æ‰æœåŠ¡å™¨çš„ç›‘å¬ï¼Œè®©å­è¿›ç¨‹æ¥å¤„ç†è¯·æ±‚å‘¢?æˆ‘ä»¬å¯¹ä¸»è¿›ç¨‹è¿›è¡Œæ”¹åŠ¨ï¼Œå¦‚ä¸‹æ‰€ç¤º:master.js123456789101112const cp = require('child_process'); const child1 = cp.fork('worker.js'); const child2 = cp.fork('worker.js');const server = require('net').createServer(); server.on('connection', function (socket) &#123; socket.end('handled by parent\n'); &#125;);server.listen(3000, function () &#123; child1.send('server', server); child2.send('server', server);+ server.close();&#125;); å†æ¬¡é‡å¯å‘ç°ä¸ä¼šå‡ºç° handled by parent çš„æ‰“å°ä¿¡æ¯äº†ï¼Œè¿™æ ·æ‰€æœ‰çš„è¯·æ±‚éƒ½äº¤ç»™å­è¿›ç¨‹å¤„ç†äº† å¥æŸ„ä¼ é€’æ˜¯å¯¹è±¡ä¼ é€’å—ï¼Ÿç»è¿‡ä¸Šé¢çš„æ“ä½œï¼Œæˆ‘ä»¬åº”ç”¨å±‚çš„è¡¨è±¡æ˜æ˜¾æ„Ÿè§‰å°±æ˜¯å¯¹è±¡çš„ä¼ é€’ï¼Œä½†æ˜¯å…¶å®ä¸æ˜¯ï¼Œåœ¨ä¼ é€’å¥æŸ„ä¹‹å‰ï¼Œä¼šè¿›è¡Œä¸€å±‚å°è£…ï¼Œsend() æ–¹æ³•åœ¨å°†æ¶ˆæ¯å‘é€åˆ° IPC ç®¡é“å‰ï¼Œå°†æ¶ˆæ¯ç»„è£…æˆä¸¤ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå‚æ•°æ˜¯ handleï¼Œå¦ä¸€ä¸ªæ˜¯messageã€‚message å‚æ•°å¦‚ä¸‹æ‰€ç¤º12345&#123; cmd: 'NODE_HANDLE', type: 'net.Server', msg: message&#125; å‘é€åˆ° IPC ç®¡é“çš„å®é™…ä¸Šæ˜¯æˆ‘ä»¬è¦å‘é€çš„å¥æŸ„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ–‡ä»¶æè¿°ç¬¦å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•´æ•°å€¼ã€‚è¿™ä¸ª message å¯¹è±¡åœ¨å†™å…¥åˆ° IPC ç®¡é“æ—¶ä¹Ÿä¼šé€šè¿‡ JSON.stringify() è¿›è¡Œåºåˆ—åŒ–ã€‚æ‰€ä»¥æœ€ç»ˆå‘é€åˆ° IPC é€šé“ä¸­çš„ä¿¡æ¯éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œsend() æ–¹æ³•èƒ½å‘é€æ¶ˆæ¯å’Œå¥æŸ„å¹¶ä¸æ„å‘³ç€å®ƒèƒ½å‘é€ä»»æ„å¯¹è±¡ã€‚ è¿æ¥äº† IPC é€šé“çš„å­è¿›ç¨‹å¯ä»¥è¯»å–åˆ°çˆ¶è¿›ç¨‹å‘æ¥çš„æ¶ˆæ¯ï¼Œå°†å­—ç¬¦ä¸²é€šè¿‡ JSON.parse() è§£æè¿˜åŸä¸ºå¯¹è±¡åï¼Œæ‰è§¦å‘ message äº‹ä»¶å°†æ¶ˆæ¯ä½“ä¼ é€’ç»™åº”ç”¨å±‚ä½¿ç”¨ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¶ˆæ¯å¯¹è±¡è¿˜è¦è¢«è¿›è¡Œè¿‡æ»¤å¤„ç†ï¼Œmessage.cmd çš„å€¼å¦‚æœä»¥ NODE_ ä¸ºå‰ç¼€ï¼Œå®ƒå°†å“åº”ä¸€ä¸ªå†…éƒ¨äº‹ä»¶ internalMessageã€‚å¦‚æœ message.cmd å€¼ä¸º NODE_HANDLEï¼Œå®ƒå°†å–å‡º message.type å€¼å’Œå¾—åˆ°çš„æ–‡ä»¶æè¿°ç¬¦ä¸€èµ·è¿˜åŸå‡ºä¸€ä¸ªå¯¹åº”çš„å¯¹è±¡ ä¸ºä»€ä¹ˆå¥æŸ„å°±å¯ä»¥è§£å†³ç«¯å£å ç”¨æŒ‰ç…§ä¹‹å‰çš„åšæ³•çš„è¯ï¼Œä»–ä»¬ä¸åŒè¿›ç¨‹ä¹‹é—´çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œç”±äºç‹¬ç«‹å¯åŠ¨çš„è¿›ç¨‹äº’ç›¸ä¹‹é—´å¹¶ä¸çŸ¥é“æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰€ä»¥ç›‘å¬ç›¸åŒç«¯å£æ—¶å°±ä¼šå¤±è´¥ã€‚å¦‚æœä½¿ç”¨å¥æŸ„ä¼ é€’çš„æ–¹å¼ï¼Œä»–ä»¬çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç›‘å¬ç›¸åŒç«¯å£ä¸ä¼šå¼•èµ·å¼‚å¸¸ æ–‡ä»¶æè¿°ç¬¦æ˜¯ä»€ä¹ˆï¼Ÿæ–‡ä»¶æè¿°ç¬¦ï¼ˆFile descriptorï¼‰åœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚å®é™…ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ï¼ŒæŒ‡å‘å†…æ ¸ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹æ‰€ç»´æŠ¤çš„è¯¥è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„è®°å½•è¡¨ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œä¸€äº›æ¶‰åŠåº•å±‚çš„ç¨‹åºç¼–å†™å¾€å¾€ä¼šå›´ç»•ç€æ–‡ä»¶æè¿°ç¬¦å±•å¼€ã€‚ä½†æ˜¯æ–‡ä»¶æè¿°ç¬¦è¿™ä¸€æ¦‚å¿µå¾€å¾€åªé€‚ç”¨äº UNIXã€Linux è¿™æ ·çš„æ“ä½œç³»ç»Ÿã€‚åœ¨UNIXã€Linux çš„ç³»ç»Ÿè°ƒç”¨ä¸­ï¼Œå¤§é‡çš„ç³»ç»Ÿè°ƒç”¨éƒ½æ˜¯ä¾èµ–äºæ–‡ä»¶æè¿°ç¬¦ å¼‚å¸¸é‡å¯æˆ‘ä»¬ä¸Šé¢è®²äº†å­è¿›ç¨‹çš„ send æ–¹æ³•å’Œ message äº‹ä»¶ï¼Œé™¤äº† message äº‹ä»¶å¤–ï¼Œè¿˜æœ‰å¦‚ä¸‹äº‹ä»¶ error: å½“å­è¿›ç¨‹æ— æ³•è¢«å¤åˆ¶åˆ›å»ºã€æ— æ³•è¢«æ€æ­»ã€æ— æ³•å‘é€æ¶ˆæ¯æ—¶ä¼šè§¦å‘è¯¥äº‹ä»¶ exit: å­è¿›ç¨‹é€€å‡ºæ—¶è§¦å‘è¯¥äº‹ä»¶ï¼Œå­è¿›ç¨‹å¦‚æœæ˜¯æ­£å¸¸é€€å‡ºï¼Œè¿™ä¸ªäº‹ä»¶çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé€€å‡ºç ï¼Œå¦åˆ™ä¸º nullã€‚å¦‚æœè¿›ç¨‹æ˜¯é€šè¿‡ kill() æ–¹æ³•è¢«æ€æ­»çš„ï¼Œä¼šå¾—åˆ°ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®ƒè¡¨ç¤ºæ€æ­»è¿›ç¨‹æ—¶çš„ä¿¡å·ã€‚ close: åœ¨å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¾“å‡ºæµä¸­æ­¢æ—¶è§¦å‘è¯¥äº‹ä»¶ï¼Œå‚æ•°ä¸ exit ç›¸åŒã€‚ disconnect: åœ¨çˆ¶è¿›ç¨‹æˆ–å­è¿›ç¨‹ä¸­è°ƒç”¨ disconnect() æ–¹æ³•æ—¶è§¦å‘è¯¥äº‹ä»¶ï¼Œåœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶å°†å…³é—­ç›‘å¬IPCé€šé“ ä¿®æ”¹ä»£ç master.js1234567891011121314151617181920212223242526const fork = require("child_process").fork;const cpus = require("os").cpus();const server = require("net").createServer();server.listen(3000);const workers = &#123;&#125;;const createWorker = function() &#123; const worker = fork(__dirname + "/worker.js"); // é€€å‡ºæ—¶é‡æ–°å¯åŠ¨æ–°çš„è¿›ç¨‹ worker.on("exit", function() &#123; console.log("Worker " + worker.pid + " exited."); delete workers[worker.pid]; createWorker(); &#125;); // å¥æŸ„è½¬å‘ worker.send("server", server); workers[worker.pid] = worker; console.log("Create worker. pid: " + worker.pid);&#125;;for (let i = 0; i &lt; cpus.length; i++) &#123; createWorker();&#125;// è¿›ç¨‹è‡ªå·±é€€å‡ºæ—¶ï¼Œè®©æ‰€æœ‰å·¥ä½œè¿›ç¨‹é€€å‡ºprocess.on("exit", function() &#123; for (let pid in workers) &#123; workers[pid].kill(); &#125;&#125;); æµ‹è¯•è¿è¡Œ12345678910111213âœ node masterCreate worker. pid: 36736Create worker. pid: 36737Create worker. pid: 36738Create worker. pid: 36739Create worker. pid: 36740Create worker. pid: 36741Create worker. pid: 36742Create worker. pid: 36743Create worker. pid: 36744Create worker. pid: 36745Create worker. pid: 36746Create worker. pid: 36747 æˆ‘ä»¬ä½¿ç”¨å‘½ä»¤è¡Œæ€æ­»ä¸€ä¸ªè¿›ç¨‹1kill 36747 36747è¿›ç¨‹é€€å‡ºåï¼Œå†çœ‹çœ‹åˆšåˆšçš„å‘½ä»¤è¡Œçª—å£ï¼Œæ˜¯ä¸æ˜¯å¤šäº†ä¸¤æ®µï¼Œæ€æ­»ä¹‹ååˆé‡æ–°åˆ›å»ºäº†ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™é‡Œä¸»è¦æ˜¯ä½¿ç”¨äº†äº‹ä»¶ exit12Worker 36747 exited.Create worker. pid: 36761 ä½†æ˜¯å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¸ä¼šä¸»åŠ¨å»æ€æ­»æŸä¸ªè¿›ç¨‹ï¼Œå¤§å¤šæ•°éƒ½æ˜¯å› ä¸ºç¨‹åºé”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¤„ç†å­è¿›ç¨‹çš„å¼‚å¸¸ï¼Œä¿®æ”¹ worker.js123456789101112131415161718192021const http = require("http");const server = http.createServer(function(req, res) &#123; res.writeHead(200, &#123; "Content-Type": "text/plain" &#125;); res.end("handled by child, pid is " + process.pid + "\n");&#125;);let worker;process.on("message", function(message, tcp) &#123; if (message === "server") &#123; worker = tcp; worker.on("connection", function(socket) &#123; server.emit("connection", socket); &#125;); &#125;&#125;);+process.on("uncaughtException", function() &#123;+ // åœæ­¢æ¥æ”¶æ–°çš„è¿æ¥+ worker.close(function() &#123;+ // æ‰€æœ‰å·²æœ‰è¿æ¥æ–­å¼€åï¼Œé€€å‡ºè¿›ç¨‹+ process.exit(1);+ &#125;);+&#125;); ä¸Šè¿°ä»£ç çš„å¤„ç†æµç¨‹æ˜¯ï¼Œä¸€æ—¦æœ‰æœªæ•è·çš„å¼‚å¸¸å‡ºç°ï¼Œå·¥ä½œè¿›ç¨‹å°±ä¼šç«‹å³åœæ­¢æ¥æ”¶æ–°çš„è¿æ¥; å½“æ‰€æœ‰è¿æ¥æ–­å¼€åï¼Œé€€å‡ºè¿›ç¨‹ã€‚ä¸»è¿›ç¨‹åœ¨ä¾¦å¬åˆ°å·¥ä½œè¿›ç¨‹çš„ exit åï¼Œå°†ä¼šç«‹å³å¯åŠ¨æ–°çš„è¿›ç¨‹æœåŠ¡ï¼Œ ä»¥æ­¤ä¿è¯æ•´ä¸ªé›†ç¾¤ä¸­æ€»æ˜¯æœ‰è¿›ç¨‹åœ¨ä¸ºç”¨æˆ·æœåŠ¡çš„ ç­‰ç­‰ï¼Œåˆšåˆšä¸€ä¸ªè¿›ç¨‹ç¨‹åºå‡ºé”™äº†ä¹‹åæˆ‘ä»¬å…³é—­äº†ï¼Œé‚£ä¹ˆå°‘äº†ä¸€ä¸ªè¿›ç¨‹ï¼ŒCPUæ²¡æœ‰å®Œå…¨åˆ©ç”¨ï¼Œæˆ‘ä»¬éœ€è¦é€šçŸ¥ä¸»è¿›ç¨‹å»é‡æ–°åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™é‡Œç»™ä¸»è¿›ç¨‹å‘é€è‡ªæ€ä¿¡å· worker12345678process.on("uncaughtException", function() &#123;+ process.send(&#123;act: 'suicide'&#125;); // åœæ­¢æ¥æ”¶æ–°çš„è¿æ¥ worker.close(function() &#123; // æ‰€æœ‰å·²æœ‰è¿æ¥æ–­å¼€åï¼Œé€€å‡ºè¿›ç¨‹ process.exit(1); &#125;);&#125;); master.jsä¸»è¿›ç¨‹æ¥æ”¶è‡ªæ€ä¿¡å·12345678910111213141516171819202122232425262728293031const fork = require("child_process").fork;const cpus = require("os").cpus();const server = require("net").createServer();server.listen(3000);const workers = &#123;&#125;;const createWorker = function() &#123; const worker = fork(__dirname + "/worker.js"); // é€€å‡ºæ—¶é‡æ–°å¯åŠ¨æ–°çš„è¿›ç¨‹+ worker.on("message", function(message) &#123;+ if (message.act === "suicide") &#123;+ createWorker();+ &#125;+ &#125;); worker.on("exit", function() &#123; console.log("Worker " + worker.pid + " exited."); delete workers[worker.pid]; createWorker(); &#125;); // å¥æŸ„è½¬å‘ worker.send("server", server); workers[worker.pid] = worker; console.log("Create worker. pid: " + worker.pid);&#125;;for (let i = 0; i &lt; cpus.length; i++) &#123; createWorker();&#125;// è¿›ç¨‹è‡ªå·±é€€å‡ºæ—¶ï¼Œè®©æ‰€æœ‰å·¥ä½œè¿›ç¨‹é€€å‡ºprocess.on("exit", function() &#123; for (let pid in workers) &#123; workers[pid].kill(); &#125;&#125;); æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªå¼‚å¸¸ï¼Œä¿®æ”¹å­è¿›ç¨‹ä»£ç 1234567...const server = http.createServer(function(req, res) &#123; res.writeHead(200, &#123; "Content-Type": "text/plain" &#125;); res.end("handled by child, pid is " + process.pid + "\n");+ throw new Error("throw exception");&#125;);... ç„¶åå¯åŠ¨æ‰€æœ‰çš„è¿›ç¨‹ï¼Œå¦‚ä¸‹1234567891011121314âœ node masterCreate worker. pid: 37169Create worker. pid: 37170Create worker. pid: 37171Create worker. pid: 37172Create worker. pid: 37173Create worker. pid: 37174Create worker. pid: 37175Create worker. pid: 37176Create worker. pid: 37177Create worker. pid: 37178Create worker. pid: 37179Create worker. pid: 37180Create worker. pid: 37185 12âœ curl http://127.0.0.1:3000/handled by child, pid is 37173 å›å¤´çœ‹çœ‹12Worker 37173 exited.Create worker. pid: 37189 å—¯ï¼Œå·¥ä½œæ­£å¸¸äº† çŠ¶æ€å…±äº«ç¬¬ä¸‰æ–¹æ•°æ®å­˜å‚¨è§£å†³æ•°æ®å…±äº«æœ€ç›´æ¥ã€ç®€å•çš„æ–¹å¼å°±æ˜¯é€šè¿‡ç¬¬ä¸‰æ–¹æ¥è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œæ¯”å¦‚å°†æ•°æ®å­˜æ”¾åˆ°æ•°æ®åº“ã€ç£ç›˜æ–‡ä»¶ã€ç¼“å­˜æœåŠ¡(å¦‚ Redis )ä¸­ï¼Œæ‰€æœ‰å·¥ä½œè¿›ç¨‹å¯åŠ¨æ—¶å°†å…¶è¯»å–è¿›å†…å­˜ä¸­ã€‚ä½†è¿™ç§æ–¹å¼å­˜åœ¨çš„é—®é¢˜æ˜¯å¦‚æœæ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œè¿˜éœ€è¦ä¸€ç§æœºåˆ¶é€šçŸ¥åˆ°å„ä¸ªå­è¿›ç¨‹ï¼Œä½¿å¾—å®ƒä»¬çš„å†…éƒ¨çŠ¶æ€ä¹Ÿå¾— åˆ°æ›´æ–°ã€‚å®ç°çŠ¶æ€åŒæ­¥çš„æœºåˆ¶æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å„ä¸ªå­è¿›ç¨‹å»å‘ç¬¬ä¸‰æ–¹è¿›è¡Œï¼Œå®šæ—¶è½®è¯¢å®šæ—¶è½®è¯¢å¸¦æ¥çš„é—®é¢˜æ˜¯è½®è¯¢æ—¶é—´ä¸èƒ½è¿‡å¯†ï¼Œå¦‚æœå­è¿›ç¨‹è¿‡å¤šï¼Œä¼šå½¢æˆå¹¶å‘å¤„ç†ï¼Œå¦‚æœæ•°æ®æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œè¿™äº›è½®è¯¢ä¼šæ²¡æœ‰æ„ä¹‰ï¼Œç™½ç™½å¢åŠ æŸ¥è¯¢çŠ¶æ€çš„å¼€é”€ã€‚å¦‚æœè½®è¯¢æ—¶é—´è¿‡é•¿ï¼Œæ•°æ®å‘ç”Ÿæ”¹ å˜æ—¶ï¼Œä¸èƒ½åŠæ—¶æ›´æ–°åˆ°å­è¿›ç¨‹ä¸­ï¼Œä¼šæœ‰ä¸€å®šçš„å»¶è¿Ÿã€‚ ä¸»åŠ¨é€šçŸ¥ä¸€ç§æ”¹è¿›çš„æ–¹å¼æ˜¯å½“æ•°æ®å‘ç”Ÿæ›´æ–°æ—¶ï¼Œä¸»åŠ¨é€šçŸ¥å­è¿›ç¨‹ã€‚å½“ç„¶ï¼Œå³ä½¿æ˜¯ä¸»åŠ¨é€šçŸ¥ï¼Œä¹Ÿéœ€è¦ä¸€ç§æœºåˆ¶æ¥åŠæ—¶è·å–æ•°æ®çš„æ”¹å˜ã€‚è¿™ä¸ªè¿‡ç¨‹ä»ç„¶ä¸èƒ½è„±ç¦»è½®è¯¢ï¼Œä½†æˆ‘ä»¬å¯ä»¥å‡å°‘è½®è¯¢çš„è¿›ç¨‹æ•°é‡ï¼Œ æˆ‘ä»¬å°†è¿™ç§ç”¨æ¥å‘é€é€šçŸ¥å’ŒæŸ¥è¯¢çŠ¶æ€æ˜¯å¦æ›´æ”¹çš„è¿›ç¨‹å«åšé€šçŸ¥è¿›ç¨‹ã€‚ä¸ºäº†ä¸æ··åˆä¸šåŠ¡é€»è¾‘ï¼Œå¯ä»¥å°†è¿™ä¸ªè¿›ç¨‹è®¾è®¡ä¸ºåªè¿›è¡Œè½®è¯¢å’Œé€šçŸ¥ï¼Œä¸å¤„ç†ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚è¿™ç§æ¨é€æœºåˆ¶å¦‚æœæŒ‰è¿›ç¨‹é—´ä¿¡å·ä¼ é€’ï¼Œåœ¨è·¨å¤šå°æœåŠ¡å™¨æ—¶ä¼šæ— æ•ˆï¼Œæ˜¯æ•…å¯ä»¥è€ƒè™‘é‡‡ç”¨ TCP æˆ– UDPçš„æ–¹æ¡ˆã€‚è¿›ç¨‹åœ¨å¯åŠ¨æ—¶ä»é€šçŸ¥æœåŠ¡å¤„é™¤äº†è¯»å–ç¬¬ä¸€æ¬¡æ•°æ®å¤–ï¼Œè¿˜å°†è¿›ç¨‹ä¿¡æ¯æ³¨å†Œåˆ°é€šçŸ¥æœåŠ¡å¤„ã€‚ä¸€æ—¦é€šè¿‡è½®è¯¢å‘ç°æœ‰æ•°æ®æ›´æ–°åï¼Œæ ¹æ®æ³¨å†Œä¿¡æ¯ï¼Œå°†æ›´æ–°åçš„æ•°æ®å‘é€ç»™å·¥ä½œè¿›ç¨‹ã€‚ç”±äºä¸ æ¶‰åŠå¤ªå¤šè¿›ç¨‹å»å‘åŒä¸€åœ°æ–¹è¿›è¡ŒçŠ¶æ€æŸ¥è¯¢ï¼ŒçŠ¶æ€å“åº”å¤„çš„å‹åŠ›ä¸è‡³äºå¤ªè¿‡å·¨å¤§ï¼Œå•ä¸€çš„é€šçŸ¥æœåŠ¡è½®è¯¢å¸¦æ¥çš„å‹åŠ›å¹¶ä¸å¤§ï¼Œæ‰€ä»¥å¯ä»¥å°†è½®è¯¢æ—¶é—´è°ƒæ•´å¾—è¾ƒçŸ­ï¼Œä¸€æ—¦å‘ç°æ›´æ–°ï¼Œå°±èƒ½å®æ—¶åœ°æ¨é€åˆ°å„ä¸ªå­è¿›ç¨‹ä¸­ã€‚ Eggçš„agentæ¨¡å¼https://eggjs.org/zh-cn/core/cluster-and-ipc.html#agent-%E6%9C%BA%E5%88%B61234567891011 +--------+ +-------+ | Master |&lt;--------&gt;| Agent | +--------+ +-------+ ^ ^ ^ / | \ / | \ / | \ v v v+----------+ +----------+ +----------+| Worker 1 | | Worker 2 | | Worker 3 |+----------+ +----------+ +----------+ Master å¯åŠ¨åå…ˆ fork Agent è¿›ç¨‹ Agent åˆå§‹åŒ–æˆåŠŸåï¼Œé€šè¿‡ IPC é€šé“é€šçŸ¥ Master Master å† fork å¤šä¸ª App Worker App Worker åˆå§‹åŒ–æˆåŠŸï¼Œé€šçŸ¥ Master æ‰€æœ‰çš„è¿›ç¨‹åˆå§‹åŒ–æˆåŠŸåï¼ŒMaster é€šçŸ¥ Agent å’Œ Worker åº”ç”¨å¯åŠ¨æˆåŠŸ å¦å¤–ï¼Œå…³äº Agent Worker è¿˜æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼š ç”±äº App Worker ä¾èµ–äº Agentï¼Œæ‰€ä»¥å¿…é¡»ç­‰ Agent åˆå§‹åŒ–å®Œæˆåæ‰èƒ½ fork App Worker Agent è™½ç„¶æ˜¯ App Worker çš„ã€å°ç§˜ã€ï¼Œä½†æ˜¯ä¸šåŠ¡ç›¸å…³çš„å·¥ä½œä¸åº”è¯¥æ”¾åˆ° Agent ä¸Šå»åšï¼Œä¸ç„¶æŠŠå¥¹ç´¯å®äº†å°±ä¸å¥½äº† ç”±äº Agent çš„ç‰¹æ®Šå®šä½ï¼Œæˆ‘ä»¬åº”è¯¥ä¿è¯å®ƒç›¸å¯¹ç¨³å®šã€‚å½“å®ƒå‘ç”Ÿæœªæ•è·å¼‚å¸¸ï¼Œæ¡†æ¶ä¸ä¼šåƒ App Worker ä¸€æ ·è®©ä»–é€€å‡ºé‡å¯ï¼Œè€Œæ˜¯è®°å½•å¼‚å¸¸æ—¥å¿—ã€æŠ¥è­¦ç­‰å¾…äººå·¥å¤„ç† Agent å’Œæ™®é€š App Worker æŒ‚è½½çš„ API ä¸å®Œå…¨ä¸€æ ·ï¼Œå¦‚ä½•è¯†åˆ«å·®å¼‚å¯æŸ¥ ClusterCluster è¿™ä¸ªæ”¾åˆ°æœ€åæ¥å°†æ¯”è¾ƒåˆé€‚ï¼ŒCluster çš„å®ç°æœºåˆ¶æ˜¯åŸºäº child_process çš„ï¼ŒNodeåŸºäº child_process è¿›ä¸€æ­¥å°è£…äº†ä¸€ä¸‹ï¼Œæ¥çœ‹çœ‹æ€ä¹ˆä½¿ç”¨ 12345678910111213141516171819202122232425const cluster = require('cluster');const http = require('http');const numCPUs = require('os').cpus().length;if (cluster.isMaster) &#123; console.log(`ä¸»è¿›ç¨‹ $&#123;process.pid&#125; æ­£åœ¨è¿è¡Œ`); // è¡ç”Ÿå·¥ä½œè¿›ç¨‹ã€‚ for (let i = 0; i &lt; numCPUs; i++) &#123; cluster.fork(); &#125; cluster.on('exit', (worker, code, signal) =&gt; &#123; console.log(`å·¥ä½œè¿›ç¨‹ $&#123;worker.process.pid&#125; å·²é€€å‡º`); &#125;);&#125; else &#123; // å·¥ä½œè¿›ç¨‹å¯ä»¥å…±äº«ä»»ä½• TCP è¿æ¥ã€‚ // åœ¨æœ¬ä¾‹å­ä¸­ï¼Œå…±äº«çš„æ˜¯ HTTP æœåŠ¡å™¨ã€‚ http.createServer((req, res) =&gt; &#123; res.writeHead(200); res.end('ä½ å¥½ä¸–ç•Œ\n'); &#125;).listen(8000); console.log(`å·¥ä½œè¿›ç¨‹ $&#123;process.pid&#125; å·²å¯åŠ¨`);&#125; è¿è¡Œä»£ç ï¼Œåˆ™å·¥ä½œè¿›ç¨‹ä¼šå…±äº« 8000 ç«¯å£ï¼š123456âœ node server.jsä¸»è¿›ç¨‹ 3596 æ­£åœ¨è¿è¡Œå·¥ä½œè¿›ç¨‹ 4324 å·²å¯åŠ¨å·¥ä½œè¿›ç¨‹ 4520 å·²å¯åŠ¨å·¥ä½œè¿›ç¨‹ 6056 å·²å¯åŠ¨å·¥ä½œè¿›ç¨‹ 5644 å·²å¯åŠ¨ æ˜¯ä¸æ˜¯æ¯”ä¹‹å‰æˆ‘ä»¬ç”¨ child_process æ›´ç®€å•ï¼Ÿä¸è¿‡è¿™é‡Œæ¨èä½¿ç”¨ setupMaster æ¥ fork å­è¿›ç¨‹ï¼Œå®˜æ–¹ç¤ºä¾‹ä¸­å¿½è€Œåˆ¤æ–­ cluster.isMasterã€å¿½è€Œåˆ¤æ–­ cluster.isWorkerï¼Œå¯¹äºä»£ç çš„å¯è¯»æ€§ååˆ†å·®ï¼ŒsetupMaster() è¿™ä¸ª APIï¼Œå°†ä¸»è¿›ç¨‹å’Œå·¥ä½œè¿›ç¨‹ä»ä»£ç ä¸Šå®Œå…¨å‰¥ç¦»ï¼Œ å¦‚åŒ send() æ–¹æ³•çœ‹èµ·æ¥ç›´æ¥å°†æœåŠ¡å™¨ä»ä¸»è¿›ç¨‹å‘é€åˆ°å­è¿›ç¨‹é‚£æ ·ç¥å¥‡ï¼Œå‰¥ç¦»ä»£ç ä¹‹åï¼Œç”šè‡³éƒ½æ„Ÿè§‰ä¸åˆ°ä¸»è¿›ç¨‹ä¸­æœ‰ä»»ä½•æœåŠ¡å™¨ç›¸å…³çš„ä»£ç é€šè¿‡ cluster.setupMaster() åˆ›å»ºå­è¿›ç¨‹è€Œä¸æ˜¯ä½¿ç”¨ cluster.fork()ï¼Œç¨‹åºç»“æ„ä¸å†å‡Œä¹±ï¼Œé€»è¾‘åˆ†æ˜ï¼Œä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§è¾ƒå¥½ã€‚123456789101112const cluster = require('cluster');cluster.setupMaster(&#123; exec: 'worker.js', args: ['--use', 'https'], silent: true&#125;);cluster.fork(); // https å·¥ä½œè¿›ç¨‹cluster.setupMaster(&#123; exec: 'worker.js', args: ['--use', 'http']&#125;);cluster.fork(); åœ¨ cluster æ¨¡å—åº”ç”¨ä¸­ï¼Œä¸€ä¸ªä¸»è¿›ç¨‹åªèƒ½ç®¡ç†ä¸€ç»„å·¥ä½œè¿›ç¨‹1234567891011 +--------+ | Master | +--------+ / | \ / | \ / | \ / | \ v v v+--------+ +--------+ +---------+| å·¥ä½œè¿›ç¨‹ | | å·¥ä½œè¿›ç¨‹ | | å·¥ä½œè¿›ç¨‹ |+--------+ +--------+ +---------+ å¯¹äºè‡ªè¡Œé€šè¿‡ child_process æ¥æ“ä½œæ—¶ï¼Œåˆ™å¯ä»¥æ›´çµæ´»åœ°æ§åˆ¶å·¥ä½œè¿›ç¨‹ï¼Œç”šè‡³æ§åˆ¶å¤šç»„å·¥ä½œè¿›ç¨‹ã€‚å…¶åŸå› åœ¨äºè‡ªè¡Œé€šè¿‡ child_process æ“ä½œå­è¿›ç¨‹æ—¶ï¼Œå¯ä»¥éšå¼åœ°åˆ›å»ºå¤šä¸ª TCP æœåŠ¡å™¨ï¼Œä½¿å¾—å­è¿›ç¨‹å¯ä»¥å…±äº«å¤šä¸ªçš„æœåŠ¡å™¨ç«¯ socket1234567891011 +--------+ | Master | +--------+ / | \ / | \ / | \ / | \ v v v+------------+ +-----------+ +------------+| è¿›ç¨‹app1.js | | è¿›ç¨‹app2.js | | è¿›ç¨‹app3.js |+------------+ +-----------+ +------------+ ç»¼ä¸Šæ¯”è¾ƒå¾—å‡º cluster æ˜¯ child_process æ¼”å˜è€Œæ¥ cluster ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼Œç›´æ¥è§£å†³äº†ç«¯å£å ç”¨çš„é—®é¢˜ï¼Œapiä¹Ÿè¶³å¤Ÿç”¨ child_process æ›´çµæ´»ï¼Œå†™èµ·æ¥ä»£ç ä¼šæ¯”è¾ƒå¤š æ¨èäºŒè€…ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œç®€å•çœ‹äº†ä¸€ä¸‹ Egg çš„æºç ï¼Œå®ƒå°±æ˜¯è¿™ä¹ˆåšçš„ã€‚ä¸»è¿›ç¨‹ fork ä½¿ç”¨ cforkï¼Œagent è¿›ç¨‹ä½¿ç”¨child_process forkè€Œæ¥ ç»“å°¾ohï¼Œåˆæ°´ä¸€ç¯‡æ–‡ç« ï¼Œä»£ç åŸºæœ¬å‚ç…§æ·±å…¥æµ…å‡ºNode.jsç¬¬ä¹ç« ç©è½¬è¿›ç¨‹ï¼Œåœ¨æ–‡ç« æœ€åæ·»åŠ äº†ä¸€äº›æœ€è¿‘çœ‹åˆ°çš„çŸ¥è¯†ï¼ŒåŠ æ·±ä¸€ä¸‹å°è±¡å’Œç†è§£å§ Reference æ·±å…¥æµ…å‡ºNode.js æœ¬æ–‡åœ°å€ Nodejsä¹‹è¿›ç¨‹]]></content>
      <categories>
        <category>Node</category>
        <category>è¿›ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>Node</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nodejsä¹‹å®ç°è·¯ç”±å’Œä¸­é—´ä»¶]]></title>
    <url>%2F2020%2F04%2F14%2Fnode-route-middleware%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä»Šå¤©æ¥å®ç°ä¸€ä¸ª node çš„è·¯ç”±å’Œä¸­é—´ä»¶ é“ºå«æˆ‘ä»¬é¦–å…ˆèµ·ä¸€ä¸ªæœåŠ¡ 12345678const http = require("http");const url = require("url");http .createServer(function(req, res) &#123; const pathname = url.parse(req.url).pathname; res.end(req.method.toLowerCase() + ": " + pathname); &#125;) .listen(3000); è®¿é—® http://localhost:3000/ æ˜¾ç¤º get: /è®¿é—® http://localhost:3000/test æ˜¾ç¤º get: /test æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ä¸‹é¢ä»£ç åˆ¤æ–­é€»è¾‘ï¼Œè¿™æ ·åšçš„è¯å¤ªéº»çƒ¦äº†ï¼Œæ‚ç³…åœ¨ä¸€èµ·äº†ï¼Œè¿˜å¾—è¿›ä¸€æ­¥åˆ¤æ–­ä¸åŒçš„è¯·æ±‚æ–¹æ³•ï¼Œåˆ°åº•æ˜¯ get è¿˜æ˜¯ post è¿˜æ˜¯å…¶ä»–çš„ï¼Œé‡å¤ä»£ç ä¹Ÿä¼šå¢åŠ 123456789101112switch (pathname) &#123; case "/": res.end("root"); break; case "/test": res.end("test"); break; default: res.writeHead(404); res.end("404"); break;&#125; å®ç°è·¯ç”±æˆ‘ä»¬æŒ‰ç…§ RESTful é£æ ¼æ¥å®ç°æˆ‘ä»¬çš„è·¯ç”±ï¼Œä»–ä»¬åº”è¯¥æ˜¯è¿™æ ·çš„12345678route.get("/user", function(req, res) &#123;&#125;);route.post("/user", function(req, res) &#123;&#125;);route.delete("/user", function(req, res) &#123;&#125;);// è¿˜å¯ä»¥æ˜¯route.get("/:id", function(req, res) &#123;&#125;);route.get("/user/:pid/account", function(req, res) &#123;&#125;); ä¸Šé¢æˆ‘ä»¬å·²ç»å¯åŠ¨æœåŠ¡äº†ï¼Œç°åœ¨æˆ‘ä»¬æ–°å»ºåº”è¯¥è·¯ç”±æ–‡ä»¶ï¼Œå°±å« router.js å§ï¼Œç„¶ååœ¨ä¸Šé¢ğŸ‘†çš„æœåŠ¡å¼•å…¥ const Router = require(&#39;./router&#39;); router.js12345678910111213141516const url = require("url");class Router &#123; constructor() &#123; this.route = &#123;&#125;; ["HEAD", "OPTIONS", "GET", "PUT", "PATCH", "POST", "DELETE"].forEach( method =&gt; &#123; method = method.toLowerCase(); this.route[method] = []; this[method] = function(path, ...stacks) &#123; this.route[method].push([path, [...stacks]]); &#125;; &#125; ); &#125;&#125;module.exports = Router; ä»–ä»¬çš„æ„é€ å‡½æ•°å’Œå¤§è‡´çš„ç»“æ„åº”è¯¥æ˜¯è¿™æ ·çš„ï¼Œå½“æˆ‘ä»¬ new Router(); åˆå§‹åŒ–æ”¯æŒçš„è·¯ç”±æ–¹æ³•ï¼Œä½ ä¼šå‘ç°æ¯å½“æˆ‘ä»¬ route.get() æˆ–è€… route.post() éƒ½ä¼šæŠŠä»–ä»¬å­˜åˆ°å¯¹åº”çš„ route å¯¹è±¡æ•°ç»„å†…éƒ¨ï¼Œä»¥ä¾¿åç»­ä½¿ç”¨ï¼Œè¿™å«è·¯ç”±æ”¶é›†ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘éƒ½æ”¶é›†äº†ï¼Œéœ€è¦è°ƒç”¨1234567891011121314const http = require("http");const url = require("url");+ const Router = require("./router");// è·¯ç”±+ route.get("/user/:id", function(req, res) &#123;+ res.end("id");+ &#125;);http .createServer(function(req, res) &#123;+ route.install(req, res); &#125;) .listen(3000); å›åˆ°router.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051const url = require("url");class Router &#123; constructor() &#123; this.route = &#123;&#125;; ["HEAD", "OPTIONS", "GET", "PUT", "PATCH", "POST", "DELETE"].forEach( method =&gt; &#123; method = method.toLowerCase(); this.route[method] = []; this[method] = function(path, ...stacks) &#123; this.route[method].push([path, [...stacks]]); &#125;; &#125; ); &#125;+ install(req, res, app) &#123;+ const pathname = url.parse(req.url).pathname;+ const method = req.method.toLowerCase();+ if (this.route[method]) &#123;+ for (let i = 0; i &lt; this.route[method].length; i++) &#123;+ const [path, stacks] = this.route[method][i];+ const &#123; keys, regExp &#125; = this.pathRegexp(path);+ const mathed = regExp.exec(pathname);+ if (mathed) &#123;+ req.params = &#123;&#125;;+ for (let j = 0; j &lt; keys.length; j++) &#123;+ const key = keys[j];+ req.params[key] = mathed[j + 1];+ &#125;+ return app.handle(req, res, stacks);+ &#125;+ &#125;+ res.writeHead(404);+ res.end("404");+ &#125;else&#123;+ res.writeHead(404);+ res.end("404");+ &#125;+ &#125;+ pathRegexp(path) &#123;+ const keys = [];+ path = path.replace(/\/:(\w+)?(?:\/)?/g, function(match, key) &#123;+ keys.push(key);+ return `\\/([^\\/]+)(?:\\/)?`;+ &#125;);+ return &#123;+ keys,+ regExp: new RegExp(`^$&#123;path&#125;$`)+ &#125;;+ &#125;&#125;module.exports = Router; ä½ ä¼šå‘ç°å¤šäº†ä¸¤ä¸ªæ–¹æ³•installï¼ŒpathRegexpã€‚installæ˜¯ç”¨æ¥æ³¨å†Œè·¯ç”±çš„ï¼Œé¦–å…ˆæ‹¿åˆ°è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„ï¼Œç„¶åå»ä¹‹å‰æ”¶é›†çš„è·¯ç”±æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨è¿™ä¸ªè·¯ç”±ï¼Œå¦‚æœä¸å­˜åœ¨ç›´æ¥è¿”å›404ï¼Œå¦‚æœå­˜åœ¨ä¼šè°ƒç”¨ pathRegexp åšè·¯å¾„åŒ¹é…ï¼Œå› ä¸ºå¯èƒ½ä¼šæœ‰ /:idã€ /userï¼Œè¿™ç§ä¸åŒçš„è·¯ç”±ï¼Œè¿™é‡Œå€Ÿé‰´ä¸€ä¸‹ koa-router è·å–å‚æ•°çš„æ–¹å¼ï¼Œæ¯”å¦‚æˆ‘ä»¬è·¯ç”±æ˜¯ /:id/test/:pï¼Œå½“æˆ‘ä»¬è®¿é—® /123/test/456çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¿åˆ°ä¸€ä¸ªå¯¹è±¡params: {id:123,p:456}ã€‚å…¶å® koa-router çš„è·¯ç”±åŒ¹é…è§„åˆ™ç”¨çš„æ˜¯ path-to-regexp è¿™ä¸ªåŒ…ï¼Œæˆ‘ä»¬è¿™é‡Œæ˜¯è‡ªå·±åšçš„åŒ¹é…ï¼Œå¯ä»¥æ€è€ƒä¸€ä¸‹ä¸Šé¢ pathRegexp æ–¹æ³•çš„å®ç°ï¼Œæ­£åˆ™å¥½çš„åŒå­¦åº”è¯¥çœ‹å¾—å¾ˆæ˜ç™½ã€‚å¦‚æœå‘ç°åŒ¹é…ï¼Œæˆ‘ä»¬ä¼šæŠŠ params èµ‹å€¼åˆ° req å¯¹è±¡ä¸Šï¼Œç„¶åè°ƒç”¨æ‰§è¡Œä¸­é—´ä»¶çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯ app.handle(req, res, stacks);ï¼Œä½ ä¼šå‘ç°ä¸Šé¢æˆ‘ä»¬æ³¨å†Œçš„æ—¶å€™å‹æ ¹å°±æ²¡æœ‰ä¼ é€’ appï¼Œå› ä¸ºè¿™æ˜¯åé¢éœ€è¦è®²çš„å†…å®¹ï¼Œå®ç°ä¸­é—´ä»¶ é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå¦‚æœä½ æƒ³è®©ä¸Šé¢çš„ä»£ç æ­£å¸¸æ‰§è¡Œï¼ŒæŠŠ app.handle() è¿™è¡Œä»£ç å»æ‰ï¼Œç„¶å res.end() å°±å¯ä»¥æ­£å¸¸æ‰§è¡Œäº† ä¸­é—´ä»¶ä¸­é—´ä»¶å…¶å®å°±æ˜¯æ´‹è‘±æ¨¡å‹äº†ï¼Œå…ˆæ”¶é›†ä¸­é—´ä»¶çš„ä¾èµ–ï¼Œç„¶åå»é€’å½’ä¸€ä¸ªä¸ªæ‰§è¡Œä¸­é—´ä»¶ï¼Œæ„Ÿå…´è¶£å¯ä»¥å»çœ‹çœ‹æˆ‘ç›´æ¥å†™çš„Koaæºç ç³»åˆ—ä¹‹koa-compose ä¸­é—´ä»¶æˆ‘ä»¬å¸Œæœ›ä»–æ˜¯è¿™ä¹ˆæ³¨å†Œæ”¶é›†çš„12345app.use(cookie);app.use(function(req, res, next) &#123; req.query = url.parse(req.url, true).query; next();&#125;); æ–°å»ºæ–‡ä»¶middleware.jsï¼Œå†…å®¹å¦‚ä¸‹12345678910111213141516171819202122232425262728293031const url = require("url");class MiddleWare &#123; constructor() &#123; this.aloneMiddleWare = &#123;&#125;; this.commonMiddleWare = []; &#125; use(middleWare) &#123; if (typeof middleWare === "string") &#123; this.aloneMiddleWare[middleWare] = arguments[1]; &#125; else &#123; this.commonMiddleWare.push(middleWare); &#125; &#125; handle(req, res, stacks) &#123; const pathname = url.parse(req.url).pathname; const middleWareList = [ ...this.commonMiddleWare, ...(this.aloneMiddleWare[pathname] ? this.aloneMiddleWare[pathname] : []), ...stacks ]; const next = function() &#123; const middleWare = middleWareList.shift(); if (middleWare) &#123; middleWare(req, res, next); &#125; &#125;; next(); &#125;&#125;module.exports = new MiddleWare(); aloneMiddleWare å…ˆä¸çœ‹ï¼Œuseæ–¹æ³•æ˜¯è¿›è¡Œä¾èµ–æ”¶é›†çš„ï¼Œhandleæ–¹æ³•æ˜¯é›†ä¸­å¤„ç†ä¸­é—´ä»¶çš„æ–¹æ³•ï¼Œé€’å½’è°ƒç”¨ï¼Œä¾æ¬¡æ‰§è¡Œã€‚å…³é”®ä»£ç 1234567const next = function() &#123; const middleWare = middleWareList.shift(); if (middleWare) &#123; middleWare(req, res, next); &#125;&#125;;next(); æ¯æ¬¡å–å‡ºé˜Ÿåˆ—é‡Œçš„ç¬¬ä¸€ä¸ªï¼Œç„¶åæ‰§è¡Œå®ƒï¼Œç„¶åæŠŠ next æ–¹æ³•ä¼ é€’ä¸€ä¸‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»åœ¨ä¸­é—´ä»¶å†…éƒ¨è°ƒç”¨ next æ–¹æ³•ï¼Œä¸ç„¶æµç¨‹ä¼šä¸­æ–­ã€‚ æˆ‘ä»¬åˆšåˆšè¯´çš„ aloneMiddleWare æœ‰ä¸Šé¢ç”¨çš„å‘¢ï¼Œå…¶å®æ˜¯ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œå› ä¸ºæœ‰çš„ä¸­é—´ä»¶ä¸æ˜¯æ‰€æœ‰è·¯ç”±éƒ½ä½¿ç”¨åˆ°çš„ï¼Œå¯èƒ½å°±ä¸€ä¸ªè·¯ç”±ç”¨åˆ°äº†ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æŠŠå®ƒæ³¨å†Œåœ¨å…¨å±€ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è·¯ç”±éƒ½ä¼šèµ°ä¸€éã€‚æ‰€ä»¥è¿™é‡Œåšä¸ªä¼˜åŒ–ï¼Œä¸­é—´ä»¶æ”¯æŒå¦‚ä¸‹æ³¨å†Œæ–¹å¼ï¼Œè¿™æ ·å°±åªæœ‰ /alone è¿™ä¸ªè·¯ç”±ä¼šèµ°è¿™ä¸ªä¸­é—´ä»¶ï¼Œä¸Šé¢çš„å­˜å–ä½¿ç”¨ this.aloneMiddleWare[middleWare]; å¯èƒ½ä¸ä¸¥è°¨ï¼Œæœ€å¥½åšæ­£åˆ™åŒ¹é…ï¼Œè¿™é‡Œä¸»è¦æ˜¯æä¾›æ€è·¯1app.use('/alone', middleware) è¿™æ ·ä¹‹å‰çš„ router.js å†…çš„ app.handle æ–¹æ³•å°±å¯ä»¥æ‰§è¡Œäº†ï¼Œç„¶åä¾æ¬¡æ‰§è¡Œä¸­é—´ä»¶ï¼Œæœ€åæ‰æ‰§è¡Œè·¯ç”±ä¸Šé¢å†™å¾—å›è°ƒæ–¹æ³• å¦å¤–è¿˜æ‰§è¡Œä»¥ä¸‹æ–¹æ³•ä¼ é€’ä¸­é—´ä»¶123route.get("/user/:id", middleware1, middleware2, function(req, res) &#123; res.end("id");&#125;); å—¯ï¼Œç°åœ¨å¤§è‡´å®Œæˆäº†åŠŸèƒ½ï¼Œä½†æ˜¯å‘¢ï¼Œå¥½åƒæˆ‘ä»¬å¯ä»¥æŠŠä¸Šä¸€ç¯‡å†™çš„æ¨¡ç‰ˆå¼•æ“æ‹¿è¿‡æ¥ï¼Œå€Ÿé‰´ä¸€ä¸‹ koa-views æ–¹æ³•ï¼Œä½¿ç”¨ ctx.render(file,{}) æ¸²æŸ“æ¨¡ç‰ˆ æ”¯æŒæ¨¡ç‰ˆå¼•æ“æ–°å»ºæ–‡ä»¶render.js12345678910111213141516171819202122232425262728293031323334353637const fs = require("fs");const render = function(file, data) &#123; let str = fs.readFileSync(`$&#123;file&#125;.ejs`, "utf8"); const escape = function(html) &#123; return String(html) .replace(/&amp;(?!\w+;)/g, "&amp;amp;") .replace(/&lt;/g, "&amp;lt;") .replace(/&gt;/g, "&amp;gt;") .replace(/"/g, "&amp;quot;") .replace(/'/g, "&amp;#039;"); // IEä¸‹ä¸æ”¯æŒ&amp;apos;(å•å¼•å·)è½¬ä¹‰ &#125;; str = str .replace(/\n/g, "") .replace(/\s&#123;2,&#125;/g, "") .replace(/&lt;%-([\S\s]+?)%&gt;/g, function(match, val) &#123; return `'+ $&#123;val&#125; +'`; &#125;) .replace(/&lt;%=([\S\s]+?)%&gt;/g, function(match, val) &#123; return `'+ escape($&#123;val&#125;) +'`; &#125;) .replace(/&lt;%([\S\s]+?)%&gt;/g, function(match, val) &#123; return `';\n$&#123;val&#125;\ntpl +='`; &#125;); str = `let tpl = '$&#123;str&#125;';return tpl;`; str = `with(option)&#123;$&#123;str&#125;;return tpl;&#125;`; const complied = new Function("option", str); let result; try &#123; result = complied(data); &#125; catch (error) &#123; console.log(error); &#125; return result;&#125;;module.exports = render; å†™ä¸€ä¸ªæ”¯æŒæ¨¡ç‰ˆå¼•æ“çš„ä¸­é—´ä»¶12345678app.use(function(req, res, next) &#123; res.render = function(file, data) &#123; let template = render(file, data); res.writeHead(200, &#123; "Content-Type": "text/html;charset=utf8" &#125;); res.end(template); &#125;; next();&#125;); ä½¿ç”¨123456app.get("/user/:id", function(req, res) &#123; const obj = &#123; items: [&#123; name: "123" &#125;, &#123; name: "wclimb" &#125;], &#125;; res.render("template", obj);&#125;); template æ˜¯ template.ejsæ–‡ä»¶ï¼Œå½“ç„¶å¾—æœ‰ template.ejs123456789101112131415161718192021&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt; &lt;head&gt; &lt;meta charset="UTF-8" /&gt; &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt; &lt;title&gt;Document&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;% for (var i = 0; i &lt; items.length; i++) &#123; %&gt; &lt;% var item = items[i];%&gt; &lt;p&gt;&lt;%= (i+1) %&gt;ã€&lt;%-item.name%&gt;&lt;/p&gt; &lt;% &#125; %&gt; &lt;div&gt;æµ‹è¯•ä¸€ä¸‹&lt;/div&gt; &lt;% if (user) &#123; %&gt; &lt;h2&gt;&lt;%=user.name%&gt;&lt;/h2&gt; &lt;% &#125; else &#123; %&gt; &lt;h2&gt;åŒ¿åç”¨æˆ·&lt;/h2&gt; &lt;% &#125; %&gt; &lt;/body&gt;&lt;/html&gt; ç»“å°¾è‡³æ­¤ï¼Œæˆ‘ä»¬å®ç°äº†è·¯ç”±ã€ä¸­é—´ä»¶ã€æ¨¡ç‰ˆå¼•æ“ï¼Œå®Œæ•´æµç¨‹ä¸²èµ·æ¥å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬å†™ä¸€äº› demo äº†ï¼Œé¢ï¼Œä½†æ˜¯åˆ«åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œä¸ä¿è¯ä»£ç çš„å¥å£®ã€‚å½“ç„¶æˆ‘ä¹Ÿç›¸ä¿¡ä½ ç»å¯¹ä¸ä¼šä¸Šç”Ÿäº§ï¼Œå› ä¸ºè¿™å°±æ˜¯ä¸ª demoï¼Œå…¶å®é‚£ä¹ˆæ¡†æ¶ä¹Ÿæ˜¯è¿™ä¹ˆä¸€æ­¥æ­¥æ­å»ºèµ·æ¥çš„ï¼ŒåŸç†æ€æƒ³å·®ä¸å¤š ä»¥ä¸Šä»£ç å·²ç»ä¸Šä¼ åˆ°Githubï¼šhttps://github.com/wclimb/router-middleware Reference æ·±å…¥æµ…å‡ºNode.js æœ¬æ–‡åœ°å€ Nodejsä¹‹å®ç°è·¯ç”±å’Œä¸­é—´ä»¶]]></content>
      <categories>
        <category>Node</category>
        <category>æ¨¡ç‰ˆå¼•æ“</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>Node</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nodejsä¹‹å®ç°ä¸€ä¸ªæ¨¡ç‰ˆå¼•æ“]]></title>
    <url>%2F2020%2F04%2F14%2Fnode-template%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ€è¿‘çœ‹å®Œäº†æœ´å¤§çš„ ã€Šæ·±å…¥æµ…å‡ºNode.jsã€‹ è¿™æœ¬ä¹¦ï¼Œåœ¨é‡Œé¢å­¦åˆ°äº†è®¸å¤šï¼Œä¹Ÿæ¨èå¤§å®¶å¯ä»¥å»çœ‹ä¸€ä¸‹ï¼Œçœ‹å®Œæ„Ÿè§‰å¯ä»¥å†™å‡ ç¯‡æ–‡ç« è®°å½•æ€»ç»“ä¸€ä¸‹ï¼Œæå‡ä¸€ä¸‹å°è±¡ï¼Œæ¯•ç«Ÿå­¦åˆ°çš„ä¸œè¥¿æ„Ÿè§‰ä¸è®°ä¸‹æ¥è¿‡ä¸ä¹…å°±å®¹æ˜“å¿˜è®°ï¼Œå¤§å®¶ä¹Ÿè¦å…»æˆå­¦ä¹ è®°å½•çš„ä¹ æƒ¯ï¼Œæ–¹ä¾¿ä»¥åé‡æ¸©ï¼Œä»Šå¤©æ¥å®ç°ä¸€ä¸ª node çš„æ¨¡ç‰ˆå¼•æ“ï¼Œå½“ç„¶è¿™ä¸ªæ¨¡ç‰ˆå¼•æ“åœ¨å‰ç«¯ä¹Ÿå¯ä»¥ç”¨ã€‚ å€Ÿé‰´ejsæ ‡ç­¾æ ‡ç­¾å€Ÿé‰´ ejsï¼Œç”¨è¿‡çš„åŒå­¦è‚¯å®šçŸ¥é“ï¼Œä¾‹å¦‚ä½¿ç”¨ &lt;%= name %&gt; è¿™ç§æ ‡ç­¾æ¥å±•ç¤ºæ•°æ®ï¼Œä½¿ç”¨ &lt;% if(name){ %&gt; è¿™ç§æ ‡ç­¾æ¥åš js æ“ä½œï¼Œå¦‚ if åˆ¤æ–­/ forå¾ªç¯ï¼Œæ¯”å¦‚ä¸‹é¢12345&lt;% if (name) &#123; %&gt; &lt;h1&gt;&lt;%=name%&gt;&lt;/h1&gt;&lt;% &#125; else &#123; %&gt; &lt;h1&gt;è¯·ç™»é™†&lt;/h1&gt;&lt;% &#125; %&gt; æ¸²æŸ“æ–¹æ³•æˆ‘ä»¬å…ˆæ¥çœ‹ä¸ªç®€å•çš„æ¸²æŸ“1let str = 'hello &lt;%=name%&gt;' å‡å¦‚æˆ‘ä»¬çš„æœ‰ä¸€ä¸ªå­—æ®µ name = &#39;wclimb&#39;;12345const name = 'wclimb';let str = 'hello &lt;%=name%&gt;';str.replace(/&lt;%=([\S\s]+?)%&gt;/g, function(match,value)&#123; return name&#125;) ç»“æœ1hello wclimb æŒ‰ç…§è¿™ä¸ªæ€è·¯å°±å¾ˆç®€å•äº†ï¼Œæˆ‘ä»¬å…ˆæ¥æ€è€ƒğŸ¤”ä¸€ä¸ªé—®é¢˜ï¼Œæ•°æ®æ¸²æŸ“ç®€å•ï¼Œç›´æ¥æ›¿æ¢å°±å¯ä»¥æ¥äº†ï¼Œé‚£ä¹ˆ js çš„é€»è¾‘åˆ¤æ–­è¿™ç§æ€ä¹ˆå¤„ç†å‘¢ï¼Œæˆ‘ä»¬æ‹¿åˆ°çš„éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™é‡Œéœ€è¦å€ŸåŠ© Function æ¥å®ç°ï¼Œå…·ä½“æ¸²æŸ“æˆå¦‚ä¸‹æ ·å¼123456let tpl = '';if (name)&#123; tpl += '&lt;h1&gt;' + name ' +&lt;/h1&gt;'&#125;else&#123; tpl += '&lt;h1&gt;è¯·ç™»é™†&lt;/h1&gt;'&#125; ç„¶åä½¿ç”¨ new Function ,123const complied = new Function('name',tpl); const result = complied()console.log(result) ç›´æ¥ä¸Šä»£ç 12345678910111213141516171819202122const render = function(str, data) &#123; str = str .replace(/\n/g, "") .replace(/\s&#123;2,&#125;/g, "") .replace(/&lt;%=([\S\s]+?)%&gt;/g, function(match, val) &#123; return `'+ $&#123;val&#125; +'`; &#125;) .replace(/&lt;%([\S\s]+?)%&gt;/g, function(match, val) &#123; return `';\n$&#123;val&#125;\ntpl +='`; &#125;); str = `let tpl = '$&#123;str&#125;';return tpl;`; str = `with(option)&#123;$&#123;str&#125;;return tpl;&#125;`; const complied = new Function("option", str); let result; try &#123; result = complied(data); &#125; catch (error) &#123; console.log(error); &#125; return result;&#125;; çœ‹ç€æ•´ä¸ªä»£ç æ„Ÿè§‰æ²¡ä»€ä¹ˆï¼Œç­‰ç­‰ï¼Œwith æ˜¯ä»€ä¹ˆï¼ŸçŸ¥é“çš„åŒå­¦å¯ä»¥å¿½ç•¥åé¢çš„ï¼Œwith çš„ä½œç”¨å°±æ˜¯é€šå¸¸æˆ‘ä»¬å–æ•°æ®éƒ½æ˜¯ let people = obj.name +&#39;-&#39;+ obj.age è¿™æ ·ï¼Œæ¯æ¬¡éƒ½éœ€è¦æ‹¿ objï¼Œä¸ºäº†ç®€åŒ–æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š12345const obj = &#123;name:'wclimb', age: 26&#125;let peoplewith(obj)&#123; people = name +'-'+ age&#125; ä½†æ˜¯ä¸æ¨èç”¨ withï¼Œå®¹æ˜“å¼•èµ·ä½œç”¨åŸŸæ··ä¹±ï¼Œä½†æ˜¯æˆ‘çœ‹ Vue æºç ä¹Ÿç”¨åˆ°äº†ï¼Œè¿˜æ˜¯è°¨æ…ä¸€ç‚¹ã€‚æ¯”å¦‚å¦‚ä¸‹ï¼š123with (obj) &#123; foo = bar;&#125; å®ƒçš„ç»“æœæœ‰å¯èƒ½æ˜¯å¦‚ä¸‹å››ç§ä¹‹ä¸€: obj.foo = obj.bar;ã€obj.foo = bar;ã€foo = bar;ã€foo = obj.bar;ï¼Œè¿™äº›ç»“æœå–å†³äºå®ƒçš„ä½œç”¨åŸŸã€‚å¦‚æœä½œç”¨åŸŸé“¾ä¸Šæ²¡æœ‰å¯¼è‡´å†²çªçš„å˜é‡å­˜åœ¨ï¼Œä½¿ç”¨å®ƒåˆ™æ˜¯ å®‰å…¨çš„ã€‚ä½†åœ¨å¤šäººåˆä½œçš„é¡¹ç›®ä¸­ï¼Œè¿™å¹¶ä¸å®¹æ˜“ä¿è¯ï¼Œæ‰€ä»¥è¦æ…ç”¨ with xssæ”»å‡»æˆ‘ä»¬éœ€è¦æ—¶åˆ»å…³æ³¨å®‰å…¨ï¼Œåœ¨ä¸Šé¢çš„æ¨¡ç‰ˆä¸Šï¼Œå¦‚æœ name æ˜¯ &lt;script&gt;alert(&#39;xssæ”»å‡»&#39;)&lt;/script&gt;ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¸²æŸ“åˆ°é¡µé¢ä¸Š100%ä¼šæ˜¾ç¤ºä¸€ä¸ªå¼¹çª—ï¼Œå¾ˆå±é™©ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å¯¹å°–æ‹¬å·è¿›è¡Œè½¬ä¹‰ï¼Œæˆ‘ä»¬å•ç‹¬å†™ä¸€ä¸ªæ–¹æ³•å¤„ç† 12345678const escape = function(html) &#123; return String(html) .replace(/&amp;(?!\w+;)/g, "&amp;amp;") .replace(/&lt;/g, "&amp;lt;") .replace(/&gt;/g, "&amp;gt;") .replace(/"/g, "&amp;quot;") .replace(/'/g, "&amp;#039;"); // IEä¸‹ä¸æ”¯æŒ&amp;apos;(å•å¼•å·)è½¬ä¹‰ &#125;; å½“ç„¶ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„éƒ½éœ€è¦è½¬ä¹‰ï¼Œæ¯”å¦‚æˆ‘å°±æ˜¯æƒ³è®©ä»–è¾“å‡ºæœ‰æ ¼å¼çš„æ ‡ç­¾ &lt;h1&gt;h1&lt;/h1&gt;ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æä¾›ä¸¤ç§ä¸åŒçš„æ ‡ç­¾ï¼Œejs å°±æä¾›äº†,å¦‚ä¸‹123456&lt;%= name %&gt; ä¼šè½¬ä¹‰&lt;%- name %&gt; åŸå§‹è¾“å‡ºå¦‚æœè¾“å…¥&lt;h1&gt;h1&lt;/h1&gt;ï¼Œä»–ä»¬çš„å¯¹åº”ç»“æœæ˜¯&lt;%= name %&gt; &lt;h1&gt;h1&lt;/h1&gt;&lt;%- name %&gt; æœ‰æ ¼å¼çš„ h1 ç„¶åå®Œå–„ä¸€ä¸‹123456789101112131415161718192021222324252627282930313233const render = function(str, data) &#123;+ const escape = function(html) &#123;+ return String(html)+ .replace(/&amp;(?!\w+;)/g, "&amp;amp;")+ .replace(/&lt;/g, "&amp;lt;")+ .replace(/&gt;/g, "&amp;gt;")+ .replace(/"/g, "&amp;quot;")+ .replace(/'/g, "&amp;#039;"); // IEä¸‹ä¸æ”¯æŒ&amp;apos;(å•å¼•å·)è½¬ä¹‰+ &#125;; str = str .replace(/\n/g, "") .replace(/\s&#123;2,&#125;/g, "") .replace(/&lt;%-([\S\s]+?)%&gt;/g, function(match, val) &#123; return `'+ $&#123;val&#125; +'`; &#125;)+ .replace(/&lt;%=([\S\s]+?)%&gt;/g, function(match, val) &#123;+ return `'+ escape($&#123;val&#125;) +'`;+ &#125;) .replace(/&lt;%([\S\s]+?)%&gt;/g, function(match, val) &#123; return `';\n$&#123;val&#125;\ntpl +='`; &#125;); str = `let tpl = '$&#123;str&#125;';return tpl;`; str = `with(option)&#123;$&#123;str&#125;;return tpl;&#125;`; const complied = new Function("option", str); let result; try &#123; result = complied(data); &#125; catch (error) &#123; console.log(error); &#125; return result;&#125;; æµ‹è¯•123456const str = ` &lt;% for (var i = 0; i &lt; users.length; i++) &#123; %&gt; &lt;% var item = users[i];%&gt; &lt;p&gt;&lt;%= (i+1) %&gt;ã€&lt;%-item.name%&gt;&lt;/p&gt; &lt;% &#125; %&gt;`;const result = render(str, &#123;users: [&#123; name: "wclimb" &#125;, &#123; name: "other" &#125;]&#125;); ç»“æœ1&lt;p&gt;1ã€wclimb&lt;/p&gt;&lt;p&gt;2ã€other&lt;/p&gt; ä¸Šé¢å¯èƒ½ä¸å¥½å¤åˆ¶ï¼Œä¸‹é¢æ˜¯å®Œæ•´ä»£ç 123456789101112131415161718192021222324252627282930313233const render = function(str, data) &#123; const escape = function(html) &#123; return String(html) .replace(/&amp;(?!\w+;)/g, "&amp;amp;") .replace(/&lt;/g, "&amp;lt;") .replace(/&gt;/g, "&amp;gt;") .replace(/"/g, "&amp;quot;") .replace(/'/g, "&amp;#039;"); // IEä¸‹ä¸æ”¯æŒ&amp;apos;(å•å¼•å·)è½¬ä¹‰ &#125;; str = str .replace(/\n/g, "") .replace(/\s&#123;2,&#125;/g, "") .replace(/&lt;%-([\S\s]+?)%&gt;/g, function(match, val) &#123; return `'+ $&#123;val&#125; +'`; &#125;) .replace(/&lt;%=([\S\s]+?)%&gt;/g, function(match, val) &#123; return `'+ escape($&#123;val&#125;) +'`; &#125;) .replace(/&lt;%([\S\s]+?)%&gt;/g, function(match, val) &#123; return `';\n$&#123;val&#125;\ntpl +='`; &#125;); str = `let tpl = '$&#123;str&#125;';return tpl;`; str = `with(option)&#123;$&#123;str&#125;;return tpl;&#125;`; const complied = new Function("option", str); let result; try &#123; result = complied(data); &#125; catch (error) &#123; console.log(error); &#125; return result;&#125;; ä½¿ç”¨æ–‡ä»¶æ¨¡ç‰ˆæˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªæ¨¡ç‰ˆ test.ejs æ–‡ä»¶ï¼Œå†…å®¹ä¸ºä¹‹å‰çš„æµ‹è¯•å†…å®¹1render(fs.readFileSync(`test.ejs`, "utf8") ,&#123;users: [&#123; name: "wclimb" &#125;, &#123; name: "other" &#125;]&#125;); ç»“å°¾ä¸€ä¸ªæ¨¡ç‰ˆå¼•æ“å°±å®Œæˆäº†ï¼ŒæŒºç®€å•çš„ï¼Œè¯´å¾—æœ‰ç‚¹å¤šäº†ï¼Œä¸‹ä¸€ç¯‡å¸¦å¤§å®¶å®ç°ä¸€ä¸ªè·¯ç”±å’Œä¸­é—´ä»¶ Reference æ·±å…¥æµ…å‡ºNode.js æœ¬æ–‡åœ°å€ Nodejsä¹‹å®ç°ä¸€ä¸ªæ¨¡ç‰ˆå¼•æ“]]></content>
      <categories>
        <category>Node</category>
        <category>æ¨¡ç‰ˆå¼•æ“</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>Node</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nodejsä¹‹å®ç°ä»£ç†]]></title>
    <url>%2F2020%2F04%2F04%2Fnode-proxy%2F</url>
    <content type="text"><![CDATA[å‰è¨€æˆ‘ä»¬ä¸Šçº¿ä¸€ä¸ªç½‘ç«™ï¼Œå¾€å¾€éœ€è¦ä»£ç†æ¥å®Œæˆéœ€æ±‚ï¼Œä¸ç„¶çš„è¯å°±åªèƒ½ä½¿ç”¨ IP åŠ ç«¯å£çš„æ–¹å¼æ¥è®¿é—®åº”ç”¨ï¼Œç›®å‰åŸºæœ¬ä¸Šéƒ½ä¼šä½¿ç”¨ Nginx æ¥å®Œæˆåå‘ä»£ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¼€å‘ Node åº”ç”¨ä¸€å®šéœ€è¦ Nginx å—ï¼Ÿè‚¯å®šä¸æ˜¯ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é€šè¿‡ Node æ¥åšï¼Œä½†æ˜¯å¤§å¤šæ˜¯ä¸å»ºè®®ä½ ç”¨ Node å»å¤„ç†ï¼Œå› ä¸º Nginx åŠŸèƒ½æ›´å¼ºå¤§ï¼Œæ¯”å¦‚è´Ÿè½½å‡è¡¡ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯å¸®ä½ äº†è§£å¦‚ä½•é€šè¿‡ Node å®ç°ä»£ç† ä½¿ç”¨http-proxyæœ€ç®€å•çš„åšæ³•æ˜¯æ‹¿å·²ç»å†™å¥½çš„åŒ…ç›´æ¥ä½¿ç”¨ 1$ cnpm i http-proxy 12345678910111213141516171819const proxy = require("http-proxy").createProxyServer(&#123;&#125;);server = require("http").createServer(function(req, res) &#123; const host = req.headers.host; switch (host) &#123; case "your domain": proxy.web(req, res, &#123; target: "http://localhost:8000" &#125;); break; default: res.writeHead(200, &#123; "Content-Type": "text/plain" &#125;); res.end("Welcome to my server!"); &#125;&#125;);console.log("listening on port 80");server.listen(80); ä¸Šé¢ğŸ‘†ä»£ç ç›‘å¬ 80 ç«¯å£ï¼ˆå¦‚æœä½ çš„æœåŠ¡å™¨ç›®å‰ä½¿ç”¨æ¥ Nginxï¼Œæš‚ç”¨80 ç«¯å£çš„è¯ï¼Œéœ€è¦å…ˆæš‚åœ Nginx æœåŠ¡ï¼‰ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡è®¿é—®åŸŸåï¼ˆå‰ææ˜¯åŸŸååšå¥½äº†è§£æï¼‰ï¼Œç„¶åä½¿ç”¨ proxy.webæ–¹æ³•åå‘ä»£ç†åˆ°å½“å‰æœåŠ¡ä¸‹çš„ 8000 ç«¯å£ï¼Œåˆ°æ­¤ä¸€ä¸ªç®€å•çš„æœåŠ¡å®Œæˆäº† åŸç”Ÿå®ç°12345678910111213141516171819202122232425262728const http = require("http");const url = require("url");function request(req, res) &#123; const reqUrl = url.parse(req.url); const target = url.parse("http://localhost:3000"); const options = &#123; hostname: target.hostname, port: target.port, path: reqUrl.path, method: req.method, headers: req.headers &#125;; const proxyReq = http.request(options); proxyReq.on("response", proxyRes =&gt; &#123; res.writeHead(proxyRes.statusCode, proxyRes.headers); proxyRes.pipe(res); &#125;); req.pipe(proxyReq);&#125;http .createServer() .on("request", request) .listen(8003); æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿé€šè¿‡è®¿é—® 8003 ç«¯å£ï¼Œæˆ‘ä»¬å°†è¯·æ±‚è½¬å‘åˆ° 3000 ç«¯å£ï¼Œå¯ä»¥å¤åˆ¶å½“å‰ä»£ç å°è¯•ä¸€ä¸‹ï¼Œå‰ææ˜¯ 3000 ç«¯å£å¯ä»¥æ­£å¸¸è®¿é—®ã€‚å½“è®¿é—® 8003 ç«¯å£çš„æ—¶å€™ï¼Œå†…éƒ¨é‡æ–°è¯·æ±‚æˆ‘ä»¬éœ€è¦ä»£ç†çš„åœ°å€ï¼Œç„¶åé€šè¿‡ pipe è¿”å›è½¬å‘åçš„æ•°æ® http-proxyæºç å®ç°åŸç†æºç åœ°å€æ‰§è¡Œ proxy.web1234567function ProxyServer(options) &#123; ... this.web = this.proxyRequest = createRightProxy('web')(options); ...&#125; æºç åœ°å€ å†…éƒ¨å…³é”®ä»£ç æ‰§è¡Œäº†ä¸€ä¸‹è¿™æ®µï¼Œpasses æ˜¯ä¸€ä¸ªæ•°ç»„æ–¹æ³•ï¼ŒåŒ…å«deleteLengthã€timeoutã€XHeadersã€streamï¼Œå…³é”®ç‚¹åœ¨ streamï¼Œå…¶ä»–åŸºæœ¬æ˜¯è¾…åŠ©ä½œç”¨ï¼ŒXHeaders åŠŸèƒ½æ˜¯è®¾ç½® x-forwarded-* è¿™ç§ headerï¼Œä¸è¿‡å‰ææ˜¯ option é…ç½®äº† xfwd æ‰è¡Œï¼Œtimeout æ˜¯è®¾ç½®è¶…æ—¶æ—¶é—´çš„ï¼ŒdeleteLength åªæœ‰è¯·æ±‚æ–¹æ³•æ˜¯ OPTIONS å’Œ DELETE æ‰ä¼šæ‰§è¡Œ123456...for(var i=0; i &lt; passes.length; i++) &#123; if(passes[i](req, res, requestOptions, head, this, cbl)) &#123; // passes can return a truthy value to halt the loop break; &#125;&#125; æºç åœ°å€stream æ–¹æ³•123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596module.exports = &#123; deleteLength: ...., timeout: ..., XHeaders: ..., stream: function stream(req, res, options, _, server, clb) &#123; // And we begin! server.emit('start', req, res, options.target || options.forward); var agents = options.followRedirects ? followRedirects : nativeAgents; var http = agents.http; var https = agents.https; if(options.forward) &#123; // If forward enable, so just pipe the request var forwardReq = (options.forward.protocol === 'https:' ? https : http).request( common.setupOutgoing(options.ssl || &#123;&#125;, options, req, 'forward') ); // error handler (e.g. ECONNRESET, ECONNREFUSED) // Handle errors on incoming request as well as it makes sense to var forwardError = createErrorHandler(forwardReq, options.forward); req.on('error', forwardError); forwardReq.on('error', forwardError); (options.buffer || req).pipe(forwardReq); if(!options.target) &#123; return res.end(); &#125; &#125; // Request initalization var proxyReq = (options.target.protocol === 'https:' ? https : http).request( common.setupOutgoing(options.ssl || &#123;&#125;, options, req) ); // Enable developers to modify the proxyReq before headers are sent proxyReq.on('socket', function(socket) &#123; if(server) &#123; server.emit('proxyReq', proxyReq, req, res, options); &#125; &#125;); // allow outgoing socket to timeout so that we could // show an error page at the initial request if(options.proxyTimeout) &#123; proxyReq.setTimeout(options.proxyTimeout, function() &#123; proxyReq.abort(); &#125;); &#125; // Ensure we abort proxy if request is aborted req.on('aborted', function () &#123; proxyReq.abort(); &#125;); // handle errors in proxy and incoming request, just like for forward proxy var proxyError = createErrorHandler(proxyReq, options.target); req.on('error', proxyError); proxyReq.on('error', proxyError); function createErrorHandler(proxyReq, url) &#123; return function proxyError(err) &#123; if (req.socket.destroyed &amp;&amp; err.code === 'ECONNRESET') &#123; server.emit('econnreset', err, req, res, url); return proxyReq.abort(); &#125; if (clb) &#123; clb(err, req, res, url); &#125; else &#123; server.emit('error', err, req, res, url); &#125; &#125; &#125; (options.buffer || req).pipe(proxyReq); proxyReq.on('response', function(proxyRes) &#123; if(server) &#123; server.emit('proxyRes', proxyRes, req, res); &#125; if(!res.headersSent &amp;&amp; !options.selfHandleResponse) &#123; for(var i=0; i &lt; web_o.length; i++) &#123; if(web_o[i](req, res, proxyRes, options)) &#123; break; &#125; &#125; &#125; if (!res.finished) &#123; // Allow us to listen when the proxy has completed proxyRes.on('end', function () &#123; if (server) server.emit('end', req, res, proxyRes); &#125;); // We pipe to the response unless its expected to be handled by the user if (!options.selfHandleResponse) proxyRes.pipe(res); &#125; else &#123; if (server) server.emit('end', req, res, proxyRes); &#125; &#125;); &#125;&#125; å…³é”®ä»£ç 12345678910111213141516// Request initalizationvar proxyReq = (options.target.protocol === 'https:' ? https : http).request( common.setupOutgoing(options.ssl || &#123;&#125;, options, req));(options.buffer || req).pipe(proxyReq);proxyReq.on('response', function(proxyRes) &#123; if(!res.headersSent &amp;&amp; !options.selfHandleResponse) &#123; for(var i=0; i &lt; web_o.length; i++) &#123; if(web_o[i](req, res, proxyRes, options)) &#123; break; &#125; &#125; &#125; if (!res.finished) &#123; // We pipe to the response unless its expected to be handled by the user if (!options.selfHandleResponse) proxyRes.pipe(res); &#125; &#125;); å®ç°å¤§è‡´å’Œæˆ‘ä»¬ä¹‹å‰å†™å¾—å·®ä¸å¤šï¼Œä½†æ˜¯ä»–è€ƒè™‘å¾—æ›´å¤šï¼Œæ”¯æŒ httpsï¼Œé”™è¯¯å¤„ç†ä¹Ÿåšå¾—å¾ˆå¥½ï¼Œå·²ç»å¾ˆæˆç†Ÿäº† ç»“å°¾è‡³æ­¤å°±åŸºæœ¬è®²å®Œäº†ï¼Œæœ¬æ–‡æ„åœ¨å®æ“ï¼Œç†è®ºè®²è§£æ¶‰åŠæå°‘ï¼Œåœ¨å†™ä¸€ä¸ªåŠŸèƒ½çš„æ—¶å€™ï¼Œè¿˜æ˜¯è¦å¤šäº†è§£ä¸€ä¸‹å†…éƒ¨çš„åŸç†çŸ¥è¯†ï¼Œèƒ½å¸®åŠ©ä½ æ›´å¥½çš„ç†è§£ï¼Œå¦‚æœé”™è¯¯è¿˜æœ›æŒ‡æ­£ã€‚ æœ¬æ–‡åœ°å€ Nodejsä¹‹å®ç°ä»£ç†]]></content>
      <categories>
        <category>Node</category>
        <category>ä»£ç†</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>Node</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Vueæºç ä¹‹nextTick]]></title>
    <url>%2F2020%2F03%2F25%2Fvue-sourse-code-nextTick%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä»Šå¤©æˆ‘ä»¬å¼€å§‹è®²ä¸€ä¸‹ Vue çš„ nextTick æ–¹æ³•çš„å®ç°ï¼Œæ— è®ºæ˜¯æºç è¿˜æ˜¯å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸éœ€è¦ä½¿ç”¨åˆ° nextTickï¼ŒVue åœ¨æ›´æ–° DOM æ—¶æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œåªè¦ä¾¦å¬åˆ°æ•°æ®å˜åŒ–ï¼ŒVue å°†å¼€å¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ç¼“å†²åœ¨åŒä¸€äº‹ä»¶å¾ªç¯ä¸­å‘ç”Ÿçš„æ‰€æœ‰æ•°æ®å˜æ›´ã€‚å¦‚æœåŒä¸€ä¸ª watcher è¢«å¤šæ¬¡è§¦å‘ï¼Œåªä¼šè¢«æ¨å…¥åˆ°é˜Ÿåˆ—ä¸­ä¸€æ¬¡ã€‚è¿™ç§åœ¨ç¼“å†²æ—¶å»é™¤é‡å¤æ•°æ®å¯¹äºé¿å…ä¸å¿…è¦çš„è®¡ç®—å’Œ DOM æ“ä½œæ˜¯éå¸¸é‡è¦çš„ã€‚ç„¶åï¼Œåœ¨ä¸‹ä¸€ä¸ªçš„äº‹ä»¶å¾ªç¯ â€œtickâ€ ä¸­ï¼ŒVue åˆ·æ–°é˜Ÿåˆ—å¹¶æ‰§è¡Œå®é™… (å·²å»é‡çš„) å·¥ä½œã€‚Vue åœ¨å†…éƒ¨å¯¹å¼‚æ­¥é˜Ÿåˆ—å°è¯•ä½¿ç”¨åŸç”Ÿçš„ Promise.thenã€MutationObserver å’Œ setImmediateï¼Œå¦‚æœæ‰§è¡Œç¯å¢ƒä¸æ”¯æŒï¼Œåˆ™ä¼šé‡‡ç”¨ setTimeout(fn, 0) ä»£æ›¿ã€‚ æºç https://github.com/wclimb/vue/blob/dev/src/core/util/next-tick.js12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485export let isUsingMicroTask = false// å‚¨å­˜å›è°ƒconst callbacks = []// æ˜¯å¦æ­£åœ¨å¤„ç†ä¸­let pending = false// æ‰¹é‡æ‰§è¡Œå›è°ƒfunction flushCallbacks () &#123; // æ¢å¤çŠ¶æ€ä»¥ä¾¿åç»­èƒ½æ­£å¸¸ä½¿ç”¨ pending = false const copies = callbacks.slice(0) // æ‰§è¡Œä¹‹å‰å…ˆæŠŠå›è°ƒæ¸…ç©ºï¼Œä»¥ä¾¿åç»­èƒ½æ­£å¸¸è°ƒç”¨ callbacks.length = 0 for (let i = 0; i &lt; copies.length; i++) &#123; copies[i]() &#125;&#125;let timerFunc// åˆ¤æ–­æ˜¯å¦æ”¯æŒPromiseï¼Œä½¿ç”¨Promiseçš„å¼‚æ­¥ï¼Œå±äºå¾®ä»»åŠ¡if (typeof Promise !== 'undefined' &amp;&amp; isNative(Promise)) &#123; const p = Promise.resolve() timerFunc = () =&gt; &#123; p.then(flushCallbacks) if (isIOS) setTimeout(noop) &#125; isUsingMicroTask = true // åˆ¤æ–­æ˜¯å¦æ”¯æŒMutationObserverï¼Œå±äºå¾®ä»»åŠ¡&#125; else if (!isIE &amp;&amp; typeof MutationObserver !== 'undefined' &amp;&amp; ( isNative(MutationObserver) || // iOS 7.x å¹³å°å¤„ç†çš„åˆ¤æ–­ MutationObserver.toString() === '[object MutationObserverConstructor]')) &#123; let counter = 1 const observer = new MutationObserver(flushCallbacks) const textNode = document.createTextNode(String(counter)) observer.observe(textNode, &#123; characterData: true &#125;) timerFunc = () =&gt; &#123; counter = (counter + 1) % 2 textNode.data = String(counter) &#125; isUsingMicroTask = true // æ˜¯å¦æ”¯æŒsetImmediateï¼Œå±äºå®ä»»åŠ¡&#125; else if (typeof setImmediate !== 'undefined' &amp;&amp; isNative(setImmediate)) &#123; timerFunc = () =&gt; &#123; setImmediate(flushCallbacks) &#125;&#125; else &#123; // éƒ½ä¸æ”¯æŒå°±ç›´æ¥ä½¿ç”¨å®ä»»åŠ¡ setTimeout timerFunc = () =&gt; &#123; setTimeout(flushCallbacks, 0) &#125;&#125;// nextTickæ–¹æ³•export function nextTick (cb?: Function, ctx?: Object) &#123; let _resolve // æ”¶é›†å›è°ƒå‡½æ•° callbacks.push(() =&gt; &#123; if (cb) &#123; try &#123; cb.call(ctx) &#125; catch (e) &#123; handleError(e, ctx, 'nextTick') &#125; &#125; else if (_resolve) &#123; // å¦‚æœæ²¡æœ‰ä¼ é€’å›è°ƒå‡½æ•°ä¼šæ‰§è¡Œ_resolveï¼Œæ‰§è¡Œçš„ä»£ç å…¶å®å°±æ˜¯callback this.$nextTick().then(callback) _resolve(ctx) &#125; &#125;) // å¦‚æœçŠ¶æ€æ²¡æœ‰æ­£åœ¨å¤„ç†æ‰§è¡Œ if (!pending) &#123; // ç½®ä¸ºå¤„ç†ä¸­ pending = true // æ‰§è¡Œåˆšåˆšä¸€ç³»åˆ—åˆ¤æ–­ä¸‹æ¥è·å¾—çš„å‡½æ•°ï¼Œæœ€ç»ˆä¼šæ‰§è¡ŒflushCallbacksæ–¹æ³• timerFunc() &#125; // å¦‚æœæ²¡æœ‰ä¼ é€’å›è°ƒå‡½æ•°å°±ä¼šè¿”å›ä¸€ä¸ªPromiseï¼Œthis.$nextTick().then(callback)ï¼Œæ‰§è¡Œ _resolve(ctx) ä¹‹åä¼šæ‰§è¡Œcallback if (!cb &amp;&amp; typeof Promise !== 'undefined') &#123; return new Promise(resolve =&gt; &#123; _resolve = resolve &#125;) &#125;&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Vue ä¼šå€ŸåŠ© timerFunc æ–¹æ³•å¼‚æ­¥æ‰¹é‡å¤„ç†å›è°ƒå‡½æ•°ï¼ŒtimerFunc å¯èƒ½æ˜¯ Promise.thenã€MutationObserver ã€ setImmediateã€setTimeoutã€‚åˆ¤æ–­ä»–ä»¬çš„æ”¯æŒç¨‹åº¦ï¼Œé™çº§å¤„ç†ã€‚å¦‚æœæ²¡æœ‰ä¼ é€’å›è°ƒå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªPromiseï¼Œå¹¶æŠŠ resolve æ–¹æ³•èµ‹å€¼ç»™ _resolveï¼Œè¿™æ ·æˆ‘ä»¬ this.$nextTick().then(callback)ï¼Œcallbackå°±ä¼šè¢«è§¦å‘äº†ã€‚è‡³äºä¸ºä»€ä¹ˆè¦ä½¿ç”¨ timerFunc è¿™ç§æ–¹å¼ï¼Œå¼€å¤´å·²ç»è®²äº†ï¼Œæ˜¯å› ä¸º Vue æ˜¯å¼‚æ­¥æ›´æ–°é˜Ÿåˆ—ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å»é™¤é‡å¤æ•°æ®å¯¹äºé¿å…ä¸å¿…è¦çš„è®¡ç®—å’Œ DOM æ“ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬æ“ä½œä¸€ä¸ªæ•°æ®ï¼Œå¹¶ä¸”é‡å¤å¤šæ¬¡ç»™ä»–èµ‹ä¸ä¸€æ ·çš„å€¼ï¼Œthis.a = 1;this.a = 2; this.a = 3ï¼Œç­”æ¡ˆç»“æœæœ€åè‡ªç„¶æ˜¯3ï¼Œä½†æ˜¯ Vue ä¸ä¼šå»æ›´æ–°ä¸‰æ¬¡ DOM æˆ–è€…æ•°æ®ï¼Œè¿™æ ·ä¼šé€ æˆä¸å¿…è¦çš„æµªè´¹ï¼Œæ‰€ä»¥éœ€è¦åšå¼‚æ­¥å¤„ç†å» update ä»–ä»¬ï¼Œæ—¢ç„¶æ›´æ–°æ˜¯å¼‚æ­¥çš„ï¼Œæˆ‘ä»¬å¦‚æœæƒ³ç›´æ¥é©¬ä¸Šè·å–æœ€æ–°çš„æ•°æ®è‡ªç„¶æ˜¯ä¸è¡Œçš„ï¼Œéœ€è¦å€ŸåŠ© nextTickï¼Œåœ¨ä¸‹ä¸€æ¬¡äº‹ä»¶å¾ªç¯ä¸­å»è·å–ï¼Œå¯ä»¥çœ‹ä¸‹é¢ğŸ‘‡çš„ä»£ç  å®é™…ä»£ç æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä»£ç 1&lt;div id="app" @click="fn"&gt;&#123;&#123;code&#125;&#125;&lt;/div&gt; 123456789101112131415var vm = new Vue(&#123; el: '#app', data: &#123; code: 0 &#125;, methods:&#123; fn()&#123; this.code = 1 console.log(this.$el.textConent); // 0 this.$nextTick(()=&gt;&#123; console.log(this.$el.textConent) // 1 &#125;) &#125; &#125;&#125;) ä½ ä¹Ÿå¯ä»¥è¿™æ · 1234567891011121314151617var vm = new Vue(&#123; el: '#app', data: &#123; code: 0 &#125;, methods:&#123; async fn()&#123; this.code = 1 console.log(this.$el.textConent); // 0- this.$nextTick(()=&gt;&#123;- console.log(this.$el.textConent) // 1- &#125;)+ await this.$nextTick()+ console.log(this.$el.textConent) // 1 &#125; &#125;&#125;) æ€»ç»“ä»Šå¤©å¸¦å¤§å®¶äº†è§£äº†ä¸€ä¸‹ nextTick çš„å†…éƒ¨å®ç°ï¼Œè™½ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ setTimeout å»åšï¼Œä½†æ˜¯åŸºäºæ€§èƒ½å’Œæ‰§è¡Œé¡ºåºçš„é—®é¢˜(å¾®ä»»åŠ¡æ‰§è¡Œå¿«äºå®ä»»åŠ¡)ï¼Œæ¨èè¿˜æ˜¯ä½¿ç”¨ nextTick æ›´å¥½ä¸€ç‚¹ã€‚ æœ¬æ–‡åœ°å€ Vueæºç ä¹‹nextTick]]></content>
      <categories>
        <category>javascript</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>vue</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’¸ä¸€ä¸ªç®€æ˜“Virtual DOM]]></title>
    <url>%2F2020%2F03%2F19%2Fsimple-virtual-dom%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¸Šä¸€ç¯‡æˆ‘ä»¬è®²äº†ä¸€ä¸‹ Vue çš„ è™šæ‹ŸDOMï¼Œä»åˆ›å»ºåˆ°æ›´æ–°æ•´ä¸ªæµç¨‹ã€‚ä»Šå¤©å¸¦å¤§å®¶æ’¸ä¸€ä¸ªç®€æ˜“çš„è™šæ‹ŸDOMï¼Œæœ¬æ–‡çš„å¤§éƒ¨åˆ†å€Ÿé‰´ Vue æºç  æµè§ˆå™¨æ¸²æŸ“æµç¨‹ æ‘˜è‡ªæµè§ˆå™¨å·¥ä½œåŸç†ä¸å®è·µ æ¸²æŸ“è¿›ç¨‹å°† HTML å†…å®¹è½¬æ¢ä¸ºèƒ½å¤Ÿè¯»æ‡‚çš„ DOM æ ‘ç»“æ„ã€‚ æ¸²æŸ“å¼•æ“å°† CSS æ ·å¼è¡¨è½¬åŒ–ä¸ºæµè§ˆå™¨å¯ä»¥ç†è§£çš„ styleSheetsï¼Œè®¡ç®—å‡º DOM èŠ‚ç‚¹çš„æ ·å¼ã€‚ åˆ›å»ºå¸ƒå±€æ ‘ï¼Œå¹¶è®¡ç®—å…ƒç´ çš„å¸ƒå±€ä¿¡æ¯ã€‚ å¯¹å¸ƒå±€æ ‘è¿›è¡Œåˆ†å±‚ï¼Œå¹¶ç”Ÿæˆåˆ†å±‚æ ‘ã€‚ ä¸ºæ¯ä¸ªå›¾å±‚ç”Ÿæˆç»˜åˆ¶åˆ—è¡¨ï¼Œå¹¶å°†å…¶æäº¤åˆ°åˆæˆçº¿ç¨‹ã€‚ åˆæˆçº¿ç¨‹å°†å›¾å±‚åˆ†æˆå›¾å—ï¼Œå¹¶åœ¨å…‰æ …åŒ–çº¿ç¨‹æ± ä¸­å°†å›¾å—è½¬æ¢æˆä½å›¾ã€‚ åˆæˆçº¿ç¨‹å‘é€ç»˜åˆ¶å›¾å—å‘½ä»¤ DrawQuad ç»™æµè§ˆå™¨è¿›ç¨‹ã€‚ æµè§ˆå™¨è¿›ç¨‹æ ¹æ® DrawQuad æ¶ˆæ¯ç”Ÿæˆé¡µé¢ï¼Œå¹¶æ˜¾ç¤ºåˆ°æ˜¾ç¤ºå™¨ä¸Šã€‚ å‡†å¤‡é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½ä»€ä¹ˆæ˜¯è™šæ‹ŸDOMï¼Œä¸ºä»€ä¹ˆè¦ç”¨åˆ°å®ƒï¼Œè™šæ‹ŸDOM æ˜¯ä½¿ç”¨ javascript å¯¹è±¡æ¥æè¿° DOM æ ‘ï¼Œä¸€åˆ‡çš„æ›´æ–°ä¿®æ”¹éƒ½æ˜¯åœ¨æ›´æ”¹è¿™ä¸ªå¯¹è±¡ï¼Œç„¶åååº”åˆ°çœŸå®çš„ DOM ä¸‹ã€‚è¦è¯´ä¸ºä»€ä¹ˆè¦ç”¨åˆ°å®ƒï¼Œè‚¯å®šæ˜¯å› ä¸ºæ€§èƒ½å¥½ï¼Œå› ä¸ºç›´æ¥æ“ä½œ DOM çš„ä»£ä»·æ˜¯å¾ˆå¤§çš„ï¼Œæ¯”å¦‚ï¼Œä¸€æ¬¡æ“ä½œä¸­æœ‰ 10 æ¬¡æ›´æ–° DOM çš„åŠ¨ä½œï¼Œè™šæ‹ŸDOM ä¸ä¼šç«‹å³æ“ä½œ DOMï¼Œè€Œæ˜¯å°†è¿™ 10 æ¬¡æ›´æ–°çš„ diff å†…å®¹ä¿å­˜åˆ°æœ¬åœ°ä¸€ä¸ª js å¯¹è±¡ä¸­ï¼Œæœ€ç»ˆå°†è¿™ä¸ª js å¯¹è±¡ä¸€æ¬¡æ€§ ååº”åˆ° DOM æ ‘ä¸Šï¼Œå†è¿›è¡Œåç»­æ“ä½œï¼Œé¿å…å¤§é‡æ— è°“çš„è®¡ç®—ã€‚ä¹Ÿæœ‰äººåé©³è¯´ï¼Œä½¿ç”¨ è™šæ‹ŸDOM æ¯”èµ·æ“ä½œçœŸå® DOM è¦æ…¢ï¼Œçš„ç¡®å¦‚æ­¤ï¼Œä½¿ç”¨ è™šæ‹ŸDOM ç¡®å®æ²¡æœ‰åŸç”Ÿæ“ä½œå¿«ï¼Œä½†æ˜¯æ—¢ç„¶ä½¿ç”¨äº†æ¡†æ¶ï¼Œä¼˜åŒ–æ¡†æ¶éƒ½ä¼šå¸®ä½ åšï¼Œä½ ä¸ç”¨è‡ªå·±å»æ‰‹åŠ¨åšDOMçš„ä¼˜åŒ–ï¼Œä¸ç”¨å¤„å¤„å»è€ƒè™‘æ“ä½œ DOM å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œä½¿ç”¨ è™šæ‹ŸDOM å¯ä»¥è®©æ€§èƒ½å¾—åˆ°æœ‰åŠ›çš„ä¿è¯ã€‚ å¯ä»¥å‚è€ƒçŸ¥ä¹é—®é¢˜ ç½‘ä¸Šéƒ½è¯´æ“ä½œçœŸå® DOM æ…¢ï¼Œä½†æµ‹è¯•ç»“æœå´æ¯” React æ›´å¿«ï¼Œä¸ºä»€ä¹ˆï¼Ÿ å®ç°ä½¿ç”¨jså¯¹è±¡æ¨¡æ‹ŸDOMæ ‘è¿™é‡Œæˆ‘ä»¬ä¸ä½¿ç”¨ Vue çš„é‚£ç§æ ¹æ® template ç”Ÿæˆ è™šæ‹ŸDOM çš„æ–¹æ³•ï¼Œé‚£æ ·å¤ªå¤æ‚äº†ï¼Œè¿™é‡Œåªè®²ç®€å•çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ js å¯¹è±¡æ¥æè¿° DOM æ¯”å¦‚å¦‚ä¸‹ çš„html ä»£ç 12345678&lt;div id="app"&gt; &lt;h1 data-title="header"&gt;Virtual Dom&lt;/h1&gt; &lt;ul class="ul1"&gt; &lt;li&gt;1&lt;/li&gt; &lt;li&gt;2&lt;/li&gt; &lt;li&gt;3&lt;/li&gt; &lt;/ul&gt;&lt;/div&gt; ä½¿ç”¨ js å¯¹è±¡è¡¨ç¤º123456789101112131415161718192021222324252627function vnode(tag, data, children) &#123; return &#123; tag, data, children, &#125;;&#125;function createElement(vNode) &#123; let el; if (vNode.tag === 'textNode') &#123; el = document.createTextNode(vNode.children[0]); &#125; else &#123; el = document.createElement(vNode.tag); for (const key in vNode.data) &#123; if (vNode.data.hasOwnProperty(key)) &#123; el.setAttribute(key, vNode.data[key]); &#125; &#125; if (Array.isArray(vNode.children) &amp;&amp; vNode.children.length &gt; 0) &#123; vNode.children.forEach(val =&gt; &#123; el.appendChild(createElement(val)); &#125;); &#125; &#125; vNode.$el = el; return el;&#125; tagï¼šè¡¨ç¤ºå½“å‰å…ƒç´ çš„æ ‡ç­¾åï¼Œåé¢ä¼šçœ‹åˆ°æœ‰ textNode çš„æ ‡ç­¾åï¼Œå®é™…ä¸Šæ²¡æœ‰ï¼Œåœ¨è¿™é‡Œç‰¹æŒ‡æ–‡æœ¬èŠ‚ç‚¹ dataï¼šè¡¨ç¤ºå½“å‰å…ƒç´ ä¸Šçš„ attribute childrenï¼šè¡¨ç¤ºå½“å‰å…ƒç´ çš„å­å…ƒç´  createElementï¼šä½¿ç”¨è¯¥æ–¹æ³•æ¸²æŸ“åˆ°é¡µé¢ä¸Š ç”Ÿæˆ vNode12345678910const vNode1 = vnode('div', &#123; id: 'app' &#125;, [ vnode('h1', &#123; 'data-title': 'header' &#125;, [ vnode('textNode', &#123;&#125;, ['Virtual Dom']), ]), vnode('ul', &#123; class: 'ul1' &#125;, [ vnode('li', &#123;&#125;, [vnode('textNode', &#123;&#125;, ['1'])]), vnode('li', &#123;&#125;, [vnode('textNode', &#123;&#125;, ['2'])]), vnode('li', &#123;&#125;, [vnode('textNode', &#123;&#125;, ['3'])]), ]),]); ååº”åˆ°é¡µé¢ä¸Šï¼ŒæŠŠç»“æœæ”¾åˆ° body ä¸‹1document.body.appendChild(createElement(vNode1)) æ•ˆæœ æ›´æ–°Virtual Domæ›´æ–°ä¹‹å‰æˆ‘ä»¬æŠŠä¹‹å‰çš„æ—§çš„è™šæ‹ŸDOM liåˆ—è¡¨ä¸Šçš„ keyå€¼åŠ ä¸Š oldVNode12345678910const vNode1 = vnode('div', &#123; id: 'app' &#125;, [ vnode('h1', &#123; 'data-title': 'header' &#125;, [ vnode('textNode', &#123;&#125;, ['Virtual Dom']), ]), vnode('ul', &#123; class: 'ul1' &#125;, [ vnode('li', &#123;key: 1&#125;, [vnode('textNode', &#123;&#125;, ['1'])]), vnode('li', &#123;key: 2&#125;, [vnode('textNode', &#123;&#125;, ['2'])]), vnode('li', &#123;key: 3&#125;, [vnode('textNode', &#123;&#125;, ['3'])]), ]),]); newVNode1234567891011const vNode2 = vnode('div', &#123; id: 'app' &#125;, [ vnode('h4', &#123; id: 'header'&#125;, [ vnode('textNode', &#123;&#125;, ['å…ƒç´ æ ‡ç­¾æ”¹å˜äº†']), ]), vnode('ul', &#123; class: 'ul2' &#125;, [ vnode('li', &#123;key: 5&#125;, [vnode('textNode', &#123;&#125;, ['5'])]), vnode('li', &#123;key: 2&#125;, [vnode('textNode', &#123;&#125;, ['2'])]), vnode('li', &#123;key: 1&#125;, [vnode('textNode', &#123;&#125;, ['1'])]), vnode('li', &#123;key: 4&#125;, [vnode('textNode', &#123;&#125;, ['4'])]), ]),]); ä½ ä¼šå‘ç°ä¸ºæŠŠ h1 æ ‡ç­¾æ”¹æˆäº† h4,æ–‡æœ¬é‚£æ ·ä¹Ÿæ”¹å˜äº†ï¼Œåœ¨ ul åˆ—è¡¨é‡Œï¼ŒæŠŠä»–ä»¬çš„é¡ºåºæ”¹å˜äº†ï¼Œå¹¶æ’å…¥åˆ é™¤äº†éƒ¨åˆ†å…ƒç´ ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥å®šåˆ¶æ›´å¤æ‚çš„ç»“æ„ å¼€å§‹ diffï¼Œè°ƒç”¨ patchVnode æ–¹æ³•1patchVnode(vNode1, vNode2); 12345678910111213141516171819202122232425262728293031323334353637function patchVnode(oldVnode, vnode) &#123; // 1. æ–‡æœ¬èŠ‚ç‚¹éƒ½ä¸€æ · if (oldVnode.tag === 'textNode' || vnode.tag === 'textNode') &#123; if (oldVnode.children[0] !== vnode.children[0]) &#123; oldVnode.$el.textContent = vnode.children[0]; &#125; return; &#125; // 2. dataæ˜¯å¦è¢«æ”¹å˜ if (dataChanged(oldVnode.data, vnode.data)) &#123; const oldData = oldVnode.data; const newData = vnode.data; const oldDataKeys = Object.keys(oldData); const newDataKeys = Object.keys(newData); if (oldDataKeys.length === 0) &#123; for (let i = 0; i &lt; oldDataKeys.length; i++) &#123; oldVnode.$el.removeAttribute(oldData[i]); &#125; &#125; else &#123; const filterKeys = new Set([...oldDataKeys, ...newDataKeys]); for (let key of filterKeys) &#123; if (isUndef(newData[key])) &#123; oldVnode.$el.removeAttribute(oldData[key]); &#125; else if (newData[key] !== oldData[key]) &#123; oldVnode.$el.setAttribute(key, newData[key]); &#125; &#125; &#125; &#125; var oldCh = oldVnode.children; var ch = vnode.children; // å¦‚æœæ–°æ—§å­èŠ‚ç‚¹ä»ç„¶å­˜åœ¨ï¼Œåˆ™ç»§ç»­diffå®ƒçš„å­èŠ‚ç‚¹ if (oldCh.length || ch.length) &#123; updateChildren(oldVnode.$el, oldCh, ch); &#125;&#125; ä¸Šé¢å…ˆå¯¹æœ€å¤–å±‚è¿›è¡Œæ¯”è¾ƒï¼Œ å¦‚æœæ˜¯æ–‡æœ¬ï¼Œè¯´æ˜å·²ç»æ˜¯å½“å‰æœ€åçš„ä¸€ä¸ªå…ƒç´ äº†ï¼Œåé¢ä¸éœ€è¦ç»§ç»­æ‰§è¡Œï¼Œå‘ç°ä¸ä¸€æ ·åˆ™æ”¹å˜ä»–ä»¬ åˆ¤æ–­ data æ˜¯å¦å˜æ›´ï¼Œå¦‚æœå˜æ›´åˆ™è¿›è¡Œæ’å…¥æˆ–è€…åˆ é™¤ä¿®æ”¹æ“ä½œ ç»§ç»­æ‰¾å®ƒçš„å­å…ƒç´ æ˜¯å¦æ“ä½œï¼Œå¦‚æœå­˜åœ¨è¿›è¡Œå­å…ƒç´ çš„ diffï¼Œä½¿ç”¨ updateChildren updateChildren1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465function updateChildren(parentElm, oldCh, newCh) &#123; if (oldCh) var oldStartIdx = 0; var newStartIdx = 0; var oldEndIdx = oldCh.length - 1; var oldStartVnode = oldCh[0]; var oldEndVnode = oldCh[oldEndIdx]; var newEndIdx = newCh.length - 1; var newStartVnode = newCh[0]; var newEndVnode = newCh[newEndIdx]; var oldKeyToIdx, idxInOld, vnodeToMove, refElm; while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123; if (isUndef(oldStartVnode)) &#123; oldStartVnode = oldCh[++oldStartIdx]; &#125; else if (isUndef(oldEndVnode)) &#123; oldEndVnode = oldCh[--oldEndIdx]; &#125; else if (sameVnode(oldStartVnode, newStartVnode)) &#123; patchVnode(oldStartVnode, newStartVnode); oldStartVnode = oldCh[++oldStartIdx]; newStartVnode = newCh[++newStartIdx]; &#125; else if (sameVnode(oldEndVnode, newEndVnode)) &#123; patchVnode(oldEndVnode, newEndVnode); oldEndVnode = oldCh[--oldEndIdx]; newEndVnode = newCh[--newEndIdx]; &#125; else if (sameVnode(oldStartVnode, newEndVnode)) &#123; patchVnode(oldStartVnode, newEndVnode); parentElm.insertBefore(oldStartVnode.$el, oldEndVnode.$el.nextSibling); oldStartVnode = oldCh[++oldStartIdx]; newEndVnode = newCh[--newEndIdx]; &#125; else if (sameVnode(oldEndVnode, newStartVnode)) &#123; patchVnode(oldEndVnode, newStartVnode); parentElm.insertBefore(oldEndVnode.$el, oldStartVnode.$el); oldEndVnode = oldCh[--oldEndIdx]; newStartVnode = newCh[++newStartIdx]; &#125; else &#123; if (isUndef(oldKeyToIdx)) &#123; oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx); &#125; idxInOld = isDef(newStartVnode.key) ? oldKeyToIdx[newStartVnode.key] : findIdxInOld(newStartVnode, oldCh, oldStartIdx, oldEndIdx); if (isUndef(idxInOld)) &#123; parentElm.insertBefore(createElement(newStartVnode), oldStartVnode.$el); &#125; else &#123; vnodeToMove = oldCh[idxInOld]; if (sameVnode(vnodeToMove, newStartVnode)) &#123; patchVnode(vnodeToMove, newStartVnode); oldCh[idxInOld] = undefined; parentElm.insertBefore(vnodeToMove.$el, oldStartVnode.$el); &#125; else &#123; parentElm.insertBefore( createElement(newStartVnode), oldStartVnode.$el, ); &#125; &#125; newStartVnode = newCh[++newStartIdx]; &#125; &#125; if (oldStartIdx &gt; oldEndIdx) &#123; addVnodes(parentElm, newCh, newStartIdx, newEndIdx); &#125; else if (newStartIdx &gt; newEndIdx) &#123; removeVnodes(parentElm, oldCh, oldStartIdx, oldEndIdx); &#125;&#125; ä¸Šé¢ä»£ç åŸºæœ¬å‚ç…§ Vue æºç çš„æ–¹æ³•ï¼Œå¦‚æœä½ é˜…è¯»è¿‡æˆ‘ä¹‹å‰å‘çš„æ–‡ç« ï¼Œè‚¯å®šæœ‰å°è±¡ï¼Œä»£ç å†…å°±ä¸å¤šä½œè§£é‡Šäº†ï¼Œä¸Šä¸€ç¯‡æ–‡ç« çš„æ³¨é‡Šè¯´å¾—å¾ˆæ˜ç™½ï¼Œæ„Ÿå…´è¶£å¯ä»¥å»ç¿»é˜…ä¸€ä¸‹ã€‚ çœ‹ä¸€ä¸‹ç»“æœï¼Œä¸€åˆ‡éƒ½æ­£å¸¸ ç›¸å…³æºç å·²ç»æ”¾åœ¨ GitHub: https://github.com/wclimb/simple-virtual-dom æ€»ç»“æœ¬æ–‡å¸¦å¤§å®¶æ’¸äº†ä¸€ä¸ª è™šæ‹ŸDOMï¼Œä»£ç å¤§éƒ¨åˆ†å‚ç…§ Vue çš„æºç æ”¹é€ ï¼Œå¹¶æ²¡æœ‰è¿‡å¤šçš„å»é˜è¿°ä»£ç å†…çš„è¿è¡Œæµç¨‹ï¼Œå› ä¸ºä¸Šä¸€ç¯‡å·²ç»å¤§è‡´è®²è¿‡äº†ï¼Œæœ¬æ–‡æ„åœ¨æŠ›ç –å¼•ç‰ï¼Œå¦‚æœ‰é—®é¢˜è¿˜æœ›æŒ‡å‡º æœ¬æ–‡åœ°å€ æ’¸ä¸€ä¸ªç®€æ˜“Virtual Dom]]></content>
      <categories>
        <category>javascript</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>vue</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Vueæºç ä¹‹è™šæ‹ŸDOM]]></title>
    <url>%2F2020%2F03%2F17%2Fvue-source-code-virtual-dom%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¸Šä¸€ç¯‡æˆ‘ä»¬è®²äº†ä¸€ä¸‹ Vue çš„åŒå‘æ•°æ®ç»‘å®šåŸç†ï¼Œä»Šå¤©æˆ‘ä»¬å¼€å§‹è®²ä¸€ä¸‹ Vue çš„ è™šæ‹ŸDOMã€‚æœ¬æ–‡ä¼šå…ˆåˆ†æä¸€ä¸‹ Vue çš„ è™šæ‹ŸDOMï¼Œç„¶åä¸‹ä¸€ç¯‡æ–‡ç« ä¼šå¸¦å¤§å®¶æ’¸ä¸€ä¸ªç®€æ˜“çš„ è™šæ‹ŸDOM Vueè™šæ‹ŸDOMåˆ›å»ºè™šæ‹ŸDOMhttps://github.com/wclimb/vue/blob/dev/src/core/vdom/vnode.js12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455export default class VNode &#123; tag: string | void; data: VNodeData | void; children: ?Array&lt;VNode&gt;; text: string | void; elm: Node | void; ns: string | void; context: Component | void; // rendered in this component's scope functionalContext: Component | void; // only for functional component root nodes key: string | number | void; componentOptions: VNodeComponentOptions | void; componentInstance: Component | void; // component instance parent: VNode | void; // component placeholder node raw: boolean; // contains raw HTML? (server only) isStatic: boolean; // hoisted static node isRootInsert: boolean; // necessary for enter transition check isComment: boolean; // empty comment placeholder? isCloned: boolean; // is a cloned node? isOnce: boolean; // is a v-once node? constructor ( tag?: string, data?: VNodeData, children?: ?Array&lt;VNode&gt;, text?: string, elm?: Node, context?: Component, componentOptions?: VNodeComponentOptions ) &#123; this.tag = tag this.data = data this.children = children this.text = text this.elm = elm this.ns = undefined this.context = context this.functionalContext = undefined this.key = data &amp;&amp; data.key this.componentOptions = componentOptions this.componentInstance = undefined this.parent = undefined this.raw = false this.isStatic = false this.isRootInsert = true this.isComment = false this.isCloned = false this.isOnce = false &#125; // DEPRECATED: alias for componentInstance for backwards compat. /* istanbul ignore next */ get child (): Component | void &#123; return this.componentInstance &#125;&#125; ä»¥ä¸Šä»£ç æ˜¯Vueåˆ›å»º è™šæ‹ŸDOM çš„ç±»ï¼Œä¸€çœ¼çœ‹è¿‡å»æ˜¯ä¸æ˜¯æ„Ÿè§‰ä¸œè¥¿å¤ªå¤šäº†ï¼Ÿå…¶å®æˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸»è¦çš„å‡ ä¸ªå‚æ•°å°±å¯ä»¥äº†ï¼Œtag ã€dataã€childrenã€textã€elmã€key tag è¡¨ç¤ºå½“å‰ vnode çš„æ ‡ç­¾ç±»å‹ï¼Œæ¯”å¦‚ div ul data è¡¨ç¤ºå½“å‰ vnode æ ‡ç­¾ä¸Šçš„ attributeï¼Œå¯èƒ½æ˜¯classã€idã€key children è¡¨ç¤ºå½“å‰ vnode çš„å­èŠ‚ç‚¹ text è¡¨ç¤ºæ–‡æœ¬å†…å®¹ elm è¡¨ç¤ºå½“å‰ vnode çš„çœŸå® DOM èŠ‚ç‚¹ key diffç®—æ³• éœ€è¦ç”¨åˆ°ï¼Œå°±æ˜¯æˆ‘ä»¬å¼€å‘ä¸­å†™çš„ :key ä»å…¥å£å¼€å§‹æˆ‘ä»¬ä»å…¥å£å¼€å§‹ï¼Œçœ‹ä¸€ä¸‹ Vue å®ç° è™šæ‹ŸDOM çš„æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Œhttps://github.com/wclimb/vue/blob/dev/src/core/instance/init.js#L1512345678910111213141516171819202122export function initMixin (Vue: Class&lt;Component&gt;) &#123; Vue.prototype._init = function (options?: Object) &#123; ...... // expose real self vm._self = vm initLifecycle(vm) initEvents(vm) initRender(vm) callHook(vm, 'beforeCreate') initInjections(vm) // resolve injections before data/props initState(vm) initProvide(vm) // resolve provide after data/props callHook(vm, 'created') ...... if (vm.$options.el) &#123; vm.$mount(vm.$options.el) &#125; &#125;&#125; ä¸Šé¢è¿™æ®µä»£ç åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ‰è®²è¿‡ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåªéœ€è¦å…³å¿ƒ vm.$mount(vm.$options.el) è¿™æ®µä»£ç ï¼Œä»è¿™é‡Œå¼€å§‹æŒ‚è½½DOM $mounthttps://github.com/wclimb/vue/blob/dev/src/platforms/web/entry-runtime-with-compiler.js#L17 1234567891011121314151617181920212223242526272829303132333435363738394041424344var mount = Vue.prototype.$mount;Vue.prototype.$mount = function ( el, hydrating) &#123; el = el &amp;&amp; query(el); /* istanbul ignore if */ if (el === document.body || el === document.documentElement) &#123; warn( "Do not mount Vue to &lt;html&gt; or &lt;body&gt; - mount to normal elements instead." ); return this &#125; var options = this.$options; // resolve template/el and convert to render function if (!options.render) &#123; ... &#125; else if (el) &#123; template = getOuterHTML(el); &#125; if (template) &#123; var ref = compileToFunctions(template, &#123; outputSourceRange: "development" !== 'production', shouldDecodeNewlines: shouldDecodeNewlines, shouldDecodeNewlinesForHref: shouldDecodeNewlinesForHref, delimiters: options.delimiters, comments: options.comments &#125;, this); var render = ref.render; var staticRenderFns = ref.staticRenderFns; options.render = render; options.staticRenderFns = staticRenderFns; /* istanbul ignore if */ if (config.performance &amp;&amp; mark) &#123; mark('compile end'); measure(("vue " + (this._name) + " compile"), 'compile', 'compile end'); &#125; &#125; &#125; return mount.call(this, el, hydrating)&#125;; æˆ‘ä»¬å…ˆçœ‹ä¸Šé¢ template æ˜¯ä»€ä¹ˆï¼Œtemplate å…¶å®æ˜¯æˆ‘ä»¬å†™çš„æ¨¡ç‰ˆçš„ html æ¯”å¦‚ &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;ï¼Œç„¶åæŠŠæ¨¡ç‰ˆç»™ compileToFunctions æ–¹æ³•å»è§£æï¼Œè¿™è¿‡ç¨‹å°±æ˜¯ç”Ÿæˆast htmlæ ‘ã€‚å¾—åˆ° ref å¯¹è±¡ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªrenderæ–¹æ³•ï¼Œå®ƒçš„æ–¹æ³•å°±æ˜¯ç±»ä¼¼ä¸‹é¢ä»£ç ä¸€æ ·,æ¯”å¦‚ _c å…¶å®å°±æ˜¯æˆ‘ä»¬åé¢è¦è®²çš„åˆ›å»ºç”Ÿæˆ vnode å…ƒç´ æ–¹æ³• 1with(this)&#123;return _c('div',&#123;attrs:&#123;"id":"div1"&#125;&#125;,_l((arr),function(item,idx)&#123;return _c('span',&#123;key:item&#125;,[_v(_s(item))])&#125;),0)&#125; ä»¥ä¸‹å°±æ˜¯å¯¹åº”çš„æ–¹æ³• _væŒ‡åˆ›å»ºæ–‡æœ¬vnode12345678910111213141516171819function installRenderHelpers (target) &#123; target._o = markOnce; target._n = toNumber; target._s = toString; target._l = renderList; target._t = renderSlot; target._q = looseEqual; target._i = looseIndexOf; target._m = renderStatic; target._f = resolveFilter; target._k = checkKeyCodes; target._b = bindObjectProps; target._v = createTextVNode; target._e = createEmptyVNode; target._u = resolveScopedSlots; target._g = bindObjectListeners; target._d = bindDynamicKeys; target._p = prependModifier;&#125; æˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹æœ€åä»£ç ä¼šæ‰§è¡Œ return mount.call(this, el, hydrating)ï¼Œmountä»£ç å°±æ˜¯ä¹‹å‰ç¬¬ä¸€è¡Œä»£ç æå‰è·å–äº† https://github.com/wclimb/vue/blob/dev/src/platforms/web/runtime/index.js#L371234567Vue.prototype.$mount = function ( el?: string | Element, hydrating?: boolean): Component &#123; el = el &amp;&amp; inBrowser ? query(el) : undefined return mountComponent(this, el, hydrating)&#125; ä¸Šé¢ä»£ç ç»§ç»­è°ƒç”¨äº† mountComponent æ–¹æ³•ï¼Œç»§ç»­å¾€ä¸‹çœ‹ mountComponenthttps://github.com/wclimb/vue/blob/dev/src/core/instance/lifecycle.js#L14112345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152export function mountComponent ( vm: Component, el: ?Element, hydrating?: boolean): Component &#123; vm.$el = el if (!vm.$options.render) &#123; vm.$options.render = createEmptyVNode .... &#125; callHook(vm, 'beforeMount') let updateComponent /* istanbul ignore if */ if (process.env.NODE_ENV !== 'production' &amp;&amp; config.performance &amp;&amp; mark) &#123; updateComponent = () =&gt; &#123; const name = vm._name const id = vm._uid const startTag = `vue-perf-start:$&#123;id&#125;` const endTag = `vue-perf-end:$&#123;id&#125;` mark(startTag) const vnode = vm._render() mark(endTag) measure(`vue $&#123;name&#125; render`, startTag, endTag) mark(startTag) vm._update(vnode, hydrating) mark(endTag) measure(`vue $&#123;name&#125; patch`, startTag, endTag) &#125; &#125; else &#123; updateComponent = () =&gt; &#123; vm._update(vm._render(), hydrating) &#125; &#125; new Watcher(vm, updateComponent, noop, &#123; before () &#123; if (vm._isMounted &amp;&amp; !vm._isDestroyed) &#123; callHook(vm, 'beforeUpdate') &#125; &#125; &#125;, true ) hydrating = false if (vm.$vnode == null) &#123; vm._isMounted = true callHook(vm, 'mounted') &#125; return vm&#125; è¿™æ®µä»£ç æ˜¯é‡ç‚¹ï¼Œçœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„å¯èƒ½æœ‰å°è±¡ï¼Œä¸»è¦å®ä¾‹åŒ–äº†ä¸€ä¸ªè®¢é˜…è€…Watcherï¼Œå†…éƒ¨ä¼šæ‰§è¡ŒupdateComponentæ–¹æ³•ï¼Œå†…å®¹å¦‚ä¸‹123updateComponent = () =&gt; &#123; vm._update(vm._render(), hydrating)&#125; Vueä¼šè°ƒç”¨ _render æ–¹æ³•å»ç”Ÿæˆè™šæ‹ŸDOMï¼Œè°ƒç”¨_updateå»æ›´æ–°è§†å›¾ï¼Œ_updateæ–¹æ³•åé¢è®²diffç®—æ³•ä¼šè®²ï¼Œå¾ˆé‡è¦ã€‚ä¸è¿‡è¿™é‡Œæˆ‘ä»¬å…ˆçœ‹çœ‹_renderå‡½æ•° _renderhttps://github.com/wclimb/vue/blob/dev/src/core/instance/render.js#L69123456789101112131415161718192021222324Vue.prototype._render = function (): VNode &#123; const vm: Component = this const &#123; render, _parentVnode &#125; = vm.$options .... vm.$vnode = _parentVnode // render self let vnode try &#123; currentRenderingInstance = vm vnode = render.call(vm._renderProxy, vm.$createElement) &#125; catch (e) &#123; handleError(e, vm, `render`) &#125; finally &#123; currentRenderingInstance = null &#125; ... // set parent vnode.parent = _parentVnode return vnode &#125; æˆ‘ä»¬ä¸»è¦çœ‹è¿™ä¸€æ®µä»£ç  vnode = render.call(vm._renderProxy, vm.$createElement)ï¼Œç”Ÿæˆ è™šæ‹ŸDOMï¼Œä¹‹å‰ä¼šæŠŠ vm.$createElement æ–¹æ³•ä¼ å…¥ï¼Œå…¶å®å°±æ˜¯åˆ›å»º vnode å…ƒç´ çš„æ–¹æ³•ï¼Œæœ€åä¼šæ‰§è¡Œrenderæ–¹æ³•ï¼Œrender æ–¹æ³•å°±æ˜¯æˆ‘ä»¬ä¹‹å‰ compileToFunctions å‡½æ•°ç”Ÿæˆå¯¹è±¡çš„æ–¹æ³•ï¼Œ $createElementhttps://github.com/wclimb/vue/blob/dev/src/core/instance/render.js#L3412345export function initRender (vm: Component) &#123; ... vm.$createElement = (a, b, c, d) =&gt; createElement(vm, a, b, c, d, true) ...&#125; ç»§ç»­è°ƒç”¨äº†createElementæ–¹æ³• createElementhttps://github.com/wclimb/vue/blob/dev/src/core/vdom/create-element.js#L28123456789101112131415161718export function createElement ( context: Component, tag: any, data: any, children: any, normalizationType: any, alwaysNormalize: boolean): VNode | Array&lt;VNode&gt; &#123; if (Array.isArray(data) || isPrimitive(data)) &#123; normalizationType = children children = data data = undefined &#125; if (isTrue(alwaysNormalize)) &#123; normalizationType = ALWAYS_NORMALIZE &#125; return _createElement(context, tag, data, children, normalizationType)&#125; ä¸ç”¨å¤šè¯´äº†ï¼Ÿ ç»§ç»­æ‰¾_createElementï¼Œå¾€ä¸‹çœ‹ä¸‹é¢å‡ è¡Œä»£ç å°±æ˜¯äº† _createElementhttps://github.com/wclimb/vue/blob/dev/src/core/vdom/create-element.js#L471234567891011121314151617181920212223242526272829303132333435363738394041424344454647export function _createElement ( context: Component, tag?: string | Class&lt;Component&gt; | Function | Object, data?: VNodeData, children?: any, normalizationType?: number): VNode | Array&lt;VNode&gt; &#123; .... if (normalizationType === ALWAYS_NORMALIZE) &#123; children = normalizeChildren(children) &#125; else if (normalizationType === SIMPLE_NORMALIZE) &#123; children = simpleNormalizeChildren(children) &#125; let vnode, ns if (typeof tag === 'string') &#123; let Ctor ns = (context.$vnode &amp;&amp; context.$vnode.ns) || config.getTagNamespace(tag) if (config.isReservedTag(tag)) &#123; ... vnode = new VNode( config.parsePlatformTagName(tag), data, children, undefined, undefined, context ) &#125; else if ((!data || !data.pre) &amp;&amp; isDef(Ctor = resolveAsset(context.$options, 'components', tag))) &#123; // component vnode = createComponent(Ctor, data, context, children, tag) &#125; else &#123; vnode = new VNode( tag, data, children, undefined, undefined, context ) &#125; &#125; else &#123; vnode = createComponent(tag, data, context, children) &#125; if (Array.isArray(vnode)) &#123; return vnode &#125; else if (isDef(vnode)) &#123; if (isDef(ns)) applyNS(vnode, ns) if (isDef(data)) registerDeepBindings(data) return vnode &#125; else &#123; return createEmptyVNode() &#125;&#125; åˆ°ç›®å‰ä¸ºæ­¢åˆ›å»ºè™šæ‹ŸDOMçš„è¿‡ç¨‹å°±ç»“æŸäº† diffæ›´æ–°è™šæ‹ŸDOMä¹‹å‰æˆ‘ä»¬åˆè¯´åˆ°ç”¨_renderæ¥ç”Ÿæˆvnodeæ ‘ï¼Œç”¨_updateæ¥æ›´æ–°è§†å›¾ _updatehttps://github.com/wclimb/vue/blob/dev/src/core/instance/lifecycle.js#L5912345678910111213141516Vue.prototype._update = function (vnode: VNode, hydrating?: boolean) &#123; const vm: Component = this const prevEl = vm.$el const prevVnode = vm._vnode const restoreActiveInstance = setActiveInstance(vm) vm._vnode = vnode // å¦‚æœä¹‹å‰ä¸å­˜åœ¨è™šæ‹ŸDOM if (!prevVnode) &#123; // initial render vm.$el = vm.__patch__(vm.$el, vnode, hydrating, false /* removeOnly */) &#125; else &#123; // å¦‚æœå­˜åœ¨æ—§çš„è™šæ‹ŸDOMï¼Œå°±ä¼ é€’åˆ°__patch__å»è¿›è¡Œæ–°æ—§çš„æ¯”è¾ƒ vm.$el = vm.__patch__(prevVnode, vnode) &#125; .....&#125; ä¸Šé¢ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’çš„å°±æ˜¯è™šæ‹ŸDOMï¼Œä¹Ÿå°±æ˜¯æœ¬æ–‡ä¹‹å‰è¯´çš„ _render() è¿”å›çš„ vnode ï¼Œæˆ‘ä»¬éœ€è¦ç»§ç»­çœ‹ __patch__ æ–¹æ³• patch12345678910111213141516171819202122return function patch (oldVnode, vnode, hydrating, removeOnly) &#123; ..... let isInitialPatch = false const insertedVnodeQueue = [] // ä¸å­˜åœ¨æ—§çš„å°±ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ª if (isUndef(oldVnode)) &#123; isInitialPatch = true createElm(vnode, insertedVnodeQueue) &#125; else &#123; const isRealElement = isDef(oldVnode.nodeType) if (!isRealElement &amp;&amp; sameVnode(oldVnode, vnode)) &#123; patchVnode(oldVnode, vnode, insertedVnodeQueue, null, null, removeOnly) &#125; else &#123; ..... &#125; &#125; return vnode.elm&#125; patchæ–¹æ³•ä¸»è¦åšäº†ä¸¤ä»¶äº‹æƒ…ï¼Œå¦‚æœæ²¡æœ‰æ—§çš„ è™šæ‹ŸDOMï¼Œæ—§ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ ¹èŠ‚ç‚¹ã€‚å¦åˆ™çš„è¯ä½¿ç”¨sameVnodeåˆ¤æ–­ oldVnodeå’Œvnodeæ˜¯å¦æ˜¯ç›¸åŒçš„èŠ‚ç‚¹(è¿™ä¸ªç›¸åŒä¸æ˜¯å®Œå…¨éƒ½ç›¸åŒ)ï¼ŒsameVnodeçš„ä½œç”¨ä¸»è¦æ˜¯åˆ¤æ–­æ˜¯å¦åªéœ€è¦ä½œå±€éƒ¨åˆ·æ–°ï¼Œæ¥çœ‹çœ‹å…·ä½“çš„ä»£ç 12345678910111213141516function sameVnode (a, b) &#123; return ( a.key === b.key &amp;&amp; ( ( a.tag === b.tag &amp;&amp; a.isComment === b.isComment &amp;&amp; isDef(a.data) === isDef(b.data) &amp;&amp; sameInputType(a, b) ) || ( isTrue(a.isAsyncPlaceholder) &amp;&amp; a.asyncFactory === b.asyncFactory &amp;&amp; isUndef(b.asyncFactory.error) ) ) )&#125; ä¸»è¦åˆ¤æ–­key tagï¼Œå¦‚æœ key å¹¶ä¸” tag ç›¸åŒæˆ‘ä»¬æ—§å¯ä»¥åˆ¤å®šä½œå±€éƒ¨åˆ·æ–°ï¼Œå¦‚æœä¸ç›¸åŒé‚£ä¹ˆå°±ä¼šç›´æ¥è·³è¿‡ diffï¼Œè¿›è€Œä¾æ® vnode æ–°å»ºä¸€ä¸ªçœŸå®çš„ DOMï¼Œåˆ é™¤æ—§çš„ DOM èŠ‚ç‚¹ã€‚æˆ‘ä»¬çœ‹çœ‹Vueæ˜¯æ€ä¹ˆdiffçš„ï¼Œç»§ç»­çœ‹ patchVnode ä»£ç  patchVnodehttps://github.com/wclimb/vue/blob/dev/src/core/vdom/patch.js#L5011234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950function patchVnode ( oldVnode, vnode, insertedVnodeQueue, ownerArray, index, removeOnly) &#123; if (oldVnode === vnode) &#123; return &#125; .... let i const data = vnode.data if (isDef(data) &amp;&amp; isDef(i = data.hook) &amp;&amp; isDef(i = i.prepatch)) &#123; i(oldVnode, vnode) &#125; const oldCh = oldVnode.children const ch = vnode.children if (isDef(data) &amp;&amp; isPatchable(vnode)) &#123; for (i = 0; i &lt; cbs.update.length; ++i) cbs.update[i](oldVnode, vnode) if (isDef(i = data.hook) &amp;&amp; isDef(i = i.update)) i(oldVnode, vnode) &#125; // åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºæ–‡æœ¬èŠ‚ç‚¹ if (isUndef(vnode.text)) &#123; // å¦‚æœè™šæ‹ŸDOMçš„æ–°æ—§childrenéƒ½å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯å­èŠ‚ç‚¹ if (isDef(oldCh) &amp;&amp; isDef(ch)) &#123; // å¦‚æœéƒ½å­˜åœ¨ï¼Œä½†æ˜¯äºŒè€…ä¸ç›¸ç­‰ï¼Œåˆ™éœ€è¦å¯¹ä»–ä»¬çš„childrenè¿›è¡Œdiff if (oldCh !== ch) updateChildren(elm, oldCh, ch, insertedVnodeQueue, removeOnly) &#125; else if (isDef(ch)) &#123; // æ–°çš„å­èŠ‚ç‚¹å¦‚æœå­˜åœ¨ä½†æ˜¯æ—§çš„ä¸å­˜åœ¨ï¼Œåˆ™éœ€è¦æŠŠå‘æ—§çš„æ·»åŠ  if (process.env.NODE_ENV !== 'production') &#123; checkDuplicateKeys(ch) &#125; if (isDef(oldVnode.text)) nodeOps.setTextContent(elm, '') addVnodes(elm, null, ch, 0, ch.length - 1, insertedVnodeQueue) &#125; else if (isDef(oldCh)) &#123; // æ—§çš„å­èŠ‚ç‚¹å¦‚æœå­˜åœ¨ä½†æ˜¯æ–°çš„ä¸å­˜åœ¨ï¼Œåˆ™éœ€è¦æŠŠæ—§è™šæ‹ŸDOMåŸæœ‰çš„childrenåˆ é™¤ removeVnodes(oldCh, 0, oldCh.length - 1) &#125; else if (isDef(oldVnode.text)) &#123; nodeOps.setTextContent(elm, '') &#125; &#125; else if (oldVnode.text !== vnode.text) &#123; // æ–‡æœ¬ä¸ç›¸åŒåˆ™æ›¿æ¢æ–°çš„æ–‡æœ¬ nodeOps.setTextContent(elm, vnode.text) &#125;&#125; patchVnode ç›¸å½“äºåªèƒ½åšåˆ°ä¸€å±‚çš„åˆ¤æ–­ï¼Œå¦‚æœå½“å‰ diff çš„è™šæ‹ŸDOMè¿˜å­˜åœ¨ children çš„è¯ï¼Œéœ€è¦è¿›ä¸€æ­¥ diffï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ updateChildren updateChildrenhttps://github.com/wclimb/vue/blob/dev/src/core/vdom/patch.js#L4041234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283function updateChildren (parentElm, oldCh, newCh, insertedVnodeQueue, removeOnly) &#123; let oldStartIdx = 0 let newStartIdx = 0 let oldEndIdx = oldCh.length - 1 let oldStartVnode = oldCh[0] let oldEndVnode = oldCh[oldEndIdx] let newEndIdx = newCh.length - 1 let newStartVnode = newCh[0] let newEndVnode = newCh[newEndIdx] let oldKeyToIdx, idxInOld, vnodeToMove, refElm const canMove = !removeOnly if (process.env.NODE_ENV !== 'production') &#123; checkDuplicateKeys(newCh) &#125; while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123; // å¦‚æœoldStartVnodeä¸å­˜åœ¨ï¼Œå› ä¸ºå¯èƒ½æ˜¯undefinedï¼Œåé¢å¤„ç†å¯èƒ½ä¼šç½®ä¸ºundefined if (isUndef(oldStartVnode)) &#123; oldStartVnode = oldCh[++oldStartIdx] // Vnode has been moved left &#125; else if (isUndef(oldEndVnode)) &#123; // å¦‚æœoldEndVnodeä¸å­˜åœ¨ï¼Œè·Ÿä¸Šé¢æƒ…å†µç±»ä¼¼ï¼Œå¦‚æœæ²¡æœ‰å°±æ”¶ç¼©diffåŒºé—´ oldEndVnode = oldCh[--oldEndIdx] &#125; else if (sameVnode(oldStartVnode, newStartVnode)) &#123; // æ–°æ—§ç¬¬ä¸€ä½çš„è™šæ‹ŸDOMç›¸åŒï¼Œåˆ™å¯ä»¥å±€éƒ¨æ¸²æŸ“ï¼ŒdiffåŒºé—´éƒ½è¿›ä¸€ä½ï¼Œç»§ç»­patchæ¯”è¾ƒå­èŠ‚ç‚¹(å¦‚æœæœ‰childrençš„è¯,å¦‚æœæ²¡æœ‰å°±æ¯”è¾ƒæ–‡æœ¬èŠ‚ç‚¹å°±å¯ä»¥äº†) patchVnode(oldStartVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx) oldStartVnode = oldCh[++oldStartIdx] newStartVnode = newCh[++newStartIdx] &#125; else if (sameVnode(oldEndVnode, newEndVnode)) &#123; // æ–°æ—§ç»“å°¾çš„è™šæ‹ŸDOMç›¸åŒï¼ŒdiffåŒºé—´æœ€åä¸€ä½éƒ½å‘å‰è¿›ä¸€ä½ï¼Œç»§ç»­patchæ¯”è¾ƒå­èŠ‚ç‚¹ patchVnode(oldEndVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx) oldEndVnode = oldCh[--oldEndIdx] newEndVnode = newCh[--newEndIdx] &#125; else if (sameVnode(oldStartVnode, newEndVnode)) &#123; // Vnode moved right // æ—§çš„å¼€å¤´å’Œæ–°çš„ç»“å°¾åˆ¤æ–­æ˜¯å¦ä¸€æ ·ï¼Œå¦‚æœä¸€æ ·çš„è¯å°±çš„å¼€å¤´æ”¾åˆ°æœ€åå»ï¼Œæˆ‘ä»¬çœ‹å®ƒè°ƒç”¨äº†insertBeforeï¼ŒæŒ‰ç†ä¸ç®¡æ€æ ·éƒ½ä¸ä¼šåœ¨æœ€åï¼Œå› ä¸ºå®ƒåˆä½¿ç”¨äº†nextSiblingï¼Œ // nodeOps.nextSibling(oldEndVnode.elm)è¿”å›çš„å°±æ˜¯nulläº†ï¼Œè°ƒç”¨insertBeforeå°±ä¼šæŠŠå®ƒæ”¾åˆ°parentElmçš„æœ€å patchVnode(oldStartVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx) canMove &amp;&amp; nodeOps.insertBefore(parentElm, oldStartVnode.elm, nodeOps.nextSibling(oldEndVnode.elm)) oldStartVnode = oldCh[++oldStartIdx] newEndVnode = newCh[--newEndIdx] &#125; else if (sameVnode(oldEndVnode, newStartVnode)) &#123; // Vnode moved left // åŒç†ä¸Šé¢ patchVnode(oldEndVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx) canMove &amp;&amp; nodeOps.insertBefore(parentElm, oldEndVnode.elm, oldStartVnode.elm) oldEndVnode = oldCh[--oldEndIdx] newStartVnode = newCh[++newStartIdx] &#125; else &#123; // è¿™é‡Œä¼šåˆ¤æ–­oldKeyToIdxæ˜¯å¦å®šä¹‰ï¼Œåˆæ¬¡éƒ½æ˜¯undefinedï¼Œå¦‚æœæ²¡æœ‰å°±ä¼šå»é€šè¿‡keyç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œæ¯”å¦‚ä½ çš„keyä¸º abcï¼Œå½“å‰ä¸‹æ ‡ä¸º0ï¼Œé‚£ä¹ˆoldKeyToIdx = &#123;abc: 0,xxx: 1&#125; if (isUndef(oldKeyToIdx)) oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx) idxInOld = isDef(newStartVnode.key) ? oldKeyToIdx[newStartVnode.key] : findIdxInOld(newStartVnode, oldCh, oldStartIdx, oldEndIdx) // çœ‹çœ‹å½“å‰çš„keyæ˜¯å¦åœ¨é‡Œé¢ï¼Œå¾—åˆ°å½“å‰çš„idxInOld if (isUndef(idxInOld)) &#123; // New element // å¦‚æœæ²¡æ‰¾åˆ°ç›¸åº”çš„keyå°±è¯æ˜å½“å‰æ˜¯æ–°å…ƒç´ ã€‚åˆ™ç›´æ¥åˆ›å»º createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx) &#125; else &#123; // å¦‚æœæ‰¾åˆ° vnodeToMove = oldCh[idxInOld] // å¹¶ä¸”æ˜¯åŒç±»å‹çš„è™šæ‹ŸDOMï¼Œåˆ™å…ˆæŠŠå½“å‰ç½®ä¸ºundefinedï¼Œè¯æ˜å½“å‰å·²ç»å¤„ç†äº†ï¼Œç„¶åæŠŠç›¸åº”çš„å…ƒç´ æ’å…¥åˆ°å¯¹åº”çš„ä½ç½® if (sameVnode(vnodeToMove, newStartVnode)) &#123; patchVnode(vnodeToMove, newStartVnode, insertedVnodeQueue, newCh, newStartIdx) oldCh[idxInOld] = undefined canMove &amp;&amp; nodeOps.insertBefore(parentElm, vnodeToMove.elm, oldStartVnode.elm) &#125; else &#123; // ç›¸åŒçš„keyä½†æ˜¯ä¸åŒçš„å…ƒç´ å°±ç›´æ¥åˆ›å»ºå…ƒç´  createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx) &#125; &#125; // å¤„ç†å®Œå½“å‰æ–°çš„è™šæ‹ŸDOMå°±è¿›ä¸€ä½ newStartVnode = newCh[++newStartIdx] &#125; &#125; // å¦‚æœæ—§çš„å¼€å§‹ &gt; æ—§çš„ç»“å°¾ä¸‹æ ‡ï¼Œè¯æ˜å½“å‰æ—§çš„è™šæ‹ŸDOMä¸å¤Ÿæ¯”è¾ƒäº†ï¼Œè¯æ˜æ–°çš„è™šæ‹ŸDOMæ˜æ˜¾æ¯”æ—§çš„å…ƒç´ å¤šï¼Œå°±å¯ä»¥ç›´æ¥æ’å…¥å‰©ä¸‹çš„å…ƒç´ äº† if (oldStartIdx &gt; oldEndIdx) &#123; refElm = isUndef(newCh[newEndIdx + 1]) ? null : newCh[newEndIdx + 1].elm addVnodes(parentElm, refElm, newCh, newStartIdx, newEndIdx, insertedVnodeQueue) &#125; else if (newStartIdx &gt; newEndIdx) &#123; // å¦‚æœæ–°çš„å¼€å§‹ &gt; æ–°çš„ç»“å°¾ä¸‹æ ‡ï¼Œè¯æ˜å½“å‰æ–°çš„è™šæ‹ŸDOMä¸å¤Ÿæ¯”è¾ƒäº†ï¼Œè¯æ˜æ–°çš„è™šæ‹ŸDOMæ˜æ˜¾æ¯”æ—§çš„å…ƒç´ å°‘ï¼Œåˆ™éœ€è¦æŠŠå‰©ä¸‹çš„æ—§è™šæ‹ŸDOMç§»é™¤æ‰ removeVnodes(oldCh, oldStartIdx, oldEndIdx) &#125;&#125; ä¸Šé¢å°±æ˜¯å®Œæ•´çš„diffç®—æ³•äº†ï¼Œå¯ä»¥ç›´æ¥çœ‹ä»£ç å†…çš„æ³¨é‡Šï¼Œä½ ä¼šå‘ç°è¿›è¡Œæœ€ç®€å•çš„åˆ¤æ–­ï¼Œåˆ¤æ–­å¼€å§‹ç»“å°¾æ˜¯å¦ç›¸äº’ä¸€æ ·ï¼Œå†é€šè¿‡keyæ¥æŸ¥æ‰¾å…ƒç´ ï¼Œæé«˜æ•ˆç‡ã€‚ å›¾è§£diffè¿‡ç¨‹æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æˆ‘ä»¬æœ‰data [A, B, C, D]ï¼Œæˆ‘ä»¬æŠŠä»–ä»¬æ”¹ä¸º [B, C, A, D] 1&lt;div v-for="item in arr" :key="item"&gt;item&lt;/div&gt; 12345678910new Vue(&#123; data:&#123; arr: ['A', 'B', 'C', 'D'] &#125;, mounted()&#123; setTimeout(()=&gt;&#123; this.arr = ['B', 'C', 'A', 'D', 'F'] &#125;,1000) &#125;&#125;) æœ‰keyçš„æƒ…å†µè§£æğŸ‘†ï¼šæœ€å¼€å§‹çš„ startIdx éƒ½æ˜¯0ï¼Œéƒ½ä¼šä»æœ€å¼€å§‹æ¯”å¯¹ï¼Œç¬¬ä¸€ä½æ˜¯ A å’Œ Bï¼Œå‘ç°ä¸ä¸€æ ·ï¼Œæ•´ä¸ªåˆ¤æ–­ä¸‹æ¥ï¼Œå‘ç°å‰åéƒ½æ²¡æœ‰ä¸€æ ·çš„å…ƒç´ ï¼Œé‚£ä¹ˆå°±ä¼šèµ°ç¬¬7ä¸ªåˆ¤æ–­ï¼Œé€šè¿‡keyå€¼æ¥æŸ¥æ‰¾ï¼Œä»–ä¼šå»æ—§çš„è™šæ‹ŸDOMé‡Œæ‰¾Bå…ƒç´ ï¼Œå‘ç°æ‰¾äº†ï¼Œå…ˆæŠŠä»–ç½®ä¸º undefined ï¼Œç„¶åæŠŠä»–æ’å…¥åˆ°Açš„å‰é¢ï¼Œç„¶ånewStartIdxè¿›ä¸€ä½ï¼Œæ­¤è½®diffå®Œæˆ è§£æğŸ‘†ï¼šç°åœ¨newStartIdxæ¥åˆ°äº† C è¿™é‡Œï¼ŒåŒæ ·å…ˆçœ‹çœ‹æœ‰æ²¡æœ‰å‰åä¸€æ ·çš„ï¼Œå‘ç°æ²¡æœ‰ï¼Œåˆèµ°åˆ°ç¬¬7ä¸ªåˆ¤æ–­é‡Œï¼Œé€šè¿‡ key å€¼æ¥æŸ¥æ‰¾ï¼Œæ‰¾åˆ° C ä¹‹åï¼ŒæŠŠæ—§çš„Cç½®ä¸ºundefinedï¼Œç„¶åæŠŠCæ’å…¥åˆ°Aå‰é¢ï¼Œç„¶ånewStartIdxè¿›ä¸€ä½ï¼Œæ­¤è½® diff å®Œæˆ è§£æğŸ‘†ï¼šç°åœ¨newStartIdxæ¥åˆ°äº† A è¿™é‡Œï¼ŒåŒæ ·å…ˆçœ‹çœ‹æœ‰æ²¡æœ‰å‰åä¸€æ ·çš„ï¼Œå‘ç°æ—§çš„å¼€å§‹å’Œæ–°çš„å¼€å§‹ä½ç½®ä¸€æ ·ï¼Œæ­¤æ—¶å°±ä¸ç”¨æ”¹å˜ä½ç½®äº†ï¼Œç›´æ¥oldStartIdxå’ŒnewStartIdxéƒ½è¿›ä¸€ä½ï¼Œæ­¤è½®diffå®Œæˆ è§£æğŸ‘†ï¼šæˆ‘ä»¬å‘ç°oldStartIdxæ¥åˆ°äº†Bè¿™é‡Œï¼Œä½†æ˜¯Bæ˜¯å·²ç»æ˜¯undefinedçš„ï¼Œæ­¤è½®ä¼šèµ° if(isUndef(oldStartVnode)){}ï¼Œç›´æ¥oldStartIdxè¿›ä¸€ä½ã€‚è¿›ä¸€ä½ä¹‹åå‘ç°åˆæ˜¯undefinedï¼Œç»§ç»­+1ï¼Œæ¥åˆ°æ¥Dè¿™é‡Œæ­¤æ—¶çš„oldStartIdxå’ŒoldEndIdxæ˜¯ä¸€æ ·çš„ï¼Œæ­¤æ—¶çš„newStartIdxä¹Ÿæ˜¯Dï¼Œå‘ç°å¼€å§‹éƒ½ç›¸åŒï¼Œé‚£ä¹ˆä½ç½®ä¸ç”¨å˜ï¼Œæ–°æ—§çš„startIdxéƒ½è¿›ä¸€ä½ï¼Œä½ ä¼šå‘ç°æ­¤æ—¶çš„oldStartIdx &gt; oldEndIdxï¼Œå¤§äºçš„è¯å°±æ»¡è¶³ä¸Šé¢æºç é‡Œif (oldStartIdx &gt; oldEndIdx) {} è§£æğŸ‘†ï¼šæ»¡è¶³ if (oldStartIdx &gt; oldEndIdx) {} æˆ‘ä»¬éœ€è¦æŠŠå‰©ä¸‹çš„æ–°çš„ è™šæ‹ŸDOM æ’å…¥åˆ°åé¢ï¼Œä¹Ÿå°±æ˜¯æŠŠFæ’å…¥åˆ°æœ€å æ— keyçš„æƒ…å†µğŸ‘†çœ‹ä¸‹æ¥ä½ ä¼šå‘ç°ï¼Œä¸ºå•¥ä¸å¸¦ key è²Œä¼¼åè€Œæ›´å¿«ï¼Œå› ä¸ºå’±ä»¬è¿™é‡Œæ¯”è¾ƒçš„éƒ½æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œæœ€ç®€å•çš„ç¤ºä¾‹ã€‚ä¸ºä»€ä¹ˆä¼šç›´æ¥èµ‹å€¼ä¿®æ”¹ï¼Œä½ åº”è¯¥å¯ä»¥å›è¿‡å¤´çœ‹sameVnodeçš„åˆ¤æ–­è§„åˆ™12345678910111213141516function sameVnode (a, b) &#123; return ( a.key === b.key &amp;&amp; ( ( a.tag === b.tag &amp;&amp; a.isComment === b.isComment &amp;&amp; isDef(a.data) === isDef(b.data) &amp;&amp; sameInputType(a, b) ) || ( isTrue(a.isAsyncPlaceholder) &amp;&amp; a.asyncFactory === b.asyncFactory &amp;&amp; isUndef(b.asyncFactory.error) ) ) )&#125; ä¸å†™ keyï¼Œä¹Ÿæ»¡è¶³ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œç„¶å tagåˆéƒ½æ˜¯ spanï¼Œæ‰€ä»¥æ¯æ¬¡æ¯”è¾ƒéƒ½ä¼šèµ° sameVnode(oldStartVnode, newStartVnode)ï¼Œç„¶åä»–ä»¬å°±ä¼šç›´æ¥å»ä¿®æ”¹ textContentã€‚ æ‰€ä»¥åœ¨å¤æ‚çš„ DOM ä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦é€šè¿‡å†™ key æ¥æå‡æ¸²æŸ“æ•ˆç‡ æ€»ç»“æœ¬æ–‡è®²è§£äº†Vue è™šæ‹ŸDOM çš„åŸç†ï¼Œå¸¦å¤§å®¶çœ‹äº†ä¸€ä¸‹ä»–çš„è¿è¡Œæµç¨‹ï¼Œä»¥åŠå…³é”®çš„ diff ç®—æ³•ï¼Œä¹Ÿæ¯”è¾ƒäº†æœ‰ key å’Œæ—  key çš„ diff è¿‡ç¨‹ï¼Œæœ¬æ–‡çš„ç¤ºä¾‹æ¯”è¾ƒç®€å•ï¼Œä¸èƒ½è¦†ç›–æ‰€æœ‰ diff åˆ¤æ–­çš„æ¡ä»¶ï¼Œæ„Ÿå…´è¶£å¯ä»¥è‡ªå·±å»å°è¯•ã€‚ä¸‹ä¸€ç¯‡ä¼šå¸¦å¤§å®¶æ’¸ä¸€ä¸ªè‡ªå·±çš„ è™šæ‹ŸDOMï¼ŒåŠ æ·±ç†è§£ æœ¬æ–‡åœ°å€ Vueæºç ä¹‹è™šæ‹ŸDOM]]></content>
      <categories>
        <category>javascript</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>vue</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Vueæºç ä¹‹åŒå‘æ•°æ®ç»‘å®š]]></title>
    <url>%2F2020%2F03%2F15%2Fvue-source-code-data-bind%2F</url>
    <content type="text"><![CDATA[å‰è¨€è¿‘ä¸€å¹´å¤šéƒ½åœ¨åšå°ç¨‹åºå¼€å‘ï¼ŒVue æ„Ÿè§‰éƒ½æœ‰å†™äº›ç”Ÿç–äº†ï¼Œä»ä»Šå¤©å¼€å§‹é˜…è¯»ä¸€ä¸‹ Vue çš„æºç ï¼Œäº†è§£å…¶å†…éƒ¨çš„å·¥ä½œæœºåˆ¶ï¼Œæœ¬æ–‡æ¶‰åŠçš„ Vue ç‰ˆæœ¬ä¸º 2.6.11ï¼Œæˆ‘å·²ç»æå‰ fork äº†ä¸€ä»½åˆ° github ä¸Š åŒå‘æ•°æ®ç»‘å®šæåˆ° Vueï¼Œè‡ªç„¶ä¼šæƒ³åˆ°åŒå‘æ•°æ®ç»‘å®šï¼Œè¦è¯´ä»–çš„åŸç†ï¼Œä½ ä¹Ÿèƒ½è„±å£è€Œå‡ºï¼Œä½¿ç”¨ Object.defineProperty çš„ getã€setæ¥å®ç°ï¼Œä½†è¦æŠŠåŠŸèƒ½åšæ›´å¼ºå¤§å¥å£®ï¼Œå¾€å¾€å¹¶ä¸æ˜¯è¿™ä¹ˆç®€å•ã€‚Vueçš„åŒå‘æ•°æ®ç»‘å®šç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆ Obserberç›‘å¬å™¨ï¼šè´Ÿè´£æ•°æ®çš„åŠ«æŒè°ƒç”¨Object.definePropertyæ¥å®ç°ç›‘å¬æ•ˆæœï¼Œgetè´Ÿè´£æ”¶é›†ä¾èµ–ï¼Œsetè´Ÿè´£æ´¾å‘æ›´æ–° Depè®¢é˜…å™¨ï¼šè´Ÿè´£è®¢é˜…è€…çš„æ”¶é›†ï¼Œæ”¶é›†ä¾èµ– Watcherè®¢é˜…è€…ï¼šè´Ÿè´£æ›´æ–°è§†å›¾ ä»å…¥å£å¼€å§‹https://github.com/wclimb/vue/blob/dev/src/core/instance/init.js#L1512345678910111213141516171819202122export function initMixin (Vue: Class&lt;Component&gt;) &#123; Vue.prototype._init = function (options?: Object) &#123; ...... // expose real self vm._self = vm initLifecycle(vm) initEvents(vm) initRender(vm) callHook(vm, 'beforeCreate') initInjections(vm) // resolve injections before data/props initState(vm) initProvide(vm) // resolve provide after data/props callHook(vm, 'created') ...... if (vm.$options.el) &#123; vm.$mount(vm.$options.el) &#125; &#125;&#125; ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºåˆå§‹åŒ– Vue ä¼šè°ƒç”¨å¤šä¸ªå‡½æ•°æ¥åšä¸åŒçš„äº‹æƒ…ï¼Œæœ¬æ–‡ä¸»è¦è®²è§£åŒå‘æ•°æ®ç»‘å®šï¼Œæ‰€ä»¥å…¶ä»–çš„åœ¨è¿™é‡Œéƒ½ä¸é‡è¦ï¼Œè¿™é‡Œæˆ‘ä»¬ç€é‡å…³æ³¨ initState å†…éƒ¨æ–¹æ³• initStatehttps://github.com/wclimb/vue/blob/dev/src/core/instance/state.js#L421234567891011121314151617export function initState (vm: Component) &#123; vm._watchers = [] const opts = vm.$options // å¦‚æœå­˜åœ¨propsï¼Œåˆå§‹åŒ–props if (opts.props) initProps(vm, opts.props) // æŒ‚è½½å®šä¹‰çš„æ–¹æ³• if (opts.methods) initMethods(vm, opts.methods) // å¦‚æœå­˜åœ¨dataï¼Œæ‰§è¡ŒinitDataå¼€å§‹åˆ›å»ºç›‘å¬å™¨ if (opts.data) &#123; initData(vm) &#125; else &#123; observe(vm._data = &#123;&#125;, true /* asRootData */) &#125; // ä»¥ä¸‹åŒç†ï¼Œéƒ½æ˜¯åˆå§‹åŒ–å®šä¹‰çš„ä¸€äº›æ•°æ® if (opts.computed) initComputed(vm, opts.computed) if (opts.watch) initWatch(vm, opts.watch)&#125; initDatahttps://github.com/wclimb/vue/blob/dev/src/core/instance/state.js#L11212345function initData (vm: Component) &#123; .... // observe data observe(data, true /* asRootData */)&#125; observehttps://github.com/wclimb/vue/blob/dev/src/core/observer/index.js#L1101234567891011121314151617181920212223export function observe (value: any, asRootData: ?boolean): Observer | void &#123; if (!isObject(value) || value instanceof VNode) &#123; return &#125; let ob: Observer | void // è¿™é‡Œåˆ¤æ–­å½“å‰æ˜¯å¦å·²ç»åˆ›å»ºè¿‡Observerï¼Œå¦‚æœæœ‰å°±ç›´æ¥è¿”å› if (hasOwn(value, '__ob__') &amp;&amp; value.__ob__ instanceof Observer) &#123; ob = value.__ob__ &#125; else if ( shouldObserve &amp;&amp; !isServerRendering() &amp;&amp; (Array.isArray(value) || isPlainObject(value)) &amp;&amp; Object.isExtensible(value) &amp;&amp; !value._isVue ) &#123; // è¿™é‡Œæ˜¯é‡ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªObserver ob = new Observer(value) &#125; if (asRootData &amp;&amp; ob) &#123; ob.vmCount++ &#125; return ob&#125; Observer-ç›‘å¬å™¨12345678910111213141516171819202122232425262728293031323334353637383940export class Observer &#123; value: any; dep: Dep; vmCount: number; // number of vms that have this object as root $data constructor (value: any) &#123; this.value = value this.dep = new Dep() this.vmCount = 0 // defå…¶å®å°±æ˜¯ç»™å½“å‰å¯¹è±¡å®šä¹‰ä¸€ä¸ªkeyä¸º__ob__ï¼Œå€¼ä¸ºthis def(value, '__ob__', this) // åˆ¤æ–­å½“å‰å€¼æ˜¯å¦ä¸ºæ•°ç»„ï¼Œå¦‚æœæ˜¯æ•°ç»„éœ€è¦å•ç‹¬å¤„ç† // å› ä¸ºæˆ‘ä»¬çŸ¥é“vueä¸»è¦åŸç†æ˜¯ Object.definePropertyï¼Œä½†æ˜¯å®ƒç›‘å¬ä¸äº†æ•°ç»„çš„å˜åŒ–ï¼Œæ‰€ä»¥3.0é‡‡ç”¨äº†proxy // ä½†æ˜¯æ•°ç»„åªèƒ½ç›‘å¬åˆ°éƒ¨åˆ†æ–¹æ³•çš„æ”¹åŠ¨ï¼Œæ„Ÿå…´è¶£å¯ä»¥çœ‹ https://github.com/wclimb/vue/blob/dev/src/core/observer/array.js if (Array.isArray(value)) &#123; if (hasProto) &#123; protoAugment(value, arrayMethods) &#125; else &#123; copyAugment(value, arrayMethods, arrayKeys) &#125; this.observeArray(value) &#125; else &#123; this.walk(value) &#125; &#125; // é™¤äº†æ•°ç»„ï¼Œéƒ½ä¼šè°ƒç”¨è¯¥æ–¹æ³•æ¥åŠ«æŒæ•°æ® walk (obj: Object) &#123; const keys = Object.keys(obj) for (let i = 0; i &lt; keys.length; i++) &#123; defineReactive(obj, keys[i]) &#125; &#125; // ä¸ºæ•°ç»„åˆ›å»ºObserverç›‘å¬å™¨ observeArray (items: Array&lt;any&gt;) &#123; for (let i = 0, l = items.length; i &lt; l; i++) &#123; observe(items[i]) &#125; &#125;&#125; defineReactiveä¸‹é¢ä»£ç æ˜¯åŒå‘æ•°æ®ç»‘å®šé¢æ ¸å¿ƒ https://github.com/wclimb/vue/blob/dev/src/core/observer/index.js#L13512345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667export function defineReactive ( obj: Object, key: string, val: any, customSetter?: ?Function, shallow?: boolean) &#123; // åˆ›å»ºdepï¼Œä¸»è¦åšä¾èµ–æ”¶é›† const dep = new Dep() const property = Object.getOwnPropertyDescriptor(obj, key) // åˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯å¦å¯å®šä¹‰ï¼Œä¸èƒ½çš„è¯åé¢æ‰§è¡Œä¹Ÿæ²¡æœ‰æ„ä¹‰äº†ï¼Œæ‰€ä»¥ç›´æ¥return if (property &amp;&amp; property.configurable === false) &#123; return &#125; // æ˜¯å¦æœ‰è‡ªå®šä¹‰get set const getter = property &amp;&amp; property.get const setter = property &amp;&amp; property.set // å–å½“å‰çš„å€¼ if ((!getter || setter) &amp;&amp; arguments.length === 2) &#123; val = obj[key] &#125; // shallowä¸ºundfinedï¼Œå› ä¸ºä¸Šä¸€æ­¥æ²¡æœ‰ä¼ ï¼Œåªæœ‰å®šä¹‰$attrså’Œ$listenersä½¿ç”¨true // ç»§ç»­è°ƒç”¨observe(val)åŠ«æŒ let childOb = !shallow &amp;&amp; observe(val) // é‡å¤´æˆï¼Œè°ƒç”¨Object.defineProperty Object.defineProperty(obj, key, &#123; enumerable: true, configurable: true, get: function reactiveGetter () &#123; const value = getter ? getter.call(obj) : val // æ­¤æ—¶çš„Dep.targetæ˜¯ä¸€ä¸ªWatcherç±»ï¼ŒDep.targetå…¨å±€åªæœ‰ä¸€ä¸ª if (Dep.target) &#123; // è®¢é˜… dep.depend() // å¦‚æœæ•°æ®æ˜¯å¯¹è±¡ï¼Œç»§ç»­ if (childOb) &#123; childOb.dep.depend() if (Array.isArray(value)) &#123; dependArray(value) &#125; &#125; &#125; return value &#125;, set: function reactiveSetter (newVal) &#123; const value = getter ? getter.call(obj) : val if (newVal === value || (newVal !== newVal &amp;&amp; value !== value)) &#123; return &#125; ...... if (setter) &#123; setter.call(obj, newVal) &#125; else &#123; // æŠŠå€¼æ›´æ–°ä¸ºæœ€æ–°çš„ val = newVal &#125; // æŠŠæ–°å€¼å˜æˆå“åº”å¼çš„å¯¹è±¡ childOb = !shallow &amp;&amp; observe(newVal) // æ•°æ®å‘ç”Ÿå˜åŒ–ä¹‹åé€šçŸ¥ dep.notify() &#125; &#125;)&#125; Dep-è®¢é˜…å™¨Dep åœ¨ Vue é‡Œé¢ä¹Ÿæ˜¯å…³é”®çš„ä¸€ç¯ï¼Œå®ƒè´Ÿè´£ä¾èµ–æ”¶é›†ï¼Œä»ä¸Šé¢ defineReactive å†…éƒ¨æ–¹æ³•æœ‰çœ‹åˆ°å®ä¾‹åŒ–äº†ä¸€ä¸ª depï¼Œç„¶åæœ‰ä½¿ç”¨åˆ°Dep.targetã€dep.depend()ã€dep.notify()ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹ Dep çš„å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051let uid = 0/** * A dep is an observable that can have multiple * directives subscribing to it. */export default class Dep &#123; static target: ?Watcher; id: number; subs: Array&lt;Watcher&gt;; constructor () &#123; this.id = uid++ this.subs = [] &#125; addSub (sub: Watcher) &#123; this.subs.push(sub) &#125; removeSub (sub: Watcher) &#123; remove(this.subs, sub) &#125; // æ”¶é›†ä¾èµ– depend () &#123; if (Dep.target) &#123; // Dep.targetæ˜¯ä¸€ä¸ªWatcherç±»ï¼Œæ‰€ä»¥Dep.target.addDepè°ƒç”¨çš„æ˜¯Watcherç±»é‡Œé¢çš„æ–¹æ³• Dep.target.addDep(this) &#125; &#125; notify () &#123; // stabilize the subscriber list first const subs = this.subs.slice() for (let i = 0, l = subs.length; i &lt; l; i++) &#123; subs[i].update() &#125; &#125;&#125;// the current target watcher being evaluated.// this is globally unique because there could be only one// watcher being evaluated at any time.Dep.target = nullconst targetStack = []// è¯¥æ–¹æ³•ä¼šç”¨åœ¨Watcherå†…éƒ¨export function pushTarget (_target: Watcher) &#123; if (Dep.target) targetStack.push(Dep.target) Dep.target = _target&#125;// å’Œä¸Šé¢æ–¹æ³•ä¸€æ ·ï¼Œè°ƒç”¨å®ŒpushTargetä¹‹åæ¥ç€ä¼šè°ƒç”¨popTargetï¼Œåˆ é™¤å½“å‰ç›®æ ‡watcherexport function popTarget () &#123; Dep.target = targetStack.pop()&#125; ä¸ºä»€ä¹ˆ Dep.target ä¼šæœ‰å€¼å‘¢ï¼Ÿå› ä¸ºå®ä¾‹åŒ–ä¸€ä¸ª Watcher ä¼šè°ƒç”¨ pushTargetï¼Œä½†æ˜¯ä»€ä¹ˆæ—¶å€™ä¼šå®ä¾‹åŒ– Watcher å‘¢ï¼Ÿ1. åˆå§‹åŒ– initComputed 2. ç»‘å®š $watch 3. mountComponentã€‚å®é™…ä¸Šæ˜¯æ¥è‡ª mountComponent å†…éƒ¨çš„å®ä¾‹åŒ– Watcherï¼Œæˆ‘ä»¬çœ‹çœ‹ä»£ç  https://github.com/wclimb/vue/blob/dev/src/core/instance/lifecycle.js#L141 mountComponent12345678910111213141516171819202122232425262728293031323334353637383940414243export function mountComponent ( vm: Component, el: ?Element, hydrating?: boolean): Component &#123; vm.$el = el if (!vm.$options.render) &#123; ..... &#125; callHook(vm, 'beforeMount') let updateComponent /* istanbul ignore if */ if (process.env.NODE_ENV !== 'production' &amp;&amp; config.performance &amp;&amp; mark) &#123; updateComponent = () =&gt; &#123; ...... &#125; &#125; else &#123; updateComponent = () =&gt; &#123; vm._update(vm._render(), hydrating) &#125; &#125; // we set this to vm._watcher inside the watcher's constructor // since the watcher's initial patch may call $forceUpdate (e.g. inside child // component's mounted hook), which relies on vm._watcher being already defined new Watcher(vm, updateComponent, noop, &#123; before () &#123; if (vm._isMounted &amp;&amp; !vm._isDestroyed) &#123; callHook(vm, 'beforeUpdate') &#125; &#125; &#125;, true /* isRenderWatcher */) hydrating = false // manually mounted instance, call mounted on self // mounted is called for render-created child components in its inserted hook if (vm.$vnode == null) &#123; vm._isMounted = true callHook(vm, 'mounted') &#125; return vm&#125; ä¸Šé¢ä»£ç å¾ˆé‡è¦ï¼Œä¸»è¦æ˜¯è§†å›¾çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸï¼ŒbeforeMountå’Œmountedï¼Œå®ä¾‹åŒ–Watcherï¼Œä¼ é€’äº†å‡ ä¸ªä¸»è¦å‚æ•°ï¼Œåˆ†åˆ«æ˜¯vmã€updateComponentã€å’Œä¸€ä¸ª before æ–¹æ³•ï¼Œvm å°±æ˜¯å½“å‰ Vue çš„thisäº†ï¼Œé‡ç‚¹åœ¨ updateComponent æ–¹æ³•ï¼Œå†…éƒ¨æ˜¯ vm._update(vm._render(), hydrating) ï¼Œæ—¢ç„¶æ˜¯åˆå§‹åŒ–æ¸²æŸ“è§†å›¾ï¼Œé‚£ä¹ˆå®ƒä¹Ÿæ²¡æœ‰è°ƒç”¨å‘€ï¼Œæˆ‘ä»¬å…ˆè¯´ vm._render()ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç”Ÿæˆå½“å‰ vnodeï¼Œä¹Ÿå°±æ˜¯è™šæ‹Ÿ domï¼Œé€šè¿‡ vm.__update æ¥æ›´æ–°è§†å›¾ï¼Œè¿™é‡Œå…¶å®å°±ç‰µæ‰¯åˆ°äº†æ–°æ—§è™šæ‹Ÿ dom çš„æ¯”è¾ƒï¼Œä¹Ÿå°±æ˜¯ diff ç®—æ³•ï¼Œæˆ‘ä»¬çŸ¥é“ç°åœ¨æ˜¯åˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰ä¸€ä¸ª vnodeï¼Œç›´æ¥æ¸²æŸ“å°±å¯ä»¥äº†ï¼Œå…³é”®æ˜¯åœ¨è¿™é‡Œå®ƒæ²¡æœ‰æ‰§è¡Œï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦çœ‹çœ‹ Watcher åšäº†ä»€ä¹ˆ Wachter-è®¢é˜…è€…https://github.com/wclimb/vue/blob/dev/src/core/observer/watcher.js#L261234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980export default class Watcher &#123; constructor ( vm: Component, expOrFn: string | Function, cb: Function, options?: ?Object, isRenderWatcher?: boolean ) &#123; this.vm = vm if (isRenderWatcher) &#123; vm._watcher = this &#125; vm._watchers.push(this) // options if (options) &#123; this.deep = !!options.deep this.user = !!options.user this.lazy = !!options.lazy this.sync = !!options.sync this.before = options.before &#125; else &#123; this.deep = this.user = this.lazy = this.sync = false &#125; this.cb = cb this.id = ++uid // uid for batching this.active = true this.dirty = this.lazy // for lazy watchers this.deps = [] this.newDeps = [] this.depIds = new Set() this.newDepIds = new Set() this.expression = process.env.NODE_ENV !== 'production' ? expOrFn.toString() : '' // parse expression for getter if (typeof expOrFn === 'function') &#123; this.getter = expOrFn &#125; else &#123; this.getter = parsePath(expOrFn) if (!this.getter) &#123; this.getter = noop ... &#125; &#125; this.value = this.lazy ? undefined : this.get() &#125; get () &#123; pushTarget(this) let value const vm = this.vm try &#123; value = this.getter.call(vm, vm) &#125; catch (e) &#123; ..... &#125; finally &#123; // "touch" every property so they are all tracked as // dependencies for deep watching if (this.deep) &#123; traverse(value) &#125; popTarget() this.cleanupDeps() &#125; return value &#125; addDep (dep: Dep) &#123; const id = dep.id if (!this.newDepIds.has(id)) &#123; this.newDepIds.add(id) this.newDeps.push(dep) if (!this.depIds.has(id)) &#123; dep.addSub(this) &#125; &#125; &#125; .... æˆ‘ä»¬ä¸Šä¸€æ­¥å®ä¾‹åŒ–äº† Wathcerï¼Œä¼ å…¥äº†ä¸€äº›å‚æ•°ï¼ŒWatcher å†…éƒ¨æ„é€ å‡½æ•°æœ€åæ‰§è¡Œäº† this.get()ï¼Œä¹Ÿå°±æ˜¯å†…éƒ¨ get æ–¹æ³•ï¼Œé‡ç‚¹æ¥äº†12345678910111213141516171819get () &#123; pushTarget(this) let value const vm = this.vm try &#123; value = this.getter.call(vm, vm) &#125; catch (e) &#123; ..... &#125; finally &#123; // "touch" every property so they are all tracked as // dependencies for deep watching if (this.deep) &#123; traverse(value) &#125; popTarget() this.cleanupDeps() &#125; return value &#125; é¦–å…ˆå®ƒä¼šè°ƒç”¨ä¹‹å‰çš„æ–¹æ³• pushTarget æ¥èµ‹å€¼ Dep.targetï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šçŸ¥é“ Dep.target ä¸€å®šæ˜¯ä¸€ä¸ªWatcherï¼Œç´§æ¥ç€è°ƒç”¨äº†this.getterï¼Œgetteræ˜¯ä»€ä¹ˆï¼Ÿgetterå®é™…å°±æ˜¯ä¼ è¿›æ¥çš„ç¬¬äºŒä¸ªå‚æ•°expOrFnï¼Œæ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚ä¹‹å‰æˆ‘ä»¬è¯´çš„ mountComponent æ–¹æ³•å†…éƒ¨ä¼ å…¥çš„ updateComponent æ–¹æ³•ï¼Œä¼šåœ¨è¿™é‡Œè¢«è°ƒç”¨ï¼Œè¾¾åˆ°åˆå§‹åŒ–è§†å›¾çš„ä½œç”¨ã€‚ç»§ç»­å¾€ä¸‹çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° addDep æ–¹æ³•ï¼Œæ˜¯ä¸æ˜¯å¾ˆçœ¼ç†Ÿï¼Œä¹‹å‰æˆ‘ä»¬è¯´äº† Vue åŠ«æŒæ•°æ®ï¼Œåœ¨ get å†…ä¼šæ”¶é›†ä¾èµ–ï¼Œè°ƒç”¨ dep.depend() æ–¹æ³•ï¼Œç„¶å depend æ–¹æ³•æ‰§è¡Œäº† Dep.target.addDep(this)ï¼Œæ¥ç€ä¼šè°ƒç”¨è¿™é‡Œæˆ‘ä»¬è¯´çš„ addDep æ–¹æ³•ï¼Œä¼ å…¥çš„ this å°±æ˜¯ Dep12345678910addDep (dep: Dep) &#123; const id = dep.id if (!this.newDepIds.has(id)) &#123; this.newDepIds.add(id) this.newDeps.push(dep) if (!this.depIds.has(id)) &#123; dep.addSub(this) &#125; &#125;&#125; é¦–å…ˆåˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨ depï¼Œæ²¡æœ‰å°±å¾€è°ƒç”¨ dep çš„æ–¹æ³• addSub è¿½åŠ å½“å‰çš„ Watcherï¼Œè°ƒç”¨ addSub ä¼šå­˜åœ¨ dep å†…çš„ subsï¼Œsubsæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•´ä¸ªæµç¨‹æ˜¯ä¸æ˜¯å¾ˆç»•ï¼Œæˆ‘ä»¬å¯ä»¥ç”»ä¸ªå›¾æ¥çœ‹çœ‹ æ´¾å‘æ›´æ–°æˆ‘ä»¬æ”¶é›†äº†ä¾èµ–æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿæˆ‘ä»¬ä¿®æ”¹å€¼ä¹‹åéœ€è¦æ›´æ–°è§†å›¾å’Œæ•°æ®ï¼Œè¿™ä¸ªåŠ¨ä½œæˆ‘ä»¬æ˜¯å¯ä»¥é¢„çŸ¥çš„ï¼Œå› ä¸ºä¼šè§¦å‘ä¹‹å‰çš„setterï¼Œsetterå†…éƒ¨è°ƒç”¨äº† dep.notify()ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…æ›´æ–°è§†å›¾setter1234567891011121314151617181920set: function reactiveSetter (newVal) &#123; var value = getter ? getter.call(obj) : val; /* eslint-disable no-self-compare */ if (newVal === value || (newVal !== newVal &amp;&amp; value !== value)) &#123; return &#125; /* eslint-enable no-self-compare */ if (customSetter) &#123; customSetter(); &#125; // #7981: for accessor properties without setter if (getter &amp;&amp; !setter) &#123; return &#125; if (setter) &#123; setter.call(obj, newVal); &#125; else &#123; val = newVal; &#125; childOb = !shallow &amp;&amp; observe(newVal); dep.notify();&#125; dep.notify()ä¼šè°ƒç”¨ dep çš„ notify æ–¹æ³•ï¼Œæˆ‘ä»¬çŸ¥é“ subs å†…éƒ¨éƒ½æ˜¯ Watcher ç±»çš„æ•°ç»„ï¼Œéœ€è¦æ›´æ–°å…¨éƒ¨å°±å¾—å…¶éå†ä»–ä»¬ï¼Œæ‰§è¡Œ Watcher å†…éƒ¨çš„ update æ–¹æ³•1234567891011121314151617181920212223export default class Dep &#123; constructor () &#123; this.id = uid++ this.subs = [] &#125; .... notify () &#123; // stabilize the subscriber list first const subs = this.subs.slice() if (process.env.NODE_ENV !== 'production' &amp;&amp; !config.async) &#123; // subs aren't sorted in scheduler if not running async // we need to sort them now to make sure they fire in correct // order subs.sort((a, b) =&gt; a.id - b.id) &#125; for (let i = 0, l = subs.length; i &lt; l; i++) &#123; subs[i].update() &#125; &#125;&#125; updatehttps://github.com/wclimb/vue/blob/dev/src/core/observer/watcher.js#L16412345678910update () &#123; /* istanbul ignore else */ if (this.lazy) &#123; this.dirty = true &#125; else if (this.sync) &#123; this.run() &#125; else &#123; queueWatcher(this) &#125;&#125; å®é™…ä¸Šå¤§éƒ¨åˆ†æƒ…å†µéƒ½ä¼šç›´æ¥æ‰§è¡Œ queueWatcher æ–¹æ³• https://github.com/wclimb/vue/blob/dev/src/core/observer/scheduler.js#L164 queueWatcher1234567891011121314151617181920212223242526272829export function queueWatcher (watcher: Watcher) &#123; const id = watcher.id if (has[id] == null) &#123; has[id] = true if (!flushing) &#123; queue.push(watcher) &#125; else &#123; // å¦‚æœå·²ç»åˆ·æ–°ï¼Œåˆ™æ ¹æ®å…¶IDæ‹¼æ¥è®¢é˜…è€… // å¦‚æœå·²ç»è¶…è¿‡å…¶IDï¼Œå®ƒå°†ç«‹å³è¿è¡Œ let i = queue.length - 1 while (i &gt; index &amp;&amp; queue[i].id &gt; watcher.id) &#123; i-- &#125; queue.splice(i + 1, 0, watcher) &#125; // queue the flush if (!waiting) &#123; waiting = true // å¼€å‘ç¯å¢ƒå¹¶ä¸”ä¸æ˜¯å¼‚æ­¥çš„å°±ç›´æ¥æ‰§è¡Œ if (process.env.NODE_ENV !== 'production' &amp;&amp; !config.async) &#123; flushSchedulerQueue() return &#125; // è¿™é‡Œå…¶å®å°±æ˜¯æ‰§è¡Œäº†ä¸ªå¼‚æ­¥æ“ä½œï¼Œå¯ä»¥äº†è§£ä¸€äº›nextTickçš„å®ç° // https://github.com/wclimb/vue/blob/dev/src/core/util/env.js#L51 nextTick(flushSchedulerQueue) &#125; &#125;&#125; https://github.com/wclimb/vue/blob/dev/src/core/observer/scheduler.js#L71 flushSchedulerQueue1234567891011121314151617181920212223242526272829303132333435function flushSchedulerQueue () &#123; currentFlushTimestamp = getNow() flushing = true let watcher, id //åœ¨åˆ·æ–°ä¹‹å‰å¯¹é˜Ÿåˆ—è¿›è¡Œæ’åºã€‚ //è¿™æ ·å¯ä»¥ç¡®ä¿ï¼š //1.ç»„ä»¶ä»çˆ¶çº§æ›´æ–°ä¸ºå­çº§ã€‚ ï¼ˆå› ä¸ºçˆ¶æ¯æ€»æ˜¯åœ¨å­çº§ä¹‹å‰åˆ›å»ºï¼‰ //2.ç»„ä»¶çš„ç”¨æˆ·ç›‘è§†ç¨‹åºå…ˆäºå…¶å‘ˆç°ç›‘è§†ç¨‹åºè¿è¡Œï¼ˆå› ä¸ºç”¨æˆ·è®¢é˜…è€…å…ˆäºæ¸²æŸ“è®¢é˜…è€…åˆ›å»ºï¼‰ //3.å¦‚æœåœ¨çˆ¶ç»„ä»¶çš„è®¢é˜…è€…è¿è¡ŒæœŸé—´ç ´åäº†æŸä¸ªç»„ä»¶ï¼Œå¯ä»¥è·³è¿‡å…¶è®¢é˜…è€… queue.sort((a, b) =&gt; a.id - b.id) // do not cache length because more watchers might be pushed // as we run existing watchers for (index = 0; index &lt; queue.length; index++) &#123; watcher = queue[index] // è°ƒç”¨ä¹‹å‰æ‰§è¡Œä¸€ä¸‹beforeï¼Œç›®çš„æ˜¯å¯ä»¥è§¦å‘beforeUpdateç”Ÿå‘½å‘¨æœŸ if (watcher.before) &#123; watcher.before() &#125; id = watcher.id has[id] = null watcher.run() // in dev build, check and stop circular updates. if (process.env.NODE_ENV !== 'production' &amp;&amp; has[id] != null) &#123; circular[id] = (circular[id] || 0) + 1 // åˆ¤æ–­æ˜¯å¦æ­»å¾ªç¯äº† if (circular[id] &gt; MAX_UPDATE_COUNT) &#123; .... break &#125; &#125; &#125; ....&#125; ä¸Šé¢ä»£ç ä¸»è¦æ˜¯å¯¹ queue å†…çš„æ•°æ®æ ¹æ® watcher çš„ id æ¥æ’åºï¼Œç¡®ä¿æ•°æ®æ˜¯ä»çˆ¶çº§æ›´æ–°åˆ°å­çº§ï¼Œå› ä¸ºæ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œå…ˆæœ‰çˆ¶åæœ‰å­ã€‚æ¥ç€å°±æ˜¯æ‰¹é‡å»æ›´æ–°ä»–ä»¬ï¼Œå¯ä»¥çœ‹åˆ°å…ˆæ‰§è¡Œäº†beforeæ–¹æ³•ï¼Œç„¶åè°ƒç”¨äº† watcher çš„ run æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ run æ–¹æ³•çš„ä»£ç run1234567891011121314151617181920212223242526run () &#123; if (this.active) &#123; const value = this.get() if ( value !== this.value || // Deep watchers and watchers on Object/Arrays should fire even // when the value is the same, because the value may // have mutated. isObject(value) || this.deep ) &#123; // set new value const oldValue = this.value this.value = value if (this.user) &#123; try &#123; this.cb.call(this.vm, value, oldValue) &#125; catch (e) &#123; handleError(e, this.vm, `callback for watcher "$&#123;this.expression&#125;"`) &#125; &#125; else &#123; this.cb.call(this.vm, value, oldValue) &#125; &#125; &#125;&#125; æˆ‘ä»¬ä¸»è¦å…³æ³¨const value = this.get()è¿™æ®µä»£ç ï¼Œå…¶å®this.getæˆ‘ä»¬ä¹‹å‰å°±è¯´è¿‡äº†ï¼Œåˆå§‹åŒ–çš„æ—¶å€™å®ƒå°±ä¼šè°ƒç”¨ï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯ä»¥ä¸‹ä»£ç 123updateComponent = () =&gt; &#123; vm._update(vm._render(), hydrating)&#125; è‡ªæ­¤æ•´ä¸ªæµç¨‹å·²ç»è®²å®Œï¼Œä»¥ä¸Šæµç¨‹å¯ä»¥é€šè¿‡ä¸‹é¢ä¸€å¼ å›¾æ¥è¡¨è¾¾ æ€»ç»“è‡³æ­¤åŒå‘æ•°æ®ç»‘å®šçš„å…¨éƒ¨æµç¨‹å·²ç»å…¨éƒ¨è®²å®Œï¼Œä½ ä¼šå‘ç°ä¸»è¦æ˜¯é€šè¿‡Observerã€Depã€Watcheræ¥ä¸²èµ·æ¥æ•´ä¸ªæµç¨‹ï¼Œå…¶ä¸­å½“ç„¶è¿˜æœ‰å¾ˆå¤šå¯ä»¥å•ç‹¬æå–å‡ºæ¥è®²çš„ï¼Œæœ¬æ–‡è¿˜ä¼šç»§ç»­å®Œå–„è¡¥å…… æœ¬æ–‡åœ°å€ Vueæºç ä¹‹åŒå‘æ•°æ®ç»‘å®š]]></content>
      <categories>
        <category>javascript</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>vue</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç¼–å†™ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹]]></title>
    <url>%2F2020%2F03%2F08%2Fwrite-daemon%2F</url>
    <content type="text"><![CDATA[ä¸ºä»€ä¹ˆæˆ‘ä»¬ç¼–å†™nodeç¨‹åºçš„æ—¶å€™ï¼Œç«‹é©¬ä¼šå»æ‰§è¡Œå®ƒï¼Œå¦‚ä¸‹æ‰€ç¤º 12345// app.jsconst http = require("http");http.createServer((req, res) =&gt; &#123; res.end("hello world");&#125;).listen(3000); æ‰§è¡Œä¸‹é¢å‘½ä»¤è¿è¡Œ1node app.js æˆ‘ä»¬æ¥ç€è®¿é—®3000ç«¯å£ï¼Œè²Œä¼¼æ²¡æ¯›ç—…ã€‚ä½†æ˜¯å½“ä½ é€€å‡ºå‘½ä»¤è¡Œçª—å£æˆ–è€… ctrl+c ç»ˆæ­¢äº†ç¨‹åºï¼Œå†å»è®¿é—®è¿™ä¸ªç¨‹åºå‘ç°å®ƒç‚¸äº†ï¼ä½ å¾ˆä¸è§£ï¼Œå¼€å§‹æŠ±æ€¨ä¸Šå¤©ä¸ºä»€ä¹ˆè¿™æ ·å¯¹ä½ ï¼Œç„¶åã€‚ã€‚ã€‚é¢ï¼Œç®—äº†ï¼Œç©ç¬‘åˆ°æ­¤ä¸ºæ­¢ï¼Œé‚£ä¹ˆæ€ä¹ˆæ‰èƒ½è®©å®ƒå†åå°è¿è¡Œå‘¢ï¼Ÿ èƒŒæ™¯å¸‚é¢ä¸Šä¹Ÿæœ‰å¾ˆå¤šè¿›ç¨‹å®ˆæŠ¤å·¥å…·ï¼Œæ¯”å¦‚ pm2 forever å½“ç„¶å¦‚æœæˆ‘ä»¬ä½¿ç”¨dockerï¼Œå°±ä¸éœ€è¦è¿™äº›äº† ç¼–å†™ç¼–å†™ä¹‹å‰æƒ³è¿è¡Œæµç¨‹ åˆ›å»ºä¸€ä¸ªçˆ¶è¿›ç¨‹ çˆ¶è¿›ç¨‹ä¸‹é¢æ„å»ºå‡ºä¸€ä¸ªå­è¿›ç¨‹ çˆ¶è¿›ç¨‹é€€å‡º ç¬¬ä¸€ä¸ªæµç¨‹æ²¡é—®é¢˜ï¼Œç¬¬äºŒä¸ªï¼Œæˆ‘ä»¬æ€ä¹ˆåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©child_processï¼Œåå­—å°±å¾ˆæ˜æ˜¾äº†ï¼Œå­è¿›ç¨‹ã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ©æ–¹æ³• spawn æ¥å®ç°ï¼Œç”¨å¾—æ¯”è¾ƒå¤šçš„è¿˜æœ‰execæ–¹æ³•ï¼ˆå¯ä»¥æ‰§è¡Œshellå‘½ä»¤ï¼‰123456789101112const spawn = require("child_process").spawn;const child = spawn("node", ["app.js"], &#123; detached: true, stdio: "ignore"&#125;);child.on("close", function(code) &#123; console.log("close", code);&#125;);child.on("error", function(code) &#123; console.log("error", code);&#125;);console.log(process.pid, child.pid); ä»ä¸Šå›¾æˆ‘ä»¬çœ‹åˆ°ï¼Œå¼€å¯äº†ä¸¤ä¸ªè¿›ç¨‹ï¼Œ38715æ˜¯çˆ¶è¿›ç¨‹ï¼Œ38716æ˜¯å­è¿›ç¨‹ï¼Œè‡³æ­¤æˆ‘ä»¬å®ç°äº†æ­¥éª¤äºŒ æ¥ç€æˆ‘ä»¬å®ç°æ­¥éª¤ä¸‰ï¼Œå¾€ä¸‹å¢åŠ ä¸‹é¢ä¸€æ®µä»£ç 123child.unref();//orprocess.exit() ç°åœ¨æˆ‘ä»¬å¯ä»¥æ‰“å¼€æµè§ˆå™¨æŸ¥çœ‹3000ç«¯å£æ˜¯å¦ä¾ç„¶å¯ä»¥è®¿é—®æ­£å¸¸ æ‰©å±•-ä½¿ç”¨clusterä¸Šé¢æˆ‘ä»¬åªå¼€å¯äº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œæ²¡æœ‰å……åˆ†åˆ©ç”¨å¤šæ ¸ç³»ç»Ÿï¼Œå°½å¯èƒ½çš„å‹æ¦¨æœºå™¨ã€‚æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„pm2å°±æ˜¯åŸºäºè¿™ä¸ªæ¥å®ç°çš„ ä¸‹é¢æ˜¯å®˜ç½‘çš„ä¸€ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¹‹å‰çš„app.jsæ›¿æ¢ä¸ºä¸‹é¢çš„ä»£ç 12345678910111213141516171819202122232425const cluster = require('cluster');const http = require('http');const numCPUs = require('os').cpus().length;if (cluster.isMaster) &#123; console.log(`ä¸»è¿›ç¨‹ $&#123;process.pid&#125; æ­£åœ¨è¿è¡Œ`); // è¡ç”Ÿå·¥ä½œè¿›ç¨‹ã€‚ for (let i = 0; i &lt; numCPUs; i++) &#123; cluster.fork(); &#125; cluster.on('exit', (worker, code, signal) =&gt; &#123; console.log(`å·¥ä½œè¿›ç¨‹ $&#123;worker.process.pid&#125; å·²é€€å‡º`); &#125;);&#125; else &#123; // å·¥ä½œè¿›ç¨‹å¯ä»¥å…±äº«ä»»ä½• TCP è¿æ¥ã€‚ // åœ¨æœ¬ä¾‹å­ä¸­ï¼Œå…±äº«çš„æ˜¯ HTTP æœåŠ¡å™¨ã€‚ http.createServer((req, res) =&gt; &#123; res.writeHead(200); res.end('ä½ å¥½ä¸–ç•Œ\n'); &#125;).listen(8000); console.log(`å·¥ä½œè¿›ç¨‹ $&#123;process.pid&#125; å·²å¯åŠ¨`);&#125; å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆå¼€å¯äº†å¤šä¸ªå­è¿›ç¨‹ï¼Œæ¥è¾¾åˆ°è´Ÿè½½å‡è¡¡ï¼Œè¿˜æœ‰è¿›ç¨‹é—´é€šä¿¡ç›¸å…³çš„çŸ¥è¯†å°±ä¸å¾€ä¸‹è¯´äº†ã€‚ æ€»ç»“è‡³æ­¤æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªæœ€æœ€ç®€å•çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œç„¶è€Œå¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Ÿæ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹ pm2 çš„æºç ï¼Œä¸è¿‡å°±æ˜¯æœ‰ç‚¹å¤šã€‚å¯ä»¥å»çœ‹çœ‹ egg-cluster çš„å®ç°ï¼Œå…³äºè¿™æ–¹é¢çš„çŸ¥è¯†è¿˜æœ‰å¾ˆå¤šéœ€è¦å­¦ä¹ çš„åœ°æ–¹ï¼Œè¡Œäº†ï¼Œåˆæœ‰ä¸¤è½¦ç –æ¥äº†ï¼Œä»Šå¤©å…ˆåˆ°è¿™ï¼Œå¸Œæœ›ä¸‹ä¸€ç¯‡å¯ä»¥æ·±å…¥åˆ†äº« æœ¬æ–‡åœ°å€ ç¼–å†™ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹]]></content>
      <categories>
        <category>Node</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>Node</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Koaæºç ç³»åˆ—ä¹‹å…¨æµç¨‹è§£æ]]></title>
    <url>%2F2019%2F12%2F23%2FKoa%E6%BA%90%E7%A0%81%E7%B3%BB%E5%88%97%E4%B9%8B%E5%85%A8%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90%2F</url>
    <content type="text"><![CDATA[å†™åœ¨å‰é¢ä¹‹å‰æˆ‘ä»¬å·²ç»è®²è§£äº†koaæºç ä¸­çš„ä¸€äº›ä¾èµ–åŒ…ï¼ŒKoaæºç ç³»åˆ—ä¹‹ä¾èµ–åŒ…è§£æ Koaæºç ç³»åˆ—ä¹‹koa-composeï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹koaæºç çš„å…¨æµç¨‹ è§£ææˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹æœ€ç®€å•çš„ç”¨æ³•ï¼Œä¸€ä¸‹æ˜¯å®˜ç½‘çš„ç¤ºä¾‹12345678const Koa = require('koa');const app = new Koa();app.use(async ctx =&gt; &#123; ctx.body = 'Hello World';&#125;);app.listen(3000); é¦–å…ˆæˆ‘ä»¬å¼•å…¥koaåŒ…ï¼Œç„¶åå®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯const = new Koa()ã€‚ç„¶åè°ƒç”¨useæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¹‹å‰åœ¨Koaæºç ç³»åˆ—ä¹‹koa-composeè®²è¿‡ï¼Œç”¨å¤„å°±æ˜¯æŒ‚è½½ä¸­é—´ä»¶ã€‚å½“å‰å†…éƒ¨æ‰§è¡Œçš„æ–¹æ³•å°±æ˜¯å‘å‰ç«¯è¿”å›ä¸€ä¸ªhello worldçš„å†…å®¹ï¼Œæœ€åæˆ‘ä»¬å°†åº”ç”¨æŒ‚è½½åœ¨3000ç«¯å£ä¸‹ï¼Œè¿™ä¸ªlistenå¾ˆé‡è¦ï¼Œå› ä¸ºä¸€åˆ‡æˆ‘ä»¬å®šä¹‰çš„çš„æ–¹æ³•éƒ½ä¼šä»è¿™é‡Œæ‰§è¡Œã€‚æˆ‘ä»¬çœ‹çœ‹ Koa çš„æ„é€ å‡½æ•°çš„ä¸»å…¥å£æ˜¯ä»å“ªæš´éœ²çš„ï¼Œå…ˆæ¥ğŸ¤”æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ€ä¹ˆå¿«é€Ÿæ‰¾åˆ°ä¸€ä¸ªåŒ…çš„ä¸»å…¥å£å‘¢ï¼Ÿå¦‚æœä½ å‘å¸ƒè¿‡npmåŒ…å°±çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨package.jsonå†…æ‰¾åˆ°mainï¼Œkoaçš„å†…å®¹æ˜¯ &quot;main&quot;: &quot;lib/application.js&quot;ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ç›´æ¥å»æŸ¥çœ‹libä¸‹çš„applicationæ–‡ä»¶ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿ æ¥ä¸‹æ¥éƒ¨åˆ†è§£æå¯èƒ½åœ¨ä»£ç æ³¨é‡Šå†…https://github.com/koajs/koa/blob/master/lib/application.js#L30123456789101112131415161718192021module.exports = class Application extends Emitter &#123; constructor(options) &#123; super(); options = options || &#123;&#125;; this.proxy = options.proxy || false; this.subdomainOffset = options.subdomainOffset || 2; this.proxyIpHeader = options.proxyIpHeader || 'X-Forwarded-For'; this.maxIpsCount = options.maxIpsCount || 0; this.env = options.env || process.env.NODE_ENV || 'development'; if (options.keys) this.keys = options.keys; // å­˜æ”¾ä¸­é—´ä»¶ this.middleware = []; this.context = Object.create(context); this.request = Object.create(request); this.response = Object.create(response); if (util.inspect.custom) &#123; this[util.inspect.custom] = this.inspect; &#125; &#125; ...&#125; ä»¥ä¸Šä»£ç å°±æ˜¯æš´éœ²å‡ºæ¥çš„æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨new Koa()çš„å½¢å¼è°ƒç”¨ï¼Œå®ƒç»§æ‰¿äº†ï¼ˆextends Emitterè¿™æ®µä»£ç ï¼‰nodeæä¾›çš„åŸç”Ÿ eventsï¼ˆäº‹ä»¶è§¦å‘å™¨ï¼‰æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒåœ¨å“ªç”¨åˆ°äº†å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“koaå¯ä»¥ä½¿ç”¨ app.on(&#39;error&#39;) æ¥ç›‘å¬é”™è¯¯ï¼Œå¯ä»¥çœ‹ä¸‹é¢ä»£ç 123app.on('error', err =&gt; &#123; log.error('server error', err)&#125;); æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª â€œerrorâ€ äº‹ä»¶ä¾¦å¬å™¨ï¼Œé‚£ä¹ˆå®ƒåœ¨å“ªä¼šè§¦å‘ï¼Œç†æƒ³çš„ä»£ç è‚¯å®šæ˜¯ xxx.emit(&#39;error&#39;, ...)ï¼Œæœç´¢ä¸€ä¸‹å°±çŸ¥é“ï¼Œä»£ç åœ¨ lib/contextä¸‹çš„onerrorï¼Œå½“ç¨‹åºå‡ºé”™èµ°ä¼šèµ°è¿™ä¸ªonerroræ–¹æ³•ã€‚ ç»§ç»­çœ‹æ„é€ å‡½æ•°å†…ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’optionï¼Œå½“å‰thisä¸‹é¢æŒ‚è½½äº†è®²è¿‡å±æ€§ï¼Œåˆ†åˆ«æ˜¯ proxyï¼ˆä»£ç†ï¼‰ subdomainOffsetï¼ˆä½œç”¨æ˜¯å­åŸŸåç§»æ•°ï¼‰ proxyIpHeader maxIpsCount envï¼Œè¿™å‡ ä¸ªå±æ€§éƒ½å¯ä»¥ä»å¤–éƒ¨ä¼ å…¥ï¼Œå½“ç„¶ä¸ä¼ çš„è¯ä¼šæœ‰é»˜è®¤å€¼ï¼Œæ¯”å¦‚envæ ‡è®°å¼€å‘ç¯å¢ƒçš„å˜é‡ï¼Œé»˜è®¤æ˜¯ &#39;development&#39;ã€‚ å¾€ä¸‹çœ‹åˆ°æœ‰ä¸€ä¸ª this.middleware = []ï¼Œè¿™é‡Œæ˜¯å­˜æ”¾ä¸­é—´ä»¶çš„ï¼Œapp.use()å†…çš„æ–¹æ³•éƒ½ä¼špushåˆ°è¿™ä¸ªæ•°ç»„å†…ï¼Œé‚£ä¹ˆå®ƒåœ¨å“ªä¼šæ‰§è¡Œè¿™äº›æ•°ç»„å†…éƒ¨çš„æ–¹æ³•å‘¢ï¼Ÿå®ƒä¼šåœ¨å½“å‰å®ä¾‹çš„callbackå‡½æ•°å†…è°ƒç”¨ï¼Œè¿™ä¸ªåé¢å†è®²ã€‚ ç„¶åç»§ç»­çœ‹åé¢ç´§è·Ÿç€ä¸‰ä¸ªåˆ›å»ºå¯¹è±¡çš„èµ‹å€¼çš„æ“ä½œï¼Œåˆ†åˆ«æ˜¯ context/request/responseï¼Œä»–ä»¬å…¶å®éƒ½æ˜¯æ¥è‡ªå¦å¤–ä¸‰ä¸ªæ–‡ä»¶æš´éœ²å‡ºæ¥çš„å¯¹è±¡ã€‚ä»–ä»¬çš„ä½œç”¨ç®€å•æ¥è¯´å°±æ˜¯å¯¹å¯¹è±¡æ•°æ®å±‚åšäº†å¤„ç†ï¼Œæ·»åŠ äº†å¾ˆå¤šæ–¹æ³•ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ ctx.redirect ctx.body ctx.queryç­‰ç­‰ï¼Œéƒ½æ¥è‡ªè¿™ä¸‰ä¸ªå¯¹è±¡å†…æ–¹æ³•ã€‚åé¢ä¼šç»†è¯´ï¼Œå…ˆè®²æœ€å¤–å±‚çš„æ–¹æ³•ã€‚ é‚£ä¹ˆæ‰§è¡Œå®Œæ„é€ å‡½æ•°ï¼Œç¨‹åºè¿˜æ˜¯è·‘ä¸èµ·æ¥ä¸æ˜¯ï¼Ÿæˆ‘ä»¬çŸ¥é“åŸç”Ÿçš„åˆ›å»ºä¸€ä¸ªåå°åº”ç”¨éœ€è¦ä½¿ç”¨åˆ°http.createServerï¼Œåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬è¿˜æ²¡æœ‰è¯´åˆ°ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹åŸç”Ÿæ€ä¹ˆåˆ›å»ºçš„12345var http = require('http');http.createServer(function (request, response) &#123; response.writeHead(200, &#123;'Content-Type': 'text/plain'&#125;); response.end('Hello World\n');&#125;).listen(8888); æˆ‘ä»¬ä¹‹å‰è®²è¿‡app.listenæ–¹æ³•æ˜¯åˆ›å»ºåº”ç”¨çš„å…³é”®ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æºç https://github.com/koajs/koa/blob/master/lib/application.js#L7712345listen(...args) &#123; debug('listen'); const server = http.createServer(this.callback()); return server.listen(...args);&#125; æ˜¯ä¸æ˜¯è·Ÿä¹‹å‰æˆ‘ä»¬å†™çš„å¾ˆåƒï¼Ÿçœ‹ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºæ‰§è¡Œlistenæ„å»ºäº†ä¸€ä¸ªæœåŠ¡ï¼Œè°ƒç”¨äº†callbackæ–¹æ³•ï¼Œç»§ç»­çœ‹callbackhttps://github.com/koajs/koa/blob/master/lib/application.js#L141123456789101112callback() &#123; const fn = compose(this.middleware); if (!this.listenerCount('error')) this.on('error', this.onerror); const handleRequest = (req, res) =&gt; &#123; const ctx = this.createContext(req, res); return this.handleRequest(ctx, fn); &#125;; return handleRequest;&#125; å›è°ƒå†…éƒ¨é¦–å…ˆæ‰§è¡Œäº†ä¸­é—´ä»¶ï¼Œè°ƒç”¨äº†composeï¼Œè¿™ä¸ªä¸Šä¸Šç¯‡æ–‡ç« è®²è¿‡ï¼Œç»§ç»­çœ‹ï¼Œæœ€åè¿”å›äº†ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å‡½æ•°handleRequestï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°reqï¼Œresï¼Œå…¶å®å°±æ˜¯ä¹‹å‰æˆ‘ä»¬åŸç”Ÿåˆ›å»ºåº”ç”¨è¿”å›çš„æ•°æ®ï¼Œå†…éƒ¨ç»§ç»­è°ƒç”¨äº†this.createContextï¼Œè¯¥æ–¹æ³•ä¸»è¦æ˜¯å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œæºç å¦‚ä¸‹ï¼š1234567891011121314createContext(req, res) &#123; const context = Object.create(this.context); const request = context.request = Object.create(this.request); const response = context.response = Object.create(this.response); context.app = request.app = response.app = this; context.req = request.req = response.req = req; context.res = request.res = response.res = res; request.ctx = response.ctx = context; request.response = response; response.request = request; context.originalUrl = request.originalUrl = req.url; context.state = &#123;&#125;; return context;&#125; ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œå®ƒçš„åŠŸèƒ½ä¸»è¦æ˜¯å¯¹æ•°æ®è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼ŒæŠŠå®ƒæŒ‚è½½å¤šä¸ªkeyä¸Šï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ctx.reqå’Œctx.responseçš„åŸå› ã€‚ç­‰ä¼šä¼šè®²åˆ°this.context/this.request/this.responseå†…éƒ¨çš„å®ç°ã€‚callbackå›è°ƒå†…éƒ¨ä½¿ç”¨this.handleRequestæ–¹æ³•æ¥å¤„ç†ç»“æœï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æºç https://github.com/koajs/koa/blob/master/lib/application.js#L16012345678handleRequest(ctx, fnMiddleware) &#123; const res = ctx.res; res.statusCode = 404; const onerror = err =&gt; ctx.onerror(err); const handleResponse = () =&gt; respond(ctx); onFinished(res, onerror); return fnMiddleware(ctx).then(handleResponse).catch(onerror);&#125; ä¸Šé¢çš„ä»£ç å¾ˆå¥½ç†è§£ï¼Œæ„æ€å°±æ˜¯ä¸­é—´ä»¶æ‰§è¡Œå®Œåï¼Œå†å¼‚æ­¥é‡Œå¤„ç†è¿”å›è¯·æ±‚çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯respondæ–¹æ³•ï¼Œå¦‚æœå†…éƒ¨æŠ¥é”™è‡ªç„¶ä¼šèµ°catchæ–¹æ³•ï¼Œç„¶åå¤„ç†çš„å‡½æ•°æ˜¯lib/context.jsæ–‡ä»¶ä¸‹æš´éœ²çš„onerroræ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸Šé¢æœ‰è®²è¿‡ã€‚æˆ‘ä»¬å…·ä½“çœ‹ä¸€ä¸‹koaæ˜¯æ€ä¹ˆå¤„ç†è¯·æ±‚è¿”å›æ•°æ®çš„ã€‚ ğŸ¤”åˆ†æä¹‹å‰æˆ‘ä»¬å…ˆæ€è€ƒä¸€ä¸‹å¼€å‘çš„æ—¶å€™æ˜¯æ€ä¹ˆè¿”å›æ•°æ®ç»™å‰ç«¯çš„ï¼Ÿæˆ‘ä»¬ä½¿ç”¨ctx.body = &#39;xx&#39;ï¼Œå½“ç„¶è¿™ä¸ªå€¼ä¸ä¸€å®šæ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥æ˜¯å¯¹è±¡ã€bufferç­‰ã€‚ç„¶åæ€è€ƒä¸€ä¸‹åŸç”Ÿçš„ä½¿ç”¨æœ€åä¸€èˆ¬è¿”å›æ•°æ®æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿè‚¯å®šä¸æ˜¯ctx.bodyï¼Œè¿™ä¸ªåªæ˜¯ä¸ªè¯­æ³•ç³–è€Œå·²ï¼Œç†Ÿæ‚‰çš„äººåº”è¯¥ç«‹é©¬å°±çŸ¥é“ï¼ŒåŸç”Ÿè¿”å›æ•°æ®æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨res.end(data)çš„å½¢å¼è¿”å›ï¼Œè¿™é‡Œå°±å¯ä»¥çŒœæµ‹ï¼Œkoaè‚¯å®šæ˜¯å…ˆå–åˆ°äº†æˆ‘ä»¬ctx.bodyçš„å€¼ï¼Œæœ€åä½¿ç”¨res.end(data)æ¥è¿”å›æ•°æ®çš„ã€‚ respondæ–¹æ³•123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051function respond(ctx) &#123; // allow bypassing koa if (false === ctx.respond) return; if (!ctx.writable) return; const res = ctx.res; let body = ctx.body; const code = ctx.status; // ignore body if (statuses.empty[code]) &#123; // strip headers ctx.body = null; return res.end(); &#125; if ('HEAD' === ctx.method) &#123; if (!res.headersSent &amp;&amp; !ctx.response.has('Content-Length')) &#123; const &#123; length &#125; = ctx.response; if (Number.isInteger(length)) ctx.length = length; &#125; return res.end(); &#125; // status body if (null == body) &#123; if (ctx.req.httpVersionMajor &gt;= 2) &#123; body = String(code); &#125; else &#123; body = ctx.message || String(code); &#125; if (!res.headersSent) &#123; ctx.type = 'text'; ctx.length = Buffer.byteLength(body); &#125; return res.end(body); &#125; // responses if (Buffer.isBuffer(body)) return res.end(body); if ('string' == typeof body) return res.end(body); if (body instanceof Stream) return body.pipe(res); // body: json body = JSON.stringify(body); if (!res.headersSent) &#123; ctx.length = Buffer.byteLength(body); &#125; res.end(body);&#125; å¥½äº†ï¼Œæ ¹æ®ä¹‹å‰çš„ç†è§£ï¼Œå†çœ‹ä¸€ä¸‹ä¸Šé¢çš„ä»£ç æ˜¯ä¸æ˜¯æ¸…æ¥šå¾ˆå¤šï¼Ÿä¸è¿‡å…¶ä¸­koaè¿˜æ˜¯åšäº†ä¸€äº›æ•°æ®çš„å¤„ç†ï¼Œæ¯”å¦‚å¦‚æœæˆ‘ä»¬ctx.body = {}ï¼Œkoaä¼šè‡ªåŠ¨æŠŠå¯¹è±¡è½¬å­—ç¬¦ä¸²ï¼Œç„¶åå°±ç®—è¿”å›æ•°æ®çš„lengthï¼Œæœ€åå†è°ƒç”¨res.end(body)ã€‚ context.jshttps://github.com/koajs/koa/blob/master/lib/context.js ä¹‹å‰è¯´è¿‡ä¼šè®²åˆ°ä¸‰ä¸ªæ–‡ä»¶æš´éœ²å‡ºæ¥çš„æ–¹æ³•ï¼Œè¿™æ˜¯å…¶ä¸­ä¸€ä¸ªã€‚ä»–ä»¬å…¶å®éƒ½æ˜¯å¯¹æ•°æ®è¿›è¡Œäº†ä¸€ç³»åˆ—çš„å¤„ç†ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980'use strict';/** * Module dependencies. */const util = require('util');const createError = require('http-errors');const httpAssert = require('http-assert');const delegate = require('delegates');const statuses = require('statuses');const Cookies = require('cookies');const COOKIES = Symbol('context#cookies');const proto = module.exports = &#123; inspect() &#123; if (this === proto) return this; return this.toJSON(); &#125;, toJSON() &#123; ... &#125;, assert: httpAssert, throw(...args) &#123; throw createError(...args); &#125;, onerror(err) &#123; ... &#125;, get cookies() &#123; if (!this[COOKIES]) &#123; this[COOKIES] = new Cookies(this.req, this.res, &#123; keys: this.app.keys, secure: this.request.secure &#125;); &#125; return this[COOKIES]; &#125;, set cookies(_cookies) &#123; this[COOKIES] = _cookies; &#125;&#125;;if (util.inspect.custom) &#123; module.exports[util.inspect.custom] = module.exports.inspect;&#125;delegate(proto, 'response') ... .method('append') .method('flushHeaders') .access('status') .access('message') .access('body') .access('length') .access('type') .access('lastModified') .access('etag') .getter('headerSent') .getter('writable');delegate(proto, 'request') ... .getter('host') .getter('hostname') .getter('URL') .getter('header') .getter('headers') .getter('secure') .getter('stale') .getter('fresh') .getter('ips') .getter('ip'); ä»¥ä¸Šå°±æ˜¯contextçš„å…¨éƒ¨å†…å®¹ï¼Œæˆ‘åšäº†ç²¾ç®€ï¼ŒæŠŠæ³¨é‡Šå’Œä¸€äº›ç›¸ä¼¼çš„ä»£ç åˆ é™¤äº†ï¼Œä½†æ˜¯æ–¹æ³•ä¸Šé¢å…¨éƒ¨éƒ½åœ¨ï¼Œcontextä½ å¯ä»¥ç›´æ¥ç†è§£ä¸ºæˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„ctxï¼Œctxä¸‹é¢æ˜¯ä¸æ˜¯æœ‰å¾ˆå¤šæ–¹æ³•ï¼Ÿå…¶å®åŸºæœ¬ä¸Šéƒ½æ˜¯æœ«å°¾delegateæ–¹æ³•å¤„ç†ä¹‹åå¾—åˆ°çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒåˆ†åˆ«å¤„ç†äº†responseã€requestï¼Œå…¶å®å°±ç®—è¯·æ±‚ä½“å’Œå“åº”ä½“ï¼Œä¸Šç¯‡æ–‡ç« æˆ‘ä»¬ä»‹ç»è¿‡å®ƒçš„æœºåˆ¶ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ctx.bodyã€ctx.headerã€ctx.queryâ€¦.åŸºæœ¬ä¸Šæ–¹æ³•éƒ½å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ã€‚é™¤äº†è¿™äº›ï¼Œä¸Šé¢è¿˜æœ‰è·å–cookieå’Œè®¾ç½®cookieçš„æ–¹æ³•ï¼Œè¿˜æœ‰æˆ‘ä»¬ä¹‹å‰è®²åˆ°çš„ onerror æ–¹æ³•ï¼Œ request.jsç°åœ¨æˆ‘ä»¬è‡ªç„¶å¯ä»¥çŸ¥é“ï¼Œbody/header/queryè¿™äº›æ–¹æ³•éƒ½æ”¾åœ¨å¦å¤–ä¸¤ä¸ªæ–‡ä»¶ä¸‹é¢ï¼Œrequsetä¸‹é¢ä¼šæœ‰host/hostname/URL/headerâ€¦..æ–¹æ³•ï¼Œæˆ‘ä»¬è¿™é‡Œåªçœ‹éƒ¨åˆ†æ–¹æ³•ï¼Œå› ä¸ºæ–¹æ³•æœ‰ç‚¹å¤šï¼Œç¯‡å¹…å¾ˆé•¿123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384const URL = require('url').URL;const net = require('net');const accepts = require('accepts');const contentType = require('content-type');const stringify = require('url').format;const parse = require('parseurl');const qs = require('querystring');const typeis = require('type-is');const fresh = require('fresh');const only = require('only');const util = require('util');const IP = Symbol('context#ip');/** * Prototype. */module.exports = &#123; /** * Return request header. * * @return &#123;Object&#125; * @api public */ get header() &#123; return this.req.headers; &#125;, /** * Set request header. * * @api public */ set header(val) &#123; this.req.headers = val; &#125;, /** * Return request header, alias as request.header * * @return &#123;Object&#125; * @api public */ get headers() &#123; return this.req.headers; &#125;, /** * Set request header, alias as request.header * * @api public */ set headers(val) &#123; this.req.headers = val; &#125;, /** * Get request URL. * * @return &#123;String&#125; * @api public */ get url() &#123; return this.req.url; &#125;, /** * Set request URL. * * @api public */ set url(val) &#123; this.req.url = val; &#125;, ...&#125; ä¸Šé¢å°±æ˜¯éƒ¨åˆ†requestå†…çš„æ–¹æ³•ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€äº›è·å–å’Œå€¼çš„è®¾ç½®ã€‚123456get header() &#123; return this.req.headers;&#125;,set header(val) &#123; this.req.headers = val;&#125;, æ¯”å¦‚ä¸Šé¢è·å–æˆ‘è®¾ç½®headerä¼šæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œctx.headerï¼Œä¼šè°ƒç”¨ç¬¬ä¸€ä¸ªgetæ–¹æ³•ï¼Œèµ‹å€¼åˆ™ä¼šèµ°ç¬¬äºŒä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆthis.reqæ˜¯ä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬è‚¯å®šçŸ¥é“æ˜¯http.createServerå›è°ƒè¿”å›çš„reqä¿¡æ¯ï¼Œé‚£ä¹ˆthiså…·ä½“æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¹‹å‰æˆ‘ä»¬å°±è®²è¿‡åœ¨application.jså†…çš„createContextæ–¹æ³•ï¼Œrequestèµ‹å€¼ç»™äº†context.requsetï¼Œç„¶åcontext.jså†…éƒ¨é€šè¿‡delegateä»£ç†äº†æ•°æ®ï¼Œcontextä¸‹ä¹Ÿå®šä¹‰äº†reqå¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨this.reqç›´æ¥è·å–æ•°æ®1234567891011121314createContext(req, res) &#123; const context = Object.create(this.context); const request = (context.request = Object.create(this.request)); const response = (context.response = Object.create(this.response)); context.app = request.app = response.app = this; context.req = request.req = response.req = req; context.res = request.res = response.res = res; request.ctx = response.ctx = context; request.response = response; response.request = request; context.originalUrl = request.originalUrl = req.url; context.state = &#123;&#125;; return context;&#125; response.jsè¿™é‡Œè·Ÿä¸Šé¢çš„åŸç†ä¸€æ ·ï¼Œæˆ‘ä»¬ç®€å•çœ‹ä¸€ä¸‹éƒ¨åˆ†ä»£ç å§123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146module.exports = &#123; get status() &#123; return this.res.statusCode; &#125;, /** * Set response status code. * * @param &#123;Number&#125; code * @api public */ set status(code) &#123; if (this.headerSent) return; assert(Number.isInteger(code), 'status code must be a number'); assert(code &gt;= 100 &amp;&amp; code &lt;= 999, `invalid status code: $&#123;code&#125;`); this._explicitStatus = true; this.res.statusCode = code; if (this.req.httpVersionMajor &lt; 2) this.res.statusMessage = statuses[code]; if (this.body &amp;&amp; statuses.empty[code]) this.body = null; &#125;, /** * Get response status message * * @return &#123;String&#125; * @api public */ get message() &#123; return this.res.statusMessage || statuses[this.status]; &#125;, /** * Set response status message * * @param &#123;String&#125; msg * @api public */ set message(msg) &#123; this.res.statusMessage = msg; &#125;, /** * Get response body. * * @return &#123;Mixed&#125; * @api public */ get body() &#123; return this._body; &#125;, /** * Set response body. * * @param &#123;String|Buffer|Object|Stream&#125; val * @api public */ set body(val) &#123; const original = this._body; this._body = val; // no content if (null == val) &#123; if (!statuses.empty[this.status]) this.status = 204; this.remove('Content-Type'); this.remove('Content-Length'); this.remove('Transfer-Encoding'); return; &#125; // set the status if (!this._explicitStatus) this.status = 200; // set the content-type only if not yet set const setType = !this.has('Content-Type'); // string if ('string' == typeof val) &#123; if (setType) this.type = /^\s*&lt;/.test(val) ? 'html' : 'text'; this.length = Buffer.byteLength(val); return; &#125; // buffer if (Buffer.isBuffer(val)) &#123; if (setType) this.type = 'bin'; this.length = val.length; return; &#125; // stream if ('function' == typeof val.pipe) &#123; onFinish(this.res, destroy.bind(null, val)); ensureErrorHandler(val, err =&gt; this.ctx.onerror(err)); // overwriting if (null != original &amp;&amp; original != val) this.remove('Content-Length'); if (setType) this.type = 'bin'; return; &#125; // json this.remove('Content-Length'); this.type = 'json'; &#125;, /** * Set Content-Length field to `n`. * * @param &#123;Number&#125; n * @api public */ set length(n) &#123; this.set('Content-Length', n); &#125;, /** * Return parsed response Content-Length when present. * * @return &#123;Number&#125; * @api public */ get length() &#123; if (this.has('Content-Length')) &#123; return parseInt(this.get('Content-Length'), 10) || 0; &#125; const &#123; body &#125; = this; if (!body || body instanceof Stream) return undefined; if ('string' === typeof body) return Buffer.byteLength(body); if (Buffer.isBuffer(body)) return body.length; return Buffer.byteLength(JSON.stringify(body)); &#125;, ...&#125; ä¸Šé¢æ˜¯éƒ¨åˆ†ä»£ç ï¼Œçœ‹èµ·æ¥å¾ˆå®¹æ˜“ç†è§£ï¼Œè·å–çŠ¶æ€ç ä½¿ç”¨ctx.statusï¼Œä¹Ÿå¯ä»¥è®¾ç½®ã€‚è¿™é‡Œæˆ‘ä»¬å€¼å¾—çœ‹çœ‹bodyæ–¹æ³•ï¼Œçœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„ctx.bodyå°±æ˜¯æ¥è‡ªè¿™é‡Œbodyæ–¹æ³•12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758set body(val) &#123; const original = this._body; this._body = val; // no content // å¦‚æœæ²¡æœ‰å†…å®¹è¿”å›çŠ¶æ€ç 204 if (null == val) &#123; if (!statuses.empty[this.status]) this.status = 204; this.remove('Content-Type'); this.remove('Content-Length'); this.remove('Transfer-Encoding'); return; &#125; // set the status // å¦‚æœæˆ‘ä»¬æ²¡æœ‰è®¾ç½®çŠ¶æ€ç ï¼Œé»˜è®¤æ˜¯200ï¼Œthis._explicitStatusåœ¨set statusæ–¹æ³•å†…ä¼šæœ‰èµ‹å€¼ï¼Œæ„æ€æ˜¯å¦‚æœæˆ‘ä»¬æ˜¾ç¤ºçš„è®¾ç½®äº†çŠ¶æ€ç ï¼Œé‚£ä¹ˆå®ƒçš„å€¼ä¸ºtrue if (!this._explicitStatus) this.status = 200; // set the content-type only if not yet set // è¿™é‡Œæ„æ€æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰è®¾ç½®content-typeçš„æ—¶å€™ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦è®¾ç½®æ•°æ®ç±»å‹ const setType = !this.has('Content-Type'); // string // å¦‚æœæ˜¯å­—ç¬¦ä¸²ç±»å‹ if ('string' == typeof val) &#123; // å¦‚æœéœ€è¦è®¾ç½®content-typeï¼Œé‚£ä¹ˆä¼šæœ‰ä¸¤ç§ç±»å‹ï¼Œhtmlã€text if (setType) this.type = /^\s*&lt;/.test(val) ? 'html' : 'text'; // é¡ºä¾¿è®¾ç½®ä»–ä»¬çš„length this.length = Buffer.byteLength(val); return; &#125; // buffer // å¦‚æœæ˜¯bufferï¼Œå¹¶ä¸”éœ€è¦è®¾ç½®content-typeï¼Œé‚£ä¹ˆæŒ‡å®šç±»å‹ä¸ºbinï¼ŒåŒæ ·éœ€è¦è®¾ç½®length if (Buffer.isBuffer(val)) &#123; if (setType) this.type = 'bin'; this.length = val.length; return; &#125; // stream // å¦‚æœæ˜¯æµæ–‡ä»¶ï¼Œç±»å‹ä»ç„¶æ˜¯bin if ('function' == typeof val.pipe) &#123; onFinish(this.res, destroy.bind(null, val)); ensureErrorHandler(val, err =&gt; this.ctx.onerror(err)); // overwriting if (null != original &amp;&amp; original != val) this.remove('Content-Length'); if (setType) this.type = 'bin'; return; &#125; // json // æœ€åå‰©ä¸‹çš„åªæœ‰jsonç±»å‹äº† this.remove('Content-Length'); this.type = 'json';&#125;, æ€»ç»“å¤§ä½“å¯¹koaæ‰§è¡Œçš„æµç¨‹åˆ†æäº†ä¸€éï¼Œæ€»ä½“æ¥è¯´è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ï¼Œå°±æ˜¯ç”¨æ–‡å­—è¡¨è¾¾å‡ºæ¥å¯èƒ½ä¸å¤ªç†æƒ³ï¼Œç°åœ¨å…¶å®æˆ‘ä»¬å·²ç»å¯ä»¥å†™ä¸€ä¸ªè‡ªå·±çš„koaäº†ã€‚æœ¬æ–‡è¿˜ä¼šç»§ç»­å®Œå–„ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œè¿˜æœ›æŒ‡æ­£ã€‚ åŸæ–‡åœ°å€ï¼šhttp://www.wclimb.site/2019/12/23/Koaæºç ç³»åˆ—ä¹‹å…¨æµç¨‹è§£æ/]]></content>
      <categories>
        <category>Node</category>
        <category>Koa</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>Koa</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Koaæºç ç³»åˆ—ä¹‹ä¾èµ–åŒ…è§£æ]]></title>
    <url>%2F2019%2F12%2F16%2FKoa%E6%BA%90%E7%A0%81%E7%B3%BB%E5%88%97%E4%B9%8B%E4%BE%9D%E8%B5%96%E5%8C%85%E8%A7%A3%E6%9E%90%2F</url>
    <content type="text"><![CDATA[å†™åœ¨å‰é¢ä¸Šä¸€ç¯‡æˆ‘ä»¬è®²äº† Koaæºç ç³»åˆ—ä¹‹koa-composeï¼Œå…¶å®ä¹Ÿå¯ä»¥å½’ä¸ºåˆ°è¿™ç¯‡æ–‡ç« ã€‚ä»Šå¤©å¼€å§‹æˆ‘ä»¬çœ‹çœ‹Koaæºç ä¸­ä½¿ç”¨äº†å“ªäº›åŒ…ï¼Œä»–ä»¬èµ·åˆ°äº†ä»€ä¹ˆä½œç”¨ã€‚ps: è¿™é‡Œä¸å‡†å¤‡è®²æ‰€æœ‰çš„åŒ… is-generator-functionhttps://github.com/koajs/koa/blob/master/lib/application.js#L122123456789101112use(fn) &#123; if (typeof fn !== 'function') throw new TypeError('middleware must be a function!'); if (isGeneratorFunction(fn)) &#123; deprecate('Support for generators will be removed in v3. ' + 'See the documentation for examples of how to convert old middleware ' + 'https://github.com/koajs/koa/blob/master/docs/migration.md'); fn = convert(fn); &#125; debug('use %s', fn._name || fn.name || '-'); this.middleware.push(fn); return this;&#125; å¯ä»¥çœ‹çœ‹ä¸Šé¢ä¸€æ®µä»£ç ï¼Œkoaåœ¨æ³¨å…¥ä¸­é—´ä»¶çš„ä¹‹å‰å…ˆåˆ¤æ–­ä¼ å…¥æ˜¯å¦æ˜¯å‡½æ•°ï¼Œç„¶ååˆ¤æ–­å½“å‰ä¼ å…¥çš„å‡½æ•°æ˜¯å¦æ˜¯ generatorï¼Œå¦‚æœæ˜¯ generator é‚£ä¹ˆä½¿ç”¨convertï¼ˆkoa-convertåŒ…ï¼Œä¸‹é¢ä¼šè®²åˆ°ï¼‰è¿›è¡Œè½¬æ¢ï¼Œå…¶å®è½¬æ¢å‡ºæ¥è¿”å›çš„æ˜¯ä¸€ä¸ª promiseï¼Œé‚£ä¹ˆæ€ä¹ˆåˆ¤æ–­æ˜¯å¦æ˜¯ generator å‡½æ•°çš„å‘¢ï¼Ÿä½¿ç”¨äº†isGeneratorFunctionæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ is-generator-functionåŒ…ï¼Œä¸‹é¢æ˜¯æºç https://github.com/inspect-js/is-generator-function/blob/master/index.js1234567891011121314151617181920212223242526272829303132var toStr = Object.prototype.toString;var fnToStr = Function.prototype.toString;var isFnRegex = /^\s*(?:function)?\*/; var hasToStringTag = typeof Symbol === 'function' &amp;&amp; typeof Symbol.toStringTag === 'symbol';var getProto = Object.getPrototypeOf;var getGeneratorFunc = function () &#123; // eslint-disable-line consistent-return if (!hasToStringTag) &#123; return false; &#125; try &#123; return Function('return function*() &#123;&#125;')(); &#125; catch (e) &#123; &#125;&#125;;var generatorFunc = getGeneratorFunc();var GeneratorFunction = generatorFunc ? getProto(generatorFunc) : &#123;&#125;;module.exports = function isGeneratorFunction(fn) &#123; // é¦–å…ˆåˆ¤æ–­æ˜¯å¦æ˜¯å‡½æ•°ï¼Œå¦‚æœä¸æ˜¯ç›´æ¥è¿”å›false if (typeof fn !== 'function') &#123; return false; &#125; // å…ˆå°†å‡½æ•°è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åæ­£åˆ™åŒ¹é…åˆ¤æ–­ if (isFnRegex.test(fnToStr.call(fn))) &#123; return true; &#125; if (!hasToStringTag) &#123; var str = toStr.call(fn); return str === '[object GeneratorFunction]'; &#125; return getProto(fn) === GeneratorFunction;&#125;; å‡½æ•°è½¬å­—ç¬¦ä¸²æ­£åˆ™åŒ¹é…1var isFnRegex = /^\s*(?:function)?\*/; ä¸Šé¢ä»£ç æ­£åˆ™åŒ¹é… function* (){}ï¼Œè¿™é‡Œå…¶å®åŒ¹é…æœ‰é—®é¢˜ï¼Œå› ä¸ºå¯ä»¥å†™æˆ function * (){}ï¼Œæ²¡æœ‰è§„å®š*ä¸€å®šåˆ°ç´§è·Ÿfunctionï¼Œæ­£åˆ™å¯ä»¥æ”¹æˆ /^\s*(?:function)?(\s+)?\*/ åˆ¤æ–­Symbol.toStringTag1var hasToStringTag = typeof Symbol === 'function' &amp;&amp; typeof Symbol.toStringTag === 'symbol'; ä¸Šé¢è¿™æ®µä»£ç å¾ˆå¤šäººå…¶å®å¾ˆç–‘æƒ‘ï¼Œå…¶å®è¿™é‡Œå°±æƒ³å¾—å‡ºæœ‰æ²¡æœ‰Symbolä»¥åŠæœ‰æ²¡æœ‰toStringTagæ–¹æ³•ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼Œå¦‚æœå­˜åœ¨toStringTagï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”¨ Object.prototype.toStringæ¥åˆ¤æ–­æ•°æ®ç±»å‹å˜å¾—ä¸å¯é äº†ã€‚æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹é¢è¿™æ®µä»£ç 1234567class ValidatorClass &#123; get [Symbol.toStringTag]() &#123; return 'Validator'; &#125;&#125;console.log(Object.prototype.toString.call(new ValidatorClass()));// expected output: "[object Validator]" æœ‰äº†toStringTagæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ªé€ æ•°æ®ç±»å‹ï¼Œè¿™è‚¯å®šä¼šæœ‰é£é™©ï¼Œæ‰€ä»¥ä¹‹å‰é¦–å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å®ƒä¼šä½¿ç”¨ Object.getPrototypeOfæ¥åˆ¤æ–­ä»–ä»¬çš„åŸå‹æ˜¯ä¸æ˜¯æ¥è‡ªåŒä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„ä»£ç 1234567var generatorFunc = getGeneratorFunc();var getProto = Object.getPrototypeOf;var GeneratorFunction = generatorFunc ? getProto(generatorFunc) : &#123;&#125;;...return getProto(fn) === GeneratorFunction; ç›´æ¥ä½¿ç”¨Object.prototype.toStringå¦‚æœä¸å­˜åœ¨Symbol.toStringTagï¼Œé‚£ä¹ˆè‡ªç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Object.prototype.toString æ¥åˆ¤æ–­æ•°æ®ç±»å‹1234if (!hasToStringTag) &#123; var str = toStr.call(fn); return str === '[object GeneratorFunction]';&#125; delegatesåœ¨koaå†…ä½¿ç”¨https://github.com/koajs/koa/blob/master/lib/context.js#L191123456789101112131415161718192021/** * Response delegation. */delegate(proto, 'response') .method('attachment') .method('redirect') .method('remove') .method('vary') .method('has') .method('set') .method('append') .method('flushHeaders') .access('status') .access('message') .access('body') .access('length') .access('type') .access('lastModified') .access('etag') .getter('headerSent') .getter('writable'); ä¹ä¸€çœ‹çœ‹ä¸å‡ºå®ƒæœ‰å•¥ç”¨å¤„ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå®ƒç›¸å½“äºåšäº†ä»£ç†ï¼Œæœ¬æ¥æˆ‘ä»¬è®¿é—®bodyéœ€è¦ctx.response.bodyï¼Œç°åœ¨ä½ åªéœ€è¦ctx.bodyå°±å¯ä»¥äº†ã€‚æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿé‚£ä¹ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªåŒ…çš„æºç å…·ä½“æ€ä¹ˆå®ç°çš„123456789101112131415function Delegator(proto, target) &#123; ...&#125;Delegator.prototype.getter = function(name)&#123; ...&#125;;Delegator.prototype.access = function(name)&#123; ...&#125;;Delegator.prototype.setter = function(name)&#123; ...&#125;;Delegator.prototype.method = function(name)&#123; ...&#125;; ä¸Šé¢çš„ğŸ‘†ä»£ç å°±æ˜¯ delegates åŒ…çš„å¤§è‡´æ€»ä½“ç»“æ„ï¼Œè¿˜æœ‰å…¶ä»–å‡ ä¸ªæ–¹æ³•è¿™é‡Œä¸åšä»‹ç»ã€‚æˆ‘ä»¬å¯ä»¥å…ˆæ¥çœ‹ä¸€ä¸‹æ–¹æ³• Delegator æ„é€ å‡½æ•°12345678910function Delegator(proto, target) &#123; if (!(this instanceof Delegator)) return new Delegator(proto, target); this.proto = proto; this.target = target; // ä»¥ä¸‹å¯ä»¥å¿½ç•¥ this.methods = []; this.getters = []; this.setters = []; this.fluents = [];&#125; ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯å¯¹åº”çš„å¯¹è±¡å’Œç›®æ ‡keyå€¼ï¼Œkoaä½¿ç”¨çš„æ˜¯ delegate(proto, &#39;response&#39;)ï¼Œprotoå°±æ˜¯ctxï¼Œresponseå°±æ˜¯ç›®æ ‡keyå€¼ã€‚ ç»§ç»­çœ‹getter1234567891011Delegator.prototype.getter = function(name)&#123; var proto = this.proto; var target = this.target; this.getters.push(name); proto.__defineGetter__(name, function()&#123; return this[target][name]; &#125;); return this;&#125;; é€šè¿‡ä»¥ä¸Šä»£ç å¯ä»¥å¾—çŸ¥ï¼Œå®ƒä½¿ç”¨çš„æ˜¯__defineGetter__æ¥ä»£ç†è·å–å€¼ï¼Œè®¿é—®ctx.bodyçš„æ—¶å€™ï¼Œå…¶å®è¿”å›çš„å€¼æ˜¯ this[target][name]ï¼Œtargetæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œæ˜¯responseï¼Œç„¶ååœ¨è¿™é‡Œbodyå°±æ˜¯nameäº†ã€‚ä½†æ˜¯æˆ‘æŸ¥çœ‹ defineGetter è¿™ä¸ªapiï¼Œå‘ç° è¯¥ç‰¹æ€§æ˜¯éæ ‡å‡†çš„ï¼Œè¯·å°½é‡ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å®ƒï¼ï¼Œæˆ‘ä»¬æ€è€ƒä»¥ä¸‹ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Object.definePropertyï¼ŒæŠŠå®ƒè¿›è¡Œæ”¹é€ 12345Object.defineProperty(proto, name, &#123; get: function() &#123; return this[target][name]; &#125;&#125;); å…¶å®æˆ‘ä»¬çœ‹ä¸€ä¸‹è¯¥é¡¹ç›®çš„PRä¼šå‘ç°ï¼Œå·²ç»æœ‰äººæäº†PRï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰megerã€‚å‰©ä¸‹çš„å¯ä»¥åŒç†ï¼Œsetterä½¿ç”¨çš„æ˜¯__defineSetter__æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥å€ŸåŠ©Object.definePropertyçš„setè¿›è¡Œæ”¹é€ ã€‚accessæ–¹æ³•åˆ™æ˜¯ä¸¤è€…æ–¹æ³•çš„é›†åˆï¼Œå¦‚æœæ»¡è¶³å¯ä»¥è·å–å€¼å’Œè®¾ç½®å€¼æ¡ä»¶ï¼Œéƒ½å¯ä»¥ä½¿ç”¨accessï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œå®ƒçš„æºç ä¹Ÿå¾ˆå¥½ç†è§£ï¼ŒåŒæ—¶è°ƒç”¨ getå’Œset123Delegator.prototype.access = function(name)&#123; return this.getter(name).setter(name);&#125;; koa-convertæˆ‘ä»¬åœ¨ä¸Šä¸ªæ¨¡å—çœ‹åˆ°äº†Koaæºç æœ‰åˆ¤æ–­ä¸­é—´ä»¶ä¼ å…¥çš„æ˜¯å¦æ˜¯ generator ï¼Œå¦‚æœæ˜¯trueï¼Œé‚£ä¹ˆå®ƒå°±è°ƒç”¨äº† convert(fn)ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ¨¡å—éœ€è¦è§£æçš„åŒ… koa-convertï¼Œé‚£ä¹ˆä»–åˆ°åº•æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿçœ‹ä¸‹é¢ä»–çš„æºç  12345678910111213141516171819202122232425262728293031const co = require('co')const compose = require('koa-compose')module.exports = convertfunction convert (mw) &#123; if (typeof mw !== 'function') &#123; throw new TypeError('middleware must be a function') &#125; if (mw.constructor.name !== 'GeneratorFunction') &#123; // assume it's Promise-based middleware return mw &#125; const converted = function (ctx, next) &#123; return co.call(ctx, mw.call(ctx, createGenerator(next))) &#125; converted._name = mw._name || mw.name return converted&#125;function * createGenerator (next) &#123; return yield next()&#125;convert.compose = function (arr) &#123; if (!Array.isArray(arr)) &#123; arr = Array.from(arguments) &#125; return compose(arr.map(convert))&#125;convert.back = function (mw) &#123; ...&#125; æˆ‘ä»¬å¯ä»¥ç›´æ¥è·³åˆ°ç¬¬13è¡Œä»£ç ï¼Œç›´è§‚çš„çœ‹åˆ°ä»–ä½¿ç”¨äº† co æ–¹æ³•ï¼Œé€šè¿‡ coåŒ…ï¼ˆè¿™é‡Œä¸å±•å¼€è®²è¿™ä¸ªåŒ…ï¼‰å¤„ç†è¿”å›çš„ç»“æœæ‹¿åˆ°æœ€ç»ˆéœ€è¦è½¬æ¢çš„å‡½æ•°ï¼Œä½¿ç”¨ call ä¸»è¦æ˜¯æƒ³æŠŠ this æŒ‡å‘ ctx å¯¹è±¡ã€‚é€šè¿‡coå¤„ç†å¾—åˆ°çš„æ˜¯ä¸€ä¸ª Promiseå¯¹è±¡ï¼Œå½“ç„¶ convert ä¸‹è¿˜æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸‹ï¼Œä¸€ä¸ªæ˜¯ composeï¼Œçœ‹è¿‡ä¸Šç¯‡æ–‡ç« çš„åº”è¯¥çŸ¥é“ï¼Œå®ƒä¾èµ–äº† koa-composeï¼Œä¸»è¦åŠŸèƒ½æ˜¯å°†ä¸€ä¸ªæ•°ç»„é‡Œçš„ä¸­é—´ä»¶å…¨è½¬æˆ Promise å¯¹è±¡ã€‚å¦ä¸€ä¸ªæ–¹æ³•æ˜¯backï¼Œå­—é¢æ„æ€å°±èƒ½çŸ¥é“ï¼Œå°±æ˜¯å›é€€ï¼Œå¯ä»¥æŠŠå‡½æ•°è½¬æˆ generator onlyçœ‹äº†koaæºç ä½ ä¼šå‘ç°åœ¨å¥½å‡ ä¸ªåœ°æ–¹ç”¨åˆ°äº†è¿™ä¸ªä¾èµ–åŒ…ï¼Œè¿™ä¸ªåŒ…ä¸»è¦æ˜¯è¾“å‡ºä½ æƒ³è¦çš„å¯¹è±¡æ•°æ®ï¼Œä¾‹å­å¦‚ä¸‹12345678910111213var obj = &#123; name: &apos;tobi&apos;, last: &apos;holowaychuk&apos;, email: &apos;tobi@learnboost.com&apos;, _id: &apos;12345&apos;&#125;;var user = only(obj, &apos;name last email&apos;);è¾“å‡ºï¼š&#123; name: &apos;tobi&apos;, last: &apos;holowaychuk&apos;, email: &apos;tobi@learnboost.com&apos;&#125; koaæºç ä½¿ç”¨çš„ä¾‹å­ https://github.com/koajs/koa/blob/master/lib/application.js#L921234567toJSON() &#123; return only(this, [ 'subdomainOffset', 'proxy', 'env' ]);&#125; ä¾èµ–åŒ…æºç  https://github.com/tj/node-only/blob/master/index.js123456789module.exports = function(obj, keys)&#123; obj = obj || &#123;&#125;; if ('string' == typeof keys) keys = keys.split(/ +/); return keys.reduce(function(ret, key)&#123; if (null == obj[key]) return ret; ret[key] = obj[key]; return ret; &#125;, &#123;&#125;);&#125;; ä»£ç å¾ˆç®€å•ï¼Œçœ‹æºç çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å­—ç¬¦ä¸²æˆ–è€…ç›´æ¥æ•°ç»„çš„å½¢å¼ä¼ é€’éœ€è¦çš„keyå€¼ï¼Œé»˜è®¤å®šä¹‰ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œè°ƒç”¨reduceæŠŠç»“æœå¾ªç¯ä¼ é€’ä¸‹å»ï¼Œæœ€ç»ˆè¿”å›ï¼Œå¦‚æœæ²¡æ‰¾æŒ‡å®šçš„valueï¼Œç›´æ¥è¿”å›retã€‚é¢ï¼Œæ„Ÿè§‰æ²¡æœ‰è®²çš„å¿…è¦ï¼Œé‚£ä¹ˆå°±ã€‚ã€‚ã€‚ æ€»ç»“æœ¬æ¥ä¸€è‚¡è„‘æƒ³è®²5 6ä¸ªä¾èµ–åŒ…ï¼Œä½†æ˜¯çœ‹äº†ä¸€ä¸‹ï¼Œç®€å•çš„è®²èµ·æ¥æ„Ÿè§‰æœ‰ç‚¹æ²¡æ„æ€ï¼Œå¤§éƒ¨åˆ†ä¾èµ–åŒ…å†…éƒ¨åˆä¾èµ–å…¶ä»–åŒ…ï¼Œæƒ³è®²æ˜ç™½å…¶å®ä¸å®¹æ˜“ï¼Œç¯‡å¹…å¤ªé•¿ï¼Œæ‰€ä»¥å…ˆè®²åˆ°è¿™é‡Œå§ï¼Œä¸‹ä¸€ç¯‡è®²è®²æ€»ä½“çš„koaæ„é€ æµç¨‹ï¼Œæœ‰ä¸€ä¸ªæ›´æ¸…æ¥šçš„è®¤è¯†ï¼Œæ¯•ç«Ÿçœ‹æºç ä¹Ÿä¸»è¦æ˜¯ä¸ºäº†è¿™ä¸€ç‚¹ã€‚ åŸæ–‡åœ°å€ï¼šhttp://www.wclimb.site/2019/12/16/Koaæºç ç³»åˆ—ä¹‹ä¾èµ–åŒ…è§£æ/]]></content>
      <categories>
        <category>Node</category>
        <category>Koa</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>Koa</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Koaæºç ç³»åˆ—ä¹‹koa-compose]]></title>
    <url>%2F2019%2F12%2F11%2FKoa%E6%BA%90%E7%A0%81%E7%B3%BB%E5%88%97%E4%B9%8Bkoa-compose%2F</url>
    <content type="text"><![CDATA[å†™åœ¨å‰é¢ ä»ä»Šå¤©å¼€å§‹é˜…è¯»å­¦ä¹ ä¸€ä¸‹Koaæºç ï¼ŒKoaå¯¹å‰ç«¯æ¥è¯´è‚¯å®šä¸é™Œç”Ÿï¼Œä½¿ç”¨nodeåšåå°å¤§éƒ¨åˆ†ä¼šé€‰æ‹©Koaæ¥åšï¼ŒKoaæºç çš„ä»£ç é‡å…¶å®å¾ˆå°‘ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬ä¸€å±‚å±‚å‰¥ç¦»ï¼Œåˆ†æå…¶ä¸­çš„æºç  Koaç”¨æ³•12345678const Koa = require("koa");const app = new Koa();app.use(async ctx =&gt; &#123; ctx.body = &#123; a: 1 &#125;;&#125;);app.listen(3000); æµè§ˆå™¨æ‰“å¼€ http://localhost:3000 å¯ä»¥çœ‹åˆ°è¿”å›äº†ä¸€ä¸ªå¯¹è±¡ {a:1} æ´‹è‘±æ¨¡å‹Koaæœ€ç»å…¸çš„å°±æ˜¯åŸºäºæ´‹è‘±æ¨¡å‹çš„HTTPä¸­é—´ä»¶å¤„ç†æµç¨‹ï¼Œå¯ä»¥çœ‹ä¸‹å›¾ çœ‹ä¸‹é¢ä»£ç æ˜¯å¦èƒ½ç†è§£ 1234567891011121314151617181920212223const Koa = require("koa");const app = new Koa();app.use(async (ctx,next) =&gt; &#123; console.log(1); setTimeout(()=&gt;&#123; next() console.log(2) &#125;,1000)&#125;);app.use(async (ctx,next) =&gt; &#123; console.log(3); next() console.log(4)&#125;);app.use(async (ctx,next) =&gt; &#123; console.log(5); setTimeout(()=&gt;&#123; console.log(6) &#125;,1000) next() console.log(7)&#125;);app.listen(3000); è®¿é—® http://localhost:3000 è¾“å‡º123456713 // 1ç§’åå¼€å§‹è¾“å‡º57426 // 1ç§’åå¼€å§‹è¾“å‡º ä¸çŸ¥é“çœ‹åˆ°è¿™ä½ æ˜¯å¦èƒ½å¤Ÿæ˜ç™½ï¼Œä¸æ˜ç™½ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥æ·±å…¥æºç æ¥åˆ†æå…·ä½“çš„å®ç° koaæºç https://github.com/koajs/koa/blob/master/lib/application.js#L77 æ‰§è¡Œapp.listen(3000);ä¼šèµ°ä»¥ä¸‹ä»£ç  123456789101112131415/** * Shorthand for: * * http.createServer(app.callback()).listen(...) * * @param &#123;Mixed&#125; ... * @return &#123;Server&#125; * @api public */listen(...args) &#123; debug('listen'); const server = http.createServer(this.callback()); return server.listen(...args);&#125;ã€ https://github.com/koajs/koa/blob/master/lib/application.js#L141æˆ‘ä»¬æ¥ç€çœ‹callbackæ–¹æ³•1234567891011121314151617181920/** * Return a request handler callback * for node's native http server. * * @return &#123;Function&#125; * @api public */callback() &#123; const fn = compose(this.middleware); if (!this.listenerCount('error')) this.on('error', this.onerror); const handleRequest = (req, res) =&gt; &#123; const ctx = this.createContext(req, res); return this.handleRequest(ctx, fn); &#125;; return handleRequest;&#125; åœ¨ä¸Šé¢callbackæ‰§è¡Œäº†composeæ–¹æ³•æ¥å¤„ç†ä¸­é—´ä»¶ï¼Œcomposeæ–¹æ³•å°±æ˜¯ä»Šå¤©æˆ‘ä»¬éœ€è¦é‡ç‚¹è®²çš„æ–¹æ³•ï¼Œç­‰ä¼šå†è¯´ï¼Œæˆ‘ä»¬çŸ¥é“Koaå¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯åœ¨å¤„ç†ä¸­é—´ä»¶ï¼Œé‚£ä¹ˆå®ƒä»¬æ˜¯æ€ä¹ˆæ‹¿åˆ°ä¸­é—´ä»¶çš„å‘¢ï¼Ÿä¸Šé¢å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªthis.middlewareï¼Œä¸­é—´ä»¶è‚¯å®šæ˜¯æ”¾åœ¨è¿™é‡Œé¢çš„ï¼Œäºæ˜¯æˆ‘ä»¬æœç´¢ï¼Œåœ¨æœ€ä¸Šå±‚å¯ä»¥åœ¨æ„é€ å‡½æ•°é‡Œçœ‹åˆ°åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå®ƒæŠŠthis.middleware = [];ç½®ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸­é—´ä»¶çš„æ—¶å€™æ˜¯é€šè¿‡app.useæ¥ä½¿ç”¨çš„ã€‚ç»§ç»­å¯»æ‰¾useæ–¹æ³•https://github.com/koajs/koa/blob/master/lib/application.js#L120useæ–¹æ³•12345678910111213141516171819202122/** * Use the given middleware `fn`. * * Old-style middleware will be converted. * * @param &#123;Function&#125; fn * @return &#123;Application&#125; self * @api public */use(fn) &#123; if (typeof fn !== 'function') throw new TypeError('middleware must be a function!'); if (isGeneratorFunction(fn)) &#123; deprecate('Support for generators will be removed in v3. ' + 'See the documentation for examples of how to convert old middleware ' + 'https://github.com/koajs/koa/blob/master/docs/migration.md'); fn = convert(fn); &#125; debug('use %s', fn._name || fn.name || '-'); this.middleware.push(fn); return this;&#125; æ¯æ¬¡æˆ‘ä»¬è°ƒç”¨app.useï¼Œkoaéƒ½æ˜¯æŠŠè¿™ä¸ªæ–¹æ³•pushåˆ°middlewareæ•°ç»„é‡Œé¢ã€‚æ„Ÿè§‰è¯´å¾—æœ‰ç‚¹å•°å—¦äº†ï¼Œæµç¨‹å¤§ä½“å°±æ˜¯è¿™æ ·ã€‚ 1å®šä¹‰ä¸­é—´ä»¶æ•°ç»„ -&gt; æ”¶é›†ä¸­é—´ä»¶æ”¾åˆ°middlewareæ•°ç»„é‡Œ -&gt; é€šè¿‡composeæ–¹æ³•å¤„ç†ä¸­é—´ä»¶è¾¾åˆ°æ´‹è‘±æ¨¡å¼ koa-composehttps://github.com/koajs/compose/blob/master/index.js composeæ˜¯å¼•ç”¨çš„koa-composeåŒ…ï¼ŒæŸ¥çœ‹æºç å‘ç°å…³é”®åªæœ‰20å‡ è¡Œ 123456789101112131415161718192021222324252627282930313233343536373839/** * Compose `middleware` returning * a fully valid middleware comprised * of all those which are passed. * * @param &#123;Array&#125; middleware * @return &#123;Function&#125; * @api public */function compose (middleware) &#123; if (!Array.isArray(middleware)) throw new TypeError('Middleware stack must be an array!') for (const fn of middleware) &#123; if (typeof fn !== 'function') throw new TypeError('Middleware must be composed of functions!') &#125; /** * @param &#123;Object&#125; context * @return &#123;Promise&#125; * @api public */ return function (context, next) &#123; // last called middleware # let index = -1 return dispatch(0) function dispatch (i) &#123; if (i &lt;= index) return Promise.reject(new Error('next() called multiple times')) index = i let fn = middleware[i] if (i === middleware.length) fn = next if (!fn) return Promise.resolve() try &#123; return Promise.resolve(fn(context, dispatch.bind(null, i + 1))); &#125; catch (err) &#123; return Promise.reject(err) &#125; &#125; &#125;&#125; æˆ‘ä»¬é»˜è®¸ä¸­é—´ä»¶ä¼ å…¥çš„æ˜¯æ•°ç»„å‡½æ•°ï¼Œè¿›ä¸€æ­¥å‰¥ç¦»ï¼Œç²¾ç®€çš„ä»£ç å¦‚ä¸‹ 123456789101112131415161718function compose (middleware) &#123; return function (context, next) &#123; let index = -1 return dispatch(0) function dispatch (i) &#123; if (i &lt;= index) return Promise.reject(new Error('next() called multiple times')) index = i let fn = middleware[i] if (i === middleware.length) fn = next if (!fn) return Promise.resolve() try &#123; return Promise.resolve(fn(context, dispatch.bind(null, i + 1))); &#125; catch (err) &#123; return Promise.reject(err) &#125; &#125; &#125;&#125; åˆç•¥çš„çœ‹ï¼Œcomposeè¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé¦–å…ˆæ‰§è¡Œäº†dispatch(0)ï¼Œå‡½æ•°å†…å®¹è¿”å›çš„éƒ½æ˜¯Promiseå¯¹è±¡ã€‚æœ€åˆæ‰§è¡Œdispatch(0)ï¼›é€šè¿‡é€’å½’çš„æ–¹å¼ä¸æ–­çš„è¿è¡Œä¸­é—´ä»¶ï¼Œæ¯ä¸ªä¸­é—´ä»¶éƒ½æ¥æ”¶äº†ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯contextå’Œnextï¼Œcontextå…¶å®å°±æ˜¯koaçš„ctxï¼Œå¦‚æœæˆ‘ä»¬ä¸ä¼ é€’nextæ–¹æ³•ï¼Œåé¢çš„ä¸­é—´ä»¶å°±ä¸ä¼šç»§ç»­æ‰§è¡Œä¸‹å»ã€‚ ä¹‹å‰çš„ä»£ç æˆ‘ä»¬å¯ä»¥åˆç•¥çš„æƒ³è±¡ä¸€ä¸‹ä»¥ä¸‹ä»£ç 12345678910111213141516171819202122232425function fn1(context, next) &#123; console.log(1); next(); console.log(2);&#125;function fn2(context, next) &#123; console.log(3); next(); console.log(4);&#125;function fn3(context, next) &#123; console.log(5); next(); console.log(6);&#125;function compose() &#123; return fn1('', () =&gt; &#123; return fn2('', () =&gt; &#123; return fn3('', () =&gt; &#123; &#125;); &#125;); &#125;);&#125; è¾“å‡ºï¼š123456135642 å…¶å®å°±æ˜¯ä¸€å±‚å±‚åµŒå¥—æ‰§è¡Œä¸­é—´ä»¶çš„æ–¹æ³•ï¼Œæ‰§è¡Œå®Œnextå†å¾€ä¸Šæ‰§è¡Œ 12345678910111213141516171819 ------------------------------------------------------------------------------------- | | | fn1 | | +-----------------------------------------------------------+ | | | | | | | fn2 | | | | +---------------------------------+ | | | | | | | | | | | fn3 | | | | | | | | |----------------------------------------------------------------------------------------------------&gt; | | | | | | | 1 | 3 | 5 6 | 4 | 2 | | | | | | | | | +---------------------------------+ | | | | | | | +-----------------------------------------------------------+ | | | +----------------------------------------------------------------------------------+ æœ€åkoa-composeå¤§è‡´å°±è¿™äº›ï¼Œæµç¨‹å¤§è‡´å¦‚æ´‹è‘±ä¸€æ ·ï¼Œä»£ç ä¹Ÿä¸å¤šï¼Œå¾ˆå¥½ç†è§£ï¼Œä»¥åä½¿ç”¨ä¸­é—´ä»¶çš„æ—¶å€™å°±æ¸…æ™°å¾ˆå¤šäº†ã€‚ åŸæ–‡åœ°å€ï¼š http://www.wclimb.site/2019/12/11/Koaæºç ç³»åˆ—ä¹‹koa-compose/]]></content>
      <categories>
        <category>Node</category>
        <category>Koa</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>Koa</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Dockerå¿«é€Ÿå…¥é—¨]]></title>
    <url>%2F2019%2F12%2F03%2FDocker%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯Dockerï¼ŸDocker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œå¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ– ä¸ºä»€ä¹ˆè¦ç”¨Dockeræ›´é«˜æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æº ç”±äºå®¹å™¨ä¸éœ€è¦è¿›è¡Œç¡¬ä»¶è™šæ‹Ÿä»¥åŠè¿è¡Œå®Œæ•´æ“ä½œç³»ç»Ÿç­‰é¢å¤–å¼€é”€ï¼ŒDocker å¯¹ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡æ›´é«˜ã€‚æ— è®ºæ˜¯åº”ç”¨æ‰§è¡Œé€Ÿåº¦ã€å†…å­˜æŸè€—æˆ–è€…æ–‡ä»¶å­˜å‚¨é€Ÿåº¦ï¼Œéƒ½è¦æ¯”ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ›´é«˜æ•ˆã€‚å› æ­¤ï¼Œç›¸æ¯”è™šæ‹ŸæœºæŠ€æœ¯ï¼Œä¸€ä¸ªç›¸åŒé…ç½®çš„ä¸»æœºï¼Œå¾€å¾€å¯ä»¥è¿è¡Œæ›´å¤šæ•°é‡çš„åº”ç”¨ã€‚ æ›´å¿«é€Ÿçš„å¯åŠ¨æ—¶é—´ ä¼ ç»Ÿçš„è™šæ‹ŸæœºæŠ€æœ¯å¯åŠ¨åº”ç”¨æœåŠ¡å¾€å¾€éœ€è¦æ•°åˆ†é’Ÿï¼Œè€Œ Docker å®¹å™¨åº”ç”¨ï¼Œç”±äºç›´æ¥è¿è¡Œäºå®¿ä¸»å†…æ ¸ï¼Œæ— éœ€å¯åŠ¨å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œå› æ­¤å¯ä»¥åšåˆ°ç§’çº§ã€ç”šè‡³æ¯«ç§’çº§çš„å¯åŠ¨æ—¶é—´ã€‚å¤§å¤§çš„èŠ‚çº¦äº†å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²çš„æ—¶é—´ã€‚ ä¸€è‡´çš„è¿è¡Œç¯å¢ƒ å¼€å‘è¿‡ç¨‹ä¸­ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯ç¯å¢ƒä¸€è‡´æ€§é—®é¢˜ã€‚ç”±äºå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒä¸ä¸€è‡´ï¼Œå¯¼è‡´æœ‰äº› bug å¹¶æœªåœ¨å¼€å‘è¿‡ç¨‹ä¸­è¢«å‘ç°ã€‚è€Œ Docker çš„é•œåƒæä¾›äº†é™¤å†…æ ¸å¤–å®Œæ•´çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œç¡®ä¿äº†åº”ç”¨è¿è¡Œç¯å¢ƒä¸€è‡´æ€§ï¼Œä»è€Œä¸ä¼šå†å‡ºç° ã€Œè¿™æ®µä»£ç åœ¨æˆ‘æœºå™¨ä¸Šæ²¡é—®é¢˜å•Šã€ è¿™ç±»é—®é¢˜ æŒç»­äº¤ä»˜å’Œéƒ¨ç½² å¯¹å¼€å‘å’Œè¿ç»´äººå‘˜æ¥è¯´ï¼Œæœ€å¸Œæœ›çš„å°±æ˜¯ä¸€æ¬¡åˆ›å»ºæˆ–é…ç½®ï¼Œå¯ä»¥åœ¨ä»»æ„åœ°æ–¹æ­£å¸¸è¿è¡Œã€‚ ä½¿ç”¨ Docker å¯ä»¥é€šè¿‡å®šåˆ¶åº”ç”¨é•œåƒæ¥å®ç°æŒç»­é›†æˆã€æŒç»­äº¤ä»˜ã€éƒ¨ç½²ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡ Dockerfile æ¥è¿›è¡Œé•œåƒæ„å»ºï¼Œå¹¶ç»“åˆ æŒç»­é›†æˆç³»ç»Ÿè¿›è¡Œé›†æˆæµ‹è¯•ï¼Œè€Œè¿ç»´äººå‘˜åˆ™å¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¿«é€Ÿéƒ¨ç½²è¯¥é•œåƒï¼Œç”šè‡³ç»“åˆ æŒç»­éƒ¨ç½²ç³»ç»Ÿè¿›è¡Œè‡ªåŠ¨éƒ¨ç½²ã€‚ è€Œä¸”ä½¿ç”¨ Dockerfile ä½¿é•œåƒæ„å»ºé€æ˜åŒ–ï¼Œä¸ä»…ä»…å¼€å‘å›¢é˜Ÿå¯ä»¥ç†è§£åº”ç”¨è¿è¡Œç¯å¢ƒï¼Œä¹Ÿæ–¹ä¾¿è¿ç»´å›¢é˜Ÿç†è§£åº”ç”¨è¿è¡Œæ‰€éœ€æ¡ä»¶ï¼Œå¸®åŠ©æ›´å¥½çš„ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²è¯¥é•œåƒã€‚ æ›´è½»æ¾çš„è¿ç§» ç”±äº Docker ç¡®ä¿äº†æ‰§è¡Œç¯å¢ƒçš„ä¸€è‡´æ€§ï¼Œä½¿å¾—åº”ç”¨çš„è¿ç§»æ›´åŠ å®¹æ˜“ã€‚Docker å¯ä»¥åœ¨å¾ˆå¤šå¹³å°ä¸Šè¿è¡Œï¼Œæ— è®ºæ˜¯ç‰©ç†æœºã€è™šæ‹Ÿæœºã€å…¬æœ‰äº‘ã€ç§æœ‰äº‘ï¼Œç”šè‡³æ˜¯ç¬”è®°æœ¬ï¼Œå…¶è¿è¡Œç»“æœæ˜¯ä¸€è‡´çš„ã€‚å› æ­¤ç”¨æˆ·å¯ä»¥å¾ˆè½»æ˜“çš„å°†åœ¨ä¸€ä¸ªå¹³å°ä¸Šè¿è¡Œçš„åº”ç”¨ï¼Œè¿ç§»åˆ°å¦ä¸€ä¸ªå¹³å°ä¸Šï¼Œè€Œä¸ç”¨æ‹…å¿ƒè¿è¡Œç¯å¢ƒçš„å˜åŒ–å¯¼è‡´åº”ç”¨æ— æ³•æ­£å¸¸è¿è¡Œçš„æƒ…å†µã€‚ æ›´è½»æ¾çš„ç»´æŠ¤å’Œæ‰©å±• ä½¿ç”¨çš„åˆ†å±‚å­˜å‚¨ä»¥åŠé•œåƒçš„æŠ€æœ¯ï¼Œä½¿å¾—åº”ç”¨é‡å¤éƒ¨åˆ†çš„å¤ç”¨æ›´ä¸ºå®¹æ˜“ï¼Œä¹Ÿä½¿å¾—åº”ç”¨çš„ç»´æŠ¤æ›´æ–°æ›´åŠ ç®€å•ï¼ŒåŸºäºåŸºç¡€é•œåƒè¿›ä¸€æ­¥æ‰©å±•é•œåƒä¹Ÿå˜å¾—éå¸¸ç®€å•ã€‚æ­¤å¤–ï¼ŒDocker å›¢é˜ŸåŒå„ä¸ªå¼€æºé¡¹ç›®å›¢é˜Ÿä¸€èµ·ç»´æŠ¤äº†ä¸€å¤§æ‰¹é«˜è´¨é‡çš„ å®˜æ–¹é•œåƒï¼Œæ—¢å¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œåˆå¯ä»¥ä½œä¸ºåŸºç¡€è¿›ä¸€æ­¥å®šåˆ¶ï¼Œå¤§å¤§çš„é™ä½äº†åº”ç”¨æœåŠ¡çš„é•œåƒåˆ¶ä½œæˆæœ¬ã€‚ å¯¹æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ€»ç»“ ç‰¹æ€§ å®¹å™¨ è™šæ‹Ÿæœº å¯åŠ¨ ç§’çº§ åˆ†é’Ÿçº§ ç¡¬ç›˜ä½¿ç”¨ ä¸€èˆ¬ä¸º MB ä¸€èˆ¬ä¸º GB æ€§èƒ½ æ¥è¿‘åŸç”Ÿ å¼±äº ç³»ç»Ÿæ”¯æŒé‡ å•æœºæ”¯æŒä¸Šåƒä¸ªå®¹å™¨ ä¸€èˆ¬å‡ åä¸ª ä»¥ä¸Šæ‘˜è‡ª https://yeasy.gitbooks.io/docker_practice/introduction/why.html å®‰è£… æ³¨å†Œè´¦å· https://hub.docker.com/ ä¸‹è½½å®‰è£…Docker macå®‰è£…åœ°å€ å‘½ä»¤è¡Œè¾“å…¥ docker --version æŸ¥çœ‹å½“å‰ Docker ç‰ˆæœ¬ é•œåƒåŠ é€Ÿï¼Œé‰´äºå›½å†…ç½‘ç»œé—®é¢˜ï¼Œåç»­æ‹‰å– Docker é•œåƒååˆ†ç¼“æ…¢ï¼Œæˆ‘ä»¬å¯ä»¥éœ€è¦é…ç½®åŠ é€Ÿå™¨æ¥è§£å†³ã€‚Docker for mac åº”ç”¨å›¾æ ‡ -&gt; Perferences... -&gt; Daemon -&gt; Registry mirrorsï¼Œåœ¨åˆ—è¡¨ä¸­å¡«å†™åŠ é€Ÿå™¨åœ°å€ http://hub-mirror.c.163.comã€‚ä¿®æ”¹å®Œæˆä¹‹åç‚¹å‡» Apply &amp; Restart æŒ‰é’®ã€‚æœ€åæˆ‘ä»¬è¾“å…¥å‘½ä»¤è¡Œ docker info æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„é•œåƒ å®æˆ˜æˆ‘ä»¬å…ˆå¿«é€Ÿæ­å»ºä¸€ä¸ªwebæœåŠ¡å™¨å‘½ä»¤è¡Œè¾“å…¥1docker run -p 80 --name web -it centos /bin/bash ç„¶åå®‰è£… nginx12rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpmyum install -y nginx å®‰è£…å®Œæˆå¯ä»¥é€šè¿‡å‘½ä»¤whereis nginxæŸ¥çœ‹å®‰è£…è·¯å¾„ï¼Œæœ€åè¾“å…¥ä¸€ä¸‹å‘½ä»¤1nginx æœ€åæˆ‘ä»¬æ‰§è¡Œ ctrl + P + Q åˆ‡æ¢åˆ°åå°ï¼Œè¾“å…¥å‘½ä»¤ docker ps -a æŸ¥çœ‹åˆ†é…çš„ç«¯å£å·ï¼Œæˆ‘è¿™é‡Œæ˜¯ç«¯å£å·æ˜¯32768 12CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES3db42e2903a0 centos &quot;/bin/bash&quot; About a minute ago Up About a minute 0.0.0.0:32768-&gt;80/tcp web æµè§ˆå™¨è¾“å…¥ http://localhost:32768 ï¼Œçœ‹åˆ° Welcome to nginx å°±ç®—æˆåŠŸäº† é‚£ä¹ˆæˆ‘ä»¬åˆšåˆšè¾“å…¥çš„ä¸€ç³»åˆ—å‘½ä»¤ä»£è¡¨ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ æˆ‘ä»¬è¾“å…¥docker run -p 80 --name web -it centos /bin/bash docker runè¡¨ç¤ºè¿è¡Œä¸€ä¸ªæ–°çš„å®¹å™¨ï¼ŒDocker é¦–å…ˆåœ¨æœ¬æœºä¸­å¯»æ‰¾è¯¥é•œåƒï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ï¼ŒDocker åœ¨ Docker Hub ä¸ŠæŸ¥æ‰¾è¯¥é•œåƒå¹¶ä¸‹è½½å®‰è£…åˆ°æœ¬æœºï¼Œæœ€å Docker åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶å¯åŠ¨è¯¥ç¨‹åº -i é€‰é¡¹æ˜¯è®©å®¹å™¨æ ‡å‡†è¾“å…¥æ‰“å¼€ï¼Œå°±å¯ä»¥æ¥å—é”®ç›˜è¾“å…¥äº† -t é€‰é¡¹æ˜¯è®©dockeråˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ï¼Œç»‘å®šåˆ°æ ‡å‡†è¾“å…¥ä¸Šã€‚é€šè¿‡è¿™ä¸ªä¼ªç»ˆç«¯å°±å¯ä»¥åƒæ“ä½œä¸€å° linux æœºå™¨æ¥æ“ä½œè¿™ä¸ªå®¹å™¨äº† --name &lt;å®¹å™¨åç§°&gt; é€‰é¡¹ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼Œè¿™é‡Œæ˜¯web -p 80 å‘Šè¯‰dockerå¼€æ”¾80ç«¯å£ æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œdocker runæ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œå¦‚æœéœ€è¦æ“ä½œä¹‹å‰åˆ›å»ºçš„å®¹å™¨ é‡å¯å®¹å™¨1docker start web è¿›å…¥å®¹å™¨1docker attach web åœæ­¢å®¹å™¨1docker stop web é•œåƒæˆ‘ä»¬è¿è¡Œå®¹å™¨éƒ½éœ€è¦é•œåƒï¼Œä¸Šé¢æˆ‘ä»¬ä½¿ç”¨åˆ°çš„çš„é•œåƒæ˜¯ centos æŸ¥çœ‹æœ¬åœ°é•œåƒ1docker images æ˜¾ç¤º123456REPOSITORY TAG IMAGE ID CREATED SIZEnodejs latest 779742e01ba3 2 weeks ago 907MBnode latest 4ac0e1872789 5 weeks ago 933MBnginx latest 540a289bab6c 5 weeks ago 126MBnginx stable-alpine aaad4724567b 6 weeks ago 21.2MBcentos latest 0f3e07c0138f 2 months ago 220MB REPOSITORYï¼šä»“åº“åç§°ã€‚ TAGï¼š é•œåƒæ ‡ç­¾ï¼Œå…¶ä¸­ lastest è¡¨ç¤ºæœ€æ–°ç‰ˆæœ¬ã€‚æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªé•œåƒå¯ä»¥æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ ‡ç­¾æ¥ç®¡ç†æœ‰ç”¨çš„ç‰ˆæœ¬å’ŒåŠŸèƒ½æ ‡ç­¾ã€‚ IMAGE ID ï¼šé•œåƒå”¯ä¸€IDã€‚ CREATED ï¼šåˆ›å»ºæ—¶é—´ã€‚ SIZE ï¼šé•œåƒå¤§å°ã€‚ å¦‚æœç¬¬ä¸€æ¬¡æˆ‘ä»¬é€šè¿‡ docker pull centos:latest æ‹‰å–é•œåƒï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬æ‰§è¡Œ docker run -p 80 --name web -it centos /bin/bash æ—¶ï¼Œå®ƒå°±ä¸ä¼šå†å»è¿œç¨‹è·å–äº†ï¼Œå› ä¸ºæœ¬æœºä¸­å·²ç»å®‰è£…è¯¥é•œåƒï¼Œæ‰€ä»¥ Docker ä¼šç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶å¯åŠ¨è¯¥ç¨‹åºã€‚ äº‹å®ä¸Šï¼Œé•œåƒæœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ https://hub.docker.com æœç´¢ä»“åº“ï¼Œè¾“å…¥æ¡†è¾“å…¥nginxï¼Œä¼šå‡ºç°å¾ˆå¤šnginxç›¸å…³çš„é•œåƒï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ docker search nginx è·å–é•œåƒåˆ—è¡¨1234567$ docker search nginxNAME DESCRIPTION STARS OFFICIAL AUTOMATEDnginx Official build of Nginx. 12284 [OK]jwilder/nginx-proxy Automated Nginx reverse proxy for docker conâ€¦ 1696 [OK]richarvey/nginx-php-fpm Container running Nginx + PHP-FPM capable ofâ€¦ 746 [OK]...... ç›´æ¥é€šè¿‡ docker pull nginx å°±å¯ä»¥æ‹‰å–é•œåƒ æ„å»ºè‡ªå·±çš„é•œåƒè¦æƒ³æ„å»ºè‡ªå·±çš„é•œåƒï¼Œéœ€è¦æœ‰ä¸€ä¸ªDockerfileæ–‡ä»¶ï¼Œç°åœ¨æˆ‘ä»¬å°è¯•æŠŠ node ç¨‹åº Docker åŒ– åˆ›å»º Node.js åº”ç”¨12345678910111213&#123; "name": "docker_web_app", "version": "1.0.0", "description": "Node.js on Docker", "author": "First Last &lt;first.last@example.com&gt;", "main": "server.js", "scripts": &#123; "start": "node server.js" &#125;, "dependencies": &#123; "express": "^4.16.1" &#125;&#125; ç„¶åï¼Œåˆ›å»ºä¸€ä¸ª server.js æ–‡ä»¶ï¼Œä½¿ç”¨ Express.js æ¡†æ¶å®šä¹‰ä¸€ä¸ª Web åº”ç”¨12345678910111213141516'use strict';const express = require('express');// Constantsconst PORT = 8080;const HOST = '0.0.0.0';// Appconst app = express();app.get('/', (req, res) =&gt; &#123; res.send('Hello world\n');&#125;);app.listen(PORT, HOST);console.log(`Running on http://$&#123;HOST&#125;:$&#123;PORT&#125;`); Dockerfileåˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œå‘½åä¸º Dockerfile1touch Dockerfile Dockerfile1234567891011121314151617181920# nodeç‰ˆæœ¬ä¸º10çš„é•œåƒFROM node:10# åº”ç”¨ç¨‹åºå·¥ä½œç›®å½•WORKDIR /usr/src/app# æ‹·è´æ–‡ä»¶ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ADDã€COPYï¼Œç”¨æ³•éƒ½ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ ADD æ”¯æŒå°†å½’æ¡£æ–‡ä»¶ï¼ˆtar, gzip, bzip2, etcï¼‰åšæå–å’Œè§£å‹æ“ä½œ# æ³¨æ„çš„æ˜¯ï¼ŒCOPY æŒ‡ä»¤éœ€è¦å¤åˆ¶çš„ç›®å½•ä¸€å®šè¦æ”¾åœ¨ Dockerfile æ–‡ä»¶çš„åŒçº§ç›®å½•ä¸‹ã€‚COPY package*.json ./# æ‰§è¡Œå‘½ä»¤RUN npm installCOPY . .# æš´éœ²ç«¯å£EXPOSE 8080# æ‰§è¡Œå‘½ä»¤ node server.jsCMD [ &quot;node&quot;, &quot;server.js&quot; ] .dockerignore æ–‡ä»¶åœ¨ Dockerfile çš„åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª .dockerignore æ–‡ä»¶ï¼Œå¸¦æœ‰ä»¥ä¸‹å†…å®¹12node_modulesnpm-debug.log è¿™å°†é¿å…ä½ çš„æœ¬åœ°æ¨¡å—ä»¥åŠè°ƒè¯•æ—¥å¿—è¢«æ‹·è´è¿›å…¥åˆ°ä½ çš„ Docker é•œåƒä¸­ï¼Œä»¥è‡³äºæŠŠä½ é•œåƒåŸæœ‰å®‰è£…çš„æ¨¡å—ç»™è¦†ç›–äº† æ„å»ºä½ çš„é•œåƒæ„å»ºéœ€è¦ä¸€ç‚¹æ—¶é—´1docker build -t wclimb/node-web-app . ç„¶åæŸ¥çœ‹åˆšåˆšæ„å»ºçš„é•œåƒ 1234docker imagesREPOSITORY TAG IMAGE ID CREATED SIZEwclimb/node-web-app latest 04fe1cd8e0b2 49 seconds ago 907MB è¿è¡Œé•œåƒ1docker run -p 49160:8080 -d wclimb/node-web-app æŸ¥çœ‹åˆšåˆšè¿è¡Œçš„å®¹å™¨123docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMESffe453510350 wclimb/node-web-app &quot;docker-entrypoint.sâ€¦&quot; 4 seconds ago Up 3 seconds 8081/tcp, 0.0.0.0:49160-&gt;8080/tcp unruffled_kare æŸ¥çœ‹å®¹å™¨å†…çš„logä¿¡æ¯123docker logs CONTAINER IDæ‰“å°å‡ºRunning on http://0.0.0.0:8080 è®¿é—® http://0.0.0.0:8080 å‡ºç°hello world å°†é•œåƒæ¨é€åˆ°è¿œç¨‹ä»“åº“1docker push wclimb/node-web-app:v1 æ ¼å¼ä¸º docker push [OPTIONS] NAME[:TAG]ï¼Œè¿™é‡ŒTAGä¸ºv1 æ€»ç»“è‡³æ­¤ç®€å•å…¥é—¨çš„dockeræ•™ç¨‹å°±å…¨éƒ¨ç»“æŸäº†ï¼Œæˆ‘ä»¬é¦–å…ˆå®‰è£…docker -&gt; åˆ›å»ºå®¹å™¨ -&gt; æœç´¢æ‹‰å–é•œåƒ -&gt; æ„å»ºè‡ªå·±çš„é•œåƒ(Dockerfile) -&gt; å‘å¸ƒé•œåƒï¼Œæ–‡ç« å¤§éƒ¨åˆ†å…¶å®å‚é˜…äº†å„ä¸ªå¹³å°çš„æ•™ç¨‹æˆ–è€…æ–‡æ¡£ã€‚ç®€å•çš„dockerå°±è¿™æ ·è·‘èµ·æ¥äº†ï¼Œä½†æ˜¯çœŸæ­£æˆ‘ä»¬å»ä½¿ç”¨çš„æ—¶å€™å¾€å¾€ä¼šæœ‰å¾ˆå¤šé—®é¢˜ï¼Œç”¨æ³•ä¹Ÿä¸æ˜¯ç›´æ¥è¿™ä¹ˆæš´åŠ›çš„å»ä½¿ç”¨ï¼Œä¾‹å¦‚ç›´æ¥æ‹‰å– centos é•œåƒå¾€é‡Œé¢å®‰è£… nginxï¼Œä¼šå¾ˆæµªè´¹èµ„æºï¼Œä¹Ÿæ²¡æœ‰åšåˆ°çœŸæ­£çš„éš”ç¦»ç¯å¢ƒã€‚ä¸‹ä¸€ç¯‡è®²ä½¿ç”¨docker-composeè®²å¤šä¸ªå®¹å™¨ç»„åˆèµ·æ¥ï¼Œå°½å¯èƒ½å®æˆ˜æ“ä½œ referenceæŠŠä¸€ä¸ª Node.js web åº”ç”¨ç¨‹åºç»™ Docker åŒ–30 åˆ†é’Ÿå¿«é€Ÿå…¥é—¨ Docker æ•™ç¨‹Docker â€” ä»å…¥é—¨åˆ°å®è·µ æœ¬æ–‡åœ°å€ï¼š http://www.wclimb.site/2019/12/03/Dockerå¿«é€Ÿå…¥é—¨/]]></content>
      <categories>
        <category>Docker</category>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æ•™ç¨‹</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitlab-CIåˆæ¢]]></title>
    <url>%2F2019%2F10%2F16%2FGitlab-CI%E5%88%9D%E6%8E%A2%2F</url>
    <content type="text"><![CDATA[å› ä¸ºé¡¹ç›®ä¸€ç›´éƒ½æ˜¯ä½¿ç”¨gitlabè¿›è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œä½†æ˜¯éƒ½æ˜¯å‰äººç§æ ‘ï¼Œåäººä¹˜å‡‰çš„ç°çŠ¶ã€‚éš¾å¾—æŠ½ç©ºèŠ±äº†ä¸€ç‚¹æ—¶é—´æ¥ç©ä¸€ä¸‹gitlabçš„CI å®˜æ–¹README å‡†å¤‡å·¥ä½œ ä¸€å°æœåŠ¡å™¨ æ³¨å†Œgitlabè´¦å·ï¼Œå¹¶ä¸”æ–°å»ºä¸€ä¸ªé¡¹ç›® æ–°å»º.gitlab-ci.ymlé¡¹ç›®ä¸‹æ–°å»ºæ–‡ä»¶ .gitlab-ci.ymlï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨Web IDE åœ¨çº¿æ–°å»ºæ–‡ä»¶ å®‰è£…Gitlab Runneråˆ°æœåŠ¡å™¨ç™»å½•ä½ çš„æœåŠ¡å™¨ 123456# For Debian/Ubuntu$ curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.deb.sh | sudo bash$ sudo apt-get install gitlab-ci-multi-runner# For CentOS$ curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.rpm.sh | sudo bash$ sudo yum install gitlab-ci-multi-runner æ¥ä¸‹æ¥æ³¨å†Œä¸€ä¸ªRunner 1sudo gitlab-runner register ç„¶åä¼šå‡ºç°ä»¥ä¸‹æç¤ºï¼Œæˆ‘ä»¬ç›´æ¥è¾“å…¥ https://gitlab.com 12Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com )https://gitlab.com è¾“å…¥gitlabæ–°å»ºé¡¹ç›®CIçš„tokenï¼Œtokenåœ¨é¡¹ç›®å†…çš„ Setting -&gt; CI/CD -&gt; Runnersï¼ˆç‚¹å‡»expandå±•å¼€ï¼‰ 12Please enter the gitlab-ci token for this runnerè¿™é‡Œå¡«token è¾“å…¥runnerçš„æè¿° 12Please enter the gitlab-ci description for this runnerè¿™é‡Œéšä¾¿å¡« å‘½åtag 12Please enter the gitlab-ci tags for this runner (comma separated):my-tag // æ¯ä¸€ä¸ªrunnerçš„å”¯ä¸€idï¼Œä¹Ÿå¯ä»¥åœ¨gitlabåå°ä¿®æ”¹ã€‚ æ˜¯å¦æ¥æ”¶æœªæŒ‡å®š tags çš„ä»»åŠ¡ 12Whether to run untagged builds [true/false][false]: false é€‰æ‹©æ˜¯å¦ä¸ºå½“å‰é¡¹ç›®é”å®šè¯¥ Runner 12Whether to lock Runner to current project [true/false]:[false]: false é€‰æ‹© Runner executor 12345Please enter the executor: virtualbox, docker+machine, docker-ssh, shell, ssh, docker-ssh+machine, kubernetes, docker, parallels:shell // è¿™é‡Œé€‰shellï¼Œå¾ˆå¤šäººä½¿ç”¨çš„æ˜¯docker// æœ€åä¼šå‘Šè¯‰ä½ æ³¨å†ŒæˆåŠŸRunner registered successfully. Feel free to start it, but if it&apos;s running already the config should be automatically reloaded! ç°åœ¨åˆ·æ–°ä¸€ä¸‹ä¹‹å‰å¤åˆ¶tokençš„åœ°æ–¹çœ‹çœ‹ï¼Œæ˜¯ä¸æ˜¯åˆšåˆšæ–°å»ºçš„runnerç”Ÿæ•ˆäº† Pipelineä¸€æ¬¡ Pipeline ç›¸å½“äºä¸€æ¬¡æ„å»ºä»»åŠ¡ï¼Œé‡Œé¢å¯ä»¥åŒ…å«å¤šä¸ªæµç¨‹ï¼Œå¦‚å®‰è£…ä¾èµ–ã€è¿è¡Œæµ‹è¯•ã€ç¼–è¯‘ã€éƒ¨ç½²æµ‹è¯•æœåŠ¡å™¨ã€éƒ¨ç½²ç”Ÿäº§æœåŠ¡å™¨ç­‰æµç¨‹ã€‚æˆ‘ä»¬çš„ä»»ä½•æäº¤æˆ–è€… Merge Request çš„åˆå¹¶éƒ½å¯ä»¥è§¦å‘ Pipelineã€‚å¦‚ä¸‹å›¾ï¼š12345+------------------+ +----------------+| | trigger | || Commit / MR +----------&gt;+ Pipeline || | | |+------------------+ +----------------+ stagesstagesè¡¨ç¤ºæ„å»ºé˜¶æ®µ æ‰€æœ‰ stages ä¼šæŒ‰ç…§é¡ºåºè¿è¡Œï¼Œå³å½“ä¸€ä¸ª stage å®Œæˆåï¼Œä¸‹ä¸€ä¸ª stage æ‰ä¼šå¼€å§‹ åªæœ‰å½“æ‰€æœ‰ stages å®Œæˆåï¼Œè¯¥æ„å»ºä»»åŠ¡ (Pipeline) æ‰ä¼šæˆåŠŸ å¦‚æœä»»ä½•ä¸€ä¸ª stage å¤±è´¥ï¼Œé‚£ä¹ˆåé¢çš„ stages ä¸ä¼šæ‰§è¡Œï¼Œè¯¥æ„å»ºä»»åŠ¡ (Pipeline) å¤±è´¥ ä¸€ä¸ªPipelineä¼šæœ‰å¤šä¸ªStageï¼Œä¸€æ­¥æ­¥æ‰§è¡Œ123456789+--------------------------------------------------------+| || Pipeline || || +-----------+ +------------+ +------------+ || | Stage 1 |----&gt;| Stage 2 |-----&gt;| Stage 3 | || +-----------+ +------------+ +------------+ || |+--------------------------------------------------------+ é…ç½®.gitlab-ci.ymlä¹‹å‰æˆ‘ä»¬æ–°å»ºäº†.gitlab-ci.ymlï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥å¡«å†™ä¸€äº›å†…å®¹ï¼Œè®©CIå˜å¾—å¯ç”¨123456789101112131415161718192021stages: - build - test job2: stage: test script: - touch test.json only: - master tags: - my-tag job1: stage: build script: - npm init -y only: - master tags: - my-tag stages å°±æ˜¯æˆ‘ä»¬ä¸Šé¢è®²çš„æ„å»ºé˜¶æ®µï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªé˜¶æ®µï¼Œå…ˆbuildç„¶åtestï¼Œä¼šå…ˆæ‰§è¡Œä»»åŠ¡ job1 ç„¶å æ‰§è¡Œ job2ï¼Œè¿™é‡Œjob1/2åç§°å¯ç”¨éšä¾¿å–ï¼Œä¸å½±å“ stage è¡¨ç¤ºæ„å»ºçš„å­ä»»åŠ¡ script æ‰§è¡Œçš„shellå‘½ä»¤ only è¿™é‡Œå¡«å†™è¡¨ç¤ºåªæœ‰åœ¨masteråšæ“ä½œçš„æ—¶å€™ä¼šè§¦å‘è¿™ä¸ªæ„å»º tags è¿™å°±æ˜¯æˆ‘ä»¬ä¹‹å‰åœ¨æœåŠ¡å™¨å‘½åçš„tagï¼Œå¿…å¡« æˆ‘ä»¬æŠŠè¿™ä¸ªæ–‡ä»¶pushåˆ°masterï¼Œç„¶ååœ¨ CI/CD -&gt; Pipelines æŸ¥çœ‹æˆ‘ä»¬æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ å¦‚æœstatusæ˜¾ç¤ºpassedäº†ï¼Œåˆ™ä»£è¡¨è¿è¡ŒæˆåŠŸ è‡³æ­¤ï¼Œå¤§åŠŸå‘Šæˆ æ›´æ”¹æ‰§è¡Œç”¨æˆ·ä½ å¯èƒ½åœ¨ä¸Šé¢ä¸€æ­¥ä¼šå‘ç° npm not foundçš„æƒ…å†µï¼Œä½†æ˜¯æœåŠ¡å™¨å·²ç»å®‰è£…äº†node å› ä¸ºgitlab-ciçš„runneré»˜è®¤ä½¿ç”¨gitlab-runnerç”¨æˆ·æ‰§è¡Œæ“ä½œ é€šè¿‡æŒ‡ä»¤ps aux|grep gitlab-runnerå¯ä»¥çœ‹åˆ°ï¼š 1/usr/bin/gitlab-ci-multi-runner run --working-directory /home/gitlab-runner --config /etc/gitlab-runner/config.toml --service gitlab-runner --syslog --user gitlab-runner --working-directoryï¼šè®¾ç½®å·¥ä½œç›®å½•, é»˜è®¤æ˜¯/home/{æ‰§è¡Œuser} --configï¼šè®¾ç½®é…ç½®æ–‡ä»¶ç›®å½•ï¼Œé»˜è®¤æ˜¯/etc/gitlab-runner/config.toml --userï¼šè®¾ç½®æ‰§è¡Œç”¨æˆ·åï¼Œé»˜è®¤æ˜¯gitlab-runner å› æ­¤æƒ³è¦æ›´æ”¹userä¸ºrootåªéœ€è¦é‡æ–°è®¾ç½®--userå±æ€§å³å¯ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š åˆ é™¤gitlab-runner 1sudo gitlab-runner uninstall åˆ‡æ¢ä¸ºroot 1gitlab-runner install --working-directory /home/gitlab-runner --user root é‡å¯gitlab-runner 1sudo service gitlab-runner restart é‡æ–°æäº¤ä¸€ä¸‹.gitlab-cli.yamlï¼Œåº”è¯¥å°±èƒ½å¤Ÿè·‘é€šäº† åŸæ–‡åœ°å€ï¼š http://www.wclimb.site/2019/10/16/Gitlab-CIåˆæ¢/]]></content>
      <categories>
        <category>å·¥å…·</category>
        <category>è‡ªåŠ¨åŒ–</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>gitlab</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Vueä¹‹vuexæºç åˆ†æ]]></title>
    <url>%2F2019%2F10%2F14%2FVue%E4%B9%8Bvuex%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[vuexä½¿ç”¨å½“å‰vuexç‰ˆæœ¬ï¼š3.1.0 12345678910111213141516171819202122import Vue from 'vue';import Vuex from 'vuex';Vue.use(Vuex);const state = &#123; test: 1&#125;const actions = &#123; changeTest(&#123; commit &#125;, payload)&#123; commit('setTestValue', payload) &#125;&#125;const mutations = &#123; setTestValue(state, payload)&#123; state.test = payload &#125;&#125;export default new Vuex.Store(&#123; state, actions, mutations,&#125;) 123456789import Vue from 'vue';import store from './store';new Vue(&#123; el: '#app', store, template: '&lt;App/&gt;', components: &#123; App &#125;&#125;); é¦–å…ˆæˆ‘ä»¬å…ˆæ³¨å†Œvuexï¼Œç„¶åè®¾ç½®ä¸€äº›state/mutation/actions å®ä¾‹åŒ–å‡ºæ¥ï¼Œæœ€åäº¤ç»™ Vue å¤„ç† å¯¹ API ä¸ç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥ç§»æ­¥ vuex æ³¨å†Œç”¨æ³•æˆ‘ä»¬çŸ¥é“äº†ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒVuexæ˜¯æ€æ ·æŠŠstoreæ³¨å…¥åˆ°Vueå®ä¾‹ä¸­å»çš„å‘¢ï¼Ÿ æˆ‘ä»¬çŸ¥é“ä½¿ç”¨æ’ä»¶ä¸€èˆ¬éƒ½éœ€è¦vue.use()ï¼Œä¼ å…¥çš„å‚æ•°å†…éƒ¨å¿…é¡»è¦æä¾›ä¸€ä¸ªinstallçš„æ–¹æ³•ï¼Œä¸Šé¢æˆ‘ä»¬ä½¿ç”¨vue.use(vuex)å»å®‰è£…ï¼Œé‚£ä¹ˆvuexå†…éƒ¨è‚¯å®šæ˜¯æš´éœ²äº†åº”è¯¥installçš„æ–¹æ³•å¾— vuex installçš„å®ç° vuex/index.js æºç åœ°å€12345678910111213import &#123; Store, install &#125; from './store'import &#123; mapState, mapMutations, mapGetters, mapActions, createNamespacedHelpers &#125; from './helpers'export default &#123; Store, install, version: '__VERSION__', mapState, mapMutations, mapGetters, mapActions, createNamespacedHelpers&#125; installæ–¹æ³•1234567891011121314export function install (_Vue) &#123; // é¦–å…ˆåˆ¤æ–­vuexæ˜¯å¦å·²ç»æ³¨å†Œè¿‡äº† if (Vue &amp;&amp; _Vue === Vue) &#123; if (process.env.NODE_ENV !== 'production') &#123; console.error( '[vuex] already installed. Vue.use(Vuex) should be called only once.' ) &#125; return &#125; Vue = _Vue // è°ƒç”¨å…¨å±€æ··å…¥æ–¹æ³• applyMixin(Vue)&#125; é¦–å…ˆåˆ¤æ–­vuexæ˜¯å¦è¢«é‡å¤å®‰è£…ï¼Œå®‰è£…å®Œæˆä¹‹åè°ƒç”¨applyMixinæ–¹æ³•ï¼Œå†…éƒ¨æ–¹æ³•è§ä¸‹æ–‡ applyMixin æºç åœ°å€1234567891011121314151617181920212223242526272829export default function (Vue) &#123; const version = Number(Vue.version.split('.')[0]) // å¦‚æœvueç‰ˆæœ¬å¤§äº2 åˆ™è°ƒç”¨å…¨å±€æ··æ·†æ–¹æ³•ï¼Œæ··æ·†è¿›beforeCreateé’©å­ if (version &gt;= 2) &#123; Vue.mixin(&#123; beforeCreate: vuexInit &#125;) &#125; else &#123; // å¦‚æœvueå°äº2ç‰ˆæœ¬ï¼ŒæŠŠvuexInitæ”¾å…¥Vueçš„_initæ–¹æ³•ä¸­æ‰§è¡Œ const _init = Vue.prototype._init Vue.prototype._init = function (options = &#123;&#125;) &#123; options.init = options.init ? [vuexInit].concat(options.init) : vuexInit _init.call(this, options) &#125; &#125; // Vuexçš„inité’©å­ï¼Œä¼šå­˜å…¥æ¯ä¸€ä¸ªVueå®ä¾‹ç­‰é’©å­åˆ—è¡¨ function vuexInit () &#123; const options = this.$options // store injection if (options.store) &#123; this.$store = typeof options.store === 'function' ? options.store() : options.store &#125; else if (options.parent &amp;&amp; options.parent.$store) &#123; this.$store = options.parent.$store &#125; &#125;&#125; é¦–å…ˆåˆ¤æ–­å½“å‰Vueçš„ç‰ˆæœ¬é€‰æ‹©æ‰§è¡Œï¼Œå¤§äº2.0çš„ç‰ˆæœ¬ç›´æ¥æŠŠvuexInitæ··æ·†è¿›beforeCreateï¼Œå¦åˆ™æŠŠvuexInitæ”¾å…¥Vueçš„_initæ–¹æ³•ä¸­æ‰§è¡Œã€‚vuexInitä¼šå…ˆä»optionsä¸­å–storeï¼Œå¦‚æœå½“å‰ç»„ä»¶ä¸ºè·Ÿç»„ä»¶ï¼Œé‚£ä¹ˆoptions.storeè‚¯å®šä¼šå­˜åœ¨ï¼ŒæŠŠstoreæŒ‚è½½åœ¨vueçš„$storeå†…ï¼Œå¦‚æœæ˜¯éæ ¹ç»„ä»¶ï¼Œåˆ™è·å–optionsçš„parentï¼Œä¹Ÿå°±æ˜¯çˆ¶ç»„ä»¶çš„$storeï¼Œè¿™æ ·å°±å®ç°äº†ï¼Œæ‰€æœ‰çš„ç»„ä»¶éƒ½è·å–åˆ°åŒä¸€ä»½åœ°å€çš„Storeï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹Storeçš„å®ç° Storeæ„é€ å‡½æ•°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192export class Store &#123; constructor (options = &#123;&#125;) &#123; // é¦–å…ˆå…ˆå®‰è£…Vue if (!Vue &amp;&amp; typeof window !== 'undefined' &amp;&amp; window.Vue) &#123; install(window.Vue) &#125; if (process.env.NODE_ENV !== 'production') &#123; // åˆ¤æ–­vueæ˜¯å¦å®‰è£… assert(Vue, `must call Vue.use(Vuex) before creating a store instance.`) // promiseæ˜¯å¦æ”¯æŒ assert(typeof Promise !== 'undefined', `vuex requires a Promise polyfill in this browser.`) // åˆ¤æ–­thisæ˜¯å¦æ˜¯Storeçš„å®ä¾‹ assert(this instanceof Store, `store must be called with the new operator.`) &#125; // ä¸€èˆ¬optionsä¼ å…¥çš„æ˜¯ /** * &#123; * state, * mutations, * actions, * modules * &#125; **/ const &#123; // store ä¸Šçš„æ’ä»¶æ–¹æ³• plugins = [], // æ ‡è®°æ˜¯å¦æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œå¦‚æœæ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œä¸å…è®¸ç›´æ¥ä¿®æ”¹stateï¼Œä¸€å®šè¦é€šè¿‡mutations strict = false &#125; = options // store internal state // ç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯mutationsæ¥ä¿®æ”¹çš„state this._committing = false // å­˜æ”¾action this._actions = Object.create(null) this._actionSubscribers = [] // å­˜æ”¾mutations this._mutations = Object.create(null) // å­˜æ”¾getter this._wrappedGetters = Object.create(null) // å­˜æ”¾module this._modules = new ModuleCollection(options) // è·Ÿè¿›å‘½åç©ºé—´å­˜æ”¾module this._modulesNamespaceMap = Object.create(null) // å­˜æ”¾è®¢é˜…è€… this._subscribers = [] // å®ç°Vueçš„watch this._watcherVM = new Vue() // bind commit and dispatch to self const store = this const &#123; dispatch, commit &#125; = this // æŠŠdispatchçš„thisç»‘å®šåˆ°Store this.dispatch = function boundDispatch (type, payload) &#123; return dispatch.call(store, type, payload) &#125; // æŠŠcommitçš„thisç»‘å®šåˆ°Store this.commit = function boundCommit (type, payload, options) &#123; return commit.call(store, type, payload, options) &#125; // strict mode // æ˜¯å¦ä¸ºä¸¥æ ¼æ¨¡å¼ this.strict = strict // è·å–æ ¹æ¨¡å—çš„state const state = this._modules.root.state // init root module. // this also recursively registers all sub-modules // and collects all module getters inside this._wrappedGetters // é€’å½’åœ°æ³¨å†Œä¼ å…¥çš„module installModule(this, state, [], this._modules.root) // initialize the store vm, which is responsible for the reactivity // (also registers _wrappedGetters as computed properties) // é€šè¿‡vmé‡æ–°è®¾ç½®storeï¼Œç­‰ä¼šçœ‹å®ƒçš„å†…éƒ¨å®ç°ï¼ŒåŸç†æ˜¯å€ŸåŠ©Vueçš„å“åº”å¼æ¥æ³¨å†Œstateå’Œgetter resetStoreVM(this, state) // apply plugins // è°ƒç”¨æ’ä»¶ plugins.forEach(plugin =&gt; plugin(this)) // devtoolæ’ä»¶è°ƒç”¨ const useDevtools = options.devtools !== undefined ? options.devtools : Vue.config.devtools if (useDevtools) &#123; devtoolPlugin(this) &#125; &#125;&#125; dispatchï¼ˆactionï¼‰æˆ‘ä»¬çŸ¥é“å¦‚æœæˆ‘ä»¬éœ€è¦æ”¹å˜stateï¼Œéœ€è¦å…ˆè°ƒç”¨this.$store.dispatch()ï¼Œæ¥è§¦å‘actionï¼Œç„¶åå†è°ƒç”¨commitæ¥è§¦å‘mutationï¼Œæœ€ç»ˆæ›´æ”¹stateï¼Œé‚£ä¹ˆdispatchæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849dispatch (_type, _payload) &#123; // check object-style dispatch // æ ¡éªŒå‚æ•° const &#123; type, payload &#125; = unifyObjectStyle(_type, _payload) const action = &#123; type, payload &#125; // è·å–å½“å‰éœ€è¦è§¦å‘actionçš„å‡½æ•°é›†åˆï¼Œæ³¨æ„ï¼Œè¿™é‡Œentryæ˜¯ä¸€ä¸ªæ•°ç»„é›†åˆï¼Œä¸€èˆ¬æ¥è¯´æ˜¯åªä¼šå­˜åœ¨ä¸€ä¸ªæ–¹æ³•ï¼Œtype: functionï¼Œè‡³äºä¸ºä»€ä¹ˆåé¢è®²åˆ° const entry = this._actions[type] if (!entry) &#123; if (process.env.NODE_ENV !== 'production') &#123; console.error(`[vuex] unknown action type: $&#123;type&#125;`) &#125; return &#125; try &#123; // action æ‰§è¡Œå‰ï¼Œå…ˆè°ƒç”¨è®¢é˜… action å˜åŒ–çš„å›è°ƒå‡½æ•° this._actionSubscribers .filter(sub =&gt; sub.before) .forEach(sub =&gt; sub.before(action, this.state)) &#125; catch (e) &#123; if (process.env.NODE_ENV !== 'production') &#123; console.warn(`[vuex] error in before action subscribers: `) console.error(e) &#125; &#125; // å¦‚æœé›†åˆå¤§äº1åˆ™è°ƒç”¨Promise.allï¼Œå…¨éƒ¨resolveä¹‹åå¾—åˆ°resultï¼Œä¹Ÿæ˜¯ä¸ªpromiseå¯¹è±¡ï¼Œæœ€åç›´æ¥æ‰§è¡Œ.then()æ–¹æ³•è¿”å›æ‰§è¡Œçš„ç»“æœres const result = entry.length &gt; 1 ? Promise.all(entry.map(handler =&gt; handler(payload))) : entry[0](payload) return result.then(res =&gt; &#123; try &#123; // action æ‰§è¡Œåï¼Œå…ˆè°ƒç”¨è®¢é˜… action å˜åŒ–çš„å›è°ƒå‡½æ•° this._actionSubscribers .filter(sub =&gt; sub.after) .forEach(sub =&gt; sub.after(action, this.state)) &#125; catch (e) &#123; if (process.env.NODE_ENV !== 'production') &#123; console.warn(`[vuex] error in after action subscribers: `) console.error(e) &#125; &#125; return res &#125;)&#125; ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä½¿ç”¨Promise.allæ¥æ‰§è¡Œentryï¼Œæ‰§è¡Œæ¯ä¸ªhandleå‡½æ•°ï¼Œå…¨éƒ¨æ‰§è¡Œå®Œæˆåå†.then()è¿”å›ç»“æœã€‚é‚£ä¹ˆè¿™ä¸ªhandleæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ installModuleinstallModuleå†…å®‰è£…action12345678910111213function installModule (store, rootState, path, module, hot) &#123; ... module.forEachAction((action, key) =&gt; &#123; const type = action.root ? key : namespace + key const handler = action.handler || action registerAction(store, type, handler, local) &#125;) ...&#125; registerActionåœ¨Storeæ„é€ å‡½æ•°å†…æ‰§è¡Œå®‰è£…æ¨¡å—ï¼Œå†…éƒ¨ä¼šå¾ªç¯æ³¨å†Œä¼ å…¥çš„actionï¼Œè°ƒç”¨registerActionæ–¹æ³• 1234567891011121314151617181920212223242526272829function registerAction (store, type, handler, local) &#123; // é¦–å…ˆè·å–å½“å‰éœ€è¦ä¼ å…¥çš„actionåå­—ï¼Œå¦‚æœæ²¡æœ‰åˆ™èµ‹å€¼ä¸ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå¦‚æœæ‰¾åˆ°èµ‹å€¼ç»™entry const entry = store._actions[type] || (store._actions[type] = []) // å¾€entryå¢åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢dispatchæ‰§è¡Œçš„handle // handleçš„thisæŒ‡å‘storeï¼Œä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œ&#123;dispatch,commit...&#125; (è§¦å‘mutationéœ€è¦ä½¿ç”¨ï¼Œå¤§éƒ¨åˆ†åªéœ€è¦ç”¨åˆ°commit)ï¼Œpayload(å¤–éƒ¨ä¼ é€’è¿›æ¥çš„å‚æ•°) cbï¼ˆå›è°ƒå‡½æ•°ï¼‰ entry.push(function wrappedActionHandler (payload, cb) &#123; let res = handler.call(store, &#123; dispatch: local.dispatch, commit: local.commit, getters: local.getters, state: local.state, rootGetters: store.getters, rootState: store.state &#125;, payload, cb) // å¦‚æœä¸æ˜¯ä¸ªpromiseï¼Œç”¨promiseåŒ…è£…ä¸€ä¸‹è¿”å› if (!isPromise(res)) &#123; res = Promise.resolve(res) &#125; // devtoolæ’ä»¶ç›¸å…³ if (store._devtoolHook) &#123; return res.catch(err =&gt; &#123; store._devtoolHook.emit('vuex:error', err) throw err &#125;) &#125; else &#123; return res &#125; &#125;)&#125; æˆ‘ä»¬ä¸€èˆ¬æ˜¯è¿™ä¹ˆä½¿ç”¨dispathçš„ï¼ŒğŸ‘‡12345this.$store.dispatch('actionName',&#123; test: 123&#125;).then((res=&gt;&#123; ...&#125;)) å†æ¥æƒ³æƒ³dispatchçš„æ‰§è¡Œæœºåˆ¶ï¼Œæ˜¯ä¸æ˜¯å˜å¾—å¾ˆæ¸…æ™°äº†ï¼Ÿé¦–å…ˆè°ƒç”¨dispatchæ–¹æ³•ï¼Œè·å–éœ€è¦è°ƒç”¨çš„actionï¼Œä¹Ÿæ˜¯å°±actionNameï¼Œç„¶åæŠŠpayloadä¼ å…¥ï¼Œä¹Ÿå°±æ˜¯{test:1}ï¼Œç„¶åå®Œæˆä¹‹åè°ƒç”¨.then()å¼‚æ­¥æ‰§è¡Œæ‰€éœ€æ“ä½œ commit ï¼ˆmutationï¼‰å…ˆæ¥çœ‹çœ‹å®é™…åº”ç”¨æ˜¯è¿™ä¹ˆè§¦å‘commitçš„12345678910const actions = &#123; changeTest(&#123; commit &#125;, payload)&#123; commit('setTestValue', payload) &#125;&#125;const mutations = &#123; setTestValue(state, payload)&#123; state.test = payload &#125;&#125; åœ¨è§¦å‘actionçš„æ—¶å€™ï¼Œè°ƒç”¨commitï¼Œè‡³äºä¸ºä»€ä¹ˆä¼šæœ‰commitæ–¹æ³•ï¼Œæ˜¯å› ä¸ºä¸Šé¢registerAction pushçš„æ–¹æ³•ç¬¬ä¸€ä¸ªä¼ è¾“ä¼ å…¥äº†ä¸€ä¸ªå¯¹è±¡{dispatch,commit...}ï¼Œç„¶åæŠŠdispatchä¼ å…¥çš„payloadå†ä»£å…¥commitæ–¹æ³•æ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253commit (_type, _payload, _options) &#123; // check object-style commit // æ ¡éªŒå‚æ•° const &#123; type, payload, options &#125; = unifyObjectStyle(_type, _payload, _options) const mutation = &#123; type, payload &#125; // è·å–å½“å‰å¯¹åº”çš„mutationæ–¹æ³•é›†åˆ const entry = this._mutations[type] if (!entry) &#123; if (process.env.NODE_ENV !== 'production') &#123; console.error(`[vuex] unknown mutation type: $&#123;type&#125;`) &#125; return &#125; // éå†è°ƒç”¨é›†åˆå†…çš„æ–¹æ³•ï¼Œæœ€åæŠŠpayloadå‚æ•°ä¼ å…¥é›†åˆçš„æ–¹æ³•ï¼Œç­‰ä¼šä»‹ç»handleå‡½æ•° // _withCommitæ–¹æ³•æ˜¯åˆ¤æ–­å½“å‰æ“ä½œæ˜¯å¦æ˜¯é€šè¿‡commitæäº¤æ¥ä¿®æ”¹stateçš„ this._withCommit(() =&gt; &#123; entry.forEach(function commitIterator (handler) &#123; handler(payload) &#125;) &#125;) // é€šçŸ¥æ‰€æœ‰è®¢é˜…è€… this._subscribers.forEach(sub =&gt; sub(mutation, this.state)) if ( process.env.NODE_ENV !== 'production' &amp;&amp; options &amp;&amp; options.silent ) &#123; console.warn( `[vuex] mutation type: $&#123;type&#125;. Silent option has been removed. ` + 'Use the filter functionality in the vue-devtools' ) &#125;&#125;``` ### installModule```jsfunction installModule (store, rootState, path, module, hot) &#123; ... module.forEachMutation((mutation, key) =&gt; &#123; const namespacedType = namespace + key registerMutation(store, namespacedType, mutation, local) &#125;) ...&#125; å’ŒactionåŒç†ï¼Œæ³¨å†Œæ‰€æœ‰çš„mutationï¼Œè°ƒç”¨registerMutationæ–¹æ³• registerMutation123456function registerMutation (store, type, handler, local) &#123; const entry = store._mutations[type] || (store._mutations[type] = []) entry.push(function wrappedMutationHandler (payload) &#123; handler.call(store, local.state, payload) &#125;)&#125; registerMutationæ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œç›´æ¥æŠŠstateã€payloadä¼ å…¥handlerå‡½æ•° å†æ¥çœ‹çœ‹å®é™…ä½¿ç”¨12345678910const actions = &#123; changeTest(&#123; commit &#125;, payload)&#123; commit('setTestValue', payload) &#125;&#125;const mutations = &#123; setTestValue(state, payload)&#123; state.test = payload &#125;&#125; commitè°ƒç”¨ä¹‹åï¼Œè·å–åˆ°å¯¹åº”éœ€è¦è§¦å‘çš„mutationï¼Œä¹Ÿå°±æ˜¯setTestValueï¼Œç„¶åå®é™…æ‰§è¡Œçš„æ˜¯registerMutationå¤„ç†èµ‹å€¼ç»™ store._mutations[&#39;setTestValue]çš„æ–¹æ³•é›†åˆï¼Œä¹Ÿå°±æ˜¯entryï¼Œå†…éƒ¨ä¼šä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œstateã€payload,è¿™å°±æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ state.test = payload çš„åŸå›  mapState/mapAction/mapGetterç­‰å·¥å…·å‡½æ•°å¼€å‘ä¸­æˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨åˆ°mapStateæ¥è·å–æ•°æ®å·¥å…·å‡½æ•°æºç åœ°å€ mapStateå…ˆæ¥çœ‹çœ‹æˆ‘ä»¬åœ¨å®é™…é¡¹ç›®æ€ä¹ˆä½¿ç”¨12345678910111213141516171819202122232425// åœ¨å•ç‹¬æ„å»ºçš„ç‰ˆæœ¬ä¸­è¾…åŠ©å‡½æ•°ä¸º Vuex.mapStateimport &#123; mapState &#125; from 'vuex'export default &#123; // ... computed: mapState(&#123; // ç®­å¤´å‡½æ•°å¯ä½¿ä»£ç æ›´ç®€ç»ƒ count: state =&gt; state.count, // ä¼ å­—ç¬¦ä¸²å‚æ•° 'count' ç­‰åŒäº `state =&gt; state.count` countAlias: 'count', // ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨ `this` è·å–å±€éƒ¨çŠ¶æ€ï¼Œå¿…é¡»ä½¿ç”¨å¸¸è§„å‡½æ•° countPlusLocalState (state) &#123; return state.count + this.localCount &#125; &#125;) // æˆ–è€…å¸¦å‘½åç©ºé—´çš„ä½¿ç”¨ï¼Œè¿™å°±æ˜¯ä¸‹é¢normalizeNamespaceå¾—ä½œç”¨ computed: &#123; ...mapState('some/nested/module', &#123; a: state =&gt; state.a, // å¦‚æœä¸ä½¿ç”¨åˆ™éœ€è¦é€šè¿‡ state.some.nested.module.a b: state =&gt; state.b &#125;)&#125;,&#125; mapState æºç åœ°å€123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566// é¦–å…ˆæ˜¯åˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº†å‘½åç©ºé—´ï¼Œå¦‚æœæ²¡æœ‰çš„è¯namespaceä¼šè¢«èµ‹å€¼ä¸ºç©ºï¼ŒnormalizeNamespaceå®ç°è§ä»£ç åº•éƒ¨export const mapState = normalizeNamespace((namespace, states) =&gt; &#123; const res = &#123;&#125; // å…ˆæŠŠä¼ å…¥çš„statesè½¬æ¢ä¸€ä¸‹ï¼Œè½¬æ¢ä¾‹å­å¦‚ä¸‹ï¼Œè½¬æ¢æˆæ•°ç»„å¯¹è±¡çš„å½¢å¼ï¼Œéƒ½æœ‰keyå’Œval normalizeMap(states).forEach((&#123; key, val &#125;) =&gt; &#123; res[key] = function mappedState () &#123; // è·å–state let state = this.$store.state let getters = this.$store.getters // å¦‚æœæœ‰å‘½ååˆ™è§£æå®Œæˆä¹‹åé‡æ–°èµ‹å€¼stateå’Œgetter if (namespace) &#123; // é€šè¿‡æ¨¡å—æ¥è§£æè®¿é—®è·¯å¾„ some/nested/module =&gt; store._modulesNamespaceMap['some/nested/module/] = &#123; // å½“å‰æ¨¡å— &#125; // å…³äºå¦‚ä½•å®ç°çš„ï¼Œæºç åœ°å€ https://github.com/vuejs/vuex/blob/665455f8da/src/store.js#L301 const module = getModuleByNamespace(this.$store, 'mapState', namespace) if (!module) &#123; return &#125; state = module.context.state getters = module.context.getters &#125; // å¦‚æœä¼ å…¥çš„å‡½æ•°ï¼Œåˆ™æŠŠstateå’Œgetterä¼ å…¥åˆ°å‡½æ•°å†… // å¦åˆ™å¦‚æœä¼ å…¥çš„æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™ç›´æ¥å–å‡ºè¿”å›æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢ä½¿ç”¨ countAlias: 'count', return typeof val === 'function' ? val.call(this, state, getters) : state[val] &#125; // mark vuex getter for devtools res[key].vuex = true &#125;) // æœ€ç»ˆæŠŠå¤„ç†å¥½çš„å¯¹è±¡è¿”å›å¤„ç†ï¼Œæ‰€ä»¥å¯çŸ¥mapStateè¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ return res&#125;)/** * Normalize the map * normalizeMap([1, 2, 3]) =&gt; [ &#123; key: 1, val: 1 &#125;, &#123; key: 2, val: 2 &#125;, &#123; key: 3, val: 3 &#125; ] * normalizeMap(&#123;a: 1, b: 2, c: 3&#125;) =&gt; [ &#123; key: 'a', val: 1 &#125;, &#123; key: 'b', val: 2 &#125;, &#123; key: 'c', val: 3 &#125; ] * @param &#123;Array|Object&#125; map * @return &#123;Object&#125; */function normalizeMap (map) &#123; return Array.isArray(map) ? map.map(key =&gt; (&#123; key, val: key &#125;)) : Object.keys(map).map(key =&gt; (&#123; key, val: map[key] &#125;))&#125;/** * Return a function expect two param contains namespace and map. it will normalize the namespace and then the param's function will handle the new namespace and the map. * @param &#123;Function&#125; fn * @return &#123;Function&#125; */function normalizeNamespace (fn) &#123; return (namespace, map) =&gt; &#123; // é¦–å…ˆåˆ¤æ–­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ï¼Œå› ä¸ºæˆ‘ä»¬å¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯ä¼ é€’çš„æ˜¯å¯¹è±¡ï¼Œåªæœ‰ä½¿ç”¨å‘½åç©ºé—´çš„æ—¶å€™ç¬¬ä¸€ä¸ªå‚æ•°ä¼šæ˜¯å­—ç¬¦ä¸² // å¦‚æœä¸æ˜¯å­—ç¬¦ä¸²çš„è¯ï¼ŒæŠŠç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿå°±æ˜¯namespaceèµ‹å€¼ä¸ºmapï¼Œè‡ªå·±ç½®ä¸ºç©ºï¼Œè¿™æ ·å°±è¾¾åˆ°äº†ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥å¯¹è±¡ä¹Ÿæ˜¯å¯ä»¥çš„ if (typeof namespace !== 'string') &#123; map = namespace namespace = '' // å¦‚æœä¼ å…¥çš„æ˜¯å¯¹è±¡ï¼Œå¦‚æœæœ€åä¸€ä¸ªå­—ç¬¦ä¸æ˜¯/ï¼Œåˆ™è‡ªåŠ¨æ‹¼æ¥ï¼Œå› ä¸º store._modulesNamespaceMap ä¸‹éƒ½æ˜¯è¿™æ ·çš„key 'some/nested/module' // å…·ä½“æ€ä¹ˆå®ç°è¿™ç§è·¯å¾„çš„è§æºç  getNamespace æ–¹æ³• https://github.com/vuejs/vuex/blob/665455f8da/src/module/module-collection.js#L16 &#125; else if (namespace.charAt(namespace.length - 1) !== '/') &#123; namespace += '/' &#125; return fn(namespace, map) &#125;&#125; è¿™é‡Œåªè®²mapStateï¼Œå…¶ä»–çš„å®ç°å¤§åŒå°å¼‚ï¼Œéƒ½å·®ä¸å¤ªå¤š vuexå“åº”å¼åŸç†ä¸ºä»€ä¹ˆæˆ‘ä»¬é€šè¿‡ä¿®æ”¹stateï¼Œæ¨¡æ¿é‡Œçš„è§†å›¾ä¹Ÿä¸€èµ·æ›´æ–°äº†å‘¢ï¼Ÿ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354function resetStoreVM (store, state, hot) &#123; const oldVm = store._vm // bind store public getters // åˆå§‹åŒ–storeçš„getter store.getters = &#123;&#125; // è·å–registerGetteræ–¹æ³•æ³¨å†Œçš„getter const wrappedGetters = store._wrappedGetters const computed = &#123;&#125; forEachValue(wrappedGetters, (fn, key) =&gt; &#123; // use computed to leverage its lazy-caching mechanism // å› ä¸ºgetterçš„valueéƒ½æ˜¯å‡½æ•°ï¼Œç›¸å½“äºvueçš„computedï¼Œè¿™é‡Œç›´æ¥æ‰§è¡Œè·å–ç»“æœ computed[key] = () =&gt; fn(store) // é€šè¿‡Object.definePropertyä¸ºç»™ä¸ªgetterè®¾ç½®getæ–¹æ³•ï¼Œæ”¹å˜getterè·å–å€¼æ–¹å¼ï¼Œå¦‚this.$store.getter.aä¼šç›´æ¥è·å–store._vm.a Object.defineProperty(store.getters, key, &#123; get: () =&gt; store._vm[key], enumerable: true // for local getters &#125;) &#125;) // use a Vue instance to store the state tree // suppress warnings just in case the user has added // some funky global mixins // å…ˆè·å–å½“å‰è­¦å‘Šçš„é…ç½® const silent = Vue.config.silent // å°†ä»–ç½®ä¸ºtrueï¼Œæ„æ€æ˜¯new Vueçš„æ—¶å€™ä¸ä¼šæŠ›å‡ºè­¦å‘Š Vue.config.silent = true // è¿™é‡Œæ˜¯å…³é”®ï¼Œå€ŸåŠ©Vueçš„å“åº”å¼æ¥å®ç°ï¼Œè¿™æ ·stateå’Œgetterçš„ä¿®æ”¹éƒ½ä¼šæœ‰å“åº”å¼ store._vm = new Vue(&#123; data: &#123; $$state: state &#125;, computed &#125;) // newå®Œä¹‹åæ¢å¤ä¹‹å‰çš„é…ç½® Vue.config.silent = silent // enable strict mode for new vm // ä¿è¯ä¿®æ”¹å€¼ä¸€å®šæ˜¯é€šè¿‡mutationçš„ if (store.strict) &#123; enableStrictMode(store) &#125; // æ³¨é”€æ—§çš„stateçš„å¼•ç”¨ï¼Œé”€æ¯æ—§çš„Vueå¯¹è±¡ if (oldVm) &#123; if (hot) &#123; // dispatch changes in all subscribed watchers // to force getter re-evaluation for hot reloading. store._withCommit(() =&gt; &#123; oldVm._data.$$state = null &#125;) &#125; Vue.nextTick(() =&gt; oldVm.$destroy()) &#125;&#125; ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œvuexå®ç°å“åº”å¼ï¼Œå€ŸåŠ©çš„æ˜¯Vueçš„å“åº”å¼ï¼Œé€šè¿‡æŠŠstore.stateèµ‹å€¼ç»™store._vm.$$stateï¼Œè¿™æ ·ä¿®æ”¹stateï¼ŒåŒæ ·store._vm.$$stateä¹Ÿä¼šè¢«ä¿®æ”¹getteré€šè¿‡Object.definePropertyå®šä¹‰çš„getæ–¹æ³•ï¼Œè®¿é—®çš„æ˜¯store._vm.computedï¼Œè®©getteræˆä¸ºvueçš„è®¡ç®—å®ç°ï¼Œå› æ­¤getteræ—¢æ‹¥æœ‰ç›‘å¬store._vm.$$stateæ”¹å˜ï¼ˆå¹¶é‡æ–°è®¡ç®—å‡ºè‡ªèº«çš„æ–°å€¼ï¼‰çš„èƒ½åŠ›ï¼Œåˆæ‹¥æœ‰åœ¨è‡ªèº«å€¼æ”¹å˜ä¹‹åé€šçŸ¥å¤–éƒ¨watcherçš„èƒ½åŠ› å‘½åç©ºé—´çš„å‰¯ä½œç”¨æˆ‘ä»¬ä¹‹å‰æåˆ°actionå’Œmutationå¯¹åº”çš„åç§°çš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œä¸æ˜¯ç›´æ¥çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæ­£å¸¸åº”è¯¥ä¸‹é¢è¿™æ ·ğŸ‘‡12345const actionCollect = &#123; changeValue: (&#123; commit &#125;, payload))=&gt;&#123; ... &#125;&#125; ä½†æ˜¯çœ‹æºç æˆ‘ä»¬çŸ¥é“ï¼Œä»–æ˜¯ä¸€ä¸ªæ•°ç»„12345678910const actionCollect = &#123; changeValue: [ (&#123; commit &#125;, payload)=&gt;&#123; ... &#125; &#125; ,function()&#123;&#125; ... ] &#125; éš¾é“actionè¿˜æœ‰mutaionä¼šæœ‰åŒåçš„å—ï¼Ÿç­”æ¡ˆè‚¯å®šæ˜¯çš„ï¼Œè¿™å°±è¦è®²åˆ°å‘½åç©ºé—´äº†namespace 123456789101112131415161718192021222324252627282930313233343536373839new Vuex.Store(&#123; state: &#123; a: 1 &#125;, modules: &#123; test1: &#123; namespaced: true, state: &#123; a: '2' &#125;, mutations: &#123; changeValue: (state, payload) =&gt; &#123; console.log('1') state.a = payload &#125; &#125; &#125;, test2: &#123; namespaced: false, state: &#123; a: '2' &#125;, modules: &#123; test1: &#123; namespaced: true, state: &#123; a: 3 &#125;, mutations: &#123; changeValue: (state, payload) =&gt; &#123; console.log('2') state.a = payload &#125; &#125; &#125; &#125; &#125; &#125;&#125;) 1234567export default &#123; name: 'App', mounted () &#123; this.$store.commit('test1/changeValue', 'the same value')&#125;// è¾“å‡ºï¼š1// è¾“å‡ºï¼š2 ä½ ä¼šå‘ç°ä½ commitäº†ä¸€æ¬¡ç¼ºè§¦å‘äº†ä¸¤ä¸ªä¸åŒæ¨¡å—çš„mutationï¼Œè¿™å°±æ˜¯å‘½åç©ºé—´çš„å‰¯ä½œç”¨ï¼Œå…·ä½“å†…éƒ¨æ˜¯å¦‚ä½•å¤„ç†namespaceä¹‹å‰ä¹Ÿè®²åˆ°äº†ï¼Œæºç åœ°å€ 1234567getNamespace (path) &#123; let module = this.root return path.reduce((namespace, key) =&gt; &#123; module = module.getChild(key) return namespace + (module.namespaced ? key + '/' : '') &#125;, '')&#125; é€šè¿‡æ¨¡å—çš„keyæ¥æ‹¼æ¥ï¼Œå¦‚ä¹‹å‰ä»£ç è®¾ç½®çš„namespaceï¼Œnamespaceå°±æ˜¯test1/changeValue æ‰€ä»¥ä½¿ç”¨namespaceä¸€å®šè¦æ³¨æ„è·¯å¾„åé—®é¢˜ï¼Œè¿˜æ˜¯å°±æ˜¯é¿å…åç§°ç›¸åŒï¼Œé™¤éä½ å°±æƒ³è¿™ä¹ˆå¹² æ€»ç»“vuexæºç å°±å…ˆè®²è¿™ä¹ˆå¤šï¼Œå…¶å®è¿˜æœ‰å¥½å‡ ä¸ªç‚¹æ²¡è®²ï¼Œä¾‹å¦‚å„ç§å·¥å…·æ–¹æ³•å’Œvue-devtoolsçš„å®ç°ï¼Œæ€»ä½“å¤šè¯»å‡ éè¿˜æ˜¯å¯ä»¥çœ‹æ˜ç™½çš„ï¼Œè¿™å°±æ˜¯debuggerçš„è¿‡ç¨‹äº† åŸæ–‡åœ°å€ http://www.wclimb.site/2019/10/14/Vueä¹‹vuexæºç åˆ†æ/]]></content>
      <categories>
        <category>javascript</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>vue</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webpackç³»åˆ—ä¹‹ç¼–å†™ä¸€ä¸ªloader]]></title>
    <url>%2F2019%2F07%2F05%2Fwebpack%E7%B3%BB%E5%88%97%E4%B9%8B%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAloader%2F</url>
    <content type="text"><![CDATA[å†™åœ¨å‰é¢webpackçš„loaderçš„åº”ç”¨æ˜¯éå¸¸å¹¿æ³›çš„ï¼Œå®Œå…¨ç¦»ä¸å¼€å®ƒï¼Œæˆ‘ä»¬å¼€å‘çš„è¿‡ç¨‹å¾€å¾€éƒ½æ˜¯ä½¿ç”¨åˆ«äººç¼–å†™å¥½çš„loaderæ¥å¤„ç†æ–‡ä»¶ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥ç¼–å†™ä¸€ä¸ªloaderã€‚ åŸºç¡€é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹loaderæ˜¯æ€ä¹ˆä½¿ç”¨åœ¨webpackä¸Šçš„ 1234567891011module.exports = &#123; entry: '...', module: &#123; rules: [ &#123; test: /\.css$/, use: 'css-loader', &#125;, ], &#125;,&#125; ä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œå¦‚æœä½ éœ€è¦å¤„ç†cssæ–‡ä»¶ï¼Œé‚£ä¹ˆå®‰è£…å¥½css-loaderåŒ…ï¼Œç„¶åæ­£åˆ™åŒ¹é…åˆ°æ‰€æœ‰.cssçš„æ–‡ä»¶ï¼Œä½¿ç”¨css-loaderè¿›è¡Œæ–‡ä»¶å¾—å¤„ç† ç¼–å†™ç¼–å†™ä¹‹å‰æˆ‘ä»¬å…ˆç»™å®šä¸ªéœ€æ±‚å§ï¼Œè®¾æƒ³æˆ‘ä»¬èƒ½ä¸èƒ½åƒvueé‚£æ ·ç¼–å†™ï¼Œå¤„ç†style/script/templateï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å…ˆåªå¤„ç†styleçš„å†…å®¹ï¼ŒæŠŠä»–æå–å¤„ç†ã€‚ å®‰è£…12&gt; npm init -y&gt; cnpm i webpack webpack-cli webpack-dev-server clean-webpack-plugin html-webpack-plugin -D é…ç½®å…ˆæ¥ç¼–å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶ æ–°å»ºæ–‡ä»¶ webpack.config.js12345678910111213141516171819202122const path = require('path');const HtmlWebpackPlugin = require('html-webpack-plugin');const &#123; CleanWebpackPlugin &#125; = require('clean-webpack-plugin');module.exports = &#123; entry: './src/main.js', output: &#123; path: path.resolve(__dirname, './dist'), filename: 'bundle.js', &#125;, plugins: [ new CleanWebpackPlugin(), new HtmlWebpackPlugin(&#123; template: 'index.html' &#125;), ], module: &#123; rules: [ &#123; test: /\.css/, use: path.resolve(__dirname, 'loader/loader.js'), &#125;, ], &#125;,&#125;; é¡¹ç›®ä¸‹æ–°å»ºsrcæ–‡ä»¶å¤¹ï¼Œsrcé¡¹ç›®æ–°å»ºmain.jsã€a.testæ–‡ä»¶ main.js12import './a.test';console.log('loader test'); a.test12345&lt;style&gt;body&#123; background: #ccc&#125;&lt;/style&gt; æˆ‘ä»¬é‡ç‚¹æ˜¯a.testæ–‡ä»¶ï¼Œç­‰ä¼šæˆ‘ä¼šç”¨loaderå¤„ç†ä»–ï¼Œè®©ä»–æ˜¾ç¤ºåˆ°é¡µé¢ä¸­ â€”â€”â€”â€“åˆ†å‰²çº¿â€”â€”â€”â€“ ç°åœ¨æˆ‘ä»¬åœ¨é¡¹ç›®ä¸‹æ–°å»ºloaderæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸‹é¢æ–°å»ºloader.jsï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ç¼–å†™çš„loader loader/loader.js123456789101112module.exports = function(sSource) &#123; let sStyleString = sSource .match(/&lt;style&gt;([\s\S]*)&lt;\/style&gt;/)[1] .replace(/\n/g, ''); return ` let head = document.querySelector('head'); let style = document.createElement('style'); style.type = 'text/css'; let cssNode = document.createTextNode('$&#123;sStyleString&#125;'); style.appendChild(cssNode); head.appendChild(style);`;&#125;; æ²¡é”™ï¼Œå°±è¿™ä¹ˆå¤šï¼Œloaderæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯sSourceï¼Œå†…å®¹å°±æ˜¯.teståç¼€ä¸‹çš„æ–‡ä»¶å†…å®¹ï¼Œæˆ‘ä»¬åªéœ€è¦è·å–å†…å®¹ï¼Œç„¶ååšæˆ‘ä»¬æƒ³åšçš„ä¸€åˆ‡äº‹æƒ…ï¼Œæ¯”å¦‚ï¼Œæˆ‘æå–äº†æ–‡ä»¶é‡Œcssçš„éƒ¨åˆ†ï¼Œåƒ.vueé‚£æ ·ï¼Œç„¶åå»å†™ä¸€æ®µjsï¼ŒæŠŠè¿™æ®µcssé€šè¿‡&lt;style&gt;&lt;/style&gt;çš„æ–¹å¼æ”¾åˆ°é¡µé¢ä¸Šå» ç°åœ¨ä½ è¿è¡Œä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ï¼Œç„¶åæŸ¥çœ‹æµè§ˆå™¨ï¼Œæµè§ˆå™¨çš„èƒŒæ™¯æ˜¯å¦å˜äº†é¢œè‰²ï¼Ÿ apiloaderçš„ä¸Šä¸‹æ–‡é€šè¿‡thisè®¿é—®ï¼Œä¸¾å‡ ä¸ªä¾‹å­ this.query å¦‚æœè¿™ä¸ª loader é…ç½®äº† options å¯¹è±¡çš„è¯ï¼Œthis.query å°±æŒ‡å‘è¿™ä¸ª option å¯¹è±¡ å¦‚æœ loader ä¸­æ²¡æœ‰ optionsï¼Œè€Œæ˜¯ä»¥ query å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°è°ƒç”¨æ—¶ï¼Œthis.query å°±æ˜¯ä¸€ä¸ªä»¥ ? å¼€å¤´çš„å­—ç¬¦ä¸² this.contextæ¨¡å—æ‰€åœ¨çš„ç›®å½• this.emitFile1emitFile(name: string, content: Buffer|string, sourceMap: &#123;...&#125;) å¯ä»¥é€šè¿‡ç”¨å®ƒæ¥ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ æ€»ç»“å†™ä¸€ä¸ªloaderå¾ˆç®€å•ï¼Œåªéœ€è¦ä½ æœ‰å¯¹æ–‡ä»¶å†…å®¹å¤„ç†çš„èƒ½åŠ›ï¼Œè¿˜æ˜¯å¾ˆå®¹æ˜“ä¸Šæ‰‹çš„ï¼Œå…³é”®ä¸åœ¨loaderï¼Œè€Œåœ¨äºä½ çš„éœ€æ±‚å¤æ‚ç¨‹åº¦ æœ¬æ–‡åœ°å€ webpackç³»åˆ—ä¹‹ç¼–å†™ä¸€ä¸ªloader]]></content>
      <categories>
        <category>javascript</category>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webpackç³»åˆ—ä¹‹ç¼–å†™ä¸€ä¸ªplugin]]></title>
    <url>%2F2019%2F06%2F21%2Fwebpack%E7%B3%BB%E5%88%97%E4%B9%8B%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAplugin%2F</url>
    <content type="text"><![CDATA[å†™åœ¨å‰é¢ä½¿ç”¨webpackæˆ–è€…è‡ªå·±é…ç½®ç ”ç©¶è¿‡webpackçš„äººéƒ½çŸ¥é“pluginï¼Œä¹Ÿå°±æ˜¯webpackçš„æ’ä»¶ï¼Œå¯¹äºå¤§å¤šæ•°äººæ¥è¯´ï¼Œç»å¸¸ä½¿ç”¨çš„æ’ä»¶è¯¸å¦‚ï¼šclean-webpack-pluginã€html-webpack-pluginç­‰ç­‰ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªä¼šå»ç”¨å®ƒï¼ŒçŸ¥é“ä»–æ˜¯å¹²ä»€ä¹ˆçš„ï¼Œä½†æ˜¯å…¶å†…éƒ¨åšçš„æ“ä½œç¼ºçŸ¥ä¹‹ç”šå°‘ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥å†™ä¸€ä¸ªplugin åŸºç¡€é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹æ’ä»¶æ˜¯æ€ä¹ˆä½¿ç”¨åœ¨webpackä¸Šçš„ 123456789101112const &#123; CleanWebpackPlugin &#125; = require('clean-webpack-plugin');const HtmlWebpackPlugin = require('html-webpack-plugin');module.exports = &#123; entry: '...', plugins: [ new CleanWebpackPlugin(), new HtmlWebpackPlugin(&#123; filename: 'index.html', template: './index.html', &#125;), ] &#125; æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„æ’ä»¶æ˜¯é•¿è¿™æ ·çš„ï¼Œæ¯ä¸ªæ’ä»¶éƒ½æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œé€šè¿‡newä¸€ä¸ªå®ƒçš„å®ä¾‹æ¥ä½¿ç”¨ã€‚çŸ¥é“äº†æ’ä»¶æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºä¸‹é¢çš„ç»“æ„123class TestPlguin&#123; ...&#125; webpack æ’ä»¶ç”±ä»¥ä¸‹ç»„æˆï¼š ä¸€ä¸ª JavaScript å‘½åå‡½æ•°ã€‚ åœ¨æ’ä»¶å‡½æ•°çš„ prototype ä¸Šå®šä¹‰ä¸€ä¸ª apply æ–¹æ³•ã€‚ æŒ‡å®šä¸€ä¸ªç»‘å®šåˆ° webpack è‡ªèº«çš„äº‹ä»¶é’©å­ã€‚ å¤„ç† webpack å†…éƒ¨å®ä¾‹çš„ç‰¹å®šæ•°æ®ã€‚ åŠŸèƒ½å®Œæˆåè°ƒç”¨ webpack æä¾›çš„å›è°ƒã€‚ 12345678910111213class TestPlguin &#123; constructor()&#123; &#125; apply(compiler)&#123; compiler.plugin('webpacksEventHook', function(compilation /* å¤„ç† webpack å†…éƒ¨å®ä¾‹çš„ç‰¹å®šæ•°æ®ã€‚*/, callback) &#123; console.log("This is an example plugin!!!"); // åŠŸèƒ½å®Œæˆåè°ƒç”¨ webpack æä¾›çš„å›è°ƒã€‚ callback(); &#125;); &#125;&#125; ä¸Šé¢æ˜¯å®˜ç½‘ä¸Šçš„ç¤ºä¾‹ï¼Œæ’ä»¶ä¸€å®šä¼šæœ‰applyæ–¹æ³•ï¼Œä¼ é€’ä¸€ä¸ªcompilerå‚æ•°ï¼Œé€šè¿‡ CLI æˆ– Node API ä¼ é€’çš„æ‰€æœ‰é€‰é¡¹ï¼Œåˆ›å»ºå‡ºä¸€ä¸ª compilation å®ä¾‹ã€‚ åœ¨æ’ä»¶å¼€å‘ä¸­æœ€é‡è¦çš„ä¸¤ä¸ªèµ„æºå°±æ˜¯ compiler å’Œ compilation å¯¹è±¡ã€‚ç†è§£å®ƒä»¬çš„è§’è‰²æ˜¯æ‰©å±• webpack å¼•æ“é‡è¦çš„ç¬¬ä¸€æ­¥ã€‚ compiler å¯¹è±¡ä»£è¡¨äº†å®Œæ•´çš„ webpack ç¯å¢ƒé…ç½®ã€‚è¿™ä¸ªå¯¹è±¡åœ¨å¯åŠ¨ webpack æ—¶è¢«ä¸€æ¬¡æ€§å»ºç«‹ï¼Œå¹¶é…ç½®å¥½æ‰€æœ‰å¯æ“ä½œçš„è®¾ç½®ï¼ŒåŒ…æ‹¬ optionsï¼Œloader å’Œ pluginã€‚å½“åœ¨ webpack ç¯å¢ƒä¸­åº”ç”¨ä¸€ä¸ªæ’ä»¶æ—¶ï¼Œæ’ä»¶å°†æ”¶åˆ°æ­¤ compiler å¯¹è±¡çš„å¼•ç”¨ã€‚å¯ä»¥ä½¿ç”¨å®ƒæ¥è®¿é—® webpack çš„ä¸»ç¯å¢ƒã€‚ compilation å¯¹è±¡ä»£è¡¨äº†ä¸€æ¬¡èµ„æºç‰ˆæœ¬æ„å»ºã€‚å½“è¿è¡Œ webpack å¼€å‘ç¯å¢ƒä¸­é—´ä»¶æ—¶ï¼Œæ¯å½“æ£€æµ‹åˆ°ä¸€ä¸ªæ–‡ä»¶å˜åŒ–ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ compilationï¼Œä»è€Œç”Ÿæˆä¸€ç»„æ–°çš„ç¼–è¯‘èµ„æºã€‚ä¸€ä¸ª compilation å¯¹è±¡è¡¨ç°äº†å½“å‰çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºã€å˜åŒ–çš„æ–‡ä»¶ã€ä»¥åŠè¢«è·Ÿè¸ªä¾èµ–çš„çŠ¶æ€ä¿¡æ¯ã€‚compilation å¯¹è±¡ä¹Ÿæä¾›äº†å¾ˆå¤šå…³é”®æ—¶æœºçš„å›è°ƒï¼Œä»¥ä¾›æ’ä»¶åšè‡ªå®šä¹‰å¤„ç†æ—¶é€‰æ‹©ä½¿ç”¨ã€‚ Compiler å’Œ Compilation çš„åŒºåˆ«åœ¨äºï¼šCompiler ä»£è¡¨äº†æ•´ä¸ª Webpack ä»å¯åŠ¨åˆ°å…³é—­çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œ Compilation åªæ˜¯ä»£è¡¨äº†ä¸€æ¬¡æ–°çš„ç¼–è¯‘ é’©å­Compilerå’ŒCompilationéƒ½æœ‰ç”Ÿå‘½å‘¨æœŸ Compilerä¸¾å‡ ä¸ªä¾‹å­ entryOptionï¼šåœ¨ entry é…ç½®é¡¹å¤„ç†è¿‡ä¹‹åï¼Œæ‰§è¡Œæ’ä»¶ emitï¼šç”Ÿæˆèµ„æºåˆ° output ç›®å½•ä¹‹å‰ã€‚ failedï¼šç¼–è¯‘(compilation)å¤±è´¥ 12345678class TestPlguin &#123; ... apply(compiler)&#123; compiler.hooks.emit.tap('MyPlugin', params =&gt; &#123; console.log('æˆ‘ä¼šåœ¨ç”Ÿæˆèµ„æºåˆ° output ç›®å½•ä¹‹å‰æ‰§è¡Œ') &#125;) &#125;&#125; ä¸Šé¢çš„ä¾‹å­æ„æ€æ˜¯ï¼Œå½“webpackæ‰§è¡Œåˆ°æœ€ç»ˆè¦è¾“å‡ºæ–‡ä»¶å¾—æ—¶å€™ï¼Œæˆ‘åœ¨è¿™ä¸ªæ“ä½œä¹‹å‰å»æ‰“å°ä¸€æ®µè¯ï¼Œé€šå¸¸æ˜¯æˆ‘ä»¬è¾“å‡ºæ–‡ä»¶åˆ°distæ–‡ä»¶å¤¹ä¹‹å‰é‚£ä¸€æ­¥å¦‚æœä½ å®ç°å†™å¥½äº†è¿™äº›é’©å­ï¼Œé‚£ä¹ˆwebpackåœ¨ç¼–è¯‘çš„æµç¨‹é‡Œéƒ½ä¼šæ‰§è¡Œä¸Šé¢å‡ ä¸ªé’©å­ã€‚æƒ³äº†è§£æ›´å¤šè®¿é—® https://www.webpackjs.com/api/compiler-hooks/ CompilationCompilation æ¨¡å—ä¼šè¢« Compiler ç”¨æ¥åˆ›å»ºæ–°çš„ç¼–è¯‘ï¼ˆæˆ–æ–°çš„æ„å»ºï¼‰ã€‚compilationå®ä¾‹èƒ½å¤Ÿè®¿é—®æ‰€æœ‰çš„æ¨¡å—å’Œå®ƒä»¬çš„ä¾èµ–ï¼ˆå¤§éƒ¨åˆ†æ˜¯å¾ªç¯ä¾èµ–ï¼‰ã€‚å®ƒä¼šå¯¹åº”ç”¨ç¨‹åºçš„ä¾èµ–å›¾ä¸­æ‰€æœ‰æ¨¡å—è¿›è¡Œå­—é¢ä¸Šçš„ç¼–è¯‘(literal compilation)ã€‚åœ¨ç¼–è¯‘é˜¶æ®µï¼Œæ¨¡å—ä¼šè¢«åŠ è½½(loaded)ã€å°å­˜(sealed)ã€ä¼˜åŒ–(optimized)ã€åˆ†å—(chunked)ã€å“ˆå¸Œ(hashed)å’Œé‡æ–°åˆ›å»º(restored) ç®€å•çš„ç†è§£å°±æ˜¯ï¼Œå½“ç¼–è¯‘æœŸé—´æ–‡ä»¶å‘ç”Ÿå„ç§å˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Compilation é’©å­é‡Œçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å»æ‹¦æˆªï¼Œç„¶ååšä½ æƒ³åšçš„äº‹æƒ… ä¸¾å‡ ä¸ªä¾‹å­ buildModuleï¼šåœ¨æ¨¡å—æ„å»ºå¼€å§‹ä¹‹å‰è§¦å‘ã€‚ optimizeï¼šä¼˜åŒ–é˜¶æ®µå¼€å§‹æ—¶è§¦å‘ã€‚ beforeChunkAssetsï¼šåœ¨åˆ›å»º chunk èµ„æº(asset)ä¹‹å‰ additionalAssetsï¼šä¸ºç¼–è¯‘(compilation)åˆ›å»ºé™„åŠ èµ„æº(asset) 123456789101112class TestPlguin &#123; ... apply(compiler)&#123; compiler.hooks.emit.tap('MyPlugin', compilation =&gt; &#123; console.log('æˆ‘ä¼šåœ¨ç”Ÿæˆèµ„æºåˆ° output ç›®å½•ä¹‹å‰æ‰§è¡Œ') // ä»¥ä¸‹å¼€å§‹è°ƒç”¨compilationé’©å­ï¼Œå½“æ¨¡å—å¤„åœ¨ä¼˜åŒ–é˜¶æ®µå¼€å§‹æ—¶ä¼šæ‰§è¡Œä»¥ä¸‹å›è°ƒ compilation.plugin("optimize", function() &#123; console.log("æˆ‘åœ¨ä¼˜åŒ–é˜¶æ®µå¼€å§‹æ—¶è§¦å‘äº†"); &#125;); &#125;) &#125;&#125; æƒ³äº†è§£æ›´å¤šè®¿é—® https://www.webpackjs.com/api/compilation-hooks/ ç¼–å†™æ’ä»¶æˆ‘ä»¬ç°åœ¨å‡å®šæœ‰ä¸€ä¸ªè¿™ä¹ˆä¸ªéœ€æ±‚ï¼šæˆ‘éœ€è¦åœ¨æ‰“åŒ…çš„æ—¶å€™æŠŠä¸€ä¸ªå¤–éƒ¨çš„jsæ–‡ä»¶å¯¼å…¥åˆ°é¡¹ç›®ä¸­ï¼Œå¹¶ä¸”åœ¨index.htmlå¼•å…¥ï¼Œä½ å¯èƒ½ä¼šé—®äº†ï¼Œé‚£ä½ ç›´æ¥åœ¨ä¸»å…¥å£å¼•å…¥ä¸å°±è¡Œäº†å—ï¼Ÿç¡®å®ï¼Œæ„Ÿè§‰åšè¿™ä»¶äº‹æƒ…å¾ˆæ²¡æœ‰æ„ä¹‰ï¼Œä½†æ˜¯æˆ‘å°±è¦è¿™ä¸ªéœ€æ±‚ï¼ŒåŸå› åœ¨äºæˆ‘åœ¨ä½¿ç”¨DllPluginçš„æ—¶å€™ï¼Œæå‰ç”Ÿæˆå¥½äº†ä¸€å †æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶æ˜¯ä¸ä¼šåœ¨æ­£å¸¸æ‰“åŒ…çš„è¿‡ç¨‹å¼•å…¥çš„ï¼Œæ‰€ä»¥æˆ‘éœ€è¦åœ¨æœ€åæ‰“åŒ…ç”Ÿæˆæ–‡ä»¶ä¹‹å‰æŠŠä»–ä»¬å¯¼å…¥åˆ°distæ–‡ä»¶å¤¹ä¸‹ï¼Œå¹¶ä¸”å¼•å…¥ä»–ä»¬ã€‚ é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å¼€å§‹ç¼–å†™ï¼Œå…ˆå†™ä¸ªç®€å•çš„ï¼Œä¸€ä¸ªæ–‡ä»¶çš„å¯¼å…¥ï¼ŒæŠ›ç –å¼•ç‰ã€‚ é¦–å…ˆæˆ‘ä»¬æ€è€ƒä¸€ä¸‹ğŸ¤”ï¼Œè¿™ä¸ªæ’ä»¶å¾—æœ‰é…ç½®å‘€ï¼Œå’Œhtml-webpack-pluginä¸€æ ·å¯ä»¥ä¼ å‚æ•° 12345678module.exports = &#123; plugin: [ new TestPlugin(&#123; filename: 'test.js', template: path.resolve(__dirname, './otherFile/test.js'), &#125;), ]&#125; æˆ‘ä»¬åœ¨é¡¹ç›®é‡Œæ–°å»ºæ–‡ä»¶å¤¹pluginï¼Œæ–‡ä»¶å¤¹ä¸‹æ–°å»ºTestPlugin.jsã€‚ç„¶ååœ¨é¡¹ç›®é‡Œå†æ–°å»ºæ–‡ä»¶å¤¹otherFileï¼Œæ–‡ä»¶å¤¹ä¸‹æ–°å»ºtest.jsï¼Œè¿™é‡Œæ–‡ä»¶å†…å®¹éšä¾¿ ä¸Šé¢æˆ‘ä»¬è¯´äº†éœ€è¦ä¼ é€’å‚æ•°ï¼Œæ‰€ä»¥æœ‰äº†ä¸‹é¢è¿™æ®µjsï¼Œoptionsæ˜¯æˆ‘ä»¬ä¼ é€’çš„å¯¹è±¡ï¼Œapplyå°±ä¸å¤šè¯´äº†ï¼Œæ¯ä¸ªæ’ä»¶éƒ½æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œç„¶åæˆ‘ä»¬æŠŠè¿™ä¸ªæ’ä»¶æš´éœ²å‡ºæ¥TestPlugin.js123456789class TestPlugin &#123; constructor(options = &#123;&#125;) &#123; this.options = options; &#125; apply(compiler) &#123; &#125;&#125;module.exports = TestPlugin; æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å†™å†…éƒ¨æ–¹æ³• æˆ‘ä»¬åˆè¦æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘éœ€è¦åœ¨æ‰“åŒ…å®Œæˆä¹‹å‰åšè¿™ä¸ªæ“ä½œï¼Œé‚£ä¹ˆcompileré’©å­çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ˜¯å“ªä¸ªå‘¢ï¼Ÿæ²¡é”™ï¼Œæ˜¯emitï¼Œä¹‹å‰è®²è¿‡ï¼Œäºæ˜¯ä¹æœ‰äº†ä¸‹é¢è¿™æ®µjsTestPlugin.js1234567891011class TestPlugin &#123; constructor(options = &#123;&#125;) &#123; this.options = options; &#125; apply(compiler) &#123; compiler.hooks.emit.tapAsync('TestPlugin', (compilation, callback) =&gt; &#123; callback(); &#125;); &#125;&#125;module.exports = TestPlugin; ä¸Šé¢ä»£ç ï¼Œæˆ‘ä»¬æ³¨å†Œäº†ä¸€ä¸ªemitï¼Œwebpackåœ¨æ‰§è¡Œæ‰“åŒ…çš„æœ€åï¼Œä¼šè§¦å‘è¿™ä¸ªå†…éƒ¨å¾—æ–¹æ³• æ¥ä¸‹æ¥å°±æ˜¯å¯¹æ–‡ä»¶å¾—å¤„ç†äº†ï¼Œéœ€è¦ç”¨åˆ°compilation æˆ‘ä»¬æ€è€ƒä¸€ä¸‹ï¼Œæ€ä¹ˆå¤„ç†æ–‡ä»¶ï¼Ÿæˆ‘ä»¬éœ€è¦ç”¨åˆ°compilationä¸‹çš„assetï¼Œæ¥å¤„ç†èµ„æºæ–‡ä»¶ã€‚æˆ‘ä»¬å…ˆæŠŠæ–‡ä»¶å¯¼å…¥åˆ°distæ–‡ä»¶å¤¹ä¸‹ï¼Œäºæ˜¯ä¹æœ‰äº†ä¸‹é¢è¿™æ®µjsTestPlugin.js1234567891011121314151617181920212223const fs = require('fs');class TestPlugin &#123; constructor(options = &#123;&#125;) &#123; this.options = options; &#125; apply(compiler) &#123; compiler.hooks.emit.tapAsync('TestPlugin', (compilation, callback) =&gt; &#123; let template = fs.readFileSync(this.options.template, 'UTF-8'); compilation.assets[this.options.filename || 'test.js'] = &#123; source: function() &#123; return template; &#125;, size: function() &#123; return template.length; &#125;, &#125;; callback(); &#125;); &#125;&#125;module.exports = TestPlugin; ä¸Šé¢ä»£ç ï¼Œæˆ‘ä»¬è¯»å–äº†æ’ä»¶å®ä¾‹ä¼ é€’è¿‡æ¥çš„å‚æ•°filenameï¼Œè°ƒç”¨compilationé’©å­ä¸‹çš„assetsï¼Œè¿™ä¸ªassetsæ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„å½¢å¼ï¼Œkeyæ˜¯èµ„æºæ–‡ä»¶å¾—åç§°ï¼Œvalueæ˜¯èµ„æºæ–‡ä»¶çš„å†…å®¹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚æ‰§è¡Œcompilation.assetsï¼Œå¦‚æœé”®å€¼æ˜¯ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶ï¼Œwebpackä¸ä¼šå¸®ä½ é‡æ–°åˆ›å»ºï¼Œä½ å¯ä»¥å»å°è¯•ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶ å¥½äº†ï¼Œæ–‡ä»¶å¯¼å…¥äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦åœ¨index.htmlå»å¼•å…¥è¿™ä¸ªæ–‡ä»¶ï¼Œæ€è€ƒä¸€ä¸‹ï¼Œè¿™ä¸ªindex.htmlæ˜¯å·²ç»å­˜åœ¨çš„ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥ä½¿ç”¨compilation.assetså»ä¿®æ”¹å®ƒçš„æ–‡ä»¶å†…å®¹ï¼Œæ‰€ä»¥æœ‰äº†ä¸‹é¢è¿™æ®µjs TestPlugin.js123456789101112131415161718192021222324252627282930313233343536373839const fs = require('fs');class TestPlugin &#123; constructor(options = &#123;&#125;) &#123; this.options = options; &#125; apply(compiler) &#123; compiler.hooks.emit.tapAsync('TestPlugin', (compilation, callback) =&gt; &#123; let template = fs.readFileSync(this.options.template, 'UTF-8'); compilation.assets[this.options.filename || 'test.js'] = &#123; source: function() &#123; return template; &#125;, size: function() &#123; return template.length; &#125;, &#125;; // è¿™é‡Œæ˜¯æ–°åŠ çš„ let source = compilation.assets['index.html'].source(); source = source.replace( /&lt;\/(.*?)&gt;(.*?)&lt;\/body&gt;$/m, `&lt;/$1&gt;&lt;script src="$&#123;this.options.filename || 'test.js'&#125;"&gt;&lt;/script&gt;&lt;/body&gt;`, ); compilation.assets['index.html'] = &#123; source: function() &#123; return source; &#125;, size: function() &#123; return source.length; &#125;, &#125;; callback(); &#125;); &#125;&#125;module.exports = TestPlugin; æˆ‘ä»¬é€šè¿‡ä¿®æ”¹æ–‡ä»¶çš„sourceï¼ŒæŠŠä¸€æ®µscriptæ’å…¥åˆ°bodyä¹‹å‰æ¥ä¿®æ”¹æ–‡ä»¶ æ’ä»¶å†™å¥½äº†ï¼Œæˆ‘ä»¬åœ¨webpackå»å¼•å…¥å§ 12345678910111213141516171819202122const path = require('path');const HtmlWebpackPlugin = require('html-webpack-plugin');const &#123; CleanWebpackPlugin &#125; = require('clean-webpack-plugin');const TestPlugin = require('./plugin/TestPlugin');module.exports = &#123; mode: 'production', entry: &#123; app: './src/index.js', &#125;, output: &#123; filename: '[name].[hash].js', path: path.resolve(__dirname, 'dist/'), &#125;, plugins: [ new CleanWebpackPlugin(), new HtmlWebpackPlugin(&#123; template: 'index.html' &#125;), new TestPlugin(&#123; filename: 'test.js', template: path.resolve(__dirname, './otherFile/test.js'), &#125;), ],&#125;; æ‰“åŒ…è¿è¡Œä¸€ä¸‹ï¼Œçœ‹çœ‹æ•ˆæœå§ æ’ä»¶ä»£ç ä»“åº“ï¼šhttps://github.com/wclimb/webpack-plugin æ€»ç»“ä»Šå¤©æˆ‘ä»¬å­¦ä¹ äº†ä¸€å¦‚ä½•ç¼–å†™ä¸€ä¸ªæ’ä»¶ï¼Œå½“ç„¶åªæ˜¯ç®€å•çš„æ“ä½œäº†ï¼Œå¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œè¦å®ç°clean-webpack-pluginæˆ–è€…html-webpack-pluginæ’ä»¶ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåšï¼Ÿ æœ¬æ–‡åœ°å€ webpackç³»åˆ—ä¹‹ç¼–å†™ä¸€ä¸ªplugin]]></content>
      <categories>
        <category>javascript</category>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webpackç³»åˆ—ä¹‹è¾“å‡ºæ–‡ä»¶åˆ†æ]]></title>
    <url>%2F2019%2F06%2F19%2Fwebpack%E7%B3%BB%E5%88%97%E4%B9%8B%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[å†™åœ¨å‰é¢ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬è®²äº†å¦‚ä½•ä½¿ç”¨ webpackï¼Œæ‰§è¡Œæ‰“åŒ…ä¼šåœ¨ dist ç”Ÿæˆä¸€å †æ–‡ä»¶ï¼Œé‚£ä¹ˆ webpack è¾“å‡ºçš„æ–‡ä»¶é‡Œé¢åˆ°åº•é•¿å•¥æ ·å‘¢ï¼Ÿç”¨è¿‡çš„äºº100%çœ‹è¿‡ï¼Œå¤§éƒ¨åˆ†çš„è¿˜æ˜¯å‹ç¼©æ··æ·†åçš„ä»£ç ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šå»å…³å¿ƒå®ƒï¼Œåªç®¡å½“å‰æŒç»­è¿è¡Œæ­£å¸¸å°±è¡Œäº†ã€‚ä»Šå¤©æˆ‘ä»¬æ¥çœ‹çœ‹ webpack è¾“å‡ºçš„æ–‡ä»¶ é…ç½®å®‰è£…å¼€å‘ç¯å¢ƒ webpack: 4.34.0 12&gt; npm init -y&gt; cnpm i webpack webpack-cli -D æ–°å»ºæ–‡ä»¶æ–°å»ºæ–‡ä»¶ webpack.config.jsæ–°å»ºæ–‡ä»¶å¤¹ srcwebpack.config.js12345678910const path = require('path');module.exports = &#123; devtool: 'inline-source-map', mode: 'development', entry: './src/main.js', output: &#123; path: path.resolve(__dirname, './dist'), filename: 'bundle.js', &#125;,&#125;; src æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å¢ä¸‰ä¸ªæ–‡ä»¶ main.jsï¼ˆå…¥å£æ–‡ä»¶ï¼‰ a.js b.jsmain.js1234import &#123; A1, A2 &#125; from './a';import B from './b';console.log(A1, A2);B(); a.js12export const A1 = 'a1';export const A2 = 'a2'; b.js123export default function() &#123; console.log('b');&#125; æ‰“åŒ…1npx webpack --config webpack.config.js ç„¶åå°±ä¼šåœ¨ dist ä¸‹ç”Ÿæˆä¸€ä¸ª bundle.js æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥å¼€å§‹åˆ†ææ–‡ä»¶ æ–‡ä»¶åˆ†æé¦–å…ˆå…ˆæ¥çœ‹çœ‹å¤§è‡´çš„ç»“æœ1234567891011(function(modules) &#123; function __webpack_require__(moduleId) &#123; ... &#125; ... return __webpack_require__(__webpack_require__.s = "./src/main.js");&#125;)(&#123; "./src/a.js": (function(module, __webpack_exports__, __webpack_require__) &#123;&#125; "./src/b.js": (function(module, __webpack_exports__, __webpack_require__) &#123;&#125; "./src/main.js": (function(module, __webpack_exports__, __webpack_require__) &#123;&#125;&#125;) ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç«‹å³æ‰§è¡Œçš„å‡½æ•°ï¼Œä¼ é€’äº†ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ modules çš„å€¼ï¼Œæœ€ç»ˆæ‰§è¡Œäº† __webpack_require__ å‡½æ•°ï¼Œæ‰§è¡Œçš„è¿™ä¸ªæ–¹æ³•å…¶å®æ˜¯æˆ‘ä»¬åœ¨ webpack é‡Œé¢è®¾ç½®çš„ entry: ./src/main.jsï¼Œå¯¹è±¡é‡Œè¿˜æœ‰keyï¼Œ./src/a.js ã€./src/b.jsï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ a.js å’Œ b.js æˆ‘ä»¬çŸ¥é“æœ€å¼€å§‹æ‰§è¡Œäº† __webpack_require__(__webpack_require__.s = &quot;./src/main.js&quot;) æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ __webpack_require__(&quot;./src/main.js&quot;)ï¼Œé‚£ä¹ˆè¿™ä¸ª __webpack_require__ æ–¹æ³•åˆåšäº†ä»€ä¹ˆçš„ åŸå§‹çš„ __webpack_require__ æ–¹æ³•1234567891011121314151617181920// The module cachevar installedModules = &#123;&#125;;function __webpack_require__(moduleId) &#123; // Check if module is in cache if(installedModules[moduleId]) &#123; return installedModules[moduleId].exports; &#125; // Create a new module (and put it into the cache) var module = installedModules[moduleId] = &#123; i: moduleId, l: false, exports: &#123;&#125; &#125;; // Execute the module function modules[moduleId].call(module.exports, module, module.exports, __webpack_require__); // Flag the module as loaded module.l = true; // Return the exports of the module return module.exports;&#125; ç°åœ¨æˆ‘åœ¨è¿™ä¸Šé¢å†™ä¸Šæ³¨é‡Š12345678910111213141516171819202122232425// æ¨¡å—ç¼“å­˜var installedModules = &#123;&#125;;function __webpack_require__(moduleId) &#123; // é¦–å…ˆå…¨å±€æœ‰ä¸€ä¸ªæ¨¡å—å¯¹è±¡ï¼Œæœ€å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ¨¡å—ï¼Œæ˜¯å¦åšè¿‡ç›¸åº”æ“ä½œï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›å½“å‰æ¨¡å—çš„ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™é‡Œçš„exportså…¶å®å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ if(installedModules[moduleId]) &#123; return installedModules[moduleId].exports; &#125; // è¿™é‡Œå°±ç›´æ¥åˆ›å»ºäº†ä¸€ä¸ªæ¨¡å—ï¼Œå¹¶ä¸”ç¼“å­˜åœ¨å…¨å±€çš„æ¨¡å—ä¸­ï¼Œè¿™é‡Œé‡ç‚¹å…³æ³¨è¿™ä¸ªexportsï¼Œ // i æŒ‡çš„æ˜¯æ¨¡å—çš„åç§°ï¼Œæ¯”å¦‚ './src/main.js' // l æ„æ€æ˜¯å½“å‰æ¨¡å—æ˜¯å¦åŠ è½½ // exports å°±æ˜¯è¿”å›å‡ºå»çš„å¯¹è±¡å†…å®¹ var module = installedModules[moduleId] = &#123; i: moduleId, l: false, exports: &#123;&#125; &#125;; // åˆ°è¿™é‡Œå°±å¼€å§‹é€šè¿‡keyå»æ‰§è¡Œ modulesï¼ˆå°±æ˜¯åˆšå¼€å§‹ç«‹å³æ‰§è¡Œå‡½æ•°ä¼ è¿‡æ¥çš„å¯¹è±¡ï¼‰å¯¹è±¡çš„æ–¹æ³• // ç„¶åä½¿ç”¨callæ¥æŒ‡å‘ å¯¹è±¡çš„æ–¹æ³• çš„thisï¼Œå¹¶ä¸”æŠŠ module, module.exports, __webpack_require__ ä¸‰ä¸ªå€¼ä¼ è¿‡å»ï¼Œ // è¿™é‡Œå…ˆåšé¢„å‘Šï¼Œmoduleè¿™ä¸ªå‚æ•°ä¼ è¿‡å»å…¶å®æ˜¯æ²¡æœ‰ç”¨åˆ°çš„ï¼Œä¸»è¦ä½¿ç”¨ module.exports å¯¹è±¡, ä»¥åŠ__webpack_require__æ–¹æ³• modules[moduleId].call(module.exports, module, module.exports, __webpack_require__); // ä¸Šé¢è¯´åˆ°æœ‰ä¸€ä¸ªå‚æ•° lï¼Œåˆ°è¿™é‡Œå½“å‰æ¨¡å—å·²ç»åŠ è½½ module.l = true; // æœ€åæŠŠmodule.exportsè¿™ä¸ªæ¨¡å—è¿”å›å‡ºå» return module.exports;&#125; æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ä¸»å…¥å£ ./src/main.js è¿™ä¸ª key çš„å€¼çš„å†…å®¹ ./src/main.jsï¼ŒåŸå†…å®¹æ˜¯è¿™æ ·çš„ï¼Œæ¥ä¸‹æ¥æ¥è§£é‡Šä¸€ä¸‹123456789101112&#123; "./src/main.js": (function(module, __webpack_exports__, __webpack_require__) &#123; "use strict"; __webpack_require__.r(__webpack_exports__); /* harmony import */ var _a__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./a */ "./src/a.js"); /* harmony import */ var _b__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./b */ "./src/b.js"); console.log(_a__WEBPACK_IMPORTED_MODULE_0__["A1"], _a__WEBPACK_IMPORTED_MODULE_0__["A2"]); Object(_b__WEBPACK_IMPORTED_MODULE_1__["default"])(); &#125;)&#125; 1234567891011121314151617&#123; "./src/main.js": (function(module, __webpack_exports__, __webpack_require__) &#123; // ä¸Šé¢æˆ‘ä»¬è¯´åˆ° __webpack_require__ æ–¹æ³•å†…éƒ¨ä¼šæ‰§è¡Œ modules[moduleId].callï¼Œå¹¶ä¼ é€’äº†ä¸‰ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆä»–æ‰§è¡Œçš„æ–¹æ³•å°±æ˜¯è¿™ä¸ªå†…éƒ¨æ–¹æ³• // è¿™æ®µä»£ç å¯ä»¥å…ˆå¿½ç•¥ï¼Œåœ¨å½“å‰é¡¹ç›®æ²¡æœ‰ä½œç”¨ __webpack_require__.r(__webpack_exports__); // æˆ‘ä»¬çœ‹åˆ°ä¸‹é¢æœ‰ä¸¤æ®µ__webpack_require__å‡½æ•°ä»£ç çš„æ‰§è¡Œï¼Œä½ å¯ä»¥å›é¡¾ä¸€ä¸‹main.jsçš„å†…å®¹ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯åšäº† import &#123; A1, A2 &#125; from './a';å¹¶ä¸” console.log(A1, A2); /* harmony import */ var _a__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./a */ "./src/a.js"); /* harmony import */ var _b__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./b */ "./src/b.js"); console.log(_a__WEBPACK_IMPORTED_MODULE_0__["A1"], _a__WEBPACK_IMPORTED_MODULE_0__["A2"]); // è¿™æ®µä»£ç å…¶å®æ˜¯ import B from './b'; B();ä»£ç çš„æ‰§è¡Œ Object(_b__WEBPACK_IMPORTED_MODULE_1__["default"])(); &#125;)&#125; å¥½äº†ï¼Œç°åœ¨æ¥åˆ†æä¸€ä¸‹ __webpack_require__(&quot;./src/a.js&quot;) åšäº†å“ªäº›æ“ä½œï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ æ¨¡å—./src/a.js çš„å†…å®¹./src/a.js123456789&#123; "./src/a.js": (function(module, __webpack_exports__, __webpack_require__) &#123; __webpack_require__.r(__webpack_exports__); /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "A1", function() &#123; return A1; &#125;); /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "A2", function() &#123; return A2; &#125;); const A1 = 'a1'; const A2 = 'a2'; &#125;),&#125; ä»£ç å†…å®¹å¾ˆç®€å•ï¼Œé¦–å…ˆ __webpack_require__(&quot;./src/a.js&quot;) æ‰§è¡Œä¹‹åï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ¨¡å—ï¼Œç„¶åå»æ‰§è¡Œæ¨¡å— ./src/a.js å†…éƒ¨å¾—æ–¹æ³•ï¼Œä¹Ÿæ˜¯æ˜¯ä¸Šé¢è¿™æ®µï¼Œæ‰§è¡Œå®Œæˆä¹‹åæœ€ç»ˆä¼šæŠŠ module.exports è¿”å›å¤„ç†ï¼Œé‚£ä¹ˆ module.exports è¿™ä¸ªæ˜¯ä»€ä¹ˆå†…å®¹å‘¢ï¼Ÿçœ‹çœ‹ webpack_require å†…éƒ¨12345678var module = installedModules[moduleId] = &#123; i: moduleId, l: false, exports: &#123;&#125; &#125;; // Execute the module function modules[moduleId].call(module.exports, module, module.exports, __webpack_require__); return module.exports å…¶å®å°±æ˜¯æˆ‘ä»¬åˆ›å»ºæ¨¡å—æ—¶çš„ exportsï¼Œç„¶åæ‰§è¡Œåˆ°äº†æ¨¡å— ./src/a.js å†…éƒ¨å¾—æ–¹æ³•ï¼Œå®ƒå†…éƒ¨æ–¹æ³•å…³é”®çš„åœ°æ–¹åœ¨äºåˆè°ƒç”¨äº† __webpack_require__.d æ–¹æ³• __webpack_require__.d12345__webpack_require__.d = function(exports, name, getter) &#123; if(!__webpack_require__.o(exports, name)) &#123; Object.defineProperty(exports, name, &#123; enumerable: true, get: getter &#125;); &#125;&#125;; æ‰§è¡Œ __webpack_require__.d(__webpack_exports__, &quot;A1&quot;, function() { return A1; }); å¯ä»¥çœ‹å‡ºæ¥ä»–ç»™ module.exports å®šä¹‰äº†ä¸€ä¸ª key å€¼ &quot;key&quot;ï¼Œç„¶åå–å€¼ get çš„æ—¶å€™è¿”å›çš„æ˜¯ A1(ä¹Ÿå°±æ˜¯a1) æ‰€ä»¥æœ€ç»ˆ return module.exports çš„å€¼ä¸º {A1: &#39;a1&#39;}ï¼Œ æˆ‘ä»¬å›åˆ° ./src/main.js æ¨¡å—ï¼Œæ‰€ä»¥è¿™æ®µä»£ç ï¼švar _a__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./a */ &quot;./src/a.js&quot;); _a__WEBPACK_IMPORTED_MODULE_0__ å…¶å®å°±æ˜¯ç­‰äº {A1: &#39;a1&#39;} console.log(_a__WEBPACK_IMPORTED_MODULE_0__[&quot;A1&quot;])ï¼Œå–å€¼ä¸º a1ï¼ŒA2 åŒç† æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹æ¨¡å— ./src/b.jsï¼Œåœ¨ä¸»æ¨¡å—å®ƒåšäº†ä»€ä¹ˆå‘¢ï¼Ÿçœ‹çœ‹ ./src/main.js 123...var _b__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./b */ "./src/b.js");Object(_b__WEBPACK_IMPORTED_MODULE_1__["default"])(); çœ‹ä¸Šé¢æ¨¡å— ./src/b.js åœ¨ä¸»æ¨¡å—çš„æ‰§è¡Œç¬¬ä¸€æ®µä»£ç å’Œä¹‹å‰ä»‹ç»çš„ä¸€æ ·ï¼Œç¬¬äºŒæ®µä»£ç ç›´æ¥æ‰§è¡Œäº†ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹å‡º _b__WEBPACK_IMPORTED_MODULE_1__ å…¶å®å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè®¿é—®äº†å®ƒçš„ key: defaultç„¶åå®ƒçš„keyå€¼å…¶å®æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæœ€åæ‰§è¡Œäº†è¿™ä¸ªå‡½æ•° åŒç†æˆ‘ä»¬å¯ä»¥çœ‹çœ‹æ¨¡å— ./src/b.js å†…éƒ¨çš„æ–¹æ³•ï¼Œä»¥åŠæˆ‘ä»¬åœ¨ src æ–‡ä»¶å¤¹ä¸‹çš„ b.js æ˜¯æ€ä¹ˆå†™çš„æ¨¡å— ./src/b.js1234567&#123; "./src/b.js": (function(module, __webpack_exports__, __webpack_require__) &#123; __webpack_require__.r(__webpack_exports__); /* harmony default export */ __webpack_exports__["default"] = (function() &#123; console.log('b'); &#125;);&#125; b.js123export default function() &#123; console.log('b');&#125; ä»æˆ‘ä»¬æºä»£ç çœ‹å‡ºï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥å¯¼å‡ºäº†ä¸€ä¸ªæ–¹æ³•ï¼Œå†…éƒ¨æ‰§è¡Œäº†æ‰“å°å­—ç¬¦ä¸²bï¼Œç„¶åå†æ¥çœ‹çœ‹ webapck çš„æºç éƒ¨åˆ†ï¼Œ__webpack_require__.r(__webpack_exports__); è¿™æ®µå¯ä»¥å¿½ç•¥ï¼Œè§£é‡Šä¸€ä¸‹ï¼Œå…¶å®è¿™æ®µä»£ç åœ¨å¯¹è±¡é‡Œå®šä¹‰äº†ä¸€ä¸ª __esModule: trueï¼Œæ¥ç€çœ‹ä¸‹é¢ä¸€æ®µï¼Œæˆ‘ä»¬ä»ä¹‹å‰è®²çš„çŸ¥é“çŸ¥é“ __webpack_exports__ å…¶å®å°±æ˜¯ä¸€ä¸ªå•çº¯çš„ç©ºå¯¹è±¡ï¼ˆå…¶å®ä¸æ˜¯ï¼Œæ‰§è¡Œäº† __webpack_require__.r(__webpack_exports__ )å°±å˜æˆäº† {__esModule: true})ï¼Œç„¶åå®ƒåˆåœ¨å¯¹è±¡é‡Œå¢åŠ äº†ä¸€ä¸ª default å±æ€§ï¼Œç„¶åæŠŠä¸€ä¸ªæ–¹æ³•èµ‹å€¼ç»™å®ƒ(å…¶å®å°±æ˜¯æˆ‘ä»¬æ‰“åŒ…ä¹‹å‰å†™çš„ä¸€ä¸ªæ–¹æ³•)ï¼Œæœ€ç»ˆåœ¨ä¸»å…¥å£é‡Œæ‰§è¡Œçš„æ¨¡å— var _b__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./b */ &quot;./src/b.js&quot;)ï¼›å…¶å®å°±ç­‰äº {&quot;default&quot;: function{}}ï¼Œç„¶åä¸‹ä¸€æ­¥æ‰§è¡Œè®¿é—®å¯¹è±¡ default çš„å€¼å»æ‰§è¡Œå‡½æ•° æ€è€ƒå¯èƒ½ç°åœ¨ä½ å¯èƒ½ä¼šæ€è€ƒğŸ¤”ï¼Œé€šè¿‡ä¸Šé¢çš„æ¯”è¾ƒå¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®º é€šè¿‡ export å‡ºæ¥ï¼Œå¦‚æœ import {a,b,c} from &#39;..&#39;ï¼Œæ‰“åŒ…å‡ºæ¥çš„ä»£ç æ‰§è¡Œç®€å•æ“ä½œä¹‹åï¼ˆæ‰§è¡Œ __webpack_require__ å‡½æ•°ï¼‰é¦–å…ˆä¼šæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¼šæ˜¯ {a: ..., b: ..., c: ...} åŒè¿‡ export default å‡ºæ¥ï¼Œå¦‚æœ import a from &#39;..&#39;ï¼Œæ‰“åŒ…å¤„ç†çš„ä»£ç æ‰§è¡Œç®€å•æ“ä½œä¹‹åï¼ˆæ‰§è¡Œ __webpack_require__ å‡½æ•°ï¼‰é¦–å…ˆä¼šæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åä¼šå¾€å¯¹è±¡é‡Œæ·»åŠ ä¸€ä¸ªdefaultçš„keyï¼Œç±»ä¼¼ {default: ...} æ€»ç»“æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯æŒºç»•çš„ï¼Œä½ å¯ä»¥è‡ªå·±å» debugger çœ‹çœ‹ä»–çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œåº”è¯¥å°±æ˜ç™½å¾—å·®ä¸å¤šäº†ï¼Œä»Šå¤©å°±è®²äº†è¿™äº›å§ æœ¬æ–‡åœ°å€ webpackç³»åˆ—ä¹‹è¾“å‡ºæ–‡ä»¶åˆ†æ]]></content>
      <categories>
        <category>javascript</category>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webpackç³»åˆ—ä¹‹åˆæ¢]]></title>
    <url>%2F2019%2F06%2F06%2Fwebpack%E7%B3%BB%E5%88%97%E4%B9%8B%E5%88%9D%E6%8E%A2%2F</url>
    <content type="text"><![CDATA[å†™åœ¨å‰é¢ç›¸ä¿¡webpackè¿™ä¸ªåç§°å¯¹äºå‰ç«¯çš„åŒå­¦æ¥è¯´å¹¶ä¸é™Œç”Ÿï¼Œåªè¦ä½ åœ¨ç”¨vueã€reactç­‰ç­‰ä¹‹ç±»çš„æ¡†æ¶ï¼Œå°±å¾—å¤©å¤©å’Œå®ƒæ‰“äº¤é“ã€‚ä½†æ˜¯å¤§éƒ¨åˆ†äººéƒ½åªæ˜¯ç›´æ¥æ€¼ä¸€ä¸ªvue-cliè„šæ‰‹æ¶ç”Ÿæˆä¸€ä¸ªé¡¹ç›®ï¼Œè¿è¡Œèµ·æ¥å°±å¼€å§‹ä¸€é¡¿å†™ï¼Œå®Œå…¨ä¸ä¼šå»çœ‹è¿™ä¸ªé¡¹ç›®çš„å…¶ä»–ç›¸å…³çš„ä¸œè¥¿ï¼Œä»Šå¤©å¼€å§‹ï¼Œå’±ä»¬å°±æ¥è¯´è¯´è¿™ä¸ªåˆçˆ±åˆæ¨çš„webpack é—®é¢˜ä½¿ç”¨wepackçš„æ—¶å€™ç»å¸¸ä¼šå‡ºç°ä¸‹é¢è¿™äº›ç–‘é—® ä½ webpackåªèƒ½æ‰“åŒ…å•é¡µé¢çš„æ–‡ä»¶å—ï¼Ÿ WTFï¼Œæˆ‘åŒ…æ€ä¹ˆè¿™ä¹ˆå¤§ï¼ŒåŠ è½½å¤ªæ…¢äº† æˆ‘æ‰“åŒ…é€Ÿåº¦æ€ä¹ˆè¿™ä¹ˆæ…¢ï¼Œä»€ä¹ˆç ´ç©æ„ï¼Ÿâ€¦ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨webpackå“ˆï¼Œä½ é—®æˆ‘ä¸ºä»€ä¹ˆè¦ç”¨ï¼Ÿå› ä¸ºå¤§å®¶éƒ½åœ¨ç”¨å•ŠğŸ˜ƒğŸ˜ƒã€‚å¼€ä¸ªç©ç¬‘ï¼Œå‰ç«¯å‘å±•åˆ°ä»Šå¤©ï¼Œæ–°æŠ€æœ¯æ–°æ€æƒ³æ–°æ¡†æ¶çˆ†å‘å¼å¢é•¿ï¼Œå½“å‰çš„æµè§ˆå™¨ç¯å¢ƒè·‘ä¸èµ¢å•Šï¼Œä½ è¯´ä½ å†™ä¸ªES6/7åœ¨æµè§ˆå™¨ç¯å¢ƒéƒ½èƒ½è·‘èµ·æ¥ï¼Ÿæ‰¯æ·¡çš„ã€‚è¿™ä¸ªæ—¶å€™babelå°±å‡ºç°äº†ï¼Œä½ è·‘ä¸èµ·æ¥æ˜¯å§ï¼Œé‚£æˆ‘è½¬æˆES5ä½ æ€»è¯¥è·‘èµ·æ¥å§~ï¼Œé‚£babelæˆ‘è¿˜æ˜¯ä¸èƒ½ç›´æ¥ç”¨å•Šï¼Œè‚¯å®šå¾—å€ŸåŠ©å·¥å…·ç¼–è¯‘å‘€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦webpackå»åšè¿™ä»¶äº‹æƒ…äº†ã€‚è¿™ä¸ªæ—¶å€™æœ‰äººå°±è¦ç«™å‡ºæ¥è¯´äº†ï¼Œæˆ‘gulpä¸æœï¼Œæˆ‘ä¹Ÿèƒ½åšï¼Œæˆ‘å°±ä¸ç”¨webpackã€‚ä½ è¿™ä¹ˆè¯´æˆ‘å°±è¦è·Ÿä½ å” å” äº†ï¼Œç°åœ¨æˆ‘ä»¬å…ˆæ¥æ¯”è¾ƒä¸€ä¸‹webpackå’Œgulpã€‚ gulp æ˜¯ task runnerï¼ŒWebpack æ˜¯ module bundler webpackçš„ä¼˜åŠ¿åœ¨æ¨¡å—åŒ–ï¼Œgulpé™¤äº†æ¨¡å—åŒ–æ–¹é¢éƒ½å¾ˆä¸é”™ã€‚ä½†æ˜¯å‰ç«¯å‘å±•è‡³ä»Šï¼Œæ¨¡å—åŒ–çœŸçš„å¾ˆé‡è¦ï¼ŒCMDã€AMDå°±æ˜¯æ¨¡å—åŒ–çš„äº§ç‰©ã€‚ç®€å•æ¥è¯´ï¼Œå¦‚æœä½ å½“å‰é¡¹ç›®éœ€è¦æ¨¡å—åŒ–ç¼–ç¨‹ï¼Œé‚£å°±é€‰webpackï¼Œå¦‚æœæ˜¯å¤„ç†å…¶ä»–äº‹æƒ…ï¼Œæ¯”å¦‚æŠŠå›¾ç‰‡æ‹¼æ¥æˆé›ªç¢§å›¾æˆ–è€…å‹ç¼©ï¼Œé‚£ä¹ˆgulpæ˜¯æœ€æ“…é•¿çš„ æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹è¿™ä¸ªå›ç­” gulp æœ‰å“ªäº›åŠŸèƒ½æ˜¯ webpack ä¸èƒ½æ›¿ä»£çš„ï¼Ÿ å®‰è£…è¿™é‡Œå¯ä»¥å‚è€ƒwebpackå®˜ç½‘å¼€å‘ç¯å¢ƒ webpack: 4.34.0123&gt; mkdir webpack &amp;&amp; cd webpack&gt; npm init -y&gt; npm install webpack webpack-cli -D å…¥å£ï¼ˆentryï¼‰æ¯ä¸ªwebpackéƒ½ä¼šæœ‰ä¸€ä¸ªentryï¼Œå°±æ˜¯å…¥å£çš„æ„æ€ï¼ŒæŒ‡ç¤º webpack åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—ï¼Œæ¥ä½œä¸ºæ„å»ºå…¶å†…éƒ¨ä¾èµ–å›¾çš„å¼€å§‹ã€‚ æ³¨æ„ç‚¹ï¼š å…¥å£å¯ä»¥æœ‰å¤šä¸ªï¼Œå¦‚æœæ˜¯å•é¡µé¢åªéœ€è¦ä¸€ä¸ªå…¥å£ï¼Œå¤šé¡µé¢å¯ä»¥è®¾ç½®å¤šä¸ªå…¥å£ å…¥å£çš„æ–‡ä»¶å¿…é¡»æ˜¯.jsæ–‡ä»¶ï¼Œå› ä¸ºwebpackåªè®¤è¯†jsï¼ˆä¸å®Œå…¨å¯¹ï¼Œå…¶å®ä»»æ„æ–‡ä»¶éƒ½å¯ä»¥ï¼Œåªæ˜¯webpackä¼šæŠŠå®ƒå½“åšjsæ¥å¤„ç†ï¼‰ ä¸¾ä¸ªğŸŒ°æˆ‘ä»¬æ–°å»ºwebpack.config.jså’Œæ–°å»ºsrcæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”æ–‡ä»¶å¤¹ä¸‹æ–°å»ºindex.jsæ–‡ä»¶ç›®å½•å¦‚ä¸‹ 1234- webpack/- src/- index.js- webpack.config.js webpack.config.js123module.exports = &#123; entry: './src/index.js'&#125;; æˆ‘ä»¬ä¸Šé¢æŒ‡å®šwebpackçš„å…¥å£æ–‡ä»¶ä¸ºindex.jsæ–‡ä»¶ï¼Œè¿™æ˜¯æ€»å…¥å£ å‡ºå£ï¼ˆoutputï¼‰æœ‰å…¥å£å½“ç„¶å°±ä¼šæœ‰å‡ºå£äº†ï¼Œå°±æ˜¯ä½ å¯¼å‡ºçš„æ–‡ä»¶ webpack.config.js1234567module.exports = &#123; entry: './src/index.js', output: &#123; path: path.resolve(__dirname, 'dist'), filename: 'bundle.js' &#125;&#125;; ä¸Šè¿°entryå·²ç»ä»‹ç»è¿‡äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹outputï¼Œä»–æœ‰æ–‡ä»¶å¯¼å‡ºçš„è·¯å¾„ï¼ˆpathï¼‰å’Œå¯¼å‡ºçš„æ–‡ä»¶åï¼ˆfilenameï¼‰ å…³äºfilenameè¿™é‡Œéœ€è¦æ³¨æ„çš„åœ°æ–¹æœ‰ï¼š å‡ºå£çš„æ–‡ä»¶åå¯ä»¥å®šåˆ¶åŒ–ï¼Œå½“å‰å¦‚æœä½ æ˜¯å•é¡µé¢çš„è¯ï¼Œç®€å•çš„å¯ä»¥å†™æ­»ä¸€ä¸ªfilenameï¼Œå°±å¦‚ä¸Šé¢çš„bundle.jsä¸€æ · ä½ ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼Œä½¿ç”¨å…¥å£åç§°çš„åç§°ï¼šfilename: &#39;[name].bundle.js&#39;,å½“ç„¶è¿˜éœ€è¦æ”¹ä¸€ä¸‹entryï¼ŒæŠŠå®ƒæ”¹æˆä»¥ä¸‹å½¢å¼ï¼Œnameå°±ä¼šå˜æˆ -&gt; app 123456789module.exports = &#123; entry: &#123; app: './src/index.js' &#125;, output: &#123; path: path.resolve(__dirname, 'dist'), filename: 'bundle.js' &#125;&#125;; ç°åœ¨æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹webapckæ‰“åŒ… å°è¯•ç‰›åˆ€ç¬¬ä¸€æ­¥ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹webpack-demo123&gt; mkdir webpack-demo &amp;&amp; cd webpack-demo&gt; npm init -y&gt; cnpm install webpack webpack-cli -D ç¬¬äºŒæ­¥ï¼Œæ–°å»ºsrc/index.jsæ–‡ä»¶å’Œwebpack.config.jsæ–‡ä»¶ webpack.config.js 12345678const path = require('path');module.exports = &#123; entry: './src/index.js', output: &#123; filename: 'bundle.js', path: path.resolve(__dirname, 'dist/'), &#125;,&#125;; index.js1document.write('hello webpack'); ç¬¬ä¸‰æ­¥ï¼Œæ‰“åŒ…å‘½ä»¤è¡Œè¾“å…¥1&gt; npx webpack --config webpack.config.js ç„¶åæ§åˆ¶å°å°±ä¼šè¾“å‡º12345678Hash: 348dca17387cd3f29cefVersion: webpack 4.33.0Time: 227msBuilt at: 2019-06-08 15:24:07 Asset Size Chunks Chunk Namesbundle.js 961 bytes 0 [emitted] mainEntrypoint main = bundle.js[0] ./src/index.js 33 bytes &#123;0&#125; [built] çœ‹åˆ°è¿™ä¸ªä¿¡æ¯è¯æ˜ä½ å·²ç»å¤§åŠŸå‘Šæˆäº†ï¼Œå»çœ‹çœ‹dist/æ–‡ä»¶å¤¹ä¸‹æ˜¯ä¸æ˜¯æœ‰æ‰“åŒ…å¥½çš„jsæ–‡ä»¶æœ€åé¢ä½ ä¼šçœ‹åˆ°æœ‰é»„è‰²çš„è­¦å‘Šï¼Œè¯´modeæ²¡æœ‰è®¾ç½®ï¼Œå¾…ä¼šå†è®² è¿™ä¸ªæ—¶å€™ä½ å°±ä¼šæƒ³ï¼Œæˆ‘æ¯æ¬¡ç”Ÿæˆçš„æ–‡ä»¶éƒ½å«bundle.jsï¼Œæˆ‘éƒ½åŒºåˆ†ä¸å¼€ï¼Œä¹Ÿä¸å¥½åšç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™ä½ å°±éœ€è¦é…ç½®ä¸€ä¸‹filenameäº† æˆ‘ä»¬æŠŠwebpack.config.jsæ”¹æˆä»¥ä¸‹ 12345678910const path = require('path');module.exports = &#123; entry: &#123; app: './src/index.js', &#125;, output: &#123; filename: '[name].[hash].js', path: path.resolve(__dirname, 'dist/'), &#125;,&#125;; ç„¶åæ‰§è¡Œ1&gt; npx webpack --config webpack.config.js è¿™ä¸ªæ—¶å€™dist/æ–‡ä»¶å¤¹ä¸‹å°±ä¼šå¤šå‡ºä¸ªç±»ä¼¼app.32434c7cc602e3049dac.jsçš„æ–‡ä»¶ï¼Œè€Œä¸”å¦‚æœä½ åå¤æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼Œä½ å‘ç°app.32434c7cc602e3049dac.jsæ–‡ä»¶åéƒ½æ²¡æœ‰æ”¹å˜ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºwebpackä¼šåˆ¤æ–­ä½ çš„æ–‡ä»¶æ˜¯å¦æœ‰æ›´æ”¹è€Œæ¥è§‰å¾—æ–‡ä»¶å¤¹hashçš„å˜æ›´ï¼Œç°åœ¨ä½ å¯ä»¥å°è¯•ä¿®æ”¹ä¸€ä¸‹index.jsæ–‡ä»¶ä¹‹åæ‰“åŒ…çš„æ•ˆæœå°±çŸ¥é“äº†ã€‚ æ¨¡å¼ï¼ˆmode ï¼‰ä¸Šé¢è¯´åˆ°æ¯æ¬¡æ‰“åŒ…çš„æ—¶å€™éƒ½ä¼šæŠ¥è­¦å‘Šï¼Œå‘Šè¯‰æˆ‘ä»¬æ²¡æœ‰è®¾ç½®modeï¼Œç°åœ¨æˆ‘ä»¬æ¥è¯´è¯´modeé¦–å…ˆmodeæœ‰ä¸¤ä¸ªå€¼ï¼Œåˆ†åˆ«æ˜¯developmentå’Œproductionï¼Œæ„æ€å°±æ˜¯ï¼Œå½“å‰é¡¹ç›®æ‰“åŒ…çš„å¼€å‘ç¯å¢ƒè¿˜æ˜¯ç”Ÿæˆç¯å¢ƒçš„ä»£ç å¦‚æœä½ è®¾ç½®äº†mode: â€˜developmentâ€™ï¼Œåœ¨é¡¹ç›®é‡Œä½ å¯ä»¥ä½¿ç”¨ process.env.NODE_ENV æ¥è·å–å½“å‰çš„ç¯å¢ƒçš„å€¼ä½ å¯ä»¥å°è¯•æŠŠwebpack.config.jsæ”¹æˆä»¥ä¸‹ï¼Œç„¶ååœ¨index.jsé‡ŒæŠŠè¿™ä¸ªå€¼æ‰“å°å‡ºæ¥ï¼Œè¿è¡Œä¸€ä¸‹æ•ˆæœ webpack.config.js1234567891011const path = require('path');module.exports = &#123; mode: 'development', entry: &#123; app: './src/index.js', &#125;, output: &#123; filename: '[name].[hash].js', path: path.resolve(__dirname, 'dist/'), &#125;,&#125;; index.js1document.write(`hello webpackï¼Œthis is $&#123;process.env.NODE_ENV&#125;`); ç°åœ¨æˆ‘ä»¬åªæœ‰jsæ–‡ä»¶ï¼Œä½ å¯ä»¥å…ˆåœ¨æ ¹ç›®å½•æ–°å»ºä¸€ä¸ªindex.htmlæ–‡ä»¶ï¼ŒæŠŠjså¼•å…¥åœ¨æµè§ˆå™¨ç¯å¢ƒæ‰§è¡Œ(æˆ–è€…ç›´æ¥åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œjs)ï¼Œä½ ä¼šçœ‹åˆ°æµè§ˆå™¨æ˜¾ç¤º -&gt; hello webpackï¼Œthis is developmentä½ åˆ†åˆ«è¿è¡Œä¹‹åä¼šå‘ç°ä»–ä»¬çš„æ•ˆæœæ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸€ä¸ªæ˜¯è¢«å‹ç¼©çš„ï¼Œä¸€ä¸ªæ²¡æœ‰è¢«å‹ç¼© è¿™ä¸ªæ—¶å€™ä½ å°±ä¼šæƒ³äº†ï¼Œæ€ä¹ˆè¿™ä¹ˆéº»çƒ¦ï¼Œæˆ‘æ‰“åŒ…è¿˜å¾—è‡ªå·±å»æ–°å»ºhtmlæ–‡ä»¶å¼•å…¥jsç„¶åè¿è¡Œæˆ–è€…å»æ‰§è¡Œjsæ–‡ä»¶ï¼Œèƒ½ä¸èƒ½è®©ä»–è‡ªåŠ¨è¿è¡Œè·‘èµ·æ¥ï¼Ÿå½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è¯´è¯´plugins## æ’ä»¶ï¼ˆpluginsï¼‰æ’ä»¶æ˜¯ webpack çš„æ”¯æŸ±åŠŸèƒ½ã€‚webpack è‡ªèº«ä¹Ÿæ˜¯æ„å»ºäºï¼Œä½ åœ¨ webpack é…ç½®ä¸­ç”¨åˆ°çš„ç›¸åŒçš„æ’ä»¶ç³»ç»Ÿä¹‹ä¸Šï¼ï¼ˆå®˜ç½‘çš„è§£é‡Šï¼‰æ’ä»¶æ€ä¹ˆè¯´å‘¢ï¼Ÿä¸å¥½è§£é‡Šå®ƒï¼Œä½ å¯ä»¥ç†è§£ä¸ºå¤„ç†å·¥å…·ï¼Œæ’ä»¶ç›®çš„åœ¨äºè§£å†³ loader(è¿™ä¸ªç­‰ä¼šå†è®²ï¼Œç°åœ¨ç”¨ä¸ä¸Š) æ— æ³•å®ç°çš„å…¶ä»–äº‹æ’ä»¶æ€ä¹ˆé…ç½®ï¼Ÿå°±åƒä¸‹é¢è¿™æ ·ï¼Œå½“ç„¶ä¸æ˜¯éšä¾¿æ‰¾çš„æ’ä»¶ï¼Œæˆ‘ä»¬ä¼šç”¨åˆ°ä¸‹é¢é…ç½®çš„æ’ä»¶123456789101112131415const path = require('path');const HtmlWebpackPlugin = require('html-webpack-plugin');module.exports = &#123; mode: 'development', entry: &#123; app: './src/index.js', &#125;, output: &#123; filename: '[name].[hash].js', path: path.resolve(__dirname, 'dist/'), &#125;, plugins: [ new HtmlWebpackPlugin(&#123;template: 'index.html'&#125;) ]&#125;;æˆ‘ä»¬å…ˆåœ¨æ ¹ç›®å½•æ–°å»ºä¸€ä¸ªindex.htmlæ–‡ä»¶ï¼Œä¹‹å‰ä¸æ˜¯è¯´è¿è¡Œé¡¹ç›®å¾ˆéº»çƒ¦å˜›ï¼Ÿç°åœ¨æ•™ä½ ç®€å•çš„æ–¹æ³•ç„¶åæˆ‘ä»¬ç”¨åˆ°äº†html-webpack-pluginï¼Œéœ€è¦å…ˆå®‰è£…ä»–æ‰èƒ½ä½¿ç”¨1&gt; cnpm i html-webpack-plugin -Dä¸‹ä¸€æ­¥æ‰“åŒ…è¿è¡Œé¡¹ç›®1&gt; npx webpack --config webpack.config.jsè¿è¡Œç»“æœï¼š12345678910111213141516Hash: bea857ae13cad8af6e66Version: webpack 4.33.0Time: 274msBuilt at: 2019-06-08 16:00:33 Asset Size Chunks Chunk Namesapp.bea857ae13cad8af6e66.js 3.83 KiB app [emitted] app index.html 74 bytes [emitted] Entrypoint app = app.bea857ae13cad8af6e66.js[./src/index.js] 65 bytes &#123;app&#125; [built]Child html-webpack-plugin for &quot;index.html&quot;: 1 asset Entrypoint undefined = index.html [./node_modules/_html-webpack-plugin@3.2.0@html-webpack-plugin/lib/loader.js!./index.html] 209 bytes &#123;0&#125; [built] [./node_modules/_webpack@4.33.0@webpack/buildin/global.js] (webpack)/buildin/global.js 472 bytes &#123;0&#125; [built] [./node_modules/_webpack@4.33.0@webpack/buildin/module.js] (webpack)/buildin/module.js 497 bytes &#123;0&#125; [built] + 1 hidden moduleå»æŸ¥çœ‹distæ–‡ä»¶å¤¹ä¸‹ï¼Œä½ ä¼šå‘ç°å¤šå‡ºäº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œjså’Œindex.htmlæ–‡ä»¶ï¼Œè¿™å°±æ˜¯æ’ä»¶çš„åŠŸåŠ³html-webpack-pluginè¿™ä¸ªæ’ä»¶éœ€è¦æŒ‡å®šæ˜¯é‚£ä¸ªhtmlæ¨¡æ¿ï¼Œç„¶åæœ€åæ‰“åŒ…çš„æ—¶å€™å°±æ˜¯ä»¥è¿™ä¸ªæ¨¡æ¿ä¸ºä¸»ï¼ŒæŠŠæ‰“åŒ…å¥½çš„jsæ–‡ä»¶æ”¾åˆ°è¿™ä¸ªindex.htmlé‡Œé¢ï¼Œä½ å¯ä»¥æŸ¥çœ‹htmlæ–‡ä»¶é‡Œçš„å†…å®¹ï¼šindex.html1&lt;script type="text/javascript" src="app.1b0b2001b0579faec32d.js"&gt;&lt;/script&gt;è¿™ä¸ªæ—¶å€™ä½ ä¼šå‘ç°ï¼Œæˆ‘é ï¼Œæˆ‘distæ–‡ä»¶æ€ä¹ˆè¿™ä¹ˆå¤šå•Šï¼Œæ€ä¹ˆåŠå•Šï¼Ÿåˆ«æ€¥ï¼Œæˆ‘ä»¬å†æ¥ç”¨ä¸€ä¸ªæ’ä»¶è§£å†³è¿™ä¸ªé—®é¢˜ å®‰è£…æ’ä»¶clean-webpack-plugin1&gt; cnpm i clean-webpack-plugin -D ç„¶åé…ç½®æ–‡ä»¶å»æ·»åŠ æ’ä»¶ 1234567891011121314151617const path = require('path');const HtmlWebpackPlugin = require('html-webpack-plugin');const &#123; CleanWebpackPlugin &#125; = require('clean-webpack-plugin');module.exports = &#123; mode: 'development', entry: &#123; app: './src/index.js', &#125;, output: &#123; filename: '[name].[hash].js', path: path.resolve(__dirname, 'dist/'), &#125;, plugins: [ new CleanWebpackPlugin(), new HtmlWebpackPlugin(&#123;template: 'index.html'&#125;) ]&#125;; ç„¶åä½ å†å»çœ‹çœ‹distæ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶ï¼Œæ˜¯ä¸æ˜¯åªæœ‰ä¸¤ä¸ªæ–‡ä»¶äº†ï¼Ÿè¿™ä¸ªæ’ä»¶çš„ä½œç”¨æ˜¯ï¼Œå…ˆæŠŠdistæ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶å…ˆæ¸…ç©ºç„¶åå†æŠŠæ‰“åŒ…å¥½çš„æ–‡ä»¶æ”¾å…¥distã€‚ é‚£ä¹ˆä½ è¿˜ä¼šæœ‰é—®é¢˜ï¼Œè¿™è¿˜æ˜¯éº»çƒ¦å•Šï¼Œæˆ‘ä¸èƒ½åªè¿è¡Œå‘½ä»¤è¡Œï¼Œè®©é‡æ–°è‡ªå·±æ‰“å¼€æµè§ˆå™¨è¿è¡Œæˆ‘æ‰“åŒ…çš„é¡¹ç›®å—ï¼Ÿå½“ç„¶å¯ä»¥å•Šé¦–å…ˆå®‰è£… webpack-dev-server1&gt; cnpm i webpack-dev-server -Dç„¶å1&gt; webpack-dev-server --open --config webpack.config.jsä½ ä¼šå‘ç°é‡æ–°è‡ªåŠ¨æ‰“å¼€äº†æµè§ˆå™¨ï¼Œé¡µé¢æ˜¾ç¤º hello webpackï¼Œthis is developmentã€‚æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿä½ ç°åœ¨å¯ä»¥å»ä¿®æ”¹index.jsç„¶åä¿å­˜æ–‡ä»¶ï¼Œå»æµè§ˆå™¨çœ‹çœ‹æ˜¯ä¸æ˜¯è‡ªåŠ¨åˆ·æ–°äº†ä½ åˆšåˆšæ›´æ”¹çš„å†…å®¹å‘¢ï¼Ÿç°åœ¨ä½ å¯èƒ½è¿˜ä¼šæœ‰é—®é¢˜ï¼Œæˆ‘å»ï¼Œè¿™å¤ªç®€å•äº†å§ï¼Œæˆ‘è¦ç”¨csså’Œå›¾ç‰‡æ€ä¹ˆåŠï¼Ÿjsä¸èƒ½å¯¼å…¥cssæ–‡ä»¶å•Šï¼æˆ‘æ€ä¹ˆè·Ÿvueä¸€æ ·åœ¨è‡ªå·±çš„ipè®¿é—®é¡¹ç›®å•Šï¼Ÿç°åœ¨è‚¯å®šæ˜¯é—®é¢˜ä¸€å¤§å † loaderloader ç”¨äºå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œè½¬æ¢ã€‚loader å¯ä»¥ä½¿ä½ åœ¨ import æˆ–â€åŠ è½½â€æ¨¡å—æ—¶é¢„å¤„ç†æ–‡ä»¶ã€‚æ¯”å¦‚å¯ä»¥æŠŠtypescriptè½¬æ¢æˆJavaScriptï¼Œlessè½¬æˆcssç°åœ¨æˆ‘ä»¬å°±æ¥è§£å†³ä½ ä¸Šä¸€ç« èŠ‚æœ«çš„é—®é¢˜ï¼Œæ•™ä½ é…ç½®ç®€å•çš„loaderï¼Œæ¥åŠ è½½cssæˆ–è€…å›¾ç‰‡é¦–å…ˆæˆ‘ä»¬å…ˆå®‰è£…css-loader/style-loaderï¼Œæ¥åŠ è½½è§£æcssæ–‡ä»¶1&gt; cnpm i css-loader style-loader -D ä¸‹ä¸€æ­¥åœ¨srcæ–‡ä»¶å¤¹ä¸‹æ–°å»ºtest.cssæ–‡ä»¶ï¼Œå†åœ¨index.jså¯¼å…¥test.css123body &#123; background: #ccc;&#125; index.js12import './test.css';document.write(`hello webpackï¼Œthis is $&#123;process.env.NODE_ENV&#125;ï¼Œtest`); å¦‚æœä½ ç›´æ¥è¿è¡Œä¼šå‘ç°æ§åˆ¶å°æŠ¥é”™äº†1234567ERROR in ./src/test.css 1:5Module parse failed: Unexpected token (1:5)You may need an appropriate loader to handle this file type.&gt; body &#123;| background: #ccc;| &#125; @ ./src/index.js 1:0-20 è¿™ä¸ªæ—¶å€™loaderç™»åœºäº†ï¼Œæˆ‘ä»¬ä¿®æ”¹é…ç½®æ–‡ä»¶webpack.config.js12345678910111213141516171819202122232425const path = require('path');const HtmlWebpackPlugin = require('html-webpack-plugin');const &#123; CleanWebpackPlugin &#125; = require('clean-webpack-plugin');module.exports = &#123; mode: 'development', entry: &#123; app: './src/index.js', &#125;, output: &#123; filename: '[name].[hash].js', path: path.resolve(__dirname, 'dist/'), &#125;, plugins: [ new CleanWebpackPlugin(), new HtmlWebpackPlugin(&#123; template: 'index.html' &#125;), ], module: &#123; rules:[ &#123; test: /\.css$/, use: ['style-loader', 'css-loader'], &#125;, ] &#125;&#125;; ç„¶åè¿è¡Œå‘½ä»¤è¡Œ1&gt; webpack-dev-server --open --config webpack.config.js ä½ ä¼šå‘ç°é¡µé¢èƒŒæ™¯é¢œè‰²å˜äº† ç°åœ¨æˆ‘ä»¬æ¥è¯´è¯´é…ç½®ï¼šmodule.rules å…è®¸ä½ åœ¨ webpack é…ç½®ä¸­æŒ‡å®šå¤šä¸ª loaderï¼Œä¸Šé¢æˆ‘ä»¬è§„å®šæ­£åˆ™åŒ¹é…cssæ–‡ä»¶ï¼Œç„¶åå¦‚æœåŒ¹é…åˆ°äº†ï¼Œåˆ™ä½¿ç”¨style-laoderå’Œcss-loaderå»å¤„ç†cssæ–‡ä»¶ï¼Œcss-laoderè´Ÿè´£è§£æcssæ–‡ä»¶ï¼Œstyle-loaderè´Ÿè´£æŠŠcssæ–‡ä»¶æ”¾åˆ°é¡µé¢ä¸­å»ï¼Œä½ æ‰“å¼€è°ƒè¯•å¯ä»¥çœ‹åˆ°headé‡Œè¢«æ’å…¥äº†styleæ ·å¼æ ‡ç­¾ï¼Œå½“å‰å¦‚æœä½ æƒ³è§£æä¾‹å¦‚xx.tsæ–‡ä»¶ï¼Œåˆ™å¯ä»¥åœ¨æ•°ç»„é‡Œé¢æ–°å¢ï¼š1234 &#123; test: /\.ts$/, use: 'ts-loader',&#125;, ä¸‹é¢æ¥çœ‹çœ‹æ€ä¹ˆåŠ è½½å›¾ç‰‡èµ„æºï¼Œè¿˜æ˜¯è·Ÿä¸Šè¿°åŸä¸€æ ·ï¼Œå›¾ç‰‡ä¹Ÿæ˜¯æœ‰ç±»å‹çš„ï¼Œæˆ‘ä»¬é¦–å…ˆå¾—åŒ¹é…æ–‡ä»¶åç¼€ï¼Œç„¶åå»ç”¨loaderå»è§£æä»–ä»¬ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° url-loader file-loaderæŒ‰ç…§æƒ¯ä¾‹å…ˆå®‰è£…1&gt; cnpm i url-loader file-loader -D 12345678910111213141516171819module.exports = &#123; ... module: &#123; rules:[ &#123; test: /\.css$/, use: ['style-loader', 'css-loader'], &#125;, &#123; test: /\.(png|jpe?g|gif|svg)(\?.*)?$/, loader: 'url-loader', options: &#123; limit: 6000, name: 'img/[name].[hash:7].[ext]', &#125;, &#125; ] &#125;&#125;; ä¸‹ä¸€æ­¥å°±æ˜¯å¾€é¡¹ç›®é‡Œå¢åŠ å›¾ç‰‡äº†æˆ‘ä»¬ä¿®æ”¹test.cssæ–‡ä»¶test.css123body &#123; background: url(img.jpg);&#125; æµè§ˆå™¨å°±æ˜¾ç¤ºçš„å…¨æ˜¯åˆšåˆšè®¾ç½®çš„é‡å¤å›¾ç‰‡äº† è¿™é‡Œä½ åˆä¼šé—®äº†ï¼Œä¸å¯¹ï¼Œä½ è¿™é‡Œåªç”¨åˆ°äº†url-loaderï¼Œfile-loaderä¸æ˜¯å¤šä½™çš„å—ï¼Ÿ ä¸æ˜¯çš„ï¼Œä½ å¯ä»¥çœ‹çœ‹optionsï¼Œæœ‰ä¸€ä¸ªlimitå‚æ•°ï¼Œè§„å®šå¦‚æœè¶…è¿‡äº†6000byteså¤§å°çš„æ–‡ä»¶ä¼šäº¤ç»™file-loaderå¤„ç†ï¼Œå› ä¸ºå¦‚æœå›¾ç‰‡å°äºè¿™ä¸ªæ•°å€¼ï¼Œurl-loaderä¼šæŠŠå›¾ç‰‡è½¬æˆbase64æ ¼å¼çš„å›¾ç‰‡åŠ è½½ï¼Œå¦‚æœè¶…è¿‡å°±è‡ªå·±ä¸å¤„ç†äº†ï¼Œæ‰€ä»¥ä»–ä»¬ä¸¤è€…æ˜¯æœ‰ç›¸ä¾æ€§çš„ ä½¿ç”¨npmè„šæœ¬ä¸Šé¢åŸºæœ¬ä¸Šéƒ½æ˜¯ä½¿ç”¨ä¸€å¤§æ®µçš„å‘½ä»¤è¡Œæ¥æ‰§è¡Œé¡¹ç›®ï¼Œç°åœ¨æˆ‘ä»¬æ¥ç®€åŒ–ä¸€ä¸‹ä¿®æ”¹package.json1234"scripts": &#123; "dev": "webpack-dev-server --open --config webpack.config.js", "build": "webpack --config webpack.config.js"&#125;, å‘½ä»¤è¡Œè¿è¡Œé¡¹ç›®12&gt; npm run dev&gt; npm run build devServeråœ¨å¼€å‘ä¸­ä½ å¯èƒ½æœ‰å¾ˆå¤šéœ€æ±‚ï¼Œæ¯”å¦‚æ€ä¹ˆé€šè¿‡ipè®¿é—®é¡¹ç›®ï¼Œæ€ä¹ˆæŠŠæ§åˆ¶å°ä¿¡æ¯è¾“å‡ºçš„ç²¾ç®€ç‚¹ï¼Œæ€ä¹ˆä¿®æ”¹ç«¯å£ç­‰ç­‰ï¼Ÿè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°devServerçš„é…ç½®äº†æˆ‘ä»¬ä¿®æ”¹webpack.config.js,å¢åŠ ä»¥ä¸‹ï¼š 1234567891011module.exports = &#123; ... devServer: &#123; contentBase: './dist', // å‘Šè¯‰æœåŠ¡å™¨ä»å“ªé‡Œæä¾›å†…å®¹ host: '0.0.0.0', // æŒ‡å®šä½¿ç”¨ä¸€ä¸ª hostã€‚é»˜è®¤æ˜¯ localhost useLocalIp: true, // æ˜¯å¦ä½¿ç”¨æœ¬åœ°ip open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ port: 8080, // ç«¯å£å· noInfo: true, // æ˜¾ç¤ºçš„ webpack åŒ…(bundle)ä¿¡æ¯ã€çš„æ¶ˆæ¯å°†è¢«éšè— &#125;,&#125; æ˜¯çš„ï¼Œä½ ç°åœ¨å¯ä»¥ä¸ç”¨åœ¨å‘½ä»¤è¡Œé‡Œå¢åŠ â€“openè¿™ä¸ªå‚æ•°ï¼Œåœ¨è¿™é‡Œé…ç½®ä¹Ÿæ˜¯ä¸€æ ·çš„ æœ€åç´¯äº†ç´¯äº†ï¼Œå†™åˆ°è¿™å·²ç»æ˜¯å‡Œæ™¨äº†ã€‚ä¸å¤šBBäº†ï¼Œç°åœ¨åŸºæœ¬çš„webpackæ“ä½œåº”è¯¥éƒ½å·²ç»å­¦ä¼šäº†å§ï¼Œåé¢å°±æ˜¯ç¨å¾®æ·±å…¥çš„ç©ä¸€ç©webpackäº†ï¼Œæˆä¸ºä¸€ä¸ªwebpacké…ç½®å·¥ç¨‹å¸ˆï¼Ÿ to be continuedâ€¦ æœ¬æ–‡åœ°å€ webpackç³»åˆ—ä¹‹åˆæ¢]]></content>
      <categories>
        <category>javascript</category>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[redisç®€æ˜“æ•™ç¨‹ä»¥åŠä½¿ç”¨nodejsè¿æ¥redis]]></title>
    <url>%2F2019%2F04%2F19%2Fredis%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B%E4%BB%A5%E5%8F%8A%E4%BD%BF%E7%94%A8nodejs%E8%BF%9E%E6%8E%A5redis%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¸€ç›´æ²¡æœºä¼šå­¦ä¹ redisï¼Œæœ€è¿‘æŠ½ç©ºå­¦äº†ä¸€ä¸‹ï¼Œå› ä¸ºçŸ¥é“reidsè¿˜æ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œç»å¸¸çœ‹åˆ°æœ‰äººå¼€å‘å…¬ä¼—å·å› ä¸ºæ²¡æœ‰å¯¹access_tokenè¿›è¡Œç¼“å­˜ï¼Œåˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œå¯¼è‡´access_tokençš„è°ƒç”¨apiæ¬¡æ•°è¶…è¿‡é™åˆ¶è€Œå½±å“ä¸šåŠ¡çš„æƒ…å†µï¼Œç†Ÿæ‚‰çš„äººéƒ½çŸ¥é“ä½¿ç”¨redisåŸºæœ¬ä¸Šéƒ½æ˜¯åšç¼“å­˜ï¼Œå› ä¸ºä»–ç®€å•ã€é€Ÿåº¦å¿«ï¼Œå¯ä»¥è¯´æ˜¯ä¸ªâ€å¿«ç”·â€ã€‚ä½¿ç”¨reidsåšæŠ½å¥–ä¹Ÿå¾ˆæ™®éï¼Œæœ‰ç©ºå¯ä»¥è¯•è¯•ã€‚æœ¬ç¯‡æœ¬ç« æš‚æ—¶åªè®²keyã€hashã€list redisç®€ä»‹ Redis æ˜¯å®Œå…¨å¼€æºå…è´¹çš„ï¼Œéµå®ˆBSDåè®®ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„key-valueæ•°æ®åº“ã€‚ Redis ä¸å…¶ä»– key - value ç¼“å­˜äº§å“æœ‰ä»¥ä¸‹ä¸‰ä¸ªç‰¹ç‚¹ï¼š Redisæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨ã€‚ Redisä¸ä»…ä»…æ”¯æŒç®€å•çš„key-valueç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾›listï¼Œsetï¼Œzsetï¼Œhashç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨ã€‚ Redisæ”¯æŒæ•°æ®çš„å¤‡ä»½ï¼Œå³master-slaveæ¨¡å¼çš„æ•°æ®å¤‡ä»½ã€‚ ä¸ºä»€ä¹ˆè¦ç”¨redisï¼ˆä¼˜åŠ¿ï¼‰ æ€§èƒ½æé«˜ â€“ Redisèƒ½è¯»çš„é€Ÿåº¦æ˜¯110000æ¬¡/s,å†™çš„é€Ÿåº¦æ˜¯81000æ¬¡/s ã€‚ ä¸°å¯Œçš„æ•°æ®ç±»å‹ â€“ Redisæ”¯æŒäºŒè¿›åˆ¶æ¡ˆä¾‹çš„ Strings, Lists, Hashes, Sets åŠ Ordered Sets æ•°æ®ç±»å‹æ“ä½œã€‚ åŸå­ â€“ Redisçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼Œæ„æ€å°±æ˜¯è¦ä¹ˆæˆåŠŸæ‰§è¡Œè¦ä¹ˆå¤±è´¥å®Œå…¨ä¸æ‰§è¡Œã€‚å•ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„ã€‚å¤šä¸ªæ“ä½œä¹Ÿæ”¯æŒäº‹åŠ¡ï¼Œå³åŸå­æ€§ï¼Œé€šè¿‡MULTIå’ŒEXECæŒ‡ä»¤åŒ…èµ·æ¥ã€‚ ä¸°å¯Œçš„ç‰¹æ€§ â€“ Redisè¿˜æ”¯æŒ publish/subscribe, é€šçŸ¥, key è¿‡æœŸç­‰ç­‰ç‰¹æ€§ã€‚ å®‰è£…è¿è¡ŒåŠè°ƒè¯•ï¼ˆè¿™é‡Œä»¥macä¸ºä¾‹ï¼‰ å…ˆå»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…ï¼šhttp://www.redis.net.cn/download/ è§£å‹å®‰è£… 12345&gt; tar xzf redis-3.0.6.tar.gz&gt; make&gt; sudo make install&gt; cd /usr/local/bin &amp;&amp; redis-server // å¼€å¯redisæœåŠ¡&gt; cd /usr/local/bin &amp;&amp; redis-cli // å¼€å¯redisè°ƒè¯•æœåŠ¡ å¼€å¯è°ƒè¯•ä¼šæ˜¾ç¤ºä¸‹é¢çš„ç•Œé¢ï¼Œç°åœ¨ä½ å°±å¯ä»¥å¼€å§‹ä½¿ç”¨redisçš„apiäº†12&gt; cd /usr/local/bin &amp;&amp; redis-cli127.0.0.1:6379&gt; å…¨å±€apiæŸ¥è¯¢é”®123456127.0.0.1:6379&gt; keys *1) &quot;wclimb&quot;2) &quot;key&quot;3) &quot;me&quot;4) &quot;user&quot;5) &quot;user1&quot; é”®çš„æ€»æ•°12127.0.0.1:6379&gt; dbsize (integer) 5 æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨å­˜åœ¨è¿”å› 1 ï¼Œä¸å­˜åœ¨è¿”å› 01234127.0.0.1:6379&gt; exists wclimb (integer) 1127.0.0.1:6379&gt; exists wclimb1 (integer) 0 åˆ é™¤é”®è¿”å›ç»“æœä¸ºæˆåŠŸåˆ é™¤é”®çš„ä¸ªæ•°12127.0.0.1:6379&gt; del user1 (integer) 1 é”®è¿‡æœŸexpire key seconds å½“è¶…è¿‡è¿‡æœŸæ—¶é—´ï¼Œä¼šè‡ªåŠ¨åˆ é™¤ï¼Œkeyåœ¨secondsç§’åè¿‡æœŸexpireat key timestamp é”®åœ¨ç§’çº§æ—¶é—´æˆ³timestampåè¿‡æœŸpexpire key milliseconds å½“è¶…è¿‡è¿‡æœŸæ—¶é—´ï¼Œä¼šè‡ªåŠ¨åˆ é™¤ï¼Œkeyåœ¨millisecondsæ¯«ç§’åè¿‡æœŸpexpireat key milliseconds-timestamp keyåœ¨æ¯«ç§’çº§æ—¶é—´æˆ³timestampåè¿‡æœŸ 12127.0.0.1:6379&gt; expire user 10 // 10ç§’åuserä¼šè¢«åˆ é™¤(integer) 1 randomkey éšæœºè¿”å›ä¸€ä¸ªé”®1234127.0.0.1:6379&gt; randomkey &quot;wclimb&quot;127.0.0.1:6379&gt; randomkey &quot;me&quot; redis é”®ï¼ˆkeyï¼‰123456set key value [ex] [px] [nx|xx]exä¸ºé”®å€¼è®¾ç½®ç§’çº§è¿‡æœŸæ—¶é—´pxä¸ºé”®å€¼è®¾ç½®æ¯«ç§’çº§è¿‡æœŸæ—¶é—´nxé”®å¿…é¡»ä¸å­˜åœ¨ï¼Œæ‰å¯ä»¥è®¾ç½®æˆåŠŸï¼Œç”¨äºæ·»åŠ xxä¸nxç›¸åï¼Œé”®å¿…é¡»å­˜åœ¨ï¼Œæ‰å¯ä»¥è®¾ç½®æˆåŠŸï¼Œç”¨äºæ›´æ–°setnxã€setex ä¸ä¸Šé¢çš„nxã€exä½œç”¨ç›¸åŒ è®¾ç½®key(O(1))1234567127.0.0.1:6379&gt; set name 25 OK127.0.0.1:6379&gt; keys * 1) &quot;wclimb&quot;2) &quot;key&quot;3) &quot;me&quot;4) &quot;name&quot; è·å–key(O(1))12127.0.0.1:6379&gt; get name &quot;25&quot; æ‰¹é‡è®¾ç½®keymset key value [key value â€¦â€¦] 1234127.0.0.1:6379&gt; mset test1 1 test2 2OK127.0.0.1:6379&gt; get test2&quot;2&quot; è¿½åŠ å€¼(O(1))1234127.0.0.1:6379&gt; append test2 apend(integer) 6127.0.0.1:6379&gt; get test2 &quot;2apend&quot; å­—ç¬¦ä¸²é•¿åº¦12127.0.0.1:6379&gt; strlen test2(integer) 6 å“ˆå¸Œï¼ˆhashï¼‰HGET KEY_NAME FIELD_NAMEç±»ä¼¼javscripté‡Œçš„å¯¹è±¡ {} è®¾ç½®hash12127.0.0.1:6379&gt; HMSET hash name wclimb age 25OK è·å–hash12127.0.0.1:6379&gt; hmget hash name1) &quot;wclimb&quot; åˆ é™¤hashhdel key field [field â€¦â€¦] ä¼šåˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªfieldï¼Œè¿”å›ç»“æœä¸ºæˆåŠŸåˆ é™¤fielçš„ä¸ªæ•° 1234127.0.0.1:6379&gt; hdel hash name(integer) 1127.0.0.1:6379&gt; hmget hash name // å†è·å–å°±è¿”å›nil1) (nil) è·å–æ‰€æœ‰field12345678127.0.0.1:6379&gt; hkeys hash1) &quot;age&quot;127.0.0.1:6379&gt; HMSET hash name wclimb from jiangxiOK127.0.0.1:6379&gt; hkeys hash1) &quot;age&quot;2) &quot;name&quot;3) &quot;from&quot; è·å–æ‰€æœ‰value1234127.0.0.1:6379&gt; hvals hash1) &quot;25&quot;2) &quot;wclimb&quot;3) &quot;jiangxi&quot; åˆ—è¡¨ï¼ˆlistï¼‰ æ“ä½œç±»å‹ æ“ä½œ æ·»åŠ  rpush ã€lpushã€linsert æŸ¥ lrangeã€lindexã€llen åˆ é™¤ lpop ã€rpopã€ lremã€ltrim ä¿®æ”¹ lset é˜»å¡æ“ä½œ blpopã€brpop æ·»åŠ ï¼ˆ1ï¼‰ä»å·¦è¾¹æ’å…¥å…ƒç´ lpush key value [valueâ€¦â€¦]12127.0.0.1:6379&gt; LPUSH list redis(integer) 1 ï¼ˆ1ï¼‰ä»å³è¾¹æ’å…¥å…ƒç´ rpush key value [valueâ€¦â€¦]12127.0.0.1:6379&gt; RPUSH list test(integer) 2 æŸ¥æ‰¾lrange key start end ç´¢å¼•ä¸‹æ ‡ä»å·¦åˆ°å³åˆ†åˆ«æ˜¯0åˆ°N-1ï¼Œä»å³åˆ°å·¦åˆ†åˆ«æ˜¯-1åˆ°-Nï¼›endé€‰é¡¹åŒ…å«äº†è‡ªèº«lrange key 0 -1 å¯ä»¥ä»å·¦åˆ°å³è·å–åˆ—è¡¨çš„æ‰€æœ‰å…ƒç´ lrange mylist 1 3 è·å–åˆ—è¡¨ä¸­ç¬¬2ä¸ªåˆ°ç¬¬4ä¸ªå…ƒç´  123127.0.0.1:6379&gt; lrange list 0 11) &quot;redis&quot;2) &quot;test&quot; é•¿åº¦12127.0.0.1:6379&gt; llen key(integer) 2 åˆ é™¤æˆ‘ä»¬å…ˆæ·»åŠ å‡ ä¸ª 12127.0.0.1:6379&gt; LPUSH list a b c(integer) 5 ï¼ˆ1ï¼‰ä»åˆ—è¡¨å³ä¾§å¼¹å‡ºå…ƒç´  rpop key ï¼ˆ2ï¼‰ä»åˆ—è¡¨å·¦ä¾§å¼¹å‡ºå…ƒç´  lpop key å…ˆçœ‹çœ‹ç°åœ¨çš„åˆ—è¡¨123456127.0.0.1:6379&gt; lrange list 0 -11) &quot;c&quot;2) &quot;b&quot;3) &quot;a&quot;4) &quot;redis&quot;5) &quot;test&quot; åˆ é™¤12127.0.0.1:6379&gt; rpop list &quot;test&quot; æˆ‘ä»¬å‘ç°testè¢«åˆ é™¤äº†ï¼Œç°åœ¨çœ‹çœ‹æˆ‘ä»¬çš„åˆ—è¡¨12345127.0.0.1:6379&gt; lrange list 0 -11) &quot;c&quot;2) &quot;b&quot;3) &quot;a&quot;4) &quot;redis&quot; ä¿®æ”¹lset key index newValue ä¿®æ”¹æŒ‡å®šç´¢å¼•ä¸‹æ ‡çš„å…ƒç´  1234567127.0.0.1:6379&gt; lset list 0 newValueOK127.0.0.1:6379&gt; lrange list 0 -11) &quot;newValue&quot;2) &quot;b&quot;3) &quot;a&quot;4) &quot;redis&quot; ç¬¬0ä¸ªä¸‹æ ‡çš„å…ƒç´ è¢«æ›¿æ¢æˆæœ€æ–°çš„å€¼ ä½¿ç”¨nodeè¿æ¥redis1234&gt; npm init&gt; cnpm i reids -S&gt; touch index.js&gt; vim index.js è¿æ¥redisredis npmåŒ…é“¾æ¥ https://www.npmjs.com/package/redis 123456var redis = require('redis');var client = redis.createClient(6379, '127.0.0.1');client.on('error', function(err) &#123; console.log('Error ' + err);&#125;); è®¾ç½®è·å–key123456client.set('user', JSON.stringify(&#123; name: 'wclimb', age: '18' &#125;), redis.print);client.get('user', function(err, value) &#123; if (err) throw err; console.log('Got: ' + value); client.quit();&#125;); æ§åˆ¶å°æ‰“å° 123&gt; node index.jsReply: OKGot: &#123;&quot;name&quot;:&quot;wclimb&quot;,&quot;age&quot;:&quot;18&quot;&#125; è®¾ç½®è·å–hash1234client.hmset("hosts", "mjr", "1", "another", "23", "home", "1234");client.hgetall("hosts", function (err, obj) &#123; console.dir(obj);&#125;); æ§åˆ¶å°æ‰“å°12&gt; node index.js&#123; mjr: &apos;1&apos;, another: &apos;23&apos;, home: &apos;1234&apos; &#125; è®¾ç½®è·å–list12client.LPUSH('list', [1, 2, 3, 4], redis.print);client.lrange('list', '0', '-1', redis.print); æ§åˆ¶å°æ‰“å°123&gt; node index.jsReply: 8Reply: 4,3,2,1,newValue,b,a,redis åŸºæœ¬ç”¨æ³•å’Œä¸Šé¢è®²çš„éƒ½å·®ä¸å¤šï¼Œç›´æ¥ä¸Šå»ä¸€é¡¿å†™å°±å®Œäº‹äº†ï¼Œå®Œå…¨å¯ä»¥ä¸å¸¦è„‘å­çš„ä½¿ç”¨å„ç§api]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>æ•™ç¨‹</tag>
        <tag>Node</tag>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaScriptä¹‹å®ç°ä¸€ä¸ªç®€å•çš„Vue]]></title>
    <url>%2F2018%2F09%2F11%2FJavaScript%E4%B9%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84Vue%2F</url>
    <content type="text"><![CDATA[è¡¥å……ï¼šå†™ä¸€ä¸ªè¾ƒä¸ºå¼ºå¤§çš„Vueï¼Œæ”¯æŒè™šæ‹ŸDOMã€diffæ›´æ–°ä»¥åŠåŸºæœ¬çš„APIï¼Œé¡¹ç›®åœ°å€ï¼šhttps://github.com/wclimb/euv vueçš„ä½¿ç”¨ç›¸ä¿¡å¤§å®¶éƒ½å¾ˆç†Ÿç»ƒäº†ï¼Œä½¿ç”¨èµ·æ¥ç®€å•ã€‚ä½†æ˜¯å¤§éƒ¨åˆ†äººä¸çŸ¥é“å…¶å†…éƒ¨çš„åŸç†æ˜¯æ€ä¹ˆæ ·çš„ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥ä¸€èµ·å®ç°ä¸€ä¸ªç®€å•çš„vue Object.defineProperty()å®ç°ä¹‹å‰æˆ‘ä»¬å¾—å…ˆçœ‹ä¸€ä¸‹Object.definePropertyçš„å®ç°ï¼Œå› ä¸ºvueä¸»è¦æ˜¯é€šè¿‡æ•°æ®åŠ«æŒæ¥å®ç°çš„ï¼Œé€šè¿‡getã€setæ¥å®Œæˆæ•°æ®çš„è¯»å–å’Œæ›´æ–°ã€‚ 1234567891011121314151617181920var obj = &#123;name:'wclimb'&#125;var age = 24Object.defineProperty(obj,'age',&#123; enumerable: true, // å¯æšä¸¾ configurable: false, // ä¸èƒ½å†define get () &#123; return age &#125;, set (newVal) &#123; console.log('æˆ‘æ”¹å˜äº†',age +' -&gt; '+newVal); age = newVal &#125;&#125;)&gt; obj.age&gt; 24&gt; obj.age = 25;&gt; æˆ‘æ”¹å˜äº† 24 -&gt; 25&gt; 25 ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°é€šè¿‡getè·å–æ•°æ®ï¼Œé€šè¿‡setç›‘å¬åˆ°æ•°æ®å˜åŒ–æ‰§è¡Œç›¸åº”æ“ä½œï¼Œè¿˜æ˜¯ä¸æ˜ç™½çš„è¯å¯ä»¥å»çœ‹çœ‹Object.definePropertyæ–‡æ¡£ã€‚ æµç¨‹å›¾ htmlä»£ç ç»“æ„1234567&lt;div id=&quot;wrap&quot;&gt; &lt;p v-html=&quot;test&quot;&gt;&lt;/p&gt; &lt;input type=&quot;text&quot; v-model=&quot;form&quot;&gt; &lt;input type=&quot;text&quot; v-model=&quot;form&quot;&gt; &lt;button @click=&quot;changeValue&quot;&gt;æ”¹å˜å€¼&lt;/button&gt; &#123;&#123;form&#125;&#125;&lt;/div&gt; jsè°ƒç”¨12345678910111213new Vue(&#123; el: '#wrap', data:&#123; form: 'è¿™æ˜¯formçš„å€¼', test: '&lt;strong&gt;æˆ‘æ˜¯ç²—ä½“&lt;/strong&gt;', &#125;, methods:&#123; changeValue()&#123; console.log(this.form) this.form = 'å€¼è¢«æˆ‘æ”¹å˜äº†ï¼Œæ°”ä¸æ°”ï¼Ÿ' &#125; &#125;&#125;) Vueç»“æ„1234567891011class Vue&#123; constructor()&#123;&#125; proxyData()&#123;&#125; observer()&#123;&#125; compile()&#123;&#125; compileText()&#123;&#125;&#125;class Watcher&#123; constructor()&#123;&#125; update()&#123;&#125;&#125; Vue constructor æ„é€ å‡½æ•°ä¸»è¦æ˜¯æ•°æ®çš„åˆå§‹åŒ– proxyData æ•°æ®ä»£ç† observer åŠ«æŒç›‘å¬æ‰€æœ‰æ•°æ® compile è§£ædom compileText è§£ædomé‡Œå¤„ç†çº¯åŒèŠ±æ‹¬å·çš„æ“ä½œ Watcher æ›´æ–°è§†å›¾æ“ä½œ Vue constructor åˆå§‹åŒ–1234567891011121314class Vue&#123; constructor(options = &#123;&#125;)&#123; this.$el = document.querySelector(options.el); let data = this.data = options.data; // ä»£ç†dataï¼Œä½¿å…¶èƒ½ç›´æ¥this.xxxçš„æ–¹å¼è®¿é—®dataï¼Œæ­£å¸¸çš„è¯éœ€è¦this.data.xxx Object.keys(data).forEach((key)=&gt; &#123; this.proxyData(key); &#125;); this.methods = options.methods // äº‹ä»¶æ–¹æ³• this.watcherTask = &#123;&#125;; // éœ€è¦ç›‘å¬çš„ä»»åŠ¡åˆ—è¡¨ this.observer(data); // åˆå§‹åŒ–åŠ«æŒç›‘å¬æ‰€æœ‰æ•°æ® this.compile(this.$el); // è§£ædom &#125;&#125; ä¸Šé¢ä¸»è¦æ˜¯åˆå§‹åŒ–æ“ä½œï¼Œé’ˆå¯¹ä¼ è¿‡æ¥çš„æ•°æ®è¿›è¡Œå¤„ç† proxyData ä»£ç†data123456789101112131415161718class Vue&#123; constructor(options = &#123;&#125;)&#123; ...... &#125; proxyData(key)&#123; let that = this; Object.defineProperty(that, key, &#123; configurable: false, enumerable: true, get () &#123; return that.data[key]; &#125;, set (newVal) &#123; that.data[key] = newVal; &#125; &#125;); &#125; &#125; ä¸Šé¢ä¸»è¦æ˜¯ä»£ç†dataåˆ°æœ€ä¸Šå±‚ï¼Œthis.xxxçš„æ–¹å¼ç›´æ¥è®¿é—®data observer åŠ«æŒç›‘å¬123456789101112131415161718192021222324252627282930class Vue&#123; constructor(options = &#123;&#125;)&#123; ...... &#125; proxyData(key)&#123; ...... &#125; observer(data)&#123; let that = this Object.keys(data).forEach(key=&gt;&#123; let value = data[key] this.watcherTask[key] = [] Object.defineProperty(data,key,&#123; configurable: false, enumerable: true, get()&#123; return value &#125;, set(newValue)&#123; if(newValue !== value)&#123; value = newValue that.watcherTask[key].forEach(task =&gt; &#123; task.update() &#125;) &#125; &#125; &#125;) &#125;) &#125; &#125; åŒæ ·æ˜¯ä½¿ç”¨Object.definePropertyæ¥ç›‘å¬æ•°æ®ï¼Œåˆå§‹åŒ–éœ€è¦è®¢é˜…çš„æ•°æ®ã€‚æŠŠéœ€è¦è®¢é˜…çš„æ•°æ®åˆ°pushåˆ°watcherTaské‡Œï¼Œç­‰åˆ°æ—¶å€™éœ€è¦æ›´æ–°çš„æ—¶å€™å°±å¯ä»¥æ‰¹é‡æ›´æ–°æ•°æ®äº†ã€‚ğŸ‘‡ä¸‹é¢å°±æ˜¯ï¼›éå†è®¢é˜…æ± ï¼Œæ‰¹é‡æ›´æ–°è§†å›¾ã€‚123456789set(newValue)&#123; if(newValue !== value)&#123; value = newValue // æ‰¹é‡æ›´æ–°è§†å›¾ that.watcherTask[key].forEach(task =&gt; &#123; task.update() &#125;) &#125;&#125; compile è§£ædom12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667class Vue&#123; constructor(options = &#123;&#125;)&#123; ...... &#125; proxyData(key)&#123; ...... &#125; observer(data)&#123; ...... &#125; compile(el)&#123; var nodes = el.childNodes; for (let i = 0; i &lt; nodes.length; i++) &#123; const node = nodes[i]; if(node.nodeType === 3)&#123; var text = node.textContent.trim(); if (!text) continue; this.compileText(node,'textContent') &#125;else if(node.nodeType === 1)&#123; if(node.childNodes.length &gt; 0)&#123; this.compile(node) &#125; if(node.hasAttribute('v-model') &amp;&amp; (node.tagName === 'INPUT' || node.tagName === 'TEXTAREA'))&#123; node.addEventListener('input',(()=&gt;&#123; let attrVal = node.getAttribute('v-model') this.watcherTask[attrVal].push(new Watcher(node,this,attrVal,'value')) node.removeAttribute('v-model') return () =&gt; &#123; this.data[attrVal] = node.value &#125; &#125;)()) &#125; if(node.hasAttribute('v-html'))&#123; let attrVal = node.getAttribute('v-html'); this.watcherTask[attrVal].push(new Watcher(node,this,attrVal,'innerHTML')) node.removeAttribute('v-html') &#125; this.compileText(node,'innerHTML') if(node.hasAttribute('@click'))&#123; let attrVal = node.getAttribute('@click') node.removeAttribute('@click') node.addEventListener('click',e =&gt; &#123; this.methods[attrVal] &amp;&amp; this.methods[attrVal].bind(this)() &#125;) &#125; &#125; &#125; &#125;, compileText(node,type)&#123; let reg = /\&#123;\&#123;(.*?)\&#125;\&#125;/g, txt = node.textContent; if(reg.test(txt))&#123; node.textContent = txt.replace(reg,(matched,value)=&gt;&#123; let tpl = this.watcherTask[value] || [] tpl.push(new Watcher(node,this,value,type)) if(value.split('.').length &gt; 1)&#123; let v = null value.split('.').forEach((val,i)=&gt;&#123; v = !v ? this[val] : v[val] &#125;) return v &#125;else&#123; return this[value] &#125; &#125;) &#125; &#125; &#125; è¿™é‡Œä»£ç æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬æ‹†åˆ†çœ‹ä½ å°±ä¼šè§‰å¾—å¾ˆç®€å•äº† é¦–å…ˆæˆ‘ä»¬å…ˆéå†elå…ƒç´ ä¸‹é¢çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œnode.nodeType === 3 çš„æ„æ€æ˜¯å½“å‰å…ƒç´ æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œnode.nodeType === 1 çš„æ„æ€æ˜¯å½“å‰å…ƒç´ æ˜¯å…ƒç´ èŠ‚ç‚¹ã€‚å› ä¸ºå¯èƒ½æœ‰çš„æ˜¯çº¯æ–‡æœ¬çš„å½¢å¼ï¼Œå¦‚çº¯åŒèŠ±æ‹¬å·å°±æ˜¯çº¯æ–‡æœ¬çš„æ–‡æœ¬èŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡åˆ¤æ–­å…ƒç´ èŠ‚ç‚¹æ˜¯å¦è¿˜å­˜åœ¨å­èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰çš„è¯å°±é€’å½’è°ƒç”¨compileæ–¹æ³•ã€‚ä¸‹é¢é‡å¤´æˆæ¥äº†ï¼Œæˆ‘ä»¬æ‹†å¼€çœ‹ï¼š12345if(node.hasAttribute('v-html'))&#123; let attrVal = node.getAttribute('v-html'); this.watcherTask[attrVal].push(new Watcher(node,this,attrVal,'innerHTML')) node.removeAttribute('v-html')&#125; ä¸Šé¢è¿™ä¸ªé¦–å…ˆåˆ¤æ–­nodeèŠ‚ç‚¹ä¸Šæ˜¯å¦æœ‰v-htmlè¿™ç§æŒ‡ä»¤ï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œæˆ‘ä»¬å°±å‘å¸ƒè®¢é˜…ï¼Œæ€ä¹ˆå‘å¸ƒè®¢é˜…å‘¢ï¼Ÿåªéœ€è¦æŠŠå½“å‰éœ€è¦è®¢é˜…çš„æ•°æ®pushåˆ°watcherTaské‡Œé¢ï¼Œç„¶ååˆ°æ—¶å€™åœ¨è®¾ç½®å€¼çš„æ—¶å€™å°±å¯ä»¥æ‰¹é‡æ›´æ–°äº†ï¼Œå®ç°åŒå‘æ•°æ®ç»‘å®šï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„æ“ä½œ123that.watcherTask[key].forEach(task =&gt; &#123; task.update()&#125;) ç„¶åpushçš„å€¼æ˜¯ä¸€ä¸ªWatcherçš„å®ä¾‹ï¼Œé¦–å…ˆä»–newçš„æ—¶å€™ä¼šå…ˆæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰§è¡Œçš„æ“ä½œå°±æ˜¯å»æŠŠçº¯åŒèŠ±æ‹¬å· -&gt; 1ï¼Œä¹Ÿå°±æ˜¯è¯´æŠŠæˆ‘ä»¬å†™å¥½çš„æ¨¡æ¿æ•°æ®æ›´æ–°åˆ°æ¨¡æ¿è§†å›¾ä¸Šã€‚æœ€åæŠŠå½“å‰å…ƒç´ å±æ€§å‰”é™¤å‡ºå»ï¼Œæˆ‘ä»¬ç”¨Vueçš„æ—¶å€™ä¹Ÿæ˜¯çœ‹ä¸åˆ°è¿™ç§æŒ‡ä»¤çš„ï¼Œä¸å‰”é™¤ä¹Ÿä¸å½±å“ è‡³äºWatcheræ˜¯ä»€ä¹ˆï¼Œçœ‹ä¸‹é¢å°±çŸ¥é“äº† Watcher123456789101112class Watcher&#123; constructor(el,vm,value,type)&#123; this.el = el; this.vm = vm; this.value = value; this.type = type; this.update() &#125; update()&#123; this.el[this.type] = this.vm.data[this.value] &#125;&#125; ä¹‹å‰å‘å¸ƒè®¢é˜…ä¹‹åèµ°äº†è¿™é‡Œé¢çš„æ“ä½œï¼Œæ„æ€å°±æ˜¯æŠŠå½“å‰å…ƒç´ å¦‚ï¼šnode.innerHTML = â€˜è¿™æ˜¯dataé‡Œé¢çš„å€¼â€™ã€node.value = â€˜è¿™ä¸ªæ˜¯è¡¨å•çš„æ•°æ®â€™ é‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸ç›´æ¥å»æ›´æ–°å‘¢ï¼Œè¿˜éœ€è¦updateåšä»€ä¹ˆï¼Œä¸æ˜¯å¤šæ­¤ä¸€ä¸¾å—ï¼Ÿå…¶å®updateè®°å¾—å—ï¼Ÿæˆ‘ä»¬åœ¨è®¢é˜…æ± é‡Œé¢éœ€è¦æ‰¹é‡æ›´æ–°ï¼Œå°±æ˜¯é€šè¿‡è°ƒç”¨WatcheråŸå‹ä¸Šçš„updateæ–¹æ³•ã€‚ æ•ˆæœåœ¨çº¿æ•ˆæœåœ°å€ï¼Œå¤§å®¶å¯ä»¥æµè§ˆå™¨çœ‹ä¸€ä¸‹æ•ˆæœï¼Œç”±äºæœ¬äººå¤ªæ‡’äº†ï¼Œgifæ•ˆæœå›¾å°±å…ˆä¸æ”¾äº†ï¼Œå“ˆå“ˆğŸ˜„ğŸ˜„ å®Œæ•´ä»£ç å®Œæ•´ä»£ç å·²ç»æ”¾åˆ°githubä¸Šäº† -&gt; MyVue å‚è€ƒå‰–æVueåŸç†&amp;å®ç°åŒå‘ç»‘å®šMVVMä»¿Vueå®ç°æç®€åŒå‘ç»‘å®š QQç¾¤æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥åŠ qqç¾¤: 725165362 ç‚¹å‡»åŠ å…¥]]></content>
      <categories>
        <category>javascript</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaScriptä¹‹Web Worker]]></title>
    <url>%2F2018%2F09%2F10%2FJavaScript%E4%B9%8BWeb-Worker%2F</url>
    <content type="text"><![CDATA[ä»‹ç» Web Workerä¸ºWebå†…å®¹åœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œè„šæœ¬æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•ã€‚çº¿ç¨‹å¯ä»¥æ‰§è¡Œä»»åŠ¡è€Œä¸å¹²æ‰°ç”¨æˆ·ç•Œé¢ã€‚æ­¤å¤–ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨XMLHttpRequestæ‰§è¡Œ I/O (å°½ç®¡responseXMLå’Œchannelå±æ€§æ€»æ˜¯ä¸ºç©º)ã€‚ä¸€æ—¦åˆ›å»ºï¼Œ ä¸€ä¸ªworker å¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°åˆ›å»ºå®ƒçš„JavaScriptä»£ç , é€šè¿‡å°†æ¶ˆæ¯å‘å¸ƒåˆ°è¯¥ä»£ç æŒ‡å®šçš„äº‹ä»¶å¤„ç†ç¨‹åºï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚ Web Workerä½¿ç”¨è¦ç‚¹ åŒæºé™åˆ¶ï¼šåˆ†é…ç»™ Worker çº¿ç¨‹è¿è¡Œçš„è„šæœ¬æ–‡ä»¶ï¼Œå¿…é¡»ä¸ä¸»çº¿ç¨‹çš„è„šæœ¬æ–‡ä»¶åŒæºã€‚ DOM é™åˆ¶ï¼šWorker çº¿ç¨‹æ‰€åœ¨çš„å…¨å±€å¯¹è±¡ï¼Œä¸ä¸»çº¿ç¨‹ä¸ä¸€æ ·ï¼Œæ— æ³•è¯»å–ä¸»çº¿ç¨‹æ‰€åœ¨ç½‘é¡µçš„ DOM å¯¹è±¡ï¼Œä¹Ÿæ— æ³•ä½¿ç”¨documentã€windowã€parentè¿™äº›å¯¹è±¡ã€‚ä½†æ˜¯ï¼ŒWorker çº¿ç¨‹å¯ä»¥navigatorå¯¹è±¡å’Œlocationå¯¹è±¡ã€‚ é€šä¿¡è”ç³»ï¼šWorker çº¿ç¨‹å’Œä¸»çº¿ç¨‹ä¸åœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå®ƒä»¬ä¸èƒ½ç›´æ¥é€šä¿¡ï¼Œå¿…é¡»é€šè¿‡æ¶ˆæ¯å®Œæˆã€‚ è„šæœ¬é™åˆ¶ï¼šWorker çº¿ç¨‹ä¸èƒ½æ‰§è¡Œalert()æ–¹æ³•å’Œconfirm()æ–¹æ³•ï¼Œä½†å¯ä»¥ä½¿ç”¨ XMLHttpRequest å¯¹è±¡å‘å‡º AJAX è¯·æ±‚ã€‚ æ–‡ä»¶é™åˆ¶ï¼šWorker çº¿ç¨‹æ— æ³•è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œå³ä¸èƒ½æ‰“å¼€æœ¬æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆfile://ï¼‰ï¼Œå®ƒæ‰€åŠ è½½çš„è„šæœ¬ï¼Œå¿…é¡»æ¥è‡ªç½‘ç»œã€‚åé¢æˆ‘ä»¬å…è®¸ä¼šåšå¤„ç†ã€‚ å®‰è£…http-serverWorker çº¿ç¨‹æ— æ³•è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œå³ä¸èƒ½æ‰“å¼€æœ¬æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆfile://ï¼‰ï¼Œå®ƒæ‰€åŠ è½½çš„è„šæœ¬ï¼Œå¿…é¡»æ¥è‡ªç½‘ç»œã€‚æ‰€ä»¥æˆ‘ä»¬å¾—èµ·ä¸€ä¸ªé¡¹ç›®ã€‚ä½¿ç”¨http-serveræœ€ç®€å•å®‰è£…ï¼š1&gt; cnpm i -g http-server ä½¿ç”¨ï¼š1&gt; http-server åŸºæœ¬ä½¿ç”¨æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹åå«workerï¼Œé‡Œé¢æ–°å»ºä¸‰ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜¯123index.htmlmain.jsworker.js æ–°å»ºä¸€ä¸ªworkerçº¿ç¨‹å¾ˆç®€å•ï¼Œåªéœ€ï¼š 1var worker = new Worker(&apos;worker.js&apos;) main.js:12345678910var worker = new Worker('./worker.js')console.log('worker running')worker.addEventListener('message',e =&gt; &#123; console.log('main: ', e.data);&#125;)// ä¹Ÿå¯ä½¿ç”¨ï¼š// worker.onmessage = (e)=&gt;&#123;// console.log('main: ', e.data);// &#125;worker.postMessage('hello worker,I am from main.js') worker.js:123456console.log('worker task running')onmessage = (e)=&gt;&#123; console.log('worker task receive', e.data); // å‘é€æ•°æ®äº‹ä»¶ postMessage('Hello, I am from Worker.js');&#125; åœ¨workeræ–‡ä»¶å¤¹ä¸‹ï¼Œå‘½ä»¤è¡Œè¾“å…¥http-server,å¯åŠ¨é¡¹ç›®ï¼Œç”¨æµè§ˆå™¨æ‰“å¼€ï¼Œçœ‹æ§åˆ¶å°ï¼š1234worker runningworker task runningworker task receive hello worker,I am from main.jsmain: Hello, I am from Worker.js ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œworkeré€šè¿‡onmessageæ¥ç›‘å¬æ•°æ®ï¼Œé€šè¿‡postMessgaeæ¥å‘é€æ•°æ® ç»ˆæ­¢ worker1worker.terminate(); å¤„ç†é”™è¯¯123worker.addEventListener(&apos;error&apos;, (e) =&gt; &#123; console.log(&apos;main error&apos;, &apos;filename:&apos; + e.filename + &apos;message:&apos; + e.message + &apos;lineno:&apos; + e.lineno;&#125;); event.filename: å¯¼è‡´é”™è¯¯çš„ Worker è„šæœ¬çš„åç§°ï¼› event.message: é”™è¯¯çš„ä¿¡æ¯ï¼› event.lineno: å‡ºç°é”™è¯¯çš„è¡Œå·ï¼› åŠ è½½å¤–éƒ¨è„šæœ¬main.js1var worker = new Worker('./worker1.js'); worker1.js12345console.log("I'm worker1")importScripts('worker2.js', 'worker3.js');// æˆ–è€…// importScripts('worker2.js');// importScripts('worker3.js'); worker2.js1console.log("I'm worker2") worker3.js1console.log("I'm worker3") å…¼å®¹æ€§https://caniuse.com/#feat=webworkerså…¼å®¹æ€§è¿˜ä¸æ˜¯å¾ˆä¹è§‚ï¼Œä¸è¿‡åœ¨ç§»åŠ¨ç«¯çš„å…¼å®¹æ€§è¿˜ä¸é”™ å‚è€ƒä½¿ç”¨ Web WorkersWeb Worker ä½¿ç”¨æ•™ç¨‹]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaScriptä¹‹å®ç°ä¸€ä¸ªç®€å•çš„promise]]></title>
    <url>%2F2018%2F09%2F09%2FJavaScript%E4%B9%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84promise%2F</url>
    <content type="text"><![CDATA[æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¤§å¤šä¼šç”¨åˆ°promiseï¼Œæƒ³å¿…å¤§å®¶å¯¹promiseçš„ä½¿ç”¨éƒ½å¾ˆç†Ÿç»ƒäº†ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥å®ç°ä¸€ä¸ªç®€å•çš„promiseï¼Œå®ç°çš„æ•ˆæœå¦‚æœ‰å‡ºå…¥è¿˜å¾€æŒ‡æ­£ã€‚ æ•´ä½“ç»“æ„æˆ‘ä»¬å…ˆæ¥æ¢³ç†ä¸€ä¸‹æ•´ä½“çš„ç»“æœï¼Œä»¥ä¾¿åç»­å¥½æ“ä½œ 1234567891011121314151617class MyPromise &#123; constructor(fn)&#123; &#125; resolve()&#123; &#125; then()&#123; &#125; reject()&#123; &#125; catch()&#123; &#125;&#125; Promiseç†è®ºçŸ¥è¯† æ‘˜æŠ„è‡³ http://es6.ruanyifeng.com/#docs/promise#Promise-all Promiseå¯¹è±¡æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹ã€‚ ï¼ˆ1ï¼‰å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€‚Promiseå¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼špendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€fulfilledï¼ˆå·²æˆåŠŸï¼‰å’Œrejectedï¼ˆå·²å¤±è´¥ï¼‰ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™ä¹Ÿæ˜¯Promiseè¿™ä¸ªåå­—çš„ç”±æ¥ï¼Œå®ƒçš„è‹±è¯­æ„æ€å°±æ˜¯â€œæ‰¿è¯ºâ€ï¼Œè¡¨ç¤ºå…¶ä»–æ‰‹æ®µæ— æ³•æ”¹å˜ã€‚ ï¼ˆ2ï¼‰ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœã€‚Promiseå¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼šä»pendingå˜ä¸ºfulfilledå’Œä»pendingå˜ä¸ºrejectedã€‚åªè¦è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼ŒçŠ¶æ€å°±å‡å›ºäº†ï¼Œä¸ä¼šå†å˜äº†ï¼Œä¼šä¸€ç›´ä¿æŒè¿™ä¸ªç»“æœï¼Œè¿™æ—¶å°±ç§°ä¸º resolvedï¼ˆå·²å®šå‹ï¼‰ã€‚å¦‚æœæ”¹å˜å·²ç»å‘ç”Ÿäº†ï¼Œä½ å†å¯¹Promiseå¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚è¿™ä¸äº‹ä»¶ï¼ˆEventï¼‰å®Œå…¨ä¸åŒï¼Œäº‹ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼Œå¦‚æœä½ é”™è¿‡äº†å®ƒï¼Œå†å»ç›‘å¬ï¼Œæ˜¯å¾—ä¸åˆ°ç»“æœçš„ã€‚ æ€»ç»“ä¸€ä¸‹å°±æ˜¯promiseæœ‰ä¸‰ç§çŠ¶æ€ï¼špendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€fulfilledï¼ˆå·²æˆåŠŸï¼‰å’Œrejectedï¼ˆå·²å¤±è´¥ï¼‰ï¼Œè¿˜æœ‰å°±æ˜¯çŠ¶æ€çš„æ”¹å˜åªèƒ½æ˜¯pending -&gt; fulfilled æˆ–è€… pending -&gt; rejectedï¼Œè¿™äº›å¾ˆé‡è¦ å®ç°æ„é€ å‡½æ•°ç°åœ¨æˆ‘ä»¬å¼€å§‹å®ç°æ„é€ å‡½æ•° 1234567891011class MyPromise &#123; constructor(fn)&#123; if(typeof fn !== 'function') &#123; throw new TypeError(`MyPromise fn $&#123;fn&#125; is not a function`) &#125; this.state = 'pending'; this.value = void 0; fn(this.resolve.bind(this),this.reject.bind(this)) &#125; ...&#125; æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°fnï¼Œä¸”è¿™ä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬ä¸€èˆ¬è¿™æ ·ä½¿ç”¨new Promise((resolve,reject)=&gt;{});ç„¶ååˆå§‹åŒ–ä¸€ä¸‹promiseçš„çŠ¶æ€ï¼Œé»˜è®¤å¼€å§‹ä¸ºpendingï¼Œåˆå§‹åŒ–valueçš„å€¼ã€‚fnæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œresolveã€reject resolve12345678910111213141516class MyPromise &#123; constructor(fn)&#123; if(typeof fn !== 'function') &#123; throw new TypeError(`MyPromise fn $&#123;fn&#125; is not a function`) &#125; this.state = 'pending'; this.value = void 0; fn(this.resolve.bind(this),this.reject.bind(this)) &#125; resolve(value)&#123; if(this.state !== 'pending') return; this.state = 'fulfilled'; this.value = value &#125; ...&#125; å½“resolveæ‰§è¡Œï¼Œæ¥æ”¶åˆ°ä¸€ä¸ªå€¼ä¹‹åï¼›çŠ¶æ€å°±ç”± pending -&gt; fulfilledï¼›å½“å‰çš„å€¼ä¸ºæ¥æ”¶çš„å€¼ reject1234567891011121314151617181920class MyPromise &#123; constructor(fn)&#123; if(typeof fn !== 'function') &#123; throw new TypeError(`MyPromise fn $&#123;fn&#125; is not a function`) &#125; this.state = 'pending'; this.value = void 0; fn(this.resolve.bind(this),this.reject.bind(this)) &#125; resolve(value)&#123; if(this.state !== 'pending') return; this.state = 'fulfilled'; this.value = value &#125; reject(reason)&#123; if(this.state !== 'pending') return; this.state = 'rejected'; this.value = reason &#125;&#125; å½“rejectæ‰§è¡Œï¼Œæ¥æ”¶åˆ°ä¸€ä¸ªå€¼ä¹‹åï¼›çŠ¶æ€å°±ç”± pending -&gt; rejectedï¼›å½“å‰çš„å€¼ä¸ºæ¥æ”¶çš„å€¼ then1234567891011121314151617181920212223242526272829303132333435363738394041424344454647class MyPromise &#123; constructor(fn)&#123; if(typeof fn !== 'function') &#123; throw new TypeError(`MyPromise fn $&#123;fn&#125; is not a function`) &#125; this.state = 'pending'; this.value = void 0; fn(this.resolve.bind(this),this.reject.bind(this)) &#125; resolve(value)&#123; if(this.state !== 'pending') return; this.state = 'fulfilled'; this.value = value &#125; reject(reason)&#123; if(this.state !== 'pending') return; this.state = 'rejected'; this.value = reason &#125; then(fulfilled,rejected)&#123; if (typeof fulfilled !== 'function' &amp;&amp; typeof rejected !== 'function' ) &#123; return this; &#125; if (typeof fulfilled !== 'function' &amp;&amp; this.state === 'fulfilled' || typeof rejected !== 'function' &amp;&amp; this.state === 'rejected') &#123; return this; &#125; return new MyPromise((resolve,reject)=&gt;&#123; if(fulfilled &amp;&amp; typeof fulfilled === 'function' &amp;&amp; this.state === 'fulfilled')&#123; let result = fulfilled(this.value); if(result &amp;&amp; typeof result.then === 'function')&#123; return result.then(resolve,reject) &#125;else&#123; resolve(result) &#125; &#125; if(rejected &amp;&amp; typeof rejected === 'function' &amp;&amp; this.state === 'rejected')&#123; let result = rejected(this.value); if(result &amp;&amp; typeof result.then === 'function')&#123; return result.then(resolve,reject) &#125;else&#123; resolve(result) &#125; &#125; &#125;) &#125;&#125; thençš„å®ç°æ¯”è¾ƒå…³é”®ï¼Œé¦–å…ˆæœ‰ä¸¤ä¸ªåˆ¤æ–­ï¼Œç¬¬ä¸€ä¸ªåˆ¤æ–­ä¼ çš„ä¸¤ä¸ªå‚æ•°æ˜¯å¦éƒ½æ˜¯å‡½æ•°ï¼Œå¦‚æœéƒ¨ä¸æ˜¯return thisæ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚ç¬¬äºŒä¸ªåˆ¤æ–­çš„ä½œç”¨æ˜¯ï¼Œæ¯”å¦‚ï¼Œç°åœ¨çŠ¶æ€ä»pending -&gt; rejected;ä½†æ˜¯ä¸­é—´ä»£ç ä¸­æœ‰è®¸å¤šä¸ª.thençš„æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦è·³è¿‡è¿™äº›æ“ä½œæ‰§è¡Œ.catchçš„ä»£ç ã€‚å¦‚ä¸‹é¢çš„ä»£ç ï¼Œæ‰§è¡Œç»“æœåªä¼šæ‰“å°1123456789new Promise((resolve,reject)=&gt;&#123; reject(1)&#125;).then(()=&gt;&#123; console.log(2)&#125;).then(()=&gt;&#123; console.log(3)&#125;).catch((e)=&gt;&#123; console.log(e)&#125;) æˆ‘ä»¬ç»§ç»­ï¼Œæ¥ä¸‹æ¥çœ‹åˆ°çš„æ˜¯è¿”å›äº†ä¸€ä¸ªæ–°çš„promiseï¼ŒçœŸæ­£thençš„å®ç°çš„ç¡®éƒ½æ˜¯è¿”å›ä¸€ä¸ªpromiseå®ä¾‹ã€‚è¿™é‡Œä¸å¤šè¯´ ä¸‹é¢æœ‰ä¸¤ä¸ªåˆ¤æ–­ï¼Œä½œç”¨æ˜¯åˆ¤æ–­æ˜¯rejectedè¿˜æ˜¯fulfilled,é¦–å…ˆçœ‹fulfilledï¼Œå¦‚æœæ˜¯fulfilledçš„è¯ï¼Œé¦–å…ˆæ‰§è¡Œfulfilledå‡½æ•°ï¼Œå¹¶æŠŠå½“å‰çš„valueå€¼ä¼ è¿‡å»ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¿™æ­¥æ“ä½œ,reså°±æ˜¯ä¼ è¿‡å»çš„valueå€¼ï¼Œå¹¶æ‰§è¡Œäº†(res)=&gt;{console.log(res)}è¿™æ®µä»£ç ;æ‰§è¡Œå®Œæˆä¹‹åæˆ‘ä»¬å¾—åˆ°äº†resultï¼›ä¹Ÿå°±æ˜¯2è¿™ä¸ªç»“æœï¼Œä¸‹é¢å°±æ˜¯åˆ¤æ–­å½“å‰ç»“æœæ˜¯å¦æ˜¯ä¸€ä¸ªpromiseå®ä¾‹äº†ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢æ³¨é‡Šäº†çš„æƒ…å†µï¼Œç°åœ¨æˆ‘ä»¬ç›´æ¥æ‰§è¡Œresolve(result);1234567new Promise((resolve,reject)=&gt;&#123; resolve(1)&#125;).then((res)=&gt;&#123; console.log(res) return 2 //return new Promise(resolve=&gt;&#123;&#125;)&#125;) å‰©ä¸‹çš„å°±ä¸å¤šè¯´äº†ï¼Œå¯ä»¥debuggerçœ‹çœ‹æ‰§è¡Œç»“æœ catch123456class MyPromise &#123; ... catch(rejected)&#123; return this.then(null,rejected) &#125;&#125; å®Œæ•´ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950class MyPromise &#123; constructor(fn)&#123; if(typeof fn !== 'function') &#123; throw new TypeError(`MyPromise fn $&#123;fn&#125; is not a function`) &#125; this.state = 'pending'; this.value = void 0; fn(this.resolve.bind(this),this.reject.bind(this)) &#125; resolve(value)&#123; if(this.state !== 'pending') return; this.state = 'fulfilled'; this.value = value &#125; reject(reason)&#123; if(this.state !== 'pending') return; this.state = 'rejected'; this.value = reason &#125; then(fulfilled,rejected)&#123; if (typeof fulfilled !== 'function' &amp;&amp; typeof rejected !== 'function' ) &#123; return this; &#125; if (typeof fulfilled !== 'function' &amp;&amp; this.state === 'fulfilled' || typeof rejected !== 'function' &amp;&amp; this.state === 'rejected') &#123; return this; &#125; return new MyPromise((resolve,reject)=&gt;&#123; if(fulfilled &amp;&amp; typeof fulfilled === 'function' &amp;&amp; this.state === 'fulfilled')&#123; let result = fulfilled(this.value); if(result &amp;&amp; typeof result.then === 'function')&#123; return result.then(resolve,reject) &#125;else&#123; resolve(result) &#125; &#125; if(rejected &amp;&amp; typeof rejected === 'function' &amp;&amp; this.state === 'rejected')&#123; let result = rejected(this.value); if(result &amp;&amp; typeof result.then === 'function')&#123; return result.then(resolve,reject) &#125;else&#123; resolve(result) &#125; &#125; &#125;) &#125; catch(rejected)&#123; return this.then(null,rejected) &#125;&#125; æµ‹è¯•123456789101112131415161718192021222324new MyPromise((resolve,reject)=&gt;&#123; console.log(1); //reject(2) resolve(2) console.log(3) setTimeout(()=&gt;&#123;console.log(4)&#125;,0)&#125;).then(res=&gt;&#123; console.log(res) return new MyPromise((resolve,reject)=&gt;&#123; resolve(5) &#125;).then(res=&gt;&#123; return res &#125;)&#125;).then(res=&gt;&#123; console.log(res)&#125;).catch(e=&gt;&#123; console.log('e',e)&#125;)æ‰§è¡Œç»“æœï¼š&gt; 1&gt; 3&gt; 2&gt; 5&gt; 4 åŸç”Ÿpromise123456789101112131415161718192021222324new Promise((resolve,reject)=&gt;&#123; console.log(1); //reject(2) resolve(2) console.log(3) setTimeout(()=&gt;&#123;console.log(4)&#125;,0)&#125;).then(res=&gt;&#123; console.log(res) return new Promise((resolve,reject)=&gt;&#123; resolve(5) &#125;).then(res=&gt;&#123; return res &#125;)&#125;).then(res=&gt;&#123; console.log(res)&#125;).catch(e=&gt;&#123; console.log('e',e)&#125;)æ‰§è¡Œç»“æœï¼š&gt; 1&gt; 3&gt; 2&gt; 5&gt; 4]]></content>
      <categories>
        <category>javascript</category>
        <category>promise</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavsScriptä¹‹æµ…æ‹·è´ä¸æ·±æ‹·è´]]></title>
    <url>%2F2018%2F07%2F29%2FJavsScript%E4%B9%8B%E6%B5%85%E6%8B%B7%E8%B4%9D%E4%B8%8E%E6%B7%B1%E6%8B%B7%E8%B4%9D%2F</url>
    <content type="text"><![CDATA[åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦å¤åˆ¶ä¸€ä¸ªæ•°æ®ï¼Œåœ¨å¤åˆ¶åŸºæœ¬æ•°æ®ç±»å‹çš„æ—¶å€™ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œå¦‚stringã€numberã€nullç­‰ã€‚ä½†æ˜¯æˆ‘ä»¬å¤åˆ¶ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„æ•°æ®æ—¶ï¼Œå¾€å¾€ä¼šå‡ºç°é—®é¢˜ï¼Œå¦‚arrayã€objectã€‚ æµ…æ‹·è´çœ‹ä¸‹é¢è¿™æ®µä»£ç 123var arr1 = [1,2,3];var arr2 = arr1;arr2.push(4) æˆ‘ä»¬æ‰“å°ä¸€ä¸‹çœ‹çœ‹arr1 arr2çš„ç»“æœ12arr1: [1, 2, 3, 4]arr2: [1, 2, 3, 4] æˆ‘ä»¬å‘ç°ï¼Œæ”¹å˜arr2çš„åŒæ—¶ä¹Ÿæ”¹å˜äº†arr1ï¼ŒWTFï¼Ÿ æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¯¹è±¡12345var obj1 = &#123; name:'wclimb' &#125;;var obj2 = obj1obj2.age = 24 æˆ‘ä»¬æ‰“å°ä¸€ä¸‹çœ‹çœ‹arr1`arr2`çš„ç»“æœ12obj1: &#123;name: "wclimb", age: 24&#125;obj2: &#123;name: "wclimb", age: 24&#125; å’Œé¢„æƒ³çš„ä¸€æ ·ï¼Œéƒ½è¢«å½±å“äº†ã€‚why?å› ä¸ºå¼•ç”¨ç±»å‹çš„å¤åˆ¶ï¼Œä¸¤ä¸ªå¼•ç”¨ç±»å‹çš„æŒ‡é’ˆéƒ½æŒ‡å‘åŒä¸€ä¸ªå †å†…å­˜ ç½‘ä¸Šå¶å°”ä¼šçœ‹åˆ°æœ‰äººè¯´sliceã€concatæ˜¯æ·±æ‹·è´ï¼Œå…¶å®è¿™ä¸¤ä¸ªæ˜¯æµ…å¤åˆ¶ï¼Œå¦‚ä¸‹123var arr1 = [1,2,3];var arr2 = arr1.slice();arr2.push(4) ç»“æœï¼š12arr1 [1, 2, 3]arr2 [1, 2, 3, 4] æ•°ç»„å…ƒç´ åªæ˜¯åŸºæœ¬æ•°æ®ç±»å‹ä¸ä¼šæœ‰å½±å“ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœ‹ä¸‹é¢çš„123var arr1 = [1,2,3,[4]];var arr2 = arr1.slice();arr2[3].push(5) ç»“æœ12arr1: [1,2,3,[4,5]] &lt;----- è¢«å½±å“äº†arr2: [1,2,3,[4,5]] å³ä½¿ä½¿ç”¨äº†slice, ä¸¤ä¸ªæ•°ç»„ä¹Ÿç›¸äº’å½±å“äº†ï¼Œç±»ä¼¼æ–¹æ³•é™¤äº†sliceã€concatè¿˜æœ‰Array.fromã€... æ·±æ‹·è´å’Œæµ…æ‹·è´æœ€æ ¹æœ¬çš„åŒºåˆ«åœ¨äºæ˜¯å¦æ˜¯çœŸæ­£è·å–äº†ä¸€ä¸ªå¯¹è±¡çš„æ‹·è´å®ä½“ï¼Œè€Œä¸æ˜¯å¼•ç”¨ æ·±æ‹·è´Object.assignObject.assignå¯ä»¥è¿›è¡Œä¸€å±‚çš„æ·±åº¦æ‹·è´ï¼Œä¹Ÿå°±æ˜¯è·Ÿsliceç±»å‹çš„æ•ˆæœ1234567891011121314151617181920212223242526var obj1 = &#123; name: 'wclimb', test1: null, test2: undefined, test3: function()&#123;alert(1)&#125;, test4: &#123;&#125; &#125;;var obj2 = Object.assign(&#123;&#125;, obj1)obj2.age = 24ç»“æœï¼šobj1: &#123; name: 'wclimb', test1: null, test2: undefined, test3: function()&#123;alert(1)&#125;, test4: &#123;&#125; &#125;;obj2: &#123; name: 'wclimb', test1: null, test2: undefined, test3: function()&#123;alert(1)&#125;, test4: &#123;&#125;, age: 24 &#125;; ä½†æ˜¯æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä¾‹å­12345678910111213141516171819202122232425262728var obj1 = &#123; name: 'wclimb', test1: null, test2: undefined, test3: function()&#123;alert(1)&#125;, test4: &#123;&#125; &#125;;var obj2 = Object.assign(&#123;&#125;, obj1)obj2.age = 24obj2.test4.val = '1';ç»“æœï¼š obj1: &#123; name: 'wclimb', test1: null, test2: undefined, test3: function()&#123;alert(1)&#125;, test4: &#123;val: 1&#125; &lt;----- è¢«å½±å“äº† &#125;;obj2: &#123; name: 'wclimb', test1: null, test2: undefined, test3: function()&#123;alert(1)&#125;, test4: &#123;val: 1&#125;, age: 24 &#125;; JSON.parse(JSON.stringify(obj))è¯´åˆ°æ·±æ‹·è´ï¼Œä½ ä¸€å®šä¼šæƒ³åˆ°JSON.parse(JSON.stringify(obj));æ²¡é”™ï¼Œè¿™æ ·å¯ä»¥å®Œæˆä¸€ä¸ªæ·±æ‹·è´ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š 12345var obj1 = &#123; name: 'wclimb' &#125;;var obj2 = JSON.parse(JSON.stringify(obj1))obj2.age = 24 ç»“æœ12obj1: &#123;name: "wclimb"&#125; &lt;----- æ²¡æœ‰è¢«å½±å“äº†obj2: &#123;name: "wclimb", age: 24&#125; perfectï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä¸‹ä¾‹ï¼š123456789var var obj1 = &#123; name: 'wclimb', test1: null, test2: undefined, test3: function()&#123;alert(1)&#125;, test4: &#123;&#125; &#125;;var obj2 = JSON.parse(JSON.stringify(obj1))obj2.age = 24 ç»“æœ12345678910111213obj1: &#123; name: 'wclimb', test1: null, test2: undefined, test3: function()&#123;alert(1)&#125;, test4: &#123;&#125; &#125;;obj2: &#123; name: "wclimb", age: 24, test1: null, test4: &#123;&#125; &#125; WTFï¼Œé‚£ä¸¤ä¸ªä¸ªè·‘å“ªå»äº†ï¼Ÿæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¸èƒ½å¤Ÿæ‹·è´å€¼ä¸ºundefinedã€function æ·±æ‹·è´å®ç°é‚£ä¹ˆæ€ä¹ˆè¿›è¡Œæ·±æ‹·è´å‘¢ï¼Ÿæˆ‘çš„æ–¹æ³•æ˜¯ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152function deepCopy(obj)&#123; var result; var toString = Object.prototype.toString if(toString.call(obj) === '[object Array]')&#123; result = [] for(var i = 0 ;i &lt; obj.length; i++)&#123; result[i] = deepCopy(obj[i]) &#125; &#125;else if(toString.call(obj) === '[object Object]')&#123; result = &#123;&#125;; for (var key in obj) &#123; if (obj.hasOwnProperty(key)) &#123; result[key] = deepCopy(obj[key]) &#125; &#125; &#125;else&#123; return obj &#125; return result&#125;æµ‹è¯•ä¸€ä¸‹ï¼švar obj1 = &#123; name: 'wclimb', test1: null, test2: undefined, test3: function()&#123;alert(1)&#125;, test4: &#123;&#125; &#125;;var obj2 = deepCopy(obj1)obj2.age = 24obj2.test4.val = '1';è¿”å›ï¼š obj1: &#123; name: 'wclimb', test1: null, test2: undefined, test3: function()&#123;alert(1)&#125;, test4: &#123;&#125; &lt;----- æ²¡æœ‰è¢«å½±å“äº† &#125;;obj2: &#123; age: 24, name: 'wclimb', test1: null, test2: undefined, test3: function()&#123;alert(1)&#125;, test4: &#123;val: '1'&#125; &#125;; jQueryçš„å®ç°123456789var obj1 = &#123; name: 'wclimb', test1: null, test2: undefined, test3: function()&#123;alert(1)&#125;, test4: &#123;&#125; &#125;;var obj2 = $.extend(true, &#123;&#125;, obj1)obj2.age = 24 lodashçš„å®ç°123456789var obj1 = &#123; name: 'wclimb', test1: null, test2: undefined, test3: function()&#123;alert(1)&#125;, test4: &#123;&#125; &#125;;var obj2 = _.cloneDeep(obj1)obj2.age = 24 GitHubï¼šwclimb ä¸ªäººå°ç¨‹åº]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[nodeé¡¹ç›®æœåŠ¡å™¨éƒ¨ç½²(æ–°æ‰‹æ•™ç¨‹)]]></title>
    <url>%2F2018%2F07%2F28%2Fnode%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2-%E6%96%B0%E6%89%8B%E6%95%99%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[å†™åœ¨å‰é¢ä¹‹å‰åœ¨githubå†™äº†å‡ ä¸ªé¡¹ç›®ï¼Œç„¶åä¸€ç›´æœ‰å¾ˆå¤šäººé—®æˆ‘nodeé¡¹ç›®æ€ä¹ˆéƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œäºæ˜¯ä¹åº”å¤§å®¶è¦æ±‚å°±å†™äº†è¿™ç¯‡æ–‡ç« ï¼Œæ­¤ç¯‡æ•™ç¨‹åªæä¾›ç»™æ–°æ‰‹å€Ÿé‰´ï¼Œå¦‚æœä½ æ˜¯å¤§ä½¬çš„è¯å¯ä»¥ä¸ç”¨å¾€ä¸‹çœ‹äº†ï¼Œæ•™ç¨‹å¤šå°‘æœ‰äº›ç¼ºé™·ï¼Œéƒ½æ˜¯æŒ‰ç…§è‡ªå·±çš„å°è±¡å†™å‡ºæ¥çš„ï¼Œæ‰€ä»¥æœ‰é—®é¢˜è¿˜æœ›æŒ‡æ­£ã€‚ linuxæœåŠ¡å™¨å®‰è£…nodeé¦–å…ˆä¸‹è½½nodeåŒ…1wget https://npm.taobao.org/mirrors/node/latest-v8.x/node-v8.1.0-linux-x64.tar.gz è§£å‹1tar xvf node-v8.1.0-linux-x64.tar.gz 12ln -s ~/node-v8.1.0-linux-x64/bin/node /usr/local/bin/nodeln -s ~/node-v8.1.0-linux-x64/bin/npm /usr/local/bin/npm æœ€ånode -væŸ¥çœ‹nodeç‰ˆæœ¬ï¼Œå¦‚æœå‡ºç°ä»¥ä¸‹å°±è¡¨ç¤ºå®‰è£…æˆåŠŸäº†1v8.1.0 å¦‚æœä½ éœ€è¦å‡çº§nodeç‰ˆæœ¬ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯12sudo npm i -g nn stable å®‰è£…pm2pm2æ˜¯ä¸€ä¸ªè¿›ç¨‹å®ˆæŠ¤å·¥å…·,ç±»ä¼¼çš„è¿˜æœ‰forever 1sudo npm i pm2 -g ç„¶åæ‰§è¡Œï¼Œå¦‚æœä¸æ˜ å°„çš„è¯ï¼Œä¼šå‡ºç°pm2ä¸æ˜¯å†…éƒ¨æŒ‡ä»¤çš„é”™è¯¯1ln -s ~/node-v8.1.0-linux-x64/bin/pm2 /usr/local/bin/pm2 æˆ‘ä»¬é¡ºä¾¿æŠŠgitå’Œcnpmä¹Ÿå®‰è£…äº†123yum install gitsudo npm i -g cnpmln -s ~/node-v8.1.0-linux-x64/bin/cnpm /usr/bin/cnpm å®‰è£…mysqlå¸è½½å·²æœ‰çš„mysql12rpm -qa|grep -i mysqlyum remove &apos;mysql&apos; ä¸‹è½½mysqlçš„repoæº12wget http://repo.mysql.com//mysql57-community-release-el7-7.noarch.rpmrpm -ivh mysql57-community-release-el7-7.noarch.rpm å®‰è£…123yum install mysql-serveryum install mysql-develyum install mysql ç„¶åæŸ¥çœ‹åˆšåˆšå®‰è£…çš„mysql1rpm -qa|grep -i mysql ç™»å½•1234service mysqld status æŸ¥çœ‹mysqlå½“å‰çš„çŠ¶æ€service mysqld stop åœæ­¢mysqlservice mysqld restart é‡å¯mysqlservice mysqld start å¯åŠ¨mysql åœ¨å®Œæˆä¸Šè¿°æ­¥éª¤ä¹‹åç™»é™†æ—¶å¯èƒ½é‡åˆ°ERROR 2002 (HY000): Canâ€˜t connect to local MySQL server through socket â€˜/var/lib/mysql/mysql.sockâ€˜ (2)é”™è¯¯ã€‚ è¿™ä¸ªé”™è¯¯çš„åŸå› æ˜¯/var/lib/mysqlçš„è®¿é—®æƒé™é—®é¢˜ã€‚ä¸‹é¢çš„å‘½ä»¤æŠŠ/var/lib/mysqlçš„æ‹¥æœ‰è€…æ”¹ä¸ºå½“å‰ç”¨æˆ·ã€‚ 12chown -R openscanner:openscanner /var/lib/mysqlchown -R root:root /var/lib/mysql äºæ˜¯ä¹æ¥ä¸‹æ¥å°±æ˜¯æŸ¥çœ‹ä¸€ä¸‹/var/lib/mysql/mysql.sockæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œç¬¬ä¸€æ¬¡æŸ¥çœ‹æ—¶è¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåæ¥åœ¨/etc/my.cnfæ–‡ä»¶ä¸­æ·»åŠ äº†user=mysqlç„¶åå°è¯•ç™»å½•1mysql -u root ä¼šå‡ºç°ERROR 1045 (28000): Access denied for user &#39;root&#39;@&#39;localhost&#39; (using password: NO) ç™»å½•rootå¸å·éœ€è¦å¯†ç ï¼Œç°åœ¨æˆ‘ä»¬æ²¡æœ‰è®¾ç½®å¯†ç ï¼Œå“ªæ¥çš„å¯†ç ã€‚äºæ˜¯ä¹æˆ‘ä»¬å¼€å§‹å¿˜è®°å¯†ç çš„æ“ä½œç¬¬ä¸€æ­¥ï¼Œåœ¨/etc/my.cnfæ–‡ä»¶ä¸­æ·»åŠ skip-grant-tablesç¬¬äºŒæ­¥ï¼Œé‡å¯mysqlï¼Œservice mysqld restartç¬¬ä¸‰æ­¥ï¼Œç™»å½•mysqlï¼Œmysql -u rootç¬¬å››æ­¥ï¼Œä¿®æ”¹å¯†ç ï¼š1234mysql&gt;use mysql;mysql&gt;update mysql.user set authentication_string=password(&apos;ä½ çš„å¯†ç &apos;) where user=&apos;root&apos;;mysql&gt;flush privileges;mysql&gt;exit; ç¬¬äº”æ­¥ï¼Œæ¢å¤/etc/my.cnfï¼Œå°†skip-grant-tablesåˆ é™¤æˆ–è€…æ³¨é‡Šæ‰ç¬¬å…­æ­¥ï¼Œé‡å¯mysqlï¼Œservice mysqld restart åˆ†é…ç”¨æˆ· hostæŒ‡å®šè¯¥ç”¨æˆ·åœ¨å“ªä¸ªä¸»æœºä¸Šå¯ä»¥ç™»é™†ï¼Œæ­¤å¤„çš„â€localhostâ€ï¼Œæ˜¯æŒ‡è¯¥ç”¨æˆ·åªèƒ½åœ¨æœ¬åœ°ç™»å½•ï¼Œä¸èƒ½åœ¨å¦å¤–ä¸€å°æœºå™¨ä¸Šè¿œç¨‹ç™»å½•ï¼Œå¦‚æœæƒ³è¿œç¨‹ç™»å½•çš„è¯ï¼Œå°†â€localhostâ€æ”¹ä¸ºâ€%â€ï¼Œè¡¨ç¤ºåœ¨ä»»ä½•ä¸€å°ç”µè„‘ä¸Šéƒ½å¯ä»¥ç™»å½•;ä¹Ÿå¯ä»¥æŒ‡å®šæŸå°æœºå™¨å¯ä»¥è¿œç¨‹ç™»å½•; 12CREATE USER &apos;username&apos;@&apos;host&apos; IDENTIFIED BY &apos;password&apos;;CREATE USER &apos;test&apos;@&apos;%&apos; IDENTIFIED BY &apos;å¯†ç &apos;; ç»™åˆ›å»ºçš„ç”¨æˆ·æƒé™ privilegesï¼šç”¨æˆ·çš„æ“ä½œæƒé™,å¦‚SELECTï¼ŒINSERTï¼ŒUPDATEç­‰.å¦‚æœè¦æˆäºˆæ‰€çš„æƒé™åˆ™ä½¿ç”¨ALL;databasenameï¼šæ•°æ®åº“åã€‚tablenameï¼šè¡¨å,å¦‚æœè¦æˆäºˆè¯¥ç”¨æˆ·å¯¹æ‰€æœ‰æ•°æ®åº“å’Œè¡¨çš„ç›¸åº”æ“ä½œæƒé™åˆ™å¯ç”¨è¡¨ç¤º, å¦‚.*. 1GRANT privileges ON databasename.tablename TO &apos;username&apos;@&apos;host&apos; ä¸‹é¢è¡¨ç¤ºç»™testç”¨æˆ·æ‰€æœ‰æ•°æ®åº“å’Œè¡¨çš„æƒé™ mysql&gt;GRANT ALL ON . TO â€˜testâ€˜@â€™%â€™; å®‰è£…nginxå®‰è£…1yum -y install nginx å¯åŠ¨1service nginx start æŸ¥æ‰¾nginxå®‰è£…åœ¨å“ªï¼Œæˆ‘è¿™é‡Œæ˜¯/etc/nginx/conf.d1whereis nginx è¿›å…¥æ–‡ä»¶å¤¹1cd /etc/nginx/conf.d ç„¶åæ–°å»ºæ–‡ä»¶ï¼Œè¿™é‡Œä»¥æˆ‘çš„åŸŸåä¸ºä¾‹1vi www.wclimb.site.conf ç„¶åé‡Œé¢çš„æ–‡ä»¶å†…å®¹æˆ‘ä»¬å…ˆä¸å†™ï¼Œæˆ‘ä»¬å…ˆæŠŠnodeé¡¹ç›®éƒ¨ç½²ä¸€ä¸‹ ä½¿ç”¨pm2å¯åŠ¨nodeé¡¹ç›®è¿™é‡Œä»¥æˆ‘çš„é¡¹ç›®ä¸ºä¾‹koa2-blogæˆ‘ä»¬å…ˆæ‰¾åˆ°åˆé€‚çš„æ–‡ä»¶å¤¹å­˜æ”¾æˆ‘ä»¬å¾—é¡¹ç›®ï¼Œç„¶ågit cloneä¸€ä¸‹ï¼ˆgitæˆ‘ä»¬ä¹‹å‰å®‰è£…è¿‡äº†ï¼‰ è¯¥é¡¹ç›®çš„æ•°æ®åº“åå«nodeSqlï¼Œä½¿ç”¨è¿è¡Œä¹‹å‰å¾—å…ˆå»ºç«‹å¥½æ•°æ®åº“ï¼Œç„¶åå†è¿è¡Œé¡¹ç›®ï¼Œç™»å½•æ•°æ®åº“æ‰§è¡Œ create database nodesql; 1234git clone https://github.com/wclimb/Koa2-blog.gitcd Koa2-blogcnpm i pm2 start index.js ä¸Šé¢pm2æˆ‘ä»¬ä¹Ÿå®‰è£…è¿‡ï¼Œè¯¥é¡¹ç›®ç›‘å¬çš„æ˜¯3000ç«¯å£ï¼Œé¡¹ç›®å·²ç»è¿è¡Œèµ·æ¥äº†å¯ä»¥ä½¿ç”¨pm2 listæŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨ï¼Œä½¿ç”¨pm2 logæ‰“å°æ—¥å¿— nginxé…ç½®è®°å¾—åˆšåˆšæˆ‘ä»¬æ²¡æœ‰ç¼–å†™www.wclimb.site.confæ–‡ä»¶ç°åœ¨å¼€å§‹å†™å…¥ä»¥ä¸‹å†…å®¹ï¼Œblog.wclimb.siteæ˜¯æˆ‘çš„åŸŸåï¼Œä½ å¯ä»¥åœ¨ä½ çš„æœåŠ¡å™¨å¹³å°å»è§£æä¸€ä¸‹ï¼Œç›®å‰æˆ‘ä»¬ç›‘å¬çš„æ˜¯3000ç«¯å£ï¼Œæ‰€ä»¥ä»£ç†åˆ°30001234567server &#123; listen 80; server_name blog.wclimb.site; location / &#123; proxy_pass http://127.0.0.1:3000; &#125;&#125; æ£€éªŒnginxæ˜¯å¦æ­£ç¡®é…ç½®1nginx -t é‡å¯nginx1service nginx restart å¦‚æœä¸æˆåŠŸï¼Œå¯èƒ½è¿˜éœ€æ‰§è¡Œä¸€ä¸‹å‘½ä»¤12systemctl stop httpdsystemctl disable httpd å®Œç»“OKï¼Œç°åœ¨è®¿é—®åŸŸåçœ‹çœ‹æ˜¯å¦æœ‰æ•ˆæœäº†ï¼Œæ•´ä¸ªæµç¨‹å¯èƒ½æœ‰å†™çº°æ¼ï¼Œå¤§è‡´æµç¨‹ä¹Ÿå·®ä¸å¤šäº†ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ© GitHubï¼šwclimb ä¸ªäººå°ç¨‹åº]]></content>
      <categories>
        <category>Node</category>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>Node</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaScriptä¹‹å‡½æ•°è®°å¿†]]></title>
    <url>%2F2018%2F07%2F12%2FJavaScript%E4%B9%8B%E5%87%BD%E6%95%B0%E8%AE%B0%E5%BF%86%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘åœ¨è¯»è¯­è¨€ç²¾ç²¹ï¼Œè¯»åˆ°å‡½æ•°è®°å¿†è¿™å—ï¼Œè§‰å¾—æœ‰å¿…è¦è®°å½•ä¸€ä¸‹ æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸ä½¿ç”¨é€’å½’çš„æ–¹å¼è°ƒç”¨å‡½æ•°ï¼Œä½†æ˜¯å¼€å‘è¿‡ç¨‹ä¸­å¾ˆå°‘æœ‰å…³å¿ƒæ€§èƒ½é—®é¢˜ æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸‹é¢è¿™æ®µä»£ç 123456789var count = 0var f = function(n)&#123; count++ return n &lt; 2 ? n : f(n - 1) + f(n - 2);&#125;for(var i = 0; i &lt;= 10; i++)&#123; console.log(i,f(i))&#125;console.log('æ‰§è¡Œæ¬¡æ•°', count) ç»“æœ1234567891011120 01 12 13 24 35 56 87 138 219 3410 55'æ‰§è¡Œæ¬¡æ•°', 453 æ‰§è¡Œä¸€éå‘ç°ï¼Œfè¿™ä¸ªå‡½æ•°è¢«è°ƒç”¨äº†453æ¬¡ï¼Œæˆ‘ä»¬è°ƒç”¨äº†11æ¬¡ï¼Œè€Œå®ƒè‡ªèº«è°ƒç”¨äº†442æ¬¡å»è®¡ç®—å¯èƒ½å·²ç»è¢«åˆšè®¡ç®—è¿‡çš„å€¼ã€‚å¦‚æœæˆ‘ä»¬è®©å‡½æ•°å…·å¤‡è®°å¿†åŠŸèƒ½ï¼Œå°±å¯ä»¥æ˜¾è‘—å‡å°‘è¿ç®—é‡ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªmemoçš„æ•°ç»„æ¥ä¿å­˜æˆ‘ä»¬å¾—å‚¨å­˜ç»“æœï¼Œå¹¶æŠŠå®ƒéšè—åœ¨é—­åŒ…ä¸­ï¼Œè®©è¯¥å‡½æ•°èƒ½ä¸€ç›´è®¿é—®åˆ°è¿™ä¸ªæ•°ç»„ï¼Œä¸è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ 123456789101112131415161718var count = 0var f = function()&#123; var memo = [0,1]; var fib = function(n)&#123; count++ var result = memo[n]; if(typeof result !== 'number')&#123; result = fib(n - 1) + fib(n - 2) memo[n] = result &#125; return result &#125; return fib&#125;()for(var i = 0; i &lt;= 10; i++)&#123; console.log(i,f(i))&#125;console.log('æ‰§è¡Œæ¬¡æ•°', count) æ‰§è¡Œç»“æœ1234567891011120 01 12 13 24 35 56 87 138 219 3410 55æ‰§è¡Œæ¬¡æ•° 29 ç°åœ¨få‡½æ•°åªè¢«è°ƒç”¨äº†29æ¬¡ï¼Œæˆ‘ä»¬è°ƒç”¨äº†å®ƒ11æ¬¡ï¼Œå®ƒè°ƒç”¨äº†18æ¬¡å»å–å¾—ä¹‹å‰å‚¨å­˜çš„ç»“æœã€‚ å…ˆå°±åˆ†äº«åˆ°è¿™å§ï¼Œå…³é”®æ‹“å®½æ€è·¯ GitHubï¼šwclimb]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaScriptä¹‹åŸå‹ä¸åŸå‹é“¾]]></title>
    <url>%2F2018%2F06%2F13%2FJavaScript%E4%B9%8B%E5%8E%9F%E5%9E%8B%E4%B8%8E%E5%8E%9F%E5%9E%8B%E9%93%BE%2F</url>
    <content type="text"><![CDATA[ä¸‡ç‰©çš†å¯¹è±¡åœ¨JavaScriptä¸­é™¤å€¼ç±»å‹ä¹‹å¤–ï¼Œå…¶ä»–çš„éƒ½æ˜¯å¯¹è±¡ï¼Œä¸ºäº†è¯´æ˜è¿™ç‚¹ï¼Œæˆ‘ä»¬ä¸¾å‡ ä¸ªä¾‹å­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨typeofæ¥åšç±»å‹åˆ¤æ–­ 123456789typeof a; // undefinedtypeof 1; // numbertypeof 'wclimb'; // stringtypeof true; // booleantypeof function()&#123;&#125;; // functiontypeof []; // objecttypeof null; // objecttypeof &#123;&#125;; // object é™¤äº†undefinedã€numberã€stringã€booleanå±äºå€¼ç±»å‹ä¹‹å¤–ï¼Œå…¶ä»–éƒ½æ˜¯å¯¹è±¡ã€‚ä½ å¯èƒ½è¦é—®äº†ï¼Œä¸æ˜¯è¿˜æœ‰ä¸€ä¸ªæ˜¯functionå—ï¼Ÿè¦æ ¡éªŒä»–æ˜¯ä¸æ˜¯åº”è¯¥å¯¹è±¡å¯ä»¥è¿™æ ·åš:12var fn = function()&#123;&#125;fn instanceof Object // true ç”±ä¸Šé¢çš„ä¾‹å­æ‰€ç¤ºï¼Œå‡½æ•°ç¡®å®æ˜¯å¯¹è±¡ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä¾‹å­12345function Person(name)&#123; this.name = name; &#125;var person = new Person('wclimb');console.log(person) // Person &#123;name: "wclimb"&#125; ç”±æ­¤æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œå¯¹è±¡éƒ½æ˜¯é€šè¿‡å‡½æ•°åˆ›å»ºçš„ï¼Œè¿™ä¹ˆè¯´ä½ å¯èƒ½åˆä¼šè¯´ä¸å¯¹ï¼Œä½ çœ‹ä¸‹é¢çš„å°±ä¸æ˜¯å‡½æ•°åˆ›å»ºçš„1var person = &#123;name:'wclimb'&#125; ä½ å’‹å°±è¿™ä¹ˆé£˜å‘¢ï¼Ÿæˆ‘ç«Ÿæ— è¨€ä»¥å¯¹ï¼Œæ²¡é”™ï¼Œè¿™æ˜¯ä¸ªæ„å¤–ã€æ„å¤–ã€æ„å¤–ã€‚ä½†æ˜¯å½’æ ¹ç»“åº•ä»–è¿˜æ˜¯é€šè¿‡å‡½æ•°åˆ›å»ºçš„12var person = new Object()person.name = 'wclimb' soï¼Œç°åœ¨ä½ åªè¦çŸ¥é“å¯¹è±¡æ˜¯é€šè¿‡å‡½æ•°åˆ›å»ºçš„å°±å¯ä»¥äº†ï¼Œæ¥è·Ÿç€æˆ‘è¯»ï¼šç¬¬ä¸€é å¯¹è±¡éƒ½æ˜¯é€šè¿‡å‡½æ•°åˆ›å»ºçš„ç¬¬äºŒé å¯¹è±¡éƒ½æ˜¯é€šè¿‡å‡½æ•°åˆ›å»ºçš„ç¬¬ä¸‰é å¯¹è±¡éƒ½æ˜¯é€šè¿‡å‡½æ•°åˆ›å»ºçš„ æ„é€ å‡½æ•°(constructor)12345function Person(name)&#123; this.name = name&#125;var person1 = new Person('wclimb 1')var person2 = new Person('wclimb 2') ä¸Šé¢Personå°±æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬é€šè¿‡newçš„æ–¹å¼åˆ›å»ºäº†ä¸€ä¸ªå®ä¾‹å¯¹è±¡personæˆ‘ä»¬æ¥çœ‹çœ‹person1å’Œperson2çš„constructor(æ„é€ å‡½æ•°)æ˜¯ä¸æ˜¯æŒ‡å‘Personçš„12person1.constructor === Person // trueperson2.constructor === Person // true åŸå‹(prototype)åœ¨JavaScriptä¸­ï¼Œæ¯å®šä¹‰ä¸€ä¸ªå‡½æ•°éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªprototype(åŸå‹)å±æ€§ï¼Œè¿™ä¸ªå±æ€§æŒ‡å‘å‡½æ•°çš„åŸå‹å¯¹è±¡12345678function Person()&#123;&#125;Person.prototype.name = 'wclimb'Person.prototype.age = '24'Person.prototype.sayAge = function()&#123; console.log(this.age)&#125;var person = new Person()person.sayAge(); // 24 é‚£ä¹ˆè¿™ä¸ªprototypeåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè·Ÿæ„é€ å‡½æ•°æœ‰å…³ç³»å—ï¼Ÿ ä¸Šå›¾å°±å¯ä»¥åæ˜ å‡ºä»–ä»¬ä¹‹é—´çš„å…³ç³» å…¶å®å‡½æ•°çš„prototypeæŒ‡å‘å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½ä¼šå…³è”å¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯åŸå‹ï¼Œä¸Šé¢çš„ä¾‹å­æ”¹æˆï¼š1234567Person.prototype = &#123; name: 'wclimb', age: 24, satAge: function()&#123; console.log(this.age) &#125;&#125; éšå¼åŸå‹(__proto__)ä¸Šé¢æˆ‘ä»¬è¯´åˆ°æ¯å®šä¹‰ä¸€ä¸ªå‡½æ•°éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªåŸå‹ï¼Œæ¯ä¸ªå‡½æ•°å®ƒä¸æ­¢æœ‰åŸå‹ï¼Œè¿˜æœ‰ä¸€ä¸ª__proto__(éšå¼åŸå‹)æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª__proto__å±æ€§ï¼ŒæŒ‡å‘åˆ›å»ºè¯¥å¯¹è±¡å‡½æ•°çš„prototypeï¼Œæˆ‘ä»¬å¯ä»¥æ¥è¯•è¯•ï¼Œè¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼š123function Person()&#123;&#125;var person = new Person()person.__proto__ === Person.prototype // true ç°åœ¨ä»–ä»¬çš„å…³ç³»å›¾å¦‚ä¸‹ ç”±ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š123Person.prototype.constructor = Personperson.__proto__ = Person.prototypeperson.constructor = Person æˆ‘ä»¬å¯ä»¥çœ‹åˆ°person.__proto__æŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹ï¼Œé‚£ä¹ˆæ„é€ å‡½æ•°çš„åŸå‹å³Personçš„__proto__æŒ‡å‘å“ªé‡Œå‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“æ„é€ å‡½æ•°å…¶å®å°±æ˜¯ç”±Functionæ¥åˆ›å»ºçš„ï¼Œç”±æ­¤å¾—å‡º:1Person.__proto__ === Function.prototype é‚£ä¹ˆæ„é€ å‡½æ•°çš„åŸå‹å³Person.prototypeçš„__proto__æŒ‡å‘å“ªé‡Œå‘¢ï¼ŸåŸå‹å¯¹è±¡å…¶å®æ˜¯é€šè¿‡Objectç”Ÿæˆçš„ï¼Œè‡ªç„¶è€Œç„¶çš„å¾—å‡º:1Person.prototype.__proto__ === Object.prototype é‚£ä¹ˆObject.prototypeçš„__proto__æŒ‡å‘å“ªé‡Œå‘¢ï¼Ÿç­”æ¡ˆæ˜¯nullï¼Œæœ€ç»ˆå¾—åˆ°ä¸‹é¢çš„å›¾ æŠ›å¼€è¿™å¼ å›¾ï¼Œæ¥çœ‹çœ‹ä¸‹é¢å‡ é“é¢˜ person.__proto__ Person.__proto__ Person.prototype.__proto__ Object.__proto__ Object.prototype.__proto__ è§£ï¼š æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª__proto__å±æ€§ï¼ŒæŒ‡å‘åˆ›å»ºè¯¥å¯¹è±¡å‡½æ•°çš„prototypeï¼Œå› ä¸ºPersonæ˜¯personçš„æ„é€ å‡½æ•°Person === person.constructorä¸ºtrue,æ‰€ä»¥ï¼šperson.__proto__ === Person.prototype Personæ„é€ å‡½æ•°æ˜¯ç”±Functionåˆ›å»ºçš„ï¼Œæ‰€ä»¥å¯ä»¥å¾—å‡ºPerson.__proto__ === Fucntion.prototype æˆ‘ä»¬ä¸Šé¢è¯´è¿‡Person.prototypeå…¶å®æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œå¯¹è±¡æ˜¯ç”±Objectåˆ›å»ºçš„ï¼Œæ‰€ä»¥ Person.prototype.__proto__ === Object.prototype Objectå¯¹è±¡éƒ½æ˜¯å‡½æ•°åˆ›å»ºçš„ï¼Œæ‰€ä»¥Object.__proto__ === Function.prototype è™½ç„¶Object.prototypeæ˜¯ä¸€ä¸ªå¯¹è±¡ä½†æ˜¯ä»–çš„__proto__ä¸ºnull å®ä¾‹å’ŒåŸå‹å½“æˆ‘ä»¬è¦å–ä¸€ä¸ªå€¼çš„æ—¶å€™ï¼Œä¼šå…ˆä»å®ä¾‹ä¸­å–ï¼Œå¦‚æœå®ä¾‹ä¸­å­˜åœ¨ï¼Œåˆ™å–å®ä¾‹çš„å€¼ï¼Œå¦‚æœå®ä¾‹ä¸å­˜åœ¨ï¼Œåˆ™ä¼šé¡ºç€åŸå‹é‡Œæ‰¾ï¼Œç›´åˆ°æ‰¾åˆ° 12345678function Person()&#123;&#125;Person.prototype.name = 'æˆ‘æ¥è‡ªåŸå‹'var person = new Person()person.name = 'æˆ‘æ¥è‡ªå®ä¾‹'console.log(person.name); // æˆ‘æ¥è‡ªå®ä¾‹delete person.nameconsole.log(person.name)); // æˆ‘æ¥è‡ªåŸå‹ é¦–å…ˆpersonå®ä¾‹ä¸­æœ‰è¿™ä¸ªå±æ€§ï¼Œè¿”å›æˆ‘æ¥è‡ªå®ä¾‹,ç„¶åå°†å®ƒåˆ é™¤ä¹‹åï¼Œä¼šä»åŸå‹ä¸­æ‹›ï¼Œä¹Ÿå°±æ˜¯person.__proto__ï¼Œå› ä¸ºPerson.prototype === person.__proto__ï¼Œæ‰€ä»¥å¾—åˆ°æˆ‘æ¥è‡ªåŸå‹ æ€»ç»“åŸå‹å’ŒåŸå‹é“¾åŸºæœ¬å·²ç»è®²è§£å®Œï¼Œä¸è¿‡è¿˜æœ‰å¾…å®Œå–„ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œè¿˜æœ›æŒ‡æ­£ GitHubï¼šwclimb ä¸ªäººå°ç¨‹åº QQç¾¤æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥åŠ qqç¾¤: 725165362 ç‚¹å‡»åŠ å…¥]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaScriptä¹‹èŠ‚æµä¸é˜²æŠ–]]></title>
    <url>%2F2018%2F06%2F12%2FJavaScript%E4%B9%8B%E8%8A%82%E6%B5%81%E4%B8%8E%E9%98%B2%E6%8A%96%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯æˆ‘ä»¬åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ä¼šç»å¸¸ä½¿ç”¨å¦‚scrollã€resizeã€touchmoveç­‰äº‹ä»¶ï¼Œå¦‚æœæ­£å¸¸ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°çš„è¯ï¼Œæœ‰å¯èƒ½åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…å¤šæ¬¡è¿ç»­è§¦å‘äº‹ä»¶ï¼Œååˆ†å½±å“æ€§èƒ½ã€‚å› æ­¤é’ˆå¯¹è¿™ç±»äº‹ä»¶è¦è¿›è¡ŒèŠ‚æµæˆ–è€…é˜²æŠ–å¤„ç† èŠ‚æµèŠ‚æµçš„æ„æ€æ˜¯ï¼Œåœ¨è§„å®šçš„æ—¶é—´å†…åªä¼šè§¦å‘ä¸€æ¬¡å‡½æ•°ï¼Œå¦‚æˆ‘ä»¬è®¾ç½®å‡½æ•°500msè§¦å‘ä¸€æ¬¡ï¼Œä¹‹åä½ æ— è®ºä½ è§¦å‘äº†å¤šå°‘æ¬¡å‡½æ•°ï¼Œåœ¨è¿™ä¸ªæ—¶é—´å†…ä¹Ÿåªä¼šæœ‰ä¸€æ¬¡æ‰§è¡Œæ•ˆæœ å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ See the Pen gKWLpO by wclimb (@wclimb) on CodePen. æˆ‘ä»¬çœ‹åˆ°ä½¿ç”¨äº†èŠ‚æµçš„åœ¨1000mså†…åªè§¦å‘äº†ä¸€æ¬¡ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨èŠ‚æµçš„åˆ™é¢‘ç¹è§¦å‘äº†è°ƒç”¨çš„å‡½æ•° æ¥ä¸‹æ¥çœ‹çœ‹ä»£ç å®ç°v1 ç¬¬ä¸€æ¬¡ä¸è§¦å‘ï¼Œä¸ä¼ å‚å®ç°12345678910111213function throttle(fn,interval)&#123; var timer; return function()&#123; if(timer)&#123; return &#125; timer = setTimeout(() =&gt; &#123; clearTimeout(timer) timer = null fn() &#125;, interval || 1000); &#125; &#125; æ•ˆæœæ˜¯å®ç°äº†ï¼Œä½†æ˜¯æˆ‘åœ¨å°è¯•åœ¨æ‰§è¡Œå‡½æ•°é‡Œconsole.log(this)ï¼Œç»“æœå‘ç°thisæŒ‡å‘çš„æ˜¯windowï¼Œè€Œä¸”è¿˜å‘ç°æˆ‘ä»¬ä¸èƒ½ä¼ é€’å‚æ•°ï¼Œä¸‹é¢å°±æ¥æ”¹è¿›ä¸€ä¸‹v2 ç¬¬ä¸€æ¬¡è§¦å‘å‡½æ•°ï¼Œæ¥æ”¶å‚æ•°1234567891011121314151617181920function throttle(fn,interval)&#123; var timer, isFirst = true; return function()&#123; var args = arguments, that = this; if(isFirst)&#123; fn.apply(that,args) return isFirst = false &#125; if(timer)&#123; return &#125; timer = setTimeout(() =&gt; &#123; clearTimeout(timer) timer = null fn.apply(that,args) &#125;, interval || 1000); &#125; &#125; é˜²æŠ–é˜²æŠ–çš„æ„æ€æ˜¯æ— è®ºä½ è§¦å‘å¤šå°‘æ¬¡å‡½æ•°ï¼Œåªä¼šè§¦å‘æœ€åä¸€æ¬¡å‡½æ•°ã€‚æœ€å¸¸ç”¨çš„å°±æ˜¯åœ¨è¡¨å•æäº¤çš„æ—¶å€™ï¼Œç”¨æˆ·å¯èƒ½ä¼šä¸€æ®µæ—¶é—´å†…ç‚¹å‡»å¾ˆå¤šæ¬¡ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å¢åŠ é˜²æŠ–å¤„ç†ï¼Œæˆ‘ä»¬åªéœ€è¦æœ€åä¸€æ¬¡è§¦å‘çš„äº‹ä»¶ å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ See the Pen pKPeyv by wclimb (@wclimb) on CodePen. æˆ‘ä»¬çœ‹åˆ°ä½¿ç”¨äº†é˜²æŠ–çš„æ–¹æ¡†ï¼Œæ— è®ºä½ åœ¨é‡Œé¢è§¦å‘äº†å¤šå°‘æ¬¡å‡½æ•°ï¼Œéƒ½åªä¼šè§¦å‘æœ€åçš„é‚£ä¸€æ¬¡å‡½æ•°ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨é˜²æŠ–çš„åˆ™é¢‘ç¹è§¦å‘äº†è°ƒç”¨çš„å‡½æ•° v1 ç¬¬ä¸€æ¬¡ä¸è§¦å‘å‡½æ•° 1234567891011121314function debounce(fn,interval)&#123; var timer; return function()&#123; var args = arguments, that = this; if(timer)&#123; clearTimeout(timer) timer = null &#125; timer = setTimeout(() =&gt; &#123; fn.apply(null,args) &#125;, interval || 1000); &#125;&#125; ä¸Šé¢è¿™æ®µä»£ç ä»ç„¶å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰æŒ‡å®šä»–çš„this v2 ç¬¬ä¸€æ¬¡å°±è§¦å‘å‡½æ•°123456789101112131415161718192021222324function debounce(fn,interval)&#123; var timer, isFirst = true, can = false; return function()&#123; var args = arguments, that = this; if(timer)&#123; clearTimeout(timer) timer = null &#125; if(isFirst)&#123; fn.apply(that,args) isFirst = false setTimeout(() =&gt; &#123; can = true &#125;, interval || 1000); &#125;else if(can)&#123; timer = setTimeout(() =&gt; &#123; fn.apply(null,args) &#125;, interval || 1000); &#125; &#125;&#125; å¦‚æœ‰é›·åŒï¼Œçº¯å±æŠ„æˆ‘ï¼ˆå¼€ç©ç¬‘ï¼‰ å¦‚æœ‰é”™è¯¯ï¼Œè¿˜æœ›æŒ‡æ­£ï¼Œä»…ä¾›å‚è€ƒ GitHubï¼šwclimb QQç¾¤æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥åŠ qqç¾¤: 725165362 ç‚¹å‡»åŠ å…¥ ä¸ªäººå°ç¨‹åº]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HTTPç¼“å­˜â€”â€”304ä¸200 from cache]]></title>
    <url>%2F2018%2F03%2F06%2FHTTP%E7%BC%93%E5%AD%98%E2%80%94%E2%80%94304%E4%B8%8E200-from-cache%2F</url>
    <content type="text"><![CDATA[HTTPä¸ç¼“å­˜ç›¸å…³çš„å­—æ®µ1. é€šç”¨å­—æ®µ å­—æ®µåç§° é‡Šä¹‰ Cache-Control æ§åˆ¶ç¼“å­˜å…·ä½“çš„è¡Œä¸º Pragma HTTP1.0æ—¶çš„é—ç•™å­—æ®µï¼Œå½“å€¼ä¸ºâ€no-cacheâ€æ—¶å¼ºåˆ¶éªŒè¯ç¼“å­˜ Date åˆ›å»ºæŠ¥æ–‡çš„æ—¥æœŸæ—¶é—´(å¯å‘å¼ç¼“å­˜é˜¶æ®µæ‰€ç”¨) 2. responseå­—æ®µ å­—æ®µåç§° é‡Šä¹‰ ETag æœåŠ¡å™¨ç”Ÿæˆèµ„æºçš„å”¯ä¸€æ ‡è¯† Vary ä»£ç†æœåŠ¡å™¨ç¼“å­˜çš„ç®¡ç†ä¿¡æ¯ Age èµ„æºåœ¨ç¼“å­˜ä»£ç†ä¸­å­˜è´®çš„æ—¶é•¿(å–å†³äºmax-ageå’Œs-maxageçš„å¤§å°) 3. requestå­—æ®µ å­—æ®µåç§° é‡Šä¹‰ If-Match æ¡ä»¶è¯·æ±‚ï¼Œæºå¸¦ä¸Šä¸€æ¬¡è¯·æ±‚ä¸­èµ„æºçš„ETagï¼ŒæœåŠ¡å™¨æ ¹æ®è¿™ä¸ªå­—æ®µåˆ¤æ–­æ–‡ä»¶æ˜¯å¦æœ‰æ–°çš„ä¿®æ”¹ If-None-Match å’ŒIf-Matchä½œç”¨ç›¸åï¼ŒæœåŠ¡å™¨æ ¹æ®è¿™ä¸ªå­—æ®µåˆ¤æ–­æ–‡ä»¶æ˜¯å¦æœ‰æ–°çš„ä¿®æ”¹ If-Modified-Since æ¯”è¾ƒèµ„æºå‰åä¸¤æ¬¡è®¿é—®æœ€åçš„ä¿®æ”¹æ—¶é—´æ˜¯å¦ä¸€è‡´ If-Unmodified-Since æ¯”è¾ƒèµ„æºå‰åä¸¤æ¬¡è®¿é—®æœ€åçš„ä¿®æ”¹æ—¶é—´æ˜¯å¦ä¸€è‡´ 4. å®ä½“å­—æ®µ å­—æ®µåç§° é‡Šä¹‰ Expires å‘ŠçŸ¥å®¢æˆ·ç«¯èµ„æºç¼“å­˜å¤±æ•ˆçš„ç»å¯¹æ—¶é—´ Last-Modified èµ„æºæœ€åä¸€æ¬¡ä¿®æ”¹çš„æ—¶é—´ åå•†ç¼“å­˜ï¼ˆ304ï¼‰ If-modified-Since/Last-Modified æµè§ˆå™¨åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™æœåŠ¡å™¨ä¼šæ£€æŸ¥è¯·æ±‚å¤´request headeré‡Œé¢çš„If-modified-Sinceï¼Œå¦‚æœæœ€åä¿®æ”¹æ—¶é—´ç›¸åŒåˆ™è¿”å›304ï¼Œå¦åˆ™ç»™è¿”å›å¤´(response header)æ·»åŠ last-Modifiedå¹¶ä¸”è¿”å›æ•°æ®(response body)ã€‚12if-modified-since:Wed, 31 May 2017 03:21:09 GMTif-none-match:&quot;42DD5684635105372FE7720E3B39B96A&quot; If-None-Match/Etag æµè§ˆå™¨åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™æœåŠ¡å™¨ä¼šæ£€æŸ¥è¯·æ±‚å¤´(request header)é‡Œé¢çš„if-none-matchçš„å€¼ä¸å½“å‰æ–‡ä»¶çš„å†…å®¹é€šè¿‡hashç®—æ³•ï¼ˆä¾‹å¦‚ nodejs: cryto.createHash(&#39;sha1&#39;)ï¼‰ç”Ÿæˆçš„å†…å®¹æ‘˜è¦å­—ç¬¦å¯¹æ¯”ï¼Œç›¸åŒåˆ™ç›´æ¥è¿”å›304ï¼Œå¦åˆ™ç»™è¿”å›å¤´(response header)æ·»åŠ etagå±æ€§ä¸ºå½“å‰çš„å†…å®¹æ‘˜è¦å­—ç¬¦ï¼Œå¹¶ä¸”è¿”å›å†…å®¹ã€‚12etag:&quot;42DD5684635105372FE7720E3B39B96A&quot;last-modified:Wed, 31 May 2017 03:21:09 GMT è¯·æ±‚å¤´last-modifiedçš„æ—¥æœŸä¸å“åº”å¤´çš„last-modifiedä¸€è‡´è¯·æ±‚å¤´if-none-matchçš„hashä¸å“åº”å¤´çš„etagä¸€è‡´æ‰€ç”¨ä¼šè¿”å›Status Code: 304 å¼ºç¼“å­˜ï¼ˆ200 from cacheï¼‰ å¦‚æœè®¾ç½®äº†Expires(XXæ—¶é—´è¿‡æœŸ)æˆ–è€…Cache-Controlï¼ˆhttp1.0ä¸æ”¯æŒï¼‰(ç»å†XXæ—¶é—´åè¿‡æœŸ)ä¸”æ²¡æœ‰è¿‡æœŸï¼Œå‘½ä¸­cacheçš„æƒ…å†µä¸‹ï¼Œfrom cacheä¸å»å‘å‡ºè¯·æ±‚ã€‚å¦‚æœå¼ºåˆ·ï¼ˆå¦‚ctrl+rï¼‰ä¼šå‘èµ·è¯·æ±‚ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰ä¿®æ”¹ä¼šè¿”å›304å†…å®¹æœªä¿®æ”¹ï¼Œå¦‚æœå·²ç»æ”¹å˜åˆ™è¿”å›æ–°å†…å®¹ã€‚max-age &gt; Expiresã€‚ expires/cache-controlè™½ç„¶æ˜¯å¼ºç¼“å­˜ï¼Œä½†ç”¨æˆ·ä¸»åŠ¨è§¦å‘çš„åˆ·æ–°è¡Œä¸ºï¼Œè¿˜æ˜¯ä¼šé‡‡ç”¨ç¼“å­˜åå•†çš„ç­–ç•¥ï¼Œä¸»åŠ¨è§¦å‘çš„åˆ·æ–°è¡Œä¸ºåŒ…æ‹¬ç‚¹å‡»åˆ·æ–°æŒ‰é’®ã€å³é”®åˆ·æ–°ã€f5åˆ·æ–°ã€ctrl+f5åˆ·æ–°ç­‰ã€‚ å½“ç„¶å¦‚æœåœ¨æ§åˆ¶å°é‡Œé¢é€‰ä¸­äº†disable cahceåˆ™æ— è®ºå¦‚ä½•éƒ½ä¼šè¯·æ±‚æœ€æ–°å†…å®¹(304åå•†ç¼“å­˜ã€å¼ºç¼“å­˜éƒ½æ— æ•ˆ)ï¼Œå› ä¸º1.ä¸ä¼šæ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰ç¼“å­˜ã€‚2.è¯·æ±‚å¤´ä¿¡æ¯(request header)æ—¢æ²¡æœ‰If-Modified-Sinceä¹Ÿæ²¡æœ‰If-None-Matchæ¥è®©æœåŠ¡ç«¯åˆ¤æ–­ã€‚åœ°å€æ è¾“å…¥çš„åœ°å€æŒ‰ä¸‹å›è½¦é”®ï¼Œè¯¥åœ°å€é¡µé¢è¯·æ±‚ï¼ˆä»…ä»…æ˜¯è¯¥urlï¼‰çš„request headeréƒ½ä¼šå¸¦ä¸Šcache-contro:max-age=0ï¼Œæ‰€ä»¥ä¸ä¼šå‘½ä¸­å¼ºç¼“å­˜ï¼Œä½†æ˜¯é€šè¿‡é“¾æ¥ç‚¹å‡»çš„åœ°å€ä¼šå‘½ä¸­ç¼“å­˜ chromeä¸‹æŸ¥çœ‹æ‰€æœ‰çš„from cacheæ–‡ä»¶ï¼šchrome://view-http-cache/ åŒºåˆ« è§¦å‘ 200 from cacheï¼š ç›´æ¥ç‚¹å‡»é“¾æ¥è®¿é—® è¾“å…¥ç½‘å€æŒ‰å›è½¦è®¿é—® äºŒç»´ç æ‰«æ è§¦å‘ 304ï¼š åˆ·æ–°é¡µé¢æ—¶è§¦å‘ è®¾ç½®äº†é•¿ç¼“å­˜ã€ä½†Entity Tagsæ²¡æœ‰ç§»é™¤æ—¶è§¦å‘ æµç¨‹å›¾ GitHubï¼šwclimb ä¸ªäººå°ç¨‹åº]]></content>
      <categories>
        <category>HTTP</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>HTTP</tag>
        <tag>ç¼“å­˜</tag>
        <tag>Mysql</tag>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[nodejså¾®ä¿¡æ”¯ä»˜ä¹‹æ‰«ç æ”¯ä»˜]]></title>
    <url>%2F2018%2F02%2F14%2Fnodejs%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E4%B9%8B%E6%89%AB%E7%A0%81%E6%94%AF%E4%BB%98%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ¬ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•æœ¬äººåœ¨å¾®ä¿¡æ‰«ç æ”¯ä»˜è¿‡ç¨‹ä¸­æ‰€é‡åˆ°çš„é—®é¢˜ï¼Œç»™å¤§å®¶ä¸€ä¸ªå€Ÿé‰´ä½œç”¨ï¼Œå¸Œæœ›å¯¹ä½ ä»¬æœ‰å¸®åŠ© å¼€å‘ç¯å¢ƒ nodejs v8.1.0 egg v1.1.0 å‡†å¤‡å·¥ä½œ å¾®ä¿¡å…¬ä¼—å·-appid å¾®ä¿¡å•†æˆ·å·-mch_id keyå€¼(ç­¾åç®—æ³•æ‰€éœ€,å…¶å®å°±æ˜¯ä¸€ä¸ª32ä½çš„å¯†ç ï¼Œå¯ä»¥ç”¨md5ç”Ÿæˆä¸€ä¸ª)(keyè®¾ç½®è·¯å¾„ï¼šå¾®ä¿¡å•†æˆ·å¹³å°(pay.weixin.qq.com)â€“&gt;è´¦æˆ·è®¾ç½®â€“&gt;APIå®‰å…¨â€“&gt;å¯†é’¥è®¾ç½®) æ‰«ç æ”¯ä»˜-ç»Ÿä¸€ä¸‹å•ä»¥ä¸‹æ‰ç”¨çš„æ˜¯å¾®ä¿¡æ¨¡å¼äºŒï¼Œå› ä¸ºæ¯”è¾ƒç®€å•123456789101112131415let MD5 = require('md5'), xml2js = require('xml2js'), url = "https://api.mch.weixin.qq.com/pay/unifiedorder",// ä¸‹å•è¯·æ±‚åœ°å€ appid = 'å…¬ä¼—å·id', mch_id = 'å¾®ä¿¡å•†æˆ·å·'ï¼› notify_url = 'å›è°ƒåœ°å€', out_trade_no = 'è‡ªå·±è®¾ç½®çš„è®¢å•å·',// å¾®ä¿¡ä¼šæœ‰è‡ªå·±è®¢å•å·ã€æˆ‘ä»¬è‡ªå·±çš„ç³»ç»Ÿéœ€è¦è®¾ç½®è‡ªå·±çš„è®¢å•å· total_fee = 'è®¢å•é‡‘é¢',// æ³¨æ„ï¼Œå•ä½ä¸ºåˆ† body = 'å•†å“ç®€å•æè¿°', trade_type = 'NATIVE',// äº¤æ˜“ç±»å‹ï¼ŒJSAPI--å…¬ä¼—å·æ”¯ä»˜ã€NATIVE--åŸç”Ÿæ‰«ç æ”¯ä»˜ã€APP--appæ”¯ä»˜ nonce_str = moment().format('YYYYMMDDHHmmssSSS'),// éšæœºå­—ç¬¦ä¸²32ä½ä»¥ä¸‹ stringA = `appid=$&#123;å…¬ä¼—å·id&#125;&amp;body=$&#123;body&#125;&amp;mch_id=$&#123;å¾®ä¿¡å•†æˆ·å·&#125;&amp;nonce_str=$&#123;nonce_str&#125;&amp;notify_url=$&#123; notify_url&#125;&amp;out_trade_no=$&#123;out_trade_no&#125;&amp;spbill_create_ip=$&#123;ctx.request.ip&#125;&amp;total_fee=$&#123;total_fee&#125;&amp;trade_type=$&#123;trade_type&#125;`, stringSignTemp = stringA + "&amp;key=xxxxxxxxxxxxxxxxx", //æ³¨ï¼škeyä¸ºå•†æˆ·å¹³å°è®¾ç½®çš„å¯†é’¥key sign = MD5(stringSignTemp).toUpperCase(); //æ³¨ï¼šMD5ç­¾åæ–¹å¼ ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ä¸€äº›å‚æ•°ç­¾åç”Ÿæˆç®—æ³•è§å¾®ä¿¡å®˜æ–¹spbill_create_ip æ˜¯ ç»ˆç«¯ipåœ°å€ ä¸‹é¢æŠŠæ‰€æœ‰çš„å‚æ•°æ‹¼æ¥æˆxml123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657let formData = "&lt;xml&gt;";formData += "&lt;appid&gt;" + appid + "&lt;/appid&gt;"; //appidformData += "&lt;body&gt;" + body + "&lt;/body&gt;"; //å•†å“æˆ–æ”¯ä»˜å•ç®€è¦æè¿°formData += "&lt;mch_id&gt;" + mch_id + "&lt;/mch_id&gt;"; //å•†æˆ·å·formData += "&lt;nonce_str&gt;" + nonce_str + "&lt;/nonce_str&gt;"; //éšæœºå­—ç¬¦ä¸²ï¼Œä¸é•¿äº32ä½formData += "&lt;notify_url&gt;" + notify_url + "&lt;/notify_url&gt;"; //æ”¯ä»˜æˆåŠŸåå¾®ä¿¡æœåŠ¡å™¨é€šè¿‡POSTè¯·æ±‚é€šçŸ¥è¿™ä¸ªåœ°å€formData += "&lt;out_trade_no&gt;" + out_trade_no + "&lt;/out_trade_no&gt;"; //è®¢å•å·formData += "&lt;total_fee&gt;" + total_fee + "&lt;/total_fee&gt;"; //é‡‘é¢formData += "&lt;spbill_create_ip&gt;" + ctx.request.ip + "&lt;/spbill_create_ip&gt;"; //ipformData += "&lt;trade_type&gt;NATIVE&lt;/trade_type&gt;"; //NATIVEä¼šè¿”å›code_url ï¼ŒJSAPIä¸ä¼šè¿”å›formData += "&lt;sign&gt;" + sign + "&lt;/sign&gt;";formData += "&lt;/xml&gt;";// è¿™é‡Œä½¿ç”¨äº†eggé‡Œé¢è¯·æ±‚çš„æ–¹å¼const resultData = yield ctx.curl(url, &#123; method: "POST", content: formData, headers: &#123; "content-type": "text/html", &#125;,&#125;);// xmlè½¬jsonæ ¼å¼xml2js.parseString(resultData.data, function (err, json) &#123; if (err) &#123; new Error("è§£æxmlæŠ¥é”™"); &#125; else &#123; var result = formMessage(json.xml); // è½¬æ¢æˆæ­£å¸¸çš„json æ•°æ® console.log(result); //æ‰“å°å‡ºè¿”å›çš„ç»“æœ &#125;&#125;);var formMessage = function (result) &#123; var message = &#123;&#125;; if (typeof result === "object") &#123; var keys = Object.keys(result); for (var i = 0; i &lt; keys.length; i++) &#123; var item = result[keys[i]]; var key = keys[i]; if (!(item instanceof Array) || item.length === 0) &#123; continue; &#125; if (item.length === 1) &#123; var val = item[0]; if (typeof val === "object") &#123; message[key] = formMessage(val); &#125; else &#123; message[key] = (val || "").trim(); &#125; &#125; else &#123; message[key] = []; for (var j = 0, k = item.length; j &lt; k; j++) &#123; message[key].push(formMessage(itemp[j])); &#125; &#125; &#125; &#125; return message;&#125;; ä¸Šé¢ä½¿ç”¨äº†eggçš„è¯·æ±‚æ–¹å¼ï¼Œnodeå¯ä»¥ä½¿ç”¨requestå’Œaxios123456789var request = require('request');request(&#123; url: url, method: "POST", body: formData&#125;, function(error, response, body) &#123; if (!error &amp;&amp; response.statusCode == 200) &#123; &#125;&#125;); å¦‚æœè¯·æ±‚æˆåŠŸä¼šæœ€ç»ˆè¿”å›ä¸€ä¸ªxml,ç„¶åæˆ‘ä»¬è¿›è¡Œè§£ææˆjsonçš„æ ¼å¼,é‡Œé¢ä¼šæœ‰ä¸€ä¸ªcode_urlå’Œout_trade_no,æˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸¤ä¸ªè¿”å›ç»™å‰ç«¯ï¼Œç„¶åé€šè¿‡ç”ŸæˆäºŒç»´ç å±•ç¤ºç»™ç”¨æˆ·æ‰«ç ï¼Œå®Œæˆæ”¯ä»˜ ç›‘å¬æ”¯ä»˜æ˜¯å¦æˆåŠŸä¸Šé¢æ“ä½œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ç”¨æˆ·æ˜¯å¦å®Œæˆæ”¯ä»˜ï¼Œå› ä¸ºç”¨æˆ·ä¼šåœç•™åœ¨è¯¥é¡µé¢ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç”¨æˆ·ä»˜å®Œæ¬¾ä¹‹åï¼Œé€šçŸ¥ç”¨æˆ·æ”¯ä»˜æˆåŠŸã€‚é¦–å…ˆï¼Œç”¨æˆ·å‘èµ·æ”¯ä»˜çš„æ—¶å€™æˆ‘ä»¬ä¼šç”ŸæˆäºŒç»´ç ï¼Œè®©ç”¨æˆ·å®Œæˆæ‰«ç æ”¯ä»˜ï¼Œæˆ‘ä»¬è¿˜è¦åšçš„æ˜¯ï¼Œå¼€ä¸€ä¸ªå®šæ—¶å™¨ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å»å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬nodeåå°å°±éœ€è¦å†™ä¸€ä¸ªæŸ¥è¯¢è®¢å•çš„æ¥å£ï¼Œä¹‹å‰æˆ‘ä»¬æ‹¿åˆ°äº†out_trade_noï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç³»ç»Ÿå†…éƒ¨çš„è®¢å•å·ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ•°æ®å‘é€ç»™åå°æŸ¥è¯¢è®¢å•çš„æ¥å£ï¼Œç„¶ååå°æ¥æ”¶åˆ°ä¹‹åä¼šè¯·æ±‚å¾®ä¿¡çš„æŸ¥è¯¢æ¥å£åœ°å€https://api.mch.weixin.qq.com/pay/orderquery,æµç¨‹è·Ÿä¸Šé¢ä¸€æ ·ï¼Œåªæ˜¯æ¥å£åœ°å€å’Œå¾®ä¿¡è¿”å›çš„xmlä¸ä¸€æ ·è€Œå·²ï¼Œè¿”å›çš„å­—æ®µä¼šæœ‰ä¸€ä¸ªçŠ¶æ€å³SUCCESSå’ŒNOTPAYï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ¤æ–­æ˜¯å¦æ”¯ä»˜è¿”å›ç»™å‰ç«¯ï¼ŒæˆåŠŸä¹‹åæç¤ºç»™ç”¨æˆ·æ”¯ä»˜æˆåŠŸï¼Œå…³é—­å®šæ—¶å™¨ã€‚ å›è°ƒåœ°å€è¿™ä¸ªæ˜¯éå¸¸é‡è¦çš„ä¸€ç¯ï¼Œå¤§éƒ¨åˆ†çš„æ“ä½œå…¶å®åœ¨ä¸Šé¢å°±å¯ä»¥å®Œæˆï¼Œä½†æ˜¯æœ‰ç‰¹æ®Šçš„æƒ…å†µï¼Œæ¯”å¦‚ç”¨æˆ·ç”µè„‘æ–­ç½‘å‘é€ä¸äº†è¯·æ±‚ï¼Œä½†æ˜¯æ‰‹æœºä»˜æ¬¾äº†ï¼Œè¿™å°±ä¼šå¯¼è‡´æˆ‘ä»¬è®°å½•ä¸åˆ°ç”¨æˆ·æ”¯ä»˜çš„ä¿¡æ¯ã€‚è¿™ä¸ªæ—¶å€™å›è°ƒåœ°å€å°±å¾ˆé‡è¦äº† è®¾ç½®å›è°ƒåœ°å€å¾®ä¿¡å•†æˆ·ä¸­å¿ƒ-&gt;äº§å“ä¸­å¿ƒ-&gt;å¼€å‘é…ç½®-&gt;æ‰«ç æ”¯ä»˜ ä¹‹åæˆ‘ä»¬éœ€è¦åšçš„æ˜¯åç«¯ç”¨postæ¥æ¥æ”¶å¾®ä¿¡å‘é€çš„å¼‚æ­¥å›è°ƒä¿¡æ¯ï¼Œä¹Ÿæ˜¯xmlçš„æ ¼å¼ï¼Œè¿™é‡Œæ³¨æ„ï¼Œå¦‚æœä¸æ”¯æŒæ¥æ”¶xmlï¼Œå¯èƒ½ä¼šå¾—åˆ°ç©ºçš„æ•°æ®è¿™é‡Œè¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨ä¿å­˜ç”¨æˆ·æ”¯ä»˜ä¿¡æ¯çš„åŒæ—¶ï¼Œå¾—å…ˆæŸ¥æ”¹è®¢å•æ˜¯å¦æ”¯ä»˜ï¼Œä»¥å…é‡å¤æ“ä½œï¼Œå¯èƒ½ä¼šæ’å…¥å¤šæ¡è®°å½•çš„æƒ…å†µ æ€»ç»“å¾®ä¿¡æ‰«ç æ”¯ä»˜å‘è¿˜æ˜¯æœ‰çš„ï¼Œå¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡æ‘¸ç´¢çš„è¯ï¼Œä¸‹é¢ç½—åˆ—ä¸€ä¸‹éœ€è¦æ³¨æ„çš„åœ°æ–¹ ç­¾åç®—æ³•è¦å†™æ­£ç¡®ï¼Œä¸ç„¶æ˜¯ä¸ä¼šæˆåŠŸçš„ï¼Œè¦æ‹¼æ¥æ­£ç¡®æ‰è¡Œ å¾®ä¿¡è¿”å›çš„æ˜¯xmlæ ¼å¼çš„æ•°æ®ï¼Œæˆ‘ä»¬å¾—é€šè¿‡æ’ä»¶è½¬æˆjsonï¼Œè¿™æ ·æ‰æ–¹ä¾¿è·å–æ•°æ® è¿”å›çš„code_urlè¦ç»™å‰ç«¯ç”ŸæˆäºŒç»´ç ç”¨ï¼Œç„¶åéœ€è¦å¼€ä¸€ä¸ªå®šæ—¶å™¨æŸ¥è¯¢è¯¥è®¢å•æ˜¯å¦å®Œæˆæ”¯ä»˜ï¼Œæœ€ç»ˆé€šçŸ¥ç”¨æˆ·ç»“æœ å›è°ƒåœ°å€å¾ˆé‡è¦ï¼Œæˆ‘ä»¬åç«¯éœ€è¦postæ¥æ”¶å¾®ä¿¡è¿”å›çš„å›è°ƒä¿¡æ¯ï¼Œç„¶åä¿å­˜ä¿¡æ¯ï¼Œä¸è¿‡åœ¨ä¿å­˜ç”¨æˆ·æ”¯ä»˜ä¿¡æ¯çš„ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—çŸ¥é“è¯¥è®¢å•æ˜¯å¦å·²ç»ä¿å­˜è¿‡ï¼Œä»¥å…é‡å¤æ·»åŠ ã€‚è¿˜æœ‰å°±æ˜¯è¿”å›çš„æ˜¯xmlçš„æ•°æ®ï¼Œåç«¯ä¸€å®šè¦ä¿è¯èƒ½å¤Ÿæ¥æ”¶å¾—åˆ°ï¼ŒæŒ‰ç…§æ­£å¸¸çš„æ–¹å¼æ˜¯æ¥æ”¶ä¸äº†çš„ï¼Œå¾—é¢å¤–è®¾ç½®ã€‚ ä¸ªäººå°ç¨‹åº]]></content>
      <categories>
        <category>Node</category>
        <category>Egg</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>Node</tag>
        <tag>Egg</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨ Vue2.js + Node.js æ­å»ºä¸€ä¸ªå°å‹çš„å…¨æ ˆé¡¹ç›®]]></title>
    <url>%2F2017%2F09%2F08%2F%E4%BD%BF%E7%94%A8-Vue2-js-Node-js-%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%B0%8F%E5%9E%8B%E7%9A%84%E5%85%A8%E6%A0%88%E9%A1%B9%E7%9B%AE%2F</url>
    <content type="text"><![CDATA[å†™åœ¨å‰é¢ç”±äºæœ€è¿‘å…¬å¸ä¸šåŠ¡ä¸æ˜¯å¾ˆå¿™ï¼Œç©ºé—²æ—¶é—´æ¯”è¾ƒå¤šï¼Œäºæ˜¯å°±åœ¨çº ç»“Vue.jsï¼ˆä¹‹å‰å°±å­¦ä¹ è¿‡ï¼‰å’ŒNode.jså…ˆä¸“ç ”å“ªä¸ªæ¯”è¾ƒå¥½ï¼Œæœ€ç»ˆé€‰æ‹©äº†å…ˆç©ç©Node.jsã€‚ç»è¿‡ä¸€æ®µæ—¶é—´çš„å­¦ä¹ ï¼Œå°±æœ‰äº†æ•™ç¨‹ Node+Koa2+Mysql æ­å»ºç®€æ˜“åšå®¢ GitHubåœ°å€ï¼Œæƒ³è¦äº†è§£çš„å¯ä»¥å…ˆçœ‹çœ‹ï¼Œä¸ªäººæ°´å¹³æœ‰é™ï¼Œå¸Œæœ›å¯ä»¥å¸®åˆ°ä½ ã€‚å¤§æ¦‚è¿‡æ¥ä¸€ä¸ªå¤šæœˆï¼Œæˆ‘å†³å®šä¸¤è·¯å¼€å·¥ã€‚ä½¿ç”¨Node.jsç»™å‰ç«¯å†™æ¥å£ï¼Œé…å¤‡åå°ç®¡ç†åŠŸèƒ½ï¼Œå…ˆæŠŠåå°æ­å»ºå¥½ã€‚å¤§æ¦‚å‡ å¤©è¿‡åï¼Œåå°ä¸€äº›ç®€å•çš„åŠŸèƒ½å®ç°åï¼Œå°±å¼€å§‹ç”¨Vue.jså¼€å§‹æ­å»ºå‰å°ï¼Œä¹Ÿä¸€ç›´åœ¨æƒ³åšç‚¹ä»€ä¹ˆæ¯”è¾ƒå¥½ï¼Œäºæ˜¯å°±åšäº†ä¸ªè±†ç“£è¯„åˆ†ç±»ä¼¼çš„é¡¹ç›®ã€‚ å‰ç«¯é¡¹ç›®åœ°å€ https://github.com/wclimb/vue-videoå‰ç«¯é¢„è§ˆ http://video.wclimb.site åç«¯é¡¹ç›®åœ°å€ https://github.com/wclimb/video-adminåå°ç®¡ç† http://vue.wclimb.site APIæ¥å£åœ°å€ https://github.com/wclimb/video-admin/blob/master/API.md æŠ€æœ¯æ ˆ(Vue2.js + Node.js å…¨æ ˆé¡¹ç›®) ç”±äºé¡µé¢ä¸æ˜¯å¾ˆå¤šï¼Œvuexç”¨çš„ä¸å¤šï¼Œå…³é”®æŒæ¡æ€ä¹ˆå®ç°å°±å¥½äº† vue2 + vuex + vue-router + webpack + fetch + sass + flex + svg + é˜¿é‡Œå­—ä½“å›¾æ ‡ è¿è¡Œ1234567891011git clone https://github.com/wclimb/vue-video.gitcd vue-videonpm install å»ºè®®ä½¿ç”¨æ·˜å®é•œåƒ(https://npm.taobao.org/) =&gt; cnpm inpm run dev (è¿è¡Œé¡¹ç›®)npm run build (æ‰“åŒ…é¡¹ç›®)ps: å¦‚æœæ‰“åŒ…ä¹‹åæ–‡ä»¶è¿è¡Œä¸äº†ï¼Œè¯·æ‰“åŒ…ä¹‹å‰æŠŠè·¯ç”±çš„ mode:&apos;history&apos;æ³¨é‡Šæ‰ï¼Œè¯¥åŠŸèƒ½å»æ‰äº†urlä¸­ä¸‘é™‹çš„ # å· åŠŸèƒ½ æ³¨å†Œç™»å½•ç™»å‡º + éªŒè¯ç  å¯†ç æ£€æµ‹ï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º æ£€æµ‹æ˜¯å¦ç™»å½•ï¼Œå¦‚æœæ²¡æœ‰ç™»å½•åˆ™ä¸å…è®¸è¯„è®ºå’Œè¯„ä»· å¯ä»¥ä¸Šä¼ å½±ç‰‡åˆ°åå°ï¼Œè¿›è¡Œå‰å°å±•ç¤º è¯„åˆ†åŠŸèƒ½ï¼Œåˆå§‹åŒ–è¯„åˆ†å¯ä»¥è‡ªç”±è®¾ç½®ï¼Œå¦‚æœæ²¡æœ‰äººlikeåˆ™é»˜è®¤æ˜¾ç¤ºåŸå§‹è¯„åˆ†ï¼Œå¦‚æœæœ‰åˆ™è®¡ç®—å½“å‰videçš„è¯„åˆ† ä¿®æ”¹ç”¨æˆ·åï¼Œæ£€æµ‹ç”¨æˆ·åæ˜¯å¦è·Ÿå…¶ä»–äººé‡å¤ ä¸Šä¼ å¤´åƒï¼Œé»˜è®¤æ²¡æœ‰å¤´åƒ è¯„è®ºåŠŸèƒ½ï¼Œè¯„è®ºä¹‹åå¯ä»¥åœ¨ä¸ªäººä¸­å¿ƒå±•ç¤ºï¼Œå¹¶ä¸”å¯ä»¥åˆ é™¤ æœç´¢åŠŸèƒ½ï¼Œå¯ä»¥æœç´¢å­˜åœ¨çš„å½±ç‰‡ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ˜¾ç¤ºæ— ç»“æœ è‡ªå·±å–œæ¬¢çš„videoå’Œè¯„è®ºçš„å†…å®¹ä¼šåœ¨ä¸ªäººä¸­å¿ƒæ˜¾ç¤º ç»¼ä¸Šï¼š [x] æ³¨å†Œ [x] ç™»å½• [x] ç™»å‡º [x] éªŒè¯ç  [x] è¯¦æƒ…é¡µ [x] åˆ†ç±» [x] åˆ†ç±»å½±è§†åˆ—è¡¨ [x] ä¿®æ”¹ç”¨æˆ·å [x] ä¸Šä¼ å¤´åƒ [x] è¯„è®º [x] åˆ é™¤è¯„è®º [x] æœç´¢ [x] ä¸ªäººä¸­å¿ƒæ•°æ® å¦‚æœè§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©è¿˜æœ›å…³æ³¨ä¸€ä¸‹ï¼Œæœ‰é—®é¢˜å¯ä»¥å³ä½¿æå“Ÿï¼Œè§‰å¾—ä¸é”™çš„è¯starä¸€ä¸‹ä¹Ÿæ˜¯å¯ä»¥çš„å“Ÿ å‰ç«¯çº¿ä¸Šåœ°å€é¡¹ç›®æ˜¯æ‰‹æœºç«¯çš„ï¼Œè¯·ä½¿ç”¨è°·æ­Œæµè§ˆå™¨æ‰‹æœºé¢„è§ˆæ¨¡å¼ é¦–é¡µé»˜è®¤ä¸€ç§ç±»åˆ«åªæ˜¾ç¤º10ä¸ªï¼Œå¯ä»¥æŸ¥çœ‹æ›´å¤šæ˜¾ç¤ºå…¨éƒ¨ é¢„è§ˆï¼švue-video æ‰‹æœºæ‰«æå›¾ä¸‹äºŒç»´ç é¢„è§ˆ åç«¯çº¿ä¸Šåœ°å€æŠ€æœ¯æ ˆï¼šNode + Koa2 + Mysqlé¢„è§ˆï¼švideo-adminGitHub: ç®¡ç†åå° å‰ç«¯æ¼”ç¤º ä¸»é¡µ ç™»å½•é¡µ ä¸ªäººä¸­å¿ƒé¡µ è¯¦æƒ…é¡µ åå°æ¼”ç¤º æœ‰é—®é¢˜æ¬¢è¿åé¦ˆåœ¨ä½¿ç”¨ä¸­æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åé¦ˆç»™æˆ‘ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹è”ç³»æ–¹å¼è·Ÿæˆ‘äº¤æµ é‚®ä»¶(875246904#qq.com, æŠŠ#æ¢æˆ@) QQ: 875246904 weibo: @wclimb ç›®å½•ç»“æ„12345678910111213141516171819|-- build // webpacké…ç½®æ–‡ä»¶|-- config // é¡¹ç›®æ‰“åŒ…è·¯å¾„|-- src // æºç ç›®å½•| |-- assets // å›¾ç‰‡æ–‡ä»¶| |-- base // ç§»åŠ¨ç«¯é€‚é…| |-- components // ç»„ä»¶| |-- data // æ¥å£| |-- router // è·¯ç”±é…ç½®| |-- store // çŠ¶æ€ç®¡ç†| |-- style // æ ·å¼| App.vue // é¡µé¢å…¥å£æ–‡ä»¶| main.js // ç¨‹åºå…¥å£æ–‡ä»¶|-- static // é™æ€èµ„æº|-- .babelrc // ES6è¯­æ³•ç¼–è¯‘é…ç½®|-- .editorconfig // ä»£ç ç¼–å†™è§„æ ¼|-- .gitignore // gitå¿½ç•¥çš„æ–‡ä»¶|-- .postcssrc.js // post-loaderçš„æ’ä»¶é…ç½®æ–‡ä»¶|-- index.html // å…¥å£htmlæ–‡ä»¶|-- package.json // é¡¹ç›®åŠå·¥å…·çš„ä¾èµ–é…ç½®æ–‡ä»¶ ä¸ªäººå°ç¨‹åº]]></content>
      <categories>
        <category>Node</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>Mysql</tag>
        <tag>javascript</tag>
        <tag>Koa</tag>
        <tag>Node</tag>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLåŸºç¡€]]></title>
    <url>%2F2017%2F07%2F20%2FMySQL%E5%9F%BA%E7%A1%80%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ª mysql-tutorial å¼€å§‹ä½¿ç”¨MySQL ä¸ºå…³ç³»å‹æ•°æ®åº“(Relational Database Management System)ï¼Œä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ç”±ä¸€ä¸ªæˆ–æ•°ä¸ªè¡¨æ ¼ç»„æˆ, å¦‚å›¾æ‰€ç¤ºçš„ä¸€ä¸ªè¡¨æ ¼ï¼š è¡¨å¤´(header): æ¯ä¸€åˆ—çš„åç§°; åˆ—(col): å…·æœ‰ç›¸åŒæ•°æ®ç±»å‹çš„æ•°æ®çš„é›†åˆ; è¡Œ(row): æ¯ä¸€è¡Œç”¨æ¥æè¿°æŸä¸ªäºº/ç‰©çš„å…·ä½“ä¿¡æ¯; å€¼(value): è¡Œçš„å…·ä½“ä¿¡æ¯, æ¯ä¸ªå€¼å¿…é¡»ä¸è¯¥åˆ—çš„æ•°æ®ç±»å‹ç›¸åŒ; é”®(key): è¡¨ä¸­ç”¨æ¥è¯†åˆ«æŸä¸ªç‰¹å®šçš„äºº\ç‰©çš„æ–¹æ³•, é”®çš„å€¼åœ¨å½“å‰åˆ—ä¸­å…·æœ‰å”¯ä¸€æ€§ã€‚ç™»å½•MySQL 123456mysql -h 127.0.0.1 -u ç”¨æˆ·å -pmysql -D æ‰€é€‰æ‹©çš„æ•°æ®åº“å -h ä¸»æœºå -u ç”¨æˆ·å -pmysql&gt; exit # é€€å‡º ä½¿ç”¨ â€œquit;â€ æˆ– â€œ\q;â€ ä¸€æ ·çš„æ•ˆæœmysql&gt; status; # æ˜¾ç¤ºå½“å‰mysqlçš„versionçš„å„ç§ä¿¡æ¯mysql&gt; select version(); # æ˜¾ç¤ºå½“å‰mysqlçš„versionä¿¡æ¯mysql&gt; show global variables like 'port'; # æŸ¥çœ‹MySQLç«¯å£å· åˆ›å»ºæ•°æ®åº“å¯¹äºè¡¨çš„æ“ä½œéœ€è¦å…ˆè¿›å…¥åº“use åº“å; 12345678-- åˆ›å»ºä¸€ä¸ªåä¸º samp_db çš„æ•°æ®åº“ï¼Œæ•°æ®åº“å­—ç¬¦ç¼–ç æŒ‡å®šä¸º gbkcreate database samp_db character set gbk;drop database samp_db; -- åˆ é™¤ åº“åä¸ºsamp_dbçš„åº“show databases; -- æ˜¾ç¤ºæ•°æ®åº“åˆ—è¡¨ã€‚use samp_db; -- é€‰æ‹©åˆ›å»ºçš„æ•°æ®åº“samp_dbshow tables; -- æ˜¾ç¤ºsamp_dbä¸‹é¢æ‰€æœ‰çš„è¡¨åå­—describe è¡¨å; -- æ˜¾ç¤ºæ•°æ®è¡¨çš„ç»“æ„delete from è¡¨å; -- æ¸…ç©ºè¡¨ä¸­è®°å½• åˆ›å»ºæ•°æ®åº“è¡¨ ä½¿ç”¨ create table è¯­å¥å¯å®Œæˆå¯¹è¡¨çš„åˆ›å»º, create table çš„å¸¸è§å½¢å¼:è¯­æ³•ï¼šcreate table è¡¨åç§°(åˆ—å£°æ˜); 1234567891011121314-- å¦‚æœæ•°æ®åº“ä¸­å­˜åœ¨user_accountsè¡¨ï¼Œå°±æŠŠå®ƒä»æ•°æ®åº“ä¸­dropæ‰DROP TABLE IF EXISTS `user_accounts`;CREATE TABLE `user_accounts` ( `id` int(100) unsigned NOT NULL AUTO_INCREMENT primary key, `password` varchar(32) NOT NULL DEFAULT '' COMMENT 'ç”¨æˆ·å¯†ç ', `reset_password` tinyint(32) NOT NULL DEFAULT 0 COMMENT 'ç”¨æˆ·ç±»å‹ï¼š0ï¼ä¸éœ€è¦é‡ç½®å¯†ç ï¼›1-éœ€è¦é‡ç½®å¯†ç ', `mobile` varchar(20) NOT NULL DEFAULT '' COMMENT 'æ‰‹æœº', `create_at` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6), `update_at` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6), -- åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œä¸å…è®¸é‡å¤ UNIQUE INDEX idx_user_mobile(`mobile`))ENGINE=InnoDB DEFAULT CHARSET=utf8COMMENT='ç”¨æˆ·è¡¨ä¿¡æ¯'; æ•°æ®ç±»å‹çš„å±æ€§è§£é‡Š NULLï¼šæ•°æ®åˆ—å¯åŒ…å«NULLå€¼ï¼› NOT NULLï¼šæ•°æ®åˆ—ä¸å…è®¸åŒ…å«NULLå€¼ï¼› DEFAULTï¼šé»˜è®¤å€¼ï¼› PRIMARYï¼šKEY ä¸»é”®ï¼› AUTO_INCREMENTï¼šè‡ªåŠ¨é€’å¢ï¼Œé€‚ç”¨äºæ•´æ•°ç±»å‹ï¼› UNSIGNEDï¼šæ˜¯æŒ‡æ•°å€¼ç±»å‹åªèƒ½ä¸ºæ­£æ•°ï¼› CHARACTER SET nameï¼šæŒ‡å®šä¸€ä¸ªå­—ç¬¦é›†ï¼› COMMENTï¼šå¯¹è¡¨æˆ–è€…å­—æ®µè¯´æ˜ï¼› å¢åˆ æ”¹æŸ¥SELECT SELECT è¯­å¥ç”¨äºä»è¡¨ä¸­é€‰å–æ•°æ®ã€‚è¯­æ³•ï¼šSELECT åˆ—åç§° FROM è¡¨åç§°è¯­æ³•ï¼šSELECT * FROM è¡¨åç§° 12345678910111213141516171819-- è¡¨stationå–ä¸ªåˆ«åå«sï¼Œè¡¨stationä¸­ä¸åŒ…å« å­—æ®µid=13æˆ–è€…14 çš„ï¼Œå¹¶ä¸”idä¸ç­‰äº4çš„ æŸ¥è¯¢å‡ºæ¥ï¼Œåªæ˜¾ç¤ºidSELECT s.id from station s WHERE id in (13,14) and id not in (4);-- ä»è¡¨ Persons é€‰å– LastName åˆ—çš„æ•°æ®SELECT LastName FROM Persons-- ä»è¡¨ users é€‰å– id=3 çš„æ•°æ®ï¼Œå¹¶åªæ‹‰ä¸€æ¡æ•°æ®(æ®è¯´èƒ½ä¼˜åŒ–æ€§èƒ½)SELECT * FROM users where id=3 limit 1-- ç»“æœé›†ä¸­ä¼šè‡ªåŠ¨å»é‡å¤æ•°æ®SELECT DISTINCT Company FROM Orders -- è¡¨ Persons å­—æ®µ Id_P ç­‰äº Orders å­—æ®µ Id_P çš„å€¼ï¼Œ-- ç»“æœé›†æ˜¾ç¤º Personsè¡¨çš„ LastNameã€FirstNameå­—æ®µï¼ŒOrdersè¡¨çš„OrderNoå­—æ®µSELECT p.LastName, p.FirstName, o.OrderNo FROM Persons p, Orders o WHERE p.Id_P = o.Id_P -- gbk å’Œ utf8 ä¸­è‹±æ–‡æ··åˆæ’åºæœ€ç®€å•çš„åŠæ³• -- ciæ˜¯ case insensitive, å³ â€œå¤§å°å†™ä¸æ•æ„Ÿâ€SELECT tag, COUNT(tag) from news GROUP BY tag order by convert(tag using gbk) collate gbk_chinese_ci;SELECT tag, COUNT(tag) from news GROUP BY tag order by convert(tag using utf8) collate utf8_unicode_ci; UPDATE Update è¯­å¥ç”¨äºä¿®æ”¹è¡¨ä¸­çš„æ•°æ®ã€‚è¯­æ³•ï¼šUPDATE è¡¨åç§° SET åˆ—åç§° = æ–°å€¼ WHERE åˆ—åç§° = æŸå€¼ 12345-- updateè¯­å¥è®¾ç½®å­—æ®µå€¼ä¸ºå¦ä¸€ä¸ªç»“æœå–å‡ºæ¥çš„å­—æ®µupdate user set name = (select name from user1 where user1 .id = 1 )where id = (select id from user2 where user2 .name='å°è‹');-- æ›´æ–°è¡¨ orders ä¸­ id=1 çš„é‚£ä¸€è¡Œæ•°æ®æ›´æ–°å®ƒçš„ title å­—æ®µUPDATE `orders` set title='è¿™é‡Œæ˜¯æ ‡é¢˜' WHERE id=1; INSERT INSERT INTO è¯­å¥ç”¨äºå‘è¡¨æ ¼ä¸­æ’å…¥æ–°çš„è¡Œã€‚è¯­æ³•ï¼šINSERT INTO è¡¨åç§° VALUES (å€¼1, å€¼2,....)è¯­æ³•ï¼šINSERT INTO è¡¨åç§° (åˆ—1, åˆ—2,...) VALUES (å€¼1, å€¼2,....) 123456789101112-- å‘è¡¨ Persons æ’å…¥ä¸€æ¡å­—æ®µ LastName = JSLite å­—æ®µ Address = shanghaiINSERT INTO Persons (LastName, Address) VALUES ('JSLite', 'shanghai');-- å‘è¡¨ meeting æ’å…¥ å­—æ®µ a=1 å’Œå­—æ®µ b=2INSERT INTO meeting SET a=1,b=2;-- -- SQLå®ç°å°†ä¸€ä¸ªè¡¨çš„æ•°æ®æ’å…¥åˆ°å¦å¤–ä¸€ä¸ªè¡¨çš„ä»£ç -- å¦‚æœåªå¸Œæœ›å¯¼å…¥æŒ‡å®šå­—æ®µï¼Œå¯ä»¥ç”¨è¿™ç§æ–¹æ³•ï¼š-- INSERT INTO ç›®æ ‡è¡¨ (å­—æ®µ1, å­—æ®µ2, ...) SELECT å­—æ®µ1, å­—æ®µ2, ... FROM æ¥æºè¡¨;INSERT INTO orders (user_account_id, title) SELECT m.user_id, m.title FROM meeting m where m.id=1;-- å‘è¡¨ charger æ’å…¥ä¸€æ¡æ•°æ®ï¼Œå·²å­˜åœ¨å°±å¯¹è¡¨ charger æ›´æ–° `type`,`update_at` å­—æ®µï¼›INSERT INTO `charger` (`id`,`type`,`create_at`,`update_at`) VALUES (3,2,'2017-05-18 11:06:17','2017-05-18 11:06:17') ON DUPLICATE KEY UPDATE `id`=VALUES(`id`), `type`=VALUES(`type`), `update_at`=VALUES(`update_at`); DELETE DELETE è¯­å¥ç”¨äºåˆ é™¤è¡¨ä¸­çš„è¡Œã€‚è¯­æ³•ï¼šDELETE FROM è¡¨åç§° WHERE åˆ—åç§° = å€¼ 12345678-- åœ¨ä¸åˆ é™¤table_nameè¡¨çš„æƒ…å†µä¸‹åˆ é™¤æ‰€æœ‰çš„è¡Œï¼Œæ¸…ç©ºè¡¨ã€‚DELETE FROM table_name-- æˆ–è€…DELETE * FROM table_name-- åˆ é™¤ Personè¡¨å­—æ®µ LastName = 'JSLite' DELETE FROM Person WHERE LastName = 'JSLite' -- åˆ é™¤ è¡¨meeting id ä¸º2å’Œ3çš„ä¸¤æ¡æ•°æ®DELETE from meeting where id in (2,3); WHERE WHERE å­å¥ç”¨äºè§„å®šé€‰æ‹©çš„æ ‡å‡†ã€‚è¯­æ³•ï¼šSELECT åˆ—åç§° FROM è¡¨åç§° WHERE åˆ— è¿ç®—ç¬¦ å€¼ 12-- ä»è¡¨ Persons ä¸­é€‰å‡º Year å­—æ®µå¤§äº 1965 çš„æ•°æ®SELECT * FROM Persons WHERE Year&gt;1965 AND å’Œ OR AND - å¦‚æœç¬¬ä¸€ä¸ªæ¡ä»¶å’Œç¬¬äºŒä¸ªæ¡ä»¶éƒ½æˆç«‹ï¼›OR - å¦‚æœç¬¬ä¸€ä¸ªæ¡ä»¶å’Œç¬¬äºŒä¸ªæ¡ä»¶ä¸­åªè¦æœ‰ä¸€ä¸ªæˆç«‹ï¼› AND1234567-- åˆ é™¤ meeting è¡¨å­—æ®µ -- id=2 å¹¶ä¸” user_id=5 çš„æ•°æ® å’Œ-- id=3 å¹¶ä¸” user_id=6 çš„æ•°æ® DELETE from meeting where id in (2,3) and user_id in (5,6);-- ä½¿ç”¨ AND æ¥æ˜¾ç¤ºæ‰€æœ‰å§“ä¸º "Carter" å¹¶ä¸”åä¸º "Thomas" çš„äººï¼šSELECT * FROM Persons WHERE FirstName='Thomas' AND LastName='Carter'; OR12-- ä½¿ç”¨ OR æ¥æ˜¾ç¤ºæ‰€æœ‰å§“ä¸º "Carter" æˆ–è€…åä¸º "Thomas" çš„äººï¼šSELECT * FROM Persons WHERE firstname='Thomas' OR lastname='Carter' ORDER BY è¯­å¥é»˜è®¤æŒ‰ç…§å‡åºå¯¹è®°å½•è¿›è¡Œæ’åºã€‚ORDER BY - è¯­å¥ç”¨äºæ ¹æ®æŒ‡å®šçš„åˆ—å¯¹ç»“æœé›†è¿›è¡Œæ’åºã€‚DESC - æŒ‰ç…§é™åºå¯¹è®°å½•è¿›è¡Œæ’åºã€‚ASC - æŒ‰ç…§é¡ºåºå¯¹è®°å½•è¿›è¡Œæ’åºã€‚ 12345678-- Companyåœ¨è¡¨Ordersä¸­ä¸ºå­—æ¯ï¼Œåˆ™ä¼šä»¥å­—æ¯é¡ºåºæ˜¾ç¤ºå…¬å¸åç§°SELECT Company, OrderNumber FROM Orders ORDER BY Company-- åé¢è·Ÿä¸Š DESC åˆ™ä¸ºé™åºæ˜¾ç¤ºSELECT Company, OrderNumber FROM Orders ORDER BY Company DESC-- Companyä»¥é™åºæ˜¾ç¤ºå…¬å¸åç§°ï¼Œå¹¶OrderNumberä»¥é¡ºåºæ˜¾ç¤ºSELECT Company, OrderNumber FROM Orders ORDER BY Company DESC, OrderNumber ASC IN IN - æ“ä½œç¬¦å…è®¸æˆ‘ä»¬åœ¨ WHERE å­å¥ä¸­è§„å®šå¤šä¸ªå€¼ã€‚IN - æ“ä½œç¬¦ç”¨æ¥æŒ‡å®šèŒƒå›´ï¼ŒèŒƒå›´ä¸­çš„æ¯ä¸€æ¡ï¼Œéƒ½è¿›è¡ŒåŒ¹é…ã€‚INå–å€¼è§„å¾‹ï¼Œç”±é€—å·åˆ†å‰²ï¼Œå…¨éƒ¨æ”¾ç½®æ‹¬å·ä¸­ã€‚è¯­æ³•ï¼šSELECT &quot;å­—æ®µå&quot;FROM &quot;è¡¨æ ¼å&quot;WHERE &quot;å­—æ®µå&quot; IN (&#39;å€¼ä¸€&#39;, &#39;å€¼äºŒ&#39;, ...); 12-- ä»è¡¨ Persons é€‰å– å­—æ®µ LastName ç­‰äº Adamsã€CarterSELECT * FROM Persons WHERE LastName IN ('Adams','Carter') NOT NOT - æ“ä½œç¬¦æ€»æ˜¯ä¸å…¶ä»–æ“ä½œç¬¦ä¸€èµ·ä½¿ç”¨ï¼Œç”¨åœ¨è¦è¿‡æ»¤çš„å‰é¢ã€‚ 1SELECT vend_id, prod_name FROM Products WHERE NOT vend_id = 'DLL01' ORDER BY prod_name; UNION UNION - æ“ä½œç¬¦ç”¨äºåˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ª SELECT è¯­å¥çš„ç»“æœé›†ã€‚ 123456789-- åˆ—å‡ºæ‰€æœ‰åœ¨ä¸­å›½è¡¨ï¼ˆEmployees_Chinaï¼‰å’Œç¾å›½ï¼ˆEmployees_USAï¼‰çš„ä¸åŒçš„é›‡å‘˜åSELECT E_Name FROM Employees_China UNION SELECT E_Name FROM Employees_USA-- åˆ—å‡º meeting è¡¨ä¸­çš„ pic_urlï¼Œ-- station è¡¨ä¸­çš„ number_station åˆ«åè®¾ç½®æˆ pic_url é¿å…å­—æ®µä¸ä¸€æ ·æŠ¥é”™-- æŒ‰æ›´æ–°æ—¶é—´æ’åºSELECT id,pic_url FROM meeting UNION ALL SELECT id,number_station AS pic_url FROM station ORDER BY update_at;-- é€šè¿‡ UNION è¯­æ³•åŒæ—¶æŸ¥è¯¢äº† products è¡¨ å’Œ comments è¡¨çš„æ€»è®°å½•æ•°ï¼Œå¹¶ä¸”æŒ‰ç…§ count æ’åºSELECT 'product' AS type, count(*) as count FROM `products` union select 'comment' as type, count(*) as count FROM `comments` order by count; AS as - å¯ç†è§£ä¸ºï¼šç”¨ä½œã€å½“æˆï¼Œä½œä¸ºï¼›åˆ«åä¸€èˆ¬æ˜¯é‡å‘½ååˆ—åæˆ–è€…è¡¨åã€‚è¯­æ³•ï¼šselect column_1 as åˆ—1,column_2 as åˆ—2 from table as è¡¨ 12345678910111213141516SELECT * FROM Employee AS emp-- è¿™å¥æ„æ€æ˜¯æŸ¥æ‰¾æ‰€æœ‰Employee è¡¨é‡Œé¢çš„æ•°æ®ï¼Œå¹¶æŠŠEmployeeè¡¨æ ¼å‘½åä¸º empã€‚-- å½“ä½ å‘½åä¸€ä¸ªè¡¨ä¹‹åï¼Œä½ å¯ä»¥åœ¨ä¸‹é¢ç”¨ emp ä»£æ›¿ Employee.-- ä¾‹å¦‚ SELECT * FROM emp.SELECT MAX(OrderPrice) AS LargestOrderPrice FROM Orders-- åˆ—å‡ºè¡¨ Orders å­—æ®µ OrderPrice åˆ—æœ€å¤§å€¼ï¼Œ-- ç»“æœé›†åˆ—ä¸æ˜¾ç¤º OrderPrice æ˜¾ç¤º LargestOrderPrice-- æ˜¾ç¤ºè¡¨ users_profile ä¸­çš„ name åˆ—SELECT t.name from (SELECT * from users_profile a) AS t;-- è¡¨ user_accounts å‘½ååˆ«å uaï¼Œè¡¨ users_profile å‘½ååˆ«å up-- æ»¡è¶³æ¡ä»¶ è¡¨ user_accounts å­—æ®µ id ç­‰äº è¡¨ users_profile å­—æ®µ user_id-- ç»“æœé›†åªæ˜¾ç¤ºmobileã€nameä¸¤åˆ—SELECT ua.mobile,up.name FROM user_accounts as ua INNER JOIN users_profile as up ON ua.id = up.user_id; JOIN ç”¨äºæ ¹æ®ä¸¤ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­çš„åˆ—ä¹‹é—´çš„å…³ç³»ï¼Œä»è¿™äº›è¡¨ä¸­æŸ¥è¯¢æ•°æ®ã€‚ JOIN: å¦‚æœè¡¨ä¸­æœ‰è‡³å°‘ä¸€ä¸ªåŒ¹é…ï¼Œåˆ™è¿”å›è¡Œ INNER JOIN:åœ¨è¡¨ä¸­å­˜åœ¨è‡³å°‘ä¸€ä¸ªåŒ¹é…æ—¶ï¼ŒINNER JOIN å…³é”®å­—è¿”å›è¡Œã€‚ LEFT JOIN: å³ä½¿å³è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œä¹Ÿä»å·¦è¡¨è¿”å›æ‰€æœ‰çš„è¡Œ RIGHT JOIN: å³ä½¿å·¦è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œä¹Ÿä»å³è¡¨è¿”å›æ‰€æœ‰çš„è¡Œ FULL JOIN: åªè¦å…¶ä¸­ä¸€ä¸ªè¡¨ä¸­å­˜åœ¨åŒ¹é…ï¼Œå°±è¿”å›è¡Œ 12345SELECT Persons.LastName, Persons.FirstName, Orders.OrderNoFROM PersonsINNER JOIN OrdersON Persons.Id_P = Orders.Id_PORDER BY Persons.LastName; SQL å‡½æ•°COUNT COUNT è®©æˆ‘ä»¬èƒ½å¤Ÿæ•°å‡ºåœ¨è¡¨æ ¼ä¸­æœ‰å¤šå°‘ç¬”èµ„æ–™è¢«é€‰å‡ºæ¥ã€‚è¯­æ³•ï¼šSELECT COUNT(&quot;å­—æ®µå&quot;) FROM &quot;è¡¨æ ¼å&quot;; 1234567-- è¡¨ Store_Information æœ‰å‡ ç¬” store_name æ ä¸æ˜¯ç©ºç™½çš„èµ„æ–™ã€‚-- "IS NOT NULL" æ˜¯ "è¿™ä¸ªæ ä½ä¸æ˜¯ç©ºç™½" çš„æ„æ€ã€‚SELECT COUNT (Store_Name) FROM Store_Information WHERE Store_Name IS NOT NULL; -- è·å– Persons è¡¨çš„æ€»æ•°SELECT COUNT(1) AS totals FROM Persons;-- è·å–è¡¨ station å­—æ®µ user_id ç›¸åŒçš„æ€»æ•°select user_id, count(*) as totals from station group by user_id; MAX MAX å‡½æ•°è¿”å›ä¸€åˆ—ä¸­çš„æœ€å¤§å€¼ã€‚NULL å€¼ä¸åŒ…æ‹¬åœ¨è®¡ç®—ä¸­ã€‚è¯­æ³•ï¼šSELECT MAX(&quot;å­—æ®µå&quot;) FROM &quot;è¡¨æ ¼å&quot; 123-- åˆ—å‡ºè¡¨ Orders å­—æ®µ OrderPrice åˆ—æœ€å¤§å€¼ï¼Œ-- ç»“æœé›†åˆ—ä¸æ˜¾ç¤º OrderPrice æ˜¾ç¤º LargestOrderPriceSELECT MAX(OrderPrice) AS LargestOrderPrice FROM Orders è§¦å‘å™¨ è¯­æ³•ï¼šcreate trigger &lt;è§¦å‘å™¨åç§°&gt;{ before | after} # ä¹‹å‰æˆ–è€…ä¹‹åå‡ºå‘insert | update | delete # æŒ‡æ˜äº†æ¿€æ´»è§¦å‘ç¨‹åºçš„è¯­å¥çš„ç±»å‹on &lt;è¡¨å&gt; # æ“ä½œå“ªå¼ è¡¨for each row # è§¦å‘å™¨çš„æ‰§è¡Œé—´éš”ï¼Œfor each row é€šçŸ¥è§¦å‘å™¨æ¯éš”ä¸€è¡Œæ‰§è¡Œä¸€æ¬¡åŠ¨ä½œï¼Œè€Œä¸æ˜¯å¯¹æ•´ä¸ªè¡¨æ‰§è¡Œä¸€æ¬¡ã€‚&lt;è§¦å‘å™¨SQLè¯­å¥&gt; 123456789101112delimiter $CREATE TRIGGER set_userdate BEFORE INSERT on `message`for EACH ROWBEGIN set @statu = new.status; -- å£°æ˜å¤åˆ¶å˜é‡ statu if @statu = 0 then -- åˆ¤æ–­ statu æ˜¯å¦ç­‰äº 0 UPDATE `user_accounts` SET status=1 WHERE openid=NEW.openid; end if;END$DELIMITER ; -- æ¢å¤ç»“æŸç¬¦å· OLDå’ŒNEWä¸åŒºåˆ†å¤§å°å†™ NEW ç”¨NEW.col_nameï¼Œæ²¡æœ‰æ—§è¡Œã€‚åœ¨DELETEè§¦å‘ç¨‹åºä¸­ï¼Œä»…èƒ½ä½¿ç”¨OLD.col_nameï¼Œæ²¡æœ‰æ–°è¡Œã€‚ OLD ç”¨OLD.col_nameæ¥å¼•ç”¨æ›´æ–°å‰çš„æŸä¸€è¡Œçš„åˆ— æ·»åŠ ç´¢å¼•æ™®é€šç´¢å¼•(INDEX) è¯­æ³•ï¼šALTER TABLE è¡¨åå­— ADD INDEX ç´¢å¼•åå­— ( å­—æ®µåå­— ) 1234567891011121314151617-- â€“ç›´æ¥åˆ›å»ºç´¢å¼•CREATE INDEX index_user ON user(title)-- â€“ä¿®æ”¹è¡¨ç»“æ„çš„æ–¹å¼æ·»åŠ ç´¢å¼•ALTER TABLE table_name ADD INDEX index_name ON (column(length))-- ç»™ user è¡¨ä¸­çš„ nameå­—æ®µ æ·»åŠ æ™®é€šç´¢å¼•(INDEX)ALTER TABLE `table` ADD INDEX index_name (name)-- â€“åˆ›å»ºè¡¨çš„æ—¶å€™åŒæ—¶åˆ›å»ºç´¢å¼•CREATE TABLE `table` ( `id` int(11) NOT NULL AUTO_INCREMENT , `title` char(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL , `content` text CHARACTER SET utf8 COLLATE utf8_general_ci NULL , `time` int(10) NULL DEFAULT NULL , PRIMARY KEY (`id`), INDEX index_name (title(length)))-- â€“åˆ é™¤ç´¢å¼•DROP INDEX index_name ON table ä¸»é”®ç´¢å¼•(PRIMARY key) è¯­æ³•ï¼šALTER TABLE è¡¨åå­— ADD PRIMARY KEY ( å­—æ®µåå­— ) 12-- ç»™ user è¡¨ä¸­çš„ idå­—æ®µ æ·»åŠ ä¸»é”®ç´¢å¼•(PRIMARY key)ALTER TABLE `user` ADD PRIMARY key (id); å”¯ä¸€ç´¢å¼•(UNIQUE) è¯­æ³•ï¼šALTER TABLE è¡¨åå­— ADD UNIQUE (å­—æ®µåå­—) 12-- ç»™ user è¡¨ä¸­çš„ creattime å­—æ®µæ·»åŠ å”¯ä¸€ç´¢å¼•(UNIQUE)ALTER TABLE `user` ADD UNIQUE (creattime); å…¨æ–‡ç´¢å¼•(FULLTEXT) è¯­æ³•ï¼šALTER TABLE è¡¨åå­— ADD FULLTEXT (å­—æ®µåå­—) 12-- ç»™ user è¡¨ä¸­çš„ description å­—æ®µæ·»åŠ å…¨æ–‡ç´¢å¼•(FULLTEXT)ALTER TABLE `user` ADD FULLTEXT (description); æ·»åŠ å¤šåˆ—ç´¢å¼• è¯­æ³•ï¼šALTER TABLE table_name ADD INDEX index_name ( column1, column2, column3) 12-- ç»™ user è¡¨ä¸­çš„ nameã€cityã€age å­—æ®µæ·»åŠ åå­—ä¸ºname_city_ageçš„æ™®é€šç´¢å¼•(INDEX)ALTER TABLE user ADD INDEX name_city_age (name(10),city,age); å»ºç«‹ç´¢å¼•çš„æ—¶æœºåœ¨WHEREå’ŒJOINä¸­å‡ºç°çš„åˆ—éœ€è¦å»ºç«‹ç´¢å¼•ï¼Œä½†ä¹Ÿä¸å®Œå…¨å¦‚æ­¤ï¼š MySQLåªå¯¹&lt;ï¼Œ&lt;=ï¼Œ=ï¼Œ&gt;ï¼Œ&gt;=ï¼ŒBETWEENï¼ŒINä½¿ç”¨ç´¢å¼• æŸäº›æ—¶å€™çš„LIKEä¹Ÿä¼šä½¿ç”¨ç´¢å¼•ã€‚ åœ¨LIKEä»¥é€šé…ç¬¦%å’Œ_å¼€å¤´ä½œæŸ¥è¯¢æ—¶ï¼ŒMySQLä¸ä¼šä½¿ç”¨ç´¢å¼•ã€‚ 12345678-- æ­¤æ—¶å°±éœ€è¦å¯¹cityå’Œageå»ºç«‹ç´¢å¼•ï¼Œ-- ç”±äºmytableè¡¨çš„userameä¹Ÿå‡ºç°åœ¨äº†JOINå­å¥ä¸­ï¼Œä¹Ÿæœ‰å¯¹å®ƒå»ºç«‹ç´¢å¼•çš„å¿…è¦ã€‚SELECT t.Name FROM mytable t LEFT JOIN mytable m ON t.Name=m.username WHERE m.age=20 AND m.city='ä¸Šæµ·';SELECT * FROM mytable WHERE username like'admin%'; -- è€Œä¸‹å¥å°±ä¸ä¼šä½¿ç”¨ï¼šSELECT * FROM mytable WHEREt Name like'%admin'; -- å› æ­¤ï¼Œåœ¨ä½¿ç”¨LIKEæ—¶åº”æ³¨æ„ä»¥ä¸Šçš„åŒºåˆ«ã€‚ ç´¢å¼•çš„æ³¨æ„äº‹é¡¹ ç´¢å¼•ä¸ä¼šåŒ…å«æœ‰NULLå€¼çš„åˆ— ä½¿ç”¨çŸ­ç´¢å¼• ä¸è¦åœ¨åˆ—ä¸Šè¿›è¡Œè¿ç®— ç´¢å¼•ä¼šå¤±æ•ˆ åˆ›å»ºåè¡¨çš„ä¿®æ”¹æ·»åŠ åˆ— è¯­æ³•ï¼šalter table è¡¨å add åˆ—å åˆ—æ•°æ®ç±»å‹ [after æ’å…¥ä½ç½®]; ç¤ºä¾‹: 123456-- åœ¨è¡¨studentsçš„æœ€åè¿½åŠ åˆ— address: alter table students add address char(60);-- åœ¨åä¸º age çš„åˆ—åæ’å…¥åˆ— birthday: alter table students add birthday date after age;-- åœ¨åä¸º number_people çš„åˆ—åæ’å…¥åˆ— weeks: alter table students add column `weeks` varchar(5) not null default "" after `number_people`; ä¿®æ”¹åˆ— è¯­æ³•ï¼šalter table è¡¨å change åˆ—åç§° åˆ—æ–°åç§° æ–°æ•°æ®ç±»å‹; 123456789-- å°†è¡¨ tel åˆ—æ”¹åä¸º telphone: alter table students change tel telphone char(13) default "-";-- å°† name åˆ—çš„æ•°æ®ç±»å‹æ”¹ä¸º char(16): alter table students change name name char(16) not null;-- ä¿®æ”¹ COMMENT å‰é¢å¿…é¡»å¾—æœ‰ç±»å‹å±æ€§alter table students change name name char(16) COMMENT 'è¿™é‡Œæ˜¯åå­—';-- ä¿®æ”¹åˆ—å±æ€§çš„æ—¶å€™ å»ºè®®ä½¿ç”¨modify,ä¸éœ€è¦é‡å»ºè¡¨-- changeç”¨äºä¿®æ”¹åˆ—åå­—ï¼Œè¿™ä¸ªéœ€è¦é‡å»ºè¡¨alter table meeting modify `weeks` varchar(20) NOT NULL DEFAULT "" COMMENT "å¼€æ”¾æ—¥æœŸ å‘¨ä¸€åˆ°å‘¨æ—¥ï¼š0~6ï¼Œé—´éš”ç”¨è‹±æ–‡é€—å·éš”å¼€"; åˆ é™¤åˆ— è¯­æ³•ï¼šalter table è¡¨å drop åˆ—åç§°; 12-- åˆ é™¤è¡¨studentsä¸­çš„ birthday åˆ—: alter table students drop birthday; é‡å‘½åè¡¨ è¯­æ³•ï¼šalter table è¡¨å rename æ–°è¡¨å; 12-- é‡å‘½å students è¡¨ä¸º workmates: alter table students rename workmates; æ¸…ç©ºè¡¨æ•°æ® æ–¹æ³•ä¸€ï¼šdelete from è¡¨å;æ–¹æ³•äºŒï¼štruncate from &quot;è¡¨å&quot;; DELETE:1. DMLè¯­è¨€;2. å¯ä»¥å›é€€;3. å¯ä»¥æœ‰æ¡ä»¶çš„åˆ é™¤; TRUNCATE:1. DDLè¯­è¨€;2. æ— æ³•å›é€€;3. é»˜è®¤æ‰€æœ‰çš„è¡¨å†…å®¹éƒ½åˆ é™¤;4. åˆ é™¤é€Ÿåº¦æ¯”deleteå¿«ã€‚ 1234-- æ¸…ç©ºè¡¨ä¸º workmates é‡Œé¢çš„æ•°æ®ï¼Œä¸åˆ é™¤è¡¨ã€‚ delete from workmates;-- åˆ é™¤workmatesè¡¨ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œä¸”æ— æ³•æ¢å¤truncate from workmates; åˆ é™¤æ•´å¼ è¡¨ è¯­æ³•ï¼šdrop table è¡¨å; 12-- åˆ é™¤ workmates è¡¨: drop table workmates; åˆ é™¤æ•´ä¸ªæ•°æ®åº“ è¯­æ³•ï¼šdrop database æ•°æ®åº“å; 12-- åˆ é™¤ samp_db æ•°æ®åº“: drop database samp_db; ä¸ªäººå°ç¨‹åº]]></content>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>mysql</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¯»zeptoæºç ï¼Œå°è£…è‡ªå·±çš„zeptoåº“ ï¼ˆä¸‰ï¼‰]]></title>
    <url>%2F2017%2F07%2F18%2F%E8%AF%BBzepto%E6%BA%90%E7%A0%81%EF%BC%8C%E5%B0%81%E8%A3%85%E8%87%AA%E5%B7%B1%E7%9A%84zepto%E5%BA%93-%EF%BC%88%E4%B8%89%EF%BC%89%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡ç€é‡è®²é€‰æ‹©å™¨$()é€‰æ‹©å™¨æœ¬ä¾‹æˆ‘ä»¬ä¸»è¦ä¿®æ”¹wclimb.init=function(selector){}é‡Œé¢çš„ä»£ç å°†wclimb.initä»£ç ä¿®æ”¹ä¸ºï¼š1234567891011121314151617181920var domif (!selector) return wclimb.Z()else if (typeof selector == 'string') &#123; dom = wclimb.qsa(document, selector)&#125;else if (typeof selector == 'function')&#123; return wclimb.ready(selector)&#125;else&#123; if (isArray(selector)) &#123; dom = compact(selector) &#125; else if (wclimb.isZ(selector)) return selector else&#123; if (isObject(selector)) dom = [selector], selector = null ; else dom=wclimb.qsa(document,selector) &#125;&#125;return wclimb.Z(dom, selector) é¦–å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨selectorï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ç›´æ¥return ç„¶ååˆ¤æ–­æ˜¯å¦æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚$(&#39;a b&#39;)ï¼Œå°†é€‰æ‹©çš„å…ƒç´ ä¿å­˜èµ·æ¥ å¦‚æœæ˜¯å‡½æ•°åˆ™return wclimb.ready(selector)å°±æ˜¯æˆ‘ä»¬ç»å¸¸ç”¨çš„$(function(){}) åé¢åˆ¤æ–­æ˜¯å¦æ˜¯å½“å‰å¯¹è±¡çš„å®ä¾‹ï¼ˆç”¨äº†isZæ–¹æ³•ï¼‰è¿˜æœ‰åˆ¤æ–­æ˜¯å¦æ˜¯æ•°ç»„æˆ–å¯¹è±¡ æˆ‘ä»¬å…ˆåœ¨å‡½æ•°é¡¶éƒ¨æ·»åŠ å¦‚ä¸‹123emptyArray = [], concat = emptyArray.concat, filter = emptyArray.filterslice = emptyArray.slicefunction compact(array) &#123; return filter.call(array, function(item)&#123; return item != null &#125;) &#125; emptyArray = []ï¼Œé¿å…å‡ºç°æ¯æ¬¡éƒ½é‡å¤åˆ›å»ºçš„ä¸€ä¸ªæ•°ç»„[]ç„¶åæ‹¿åˆ°æ•°ç»„é‡Œé¢çš„æ–¹æ³•compactå°±æ˜¯ä¸€ä¸ªæ•°ç»„ç­›é€‰ï¼Œå¦‚æœæŸä¸ªå…ƒç´ ä¸å­˜åœ¨$([1,2,,,4]);åªä¼šåˆ›å»ºä¸€ä¸ª[1,2,4]çš„æ•°ç»„ wclimb.qsaæ–¹æ³•1234567891011121314151617wclimb.qsa=function(element, selector)&#123; var found, maybeID = selector[0] == '#', maybeClass = !maybeID &amp;&amp; selector[0] == '.', nameOnly = maybeID || maybeClass ? selector.slice(1) : selector, // Ensure that a 1 char tag name still gets checked isSimple = /^[\w-]*$/.test(nameOnly) return (element.getElementById &amp;&amp; isSimple &amp;&amp; maybeID) ? // Safari DocumentFragment doesn't have getElementById ( (found = element.getElementById(nameOnly)) ? [found] : [] ) : (element.nodeType !== 1 &amp;&amp; element.nodeType !== 9 &amp;&amp; element.nodeType !== 11) ? [] : slice.call( isSimple &amp;&amp; !maybeID &amp;&amp; element.getElementsByClassName ? // DocumentFragment doesn't have getElementsByClassName/TagName maybeClass ? element.getElementsByClassName(nameOnly) : // If it's simple, it could be a class element.getElementsByTagName(selector) : // Or a tag element.querySelectorAll(selector) // Or it's not simple, and we need to query all )&#125; è¿™é‡Œæˆ‘ç›´æ¥ç”¨äº†zeptoçš„ä»£ç wclimb.init=function(selector){}é‡Œçš„ä»£ç è¿˜ä½¿ç”¨äº†åˆ¤æ–­æ•°æ®ç±»å‹çš„ä»£ç isArray`isObject` åˆ¤æ–­æ•°æ®ç±»å‹åœ¨å‡½æ•°å¤–é¢æ·»åŠ å¦‚ä¸‹ä»£ç æ¥è¿›è¡Œæ•°æ®ç±»å‹åˆ¤æ–­ 123456789101112// åˆ¤æ–­ç±»å‹var obj_i=&#123;&#125;;['Boolean', 'Number','String', 'Function', 'Array' ,'Date', 'RegExp', 'Object' ,'Error'].forEach(function(el,idx)&#123; obj_i["[object " + el + "]"] = el.toLowerCase()&#125;)function type(obj) &#123; return obj == null ? String(obj) : obj_i[Object.prototype.toString.call(obj)] || "object"&#125;function isObject(obj) &#123; return type(obj) == "object" &#125; function isArray(obj) &#123; return type(obj) == "array" &#125;function isString(obj) &#123; return type(obj) == "string" &#125; wclimb.readyå‡½æ•°åœ¨å¤–é¢è®¾ç½®å¦‚ä¸‹å‡½æ•°123456wclimb.ready = function(fn) &#123; document.addEventListener('DOMContentLoaded',function() &#123; fn &amp;&amp; fn(); &#125;,false); document.removeEventListener('DOMContentLoaded',fn,true);&#125;; wclimb.isZå‡½æ•°ä¸‹é¢ä»£ç åˆ¤æ–­objectæ˜¯ä¸æ˜¯wclimb.Zçš„å®ä¾‹123wclimb.isZ = function(object) &#123; return object instanceof wclimb.Z&#125; ç°åœ¨è¯•è¯•ä»£ç å§ï¼Œæˆ‘ä»¬é¡ºä¾¿æŠŠaddClassé‡Œåˆ¤æ–­hasClassä»£ç æ³¨é‡Šå»æ‰äº† 123456789101112&lt;script&gt; // ready $(function()&#123; alert(1) &#125;) // addClass $('p').addClass('a b') // å®ä¾‹ console.log($(this)) // æ•°ç»„ $([1,23,3,,4])&lt;/script&gt; å…¨éƒ¨ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131(function()&#123; var wclimb = &#123;&#125;,$ emptyArray = [], concat = emptyArray.concat, filter = emptyArray.filter slice = emptyArray.slice function compact(array) &#123; return filter.call(array, function(item)&#123; return item != null &#125;) &#125; $ = function(selector)&#123; return wclimb.init(selector) &#125; wclimb.init = function(selector)&#123; var dom if (!selector) return wclimb.Z() else if (typeof selector == 'string') &#123; dom = wclimb.qsa(document, selector) &#125; else if (typeof selector == 'function')&#123; return wclimb.ready(selector) &#125; else&#123; if (isArray(selector)) &#123; dom = compact(selector) &#125; else if (wclimb.isZ(selector)) return selector else&#123; if (isObject(selector)) dom = [selector], selector = null ; else dom=wclimb.qsa(document,selector) &#125; &#125; return wclimb.Z(dom, selector) &#125; wclimb.Z = function(dom,selector)&#123; return new Z(dom,selector) &#125; function className(node, value)&#123; var klass = node.className || '' if (value === undefined) return klass node.className = value &#125; wclimb.Z.prototype = Z.prototype = &#123; each:function(callback)&#123; [].every.call(this, function(el, idx)&#123; return callback.call(el, idx, el) !== false &#125;) return this; &#125;, addClass:function(name)&#123; if (!name) return this return this.each(function(el,idx)&#123; if (!('className' in this)) return classList = []; var cls = className(this) name.split(/\s+/g).forEach(function(klass)&#123; if (!$(this).hasClass(klass)) classList.push(klass) &#125;, this) classList.length &amp;&amp; className(this, cls + (cls ? " " : "") + classList.join(" ")) &#125;) &#125;, hasClass : function(cls) &#123; var reg = new RegExp('(\\s|^)' + cls + '(\\s|$)'); for (var i = 0; i &lt; this.length; i++) &#123; if (this[i].className.match(reg)) return true; return false; &#125; return this; &#125; &#125; wclimb.ready = function(fn) &#123; document.addEventListener('DOMContentLoaded',function() &#123; fn &amp;&amp; fn(); &#125;,false); document.removeEventListener('DOMContentLoaded',fn,true); &#125;; wclimb.qsa=function(element, selector)&#123; var found, maybeID = selector[0] == '#', maybeClass = !maybeID &amp;&amp; selector[0] == '.', nameOnly = maybeID || maybeClass ? selector.slice(1) : selector, // Ensure that a 1 char tag name still gets checked isSimple = /^[\w-]*$/.test(nameOnly) return (element.getElementById &amp;&amp; isSimple &amp;&amp; maybeID) ? // Safari DocumentFragment doesn't have getElementById ( (found = element.getElementById(nameOnly)) ? [found] : [] ) : (element.nodeType !== 1 &amp;&amp; element.nodeType !== 9 &amp;&amp; element.nodeType !== 11) ? [] : slice.call( isSimple &amp;&amp; !maybeID &amp;&amp; element.getElementsByClassName ? // DocumentFragment doesn't have getElementsByClassName/TagName maybeClass ? element.getElementsByClassName(nameOnly) : // If it's simple, it could be a class element.getElementsByTagName(selector) : // Or a tag element.querySelectorAll(selector) // Or it's not simple, and we need to query all ) &#125; function Z(dom,selector) &#123; for (var i = 0; i &lt; dom.length; i++) &#123; this[i] = dom[i] &#125; this.selector = selector; this.length = dom.length &#125; wclimb.isZ = function(object) &#123; return object instanceof wclimb.Z &#125; // åˆ¤æ–­ç±»å‹ var obj_i=&#123;&#125;; ['Boolean', 'Number','String', 'Function', 'Array' ,'Date', 'RegExp', 'Object' ,'Error'].forEach(function(el,idx)&#123; obj_i["[object " + el + "]"] = el.toLowerCase() &#125;) function type(obj) &#123; return obj == null ? String(obj) : obj_i[Object.prototype.toString.call(obj)] || "object" &#125; function isObject(obj) &#123; return type(obj) == "object" &#125; function isArray(obj) &#123; return type(obj) == "array" &#125; function isString(obj) &#123; return type(obj) == "string" &#125; window.$ = window.wclimb = $&#125;)()]]></content>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>zepto</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¯»zeptoæºç ï¼Œå°è£…è‡ªå·±çš„zeptoåº“ï¼ˆäºŒï¼‰]]></title>
    <url>%2F2017%2F07%2F17%2F%E8%AF%BBzepto%E6%BA%90%E7%A0%81%EF%BC%8C%E5%B0%81%E8%A3%85%E8%87%AA%E5%B7%B1%E7%9A%84zepto%E5%BA%93%EF%BC%88%E4%BA%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[è·ç¦»ä¸Šä¸€ç¯‡zeptoæºç åˆ†æå·²ç»è¿‡å»å¤§åŠä¸ªæœˆï¼Œæƒ³æƒ³è‡ªå·±éƒ½è¿‡æ„ä¸å»ï¼Œä¸è¿‡ä¹‹å‰åˆ†äº«äº†ä¸€ç¯‡nodeåšå®¢æ•™ç¨‹ï¼Œè¿˜ç®—å¹²äº†ç‚¹æ­£äº‹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å°è£…è‡ªå·±çš„åº“å§ ä¸ŠèŠ‚ä»£ç æ¦‚è§ˆ12345678910111213141516171819202122232425262728293031323334(function()&#123; var wclimb = &#123;&#125;,$ $ = function(selector)&#123; return wclimb.init(selector) &#125; wclimb.init = function(selector)&#123; var dom; dom = document.querySelectorAll(selector); return wclimb.Z(dom,selector) &#125; wclimb.Z = function(dom,selector)&#123; return new Z(dom,selector) &#125; wclimb.Z.prototype = Z.prototype = &#123; test:function()&#123; alert(1) &#125; &#125; function Z(dom,selector) &#123; for (var i = 0; i &lt; dom.length; i++) &#123; this[i] = dom[i] &#125; this.selector = selector; this.length = dom.length &#125; window.$ = window.wclimb = $&#125;)() eachæ–¹æ³• åœ¨wclimb.Z.prototype=Z.prototype=é‡Œé¢æ·»åŠ æ–¹æ³•each 12345678wclimb.Z.prototype = Z.prototype = &#123; each:function(callback)&#123; [].every.call(this, function(el, idx)&#123; return callback.call(el, idx, el) !== false &#125;) return this; &#125;&#125; é€šè¿‡æ•°ç»„çš„everyæ–¹æ³•è¿›è¡Œéå†ï¼Œç„¶åçœ‹çœ‹æ¯æ¬¡callbackæ˜¯ä¸æ˜¯éƒ½ä¸æ˜¯falseï¼Œå¦‚æœæ˜¯åˆ™ç»“æŸéå† æœ€åé€šè¿‡ return this æ¥è¾¾åˆ°é“¾å¼è°ƒç”¨çš„æ•ˆæœ addClassæ–¹æ³•ç»§ç»­åœ¨é‡Œé¢æ·»åŠ addClassæ–¹æ³• 123456789101112131415161718addClass:function(name)&#123; if (!name) return this return this.each(function(el,idx)&#123; if (!('className' in this)) return classList = []; var cls = className(this) // newName = funcArg(this, name, idx, cls) name.split(/\s+/g).forEach(function(klass)&#123; // if (!$(this).hasClass(klass)) classList.push(klass) &#125;, this) classList.length &amp;&amp; className(this, cls + (cls ? " " : "") + classList.join(" ")) &#125;)&#125; æˆ‘ä»¬å…ˆåˆ¤æ–­nameå­˜åœ¨ä¸å¦ï¼Œæ²¡æœ‰å°±ç›´æ¥return thisï¼Œæ”¯æŒé“¾å¼è°ƒç”¨ æ–°å»ºä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾æˆ‘ä»¬è¦æ·»åŠ çš„classï¼Œå› ä¸ºå¯èƒ½è¦åŒæ—¶æ·»åŠ å¤šä¸ª é€šè¿‡è°ƒç”¨classNameæ–¹æ³•æ¥è·å–ä¹‹å‰çš„classï¼Œå¹¶ä¿å­˜èµ·æ¥ã€‚clasNameæ–¹æ³•åœ¨ä¸‹é¢ æˆ‘ä»¬æ·»åŠ classä¸€èˆ¬æ˜¯è¿™æ ·addClass(&#39;a b c&#39;)ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æŠŠä»–ä»¬ç”¨ç©ºæ ¼åˆ†å¼€/\s+/g,ç”¨+çš„åŸå› æ˜¯ï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªç©ºæ ¼çš„å­˜åœ¨ï¼Œæ¥ç€å¯¹ä»–ä»¬è¿›è¡Œå¾ªç¯ é€šè¿‡hasClassåˆ¤æ–­ä¹‹å‰æ˜¯å¦å·²ç»å­˜åœ¨éœ€è¦æ·»åŠ çš„classï¼Œå¦‚æœæœ‰å°±pushåˆ°classListæ•°ç»„é‡Œé¢ã€‚æˆ‘ä»¬å…ˆæ³¨é‡Šæ‰hasClassè¿™æ®µä»£ç ï¼Œå› ä¸ºå…¶ä¸­ç”¨åˆ°äº†$(this) ,querySelectoræ˜¯ä¸æ”¯æŒçš„å“Ÿï¼Œæ‰€ä»¥åé¢æˆ‘ä»¬å¾—ä½œåˆ¤æ–­ï¼Œåˆ¤æ–­$()è¿™é‡Œé¢æ”¾çš„æ˜¯å…ƒç´ ã€å‡½æ•°ã€ç±»æ•°ç»„ç­‰ç­‰ã€‚ æœ€åé€šè¿‡å‡½æ•°classNameæ–¹æ³•æŠŠä»–ä»¬ç”¨ç©ºæ ¼è¿æ¥èµ·æ¥ å‘ç°é‡Œé¢æœ‰ä¸€ä¸ªæ²¡æœ‰å£°æ˜çš„classNameæ–¹æ³•æ‰€ä»¥æˆ‘ä»¬åœ¨wclimb.Z.prototype=Z.prototype=ä¸Šé¢å£°æ˜è¯¥å‡½æ•°1234567//è·å–æˆ–è€…è®¾ç½®classfunction className(node, value)&#123; var klass = node.className || '' if (value === undefined) return klass node.className = value&#125; è¯¥æ–¹æ³•ä¸»è¦æ˜¯è·å–classå’Œè®¾ç½®classçš„ä½œç”¨ hasClassæ–¹æ³•12345678hasClass : function(cls) &#123; var reg = new RegExp('(\\s|^)' + cls + '(\\s|$)'); for (var i = 0; i &lt; this.length; i++) &#123; if (this[i].className.match(reg)) return true; return false; &#125; return this;&#125; é€šè¿‡æ­£åˆ™åŒ¹é…ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseï¼Œæœ€åreturn thisæ”¯æŒé“¾å¼è°ƒç”¨ ç°åœ¨æ¥è¯•è¯•æ•ˆæœå§12345html: &lt;p class="a"&gt;&lt;/p&gt;js: $('p').addClass('test other') // &lt;p class="a test other"&gt;&lt;/p&gt; console.log($('p').hasClass('a')) // true ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273(function()&#123; var wclimb = &#123;&#125;,$ $ = function(selector)&#123; return wclimb.init(selector) &#125; wclimb.init = function(selector)&#123; var dom; dom = document.querySelectorAll(selector); return wclimb.Z(dom,selector) &#125; wclimb.Z = function(dom,selector)&#123; return new Z(dom,selector) &#125; function className(node, value)&#123;//è·å–æˆ–è€…è®¾ç½®class var klass = node.className || '' if (value === undefined) return klass node.className = value &#125; wclimb.Z.prototype = Z.prototype = &#123; each:function(callback)&#123; [].every.call(this, function(el, idx)&#123; return callback.call(el, idx, el) !== false &#125;) return this; &#125;, addClass:function(name)&#123; if (!name) return this return this.each(function(el,idx)&#123; if (!('className' in this)) return classList = []; var cls = className(this) name.split(/\s+/g).forEach(function(klass)&#123; // if (!$(this).hasClass(klass)) classList.push(klass) &#125;, this) classList.length &amp;&amp; className(this, cls + (cls ? " " : "") + classList.join(" ")) &#125;) &#125;, hasClass : function(cls) &#123; var reg = new RegExp('(\\s|^)' + cls + '(\\s|$)'); for (var i = 0; i &lt; this.length; i++) &#123; if (this[i].className.match(reg)) return true; return false; &#125; return this; &#125; &#125; function Z(dom,selector) &#123; for (var i = 0; i &lt; dom.length; i++) &#123; this[i] = dom[i] &#125; this.selector = selector; this.length = dom.length &#125; window.$ = window.wclimb = $&#125;)()]]></content>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>zepto</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Node+Koa2+Mysql æ­å»ºç®€æ˜“åšå®¢]]></title>
    <url>%2F2017%2F07%2F12%2FNode-Koa2-Mysql-%E6%90%AD%E5%BB%BA%E7%AE%80%E6%98%93%E5%8D%9A%E5%AE%A2%2F</url>
    <content type="text"><![CDATA[Koa2-blog 2018-1-5 æ›´æ–°æ•™ç¨‹ï¼ˆæ–°å¢ä¸Šä¼ å¤´åƒã€æ–°å¢åˆ†é¡µã€æ ·å¼æ”¹ç‰ˆã€å‘å¸ƒæ–‡ç« å’Œè¯„è®ºæ”¯æŒmarkdownè¯­æ³•ï¼‰ç°åœ¨GitHubçš„ä»£ç ç»“æ„æœ‰å˜ï¼Œä¼˜åŒ–äº†è›®å¤šä¸œè¥¿ Node+Koa2+Mysql æ­å»ºç®€æ˜“åšå®¢ é¢„è§ˆåœ°å€http://blog.wclimb.site å†™åœ¨å‰é¢æœ¬ç¯‡æ•™ç¨‹ä¸€æ–¹é¢æ˜¯ä¸ºäº†è‡ªå·±åœ¨å­¦ä¹ çš„è¿‡ç¨‹åŠ æ·±è®°å¿†ï¼Œä¹Ÿæ˜¯æ€»ç»“çš„è¿‡ç¨‹ã€‚å¦ä¸€æ–¹é¢ç»™å¯¹è¿™æ–¹é¢ä¸å¤ªäº†è§£çš„åŒå­¦ä»¥å€Ÿé‰´ç»éªŒã€‚å¦‚å‘ç°é—®é¢˜è¿˜æœ›æŒ‡æ­£ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¸®åŠ©åˆ°äº†ä½ ï¼Œé‚£å°±èµè„¸ç»™ä¸ªstarå§ï¼Œhttps://github.com/wclimb/Koa2-blogä¸‹ä¸€ç¯‡å¯èƒ½æ˜¯ Node + express + mongoose æˆ– zeptoæºç ç³»åˆ—æ„Ÿè°¢æ‚¨çš„é˜…è¯»^_^psï¼šå…³äºmarkdownä»£ç ç¼©è¿›é—®é¢˜ï¼Œçœ‹èµ·æ¥ä¸å¤ªèˆ’æœï¼Œä½†å¤åˆ¶åˆ°ç¼–è¾‘å™¨æ˜¯æ­£å¸¸çš„å“Ÿï¼ æ¼”ç¤ºæ•ˆæœ å¼€å‘ç¯å¢ƒ nodejs v8.1.0 koa v2.3.0 mysql v5.7.0 å‡†å¤‡å·¥ä½œæ–‡ä¸­ç”¨åˆ°äº†promiseã€async awaitç­‰è¯­æ³•ï¼Œæ‰€ä»¥ä½ éœ€è¦ä¸€ç‚¹es6çš„è¯­æ³•ï¼Œä¼ é€é—¨å½“ç„¶æ˜¯é˜®è€å¸ˆçš„æ•™ç¨‹äº† http://es6.ruanyifeng.com/ å¦‚æœä½ å·²ç»é…ç½®å¥½nodeå’Œmysqlå¯ä»¥è·³è¿‡ ç»å¸¸ä¼šæœ‰äººé—®æŠ¥é”™çš„é—®é¢˜ï¼Œè¿è¡Œå‡ºé”™å¤§éƒ¨åˆ†æ˜¯å› ä¸ºä¸æ”¯æŒasyncï¼Œå‡çº§nodeç‰ˆæœ¬å¯è§£å†³ 1$ node -v æŸ¥çœ‹ä½ çš„nodeç‰ˆæœ¬ï¼Œå¦‚æœè¿‡ä½åˆ™å»nodejså®˜ç½‘ä¸‹è½½æ›¿æ¢ä¹‹å‰çš„ç‰ˆæœ¬ ä¸‹è½½mysqlï¼Œå¹¶è®¾ç½®å¥½ç”¨æˆ·åå’Œå¯†ç ï¼Œé»˜è®¤å¯ä»¥ä¸ºç”¨æˆ·åï¼šrootï¼Œå¯†ç ï¼š123456 1è¿›å…¥åˆ° bin ç›®å½•ä¸‹ æ¯”å¦‚ cd C:\Program Files\MySQL\MySQL Server 5.7\bin ç„¶åå¼€å¯mysql1$ mysql -u root -p è¾“å…¥å¯†ç ä¹‹ååˆ›å»ºdatabase(æ•°æ®åº“)ï¼Œnodesqlæ˜¯æˆ‘ä»¬åˆ›å»ºçš„æ•°æ®åº“1$ create database nodesql; è®°ä½sqlè¯­å¥åé¢ä¸€å®šè¦è·Ÿ;ç¬¦å·ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹æˆ‘ä»¬åˆ›å»ºå¥½çš„æ•°æ®åº“åˆ—è¡¨ 1$ show databases; å¯ç”¨åˆ›å»ºçš„æ•°æ®åº“1$ use nodesql; æŸ¥çœ‹æ•°æ®åº“ä¸­çš„è¡¨1$ show tables; æ˜¾ç¤ºEmpty set (0.00 sec)ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å»ºè¡¨ï¼Œç¨åä¼šç”¨ä»£ç å»ºè¡¨æ³¨é‡Šï¼šè¿™æ˜¯åé¢å»ºè¡¨ä¹‹åçš„çŠ¶æ€ ç›®å½•ç»“æ„ config å­˜æ”¾é»˜è®¤æ–‡ä»¶ lib å­˜æ”¾æ“ä½œæ•°æ®åº“æ–‡ä»¶ middlewares å­˜æ”¾åˆ¤æ–­ç™»å½•ä¸å¦æ–‡ä»¶ public å­˜æ”¾æ ·å¼å’Œå¤´åƒæ–‡ä»¶ routes å­˜æ”¾è·¯ç”±æ–‡ä»¶ views å­˜æ”¾æ¨¡æ¿æ–‡ä»¶ index ç¨‹åºä¸»æ–‡ä»¶ package.json åŒ…æ‹¬é¡¹ç›®åã€ä½œè€…ã€ä¾èµ–ç­‰ç­‰ é¦–å…ˆæˆ‘ä»¬åˆ›å»ºkoa2-blogæ–‡ä»¶å¤¹ï¼Œç„¶åcd koa2-blog1æ¥ç€ä½¿ç”¨ npm init æ¥åˆ›å»ºpackage.json æ¥ç€å®‰è£…åŒ…ï¼Œå®‰è£…ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨cnpmå®‰è£…1$ npm install -g cnpm --registry=https://registry.npm.taobao.org 1$ cnpm i koa koa-bodyparser koa-mysql-session koa-router koa-session-minimal koa-static koa-views md5 moment mysql ejs markdown-it chai mocha koa-static-cache --save-dev å„æ¨¡å—ç”¨å¤„ koa nodeæ¡†æ¶ koa-bodyparser è¡¨å•è§£æä¸­é—´ä»¶ koa-mysql-sessionã€koa-session-minimal å¤„ç†æ•°æ®åº“çš„ä¸­é—´ä»¶ koa-router è·¯ç”±ä¸­é—´ä»¶ koa-static é™æ€èµ„æºåŠ è½½ä¸­é—´ä»¶ ejs æ¨¡æ¿å¼•æ“ md5 å¯†ç åŠ å¯† moment æ—¶é—´ä¸­é—´ä»¶ mysql æ•°æ®åº“ markdown-it markdownè¯­æ³• koa-views æ¨¡æ¿å‘ˆç°ä¸­é—´ä»¶ chai mocha æµ‹è¯•ä½¿ç”¨ koa-static-cache æ–‡ä»¶ç¼“å­˜ åœ¨æ–‡ä»¶å¤¹é‡Œé¢æ–°å»ºæ‰€éœ€æ–‡ä»¶ é¦–å…ˆé…ç½®configæˆ‘ä»¬æ–°å»ºdefault.jsæ–‡ä»¶ 123456789101112131415const config = &#123; // å¯åŠ¨ç«¯å£ port: 3000, // æ•°æ®åº“é…ç½® database: &#123; DATABASE: &apos;nodesql&apos;, USERNAME: &apos;root&apos;, PASSWORD: &apos;123456&apos;, PORT: &apos;3306&apos;, HOST: &apos;localhost&apos; &#125;&#125;module.exports = config è¿™æ˜¯æˆ‘ä»¬æ‰€éœ€çš„ä¸€äº›å­—æ®µï¼ŒåŒ…æ‹¬ç«¯å£å’Œæ•°æ®åº“è¿æ¥æ‰€éœ€ï¼Œæœ€åæˆ‘ä»¬æŠŠå®ƒexportsæš´éœ²å‡ºå»ï¼Œä»¥ä¾¿å¯ä»¥åœ¨åˆ«çš„åœ°æ–¹ä½¿ç”¨ é…ç½®index.jsæ–‡ä»¶index.js 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859const Koa=require('koa');const path=require('path')const bodyParser = require('koa-bodyparser');const ejs=require('ejs');const session = require('koa-session-minimal');const MysqlStore = require('koa-mysql-session');const config = require('./config/default.js');const router=require('koa-router')const views = require('koa-views')// const koaStatic = require('koa-static')const staticCache = require('koa-static-cache')const app = new Koa()// sessionå­˜å‚¨é…ç½®const sessionMysqlConfig= &#123; user: config.database.USERNAME, password: config.database.PASSWORD, database: config.database.DATABASE, host: config.database.HOST,&#125;// é…ç½®sessionä¸­é—´ä»¶app.use(session(&#123; key: 'USER_SID', store: new MysqlStore(sessionMysqlConfig)&#125;))// é…ç½®é™æ€èµ„æºåŠ è½½ä¸­é—´ä»¶// app.use(koaStatic(// path.join(__dirname , './public')// ))// ç¼“å­˜app.use(staticCache(path.join(__dirname, './public'), &#123; dynamic: true &#125;, &#123; maxAge: 365 * 24 * 60 * 60&#125;))app.use(staticCache(path.join(__dirname, './images'), &#123; dynamic: true &#125;, &#123; maxAge: 365 * 24 * 60 * 60&#125;))// é…ç½®æœåŠ¡ç«¯æ¨¡æ¿æ¸²æŸ“å¼•æ“ä¸­é—´ä»¶app.use(views(path.join(__dirname, './views'), &#123; extension: 'ejs'&#125;))app.use(bodyParser(&#123; formLimit: '1mb'&#125;))// è·¯ç”±(æˆ‘ä»¬å…ˆæ³¨é‡Šä¸‰ä¸ªï¼Œç­‰åé¢æ·»åŠ å¥½äº†å†å–æ¶ˆæ³¨é‡Šï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å®šä¹‰è·¯ç”±ï¼Œç¨åä¼šå…ˆå®ç°æ³¨å†Œ)//app.use(require('./routers/signin.js').routes())app.use(require('./routers/signup.js').routes())//app.use(require('./routers/posts.js').routes())//app.use(require('./routers/signout.js').routes())app.listen(3000)console.log(`listening on port $&#123;config.port&#125;`) æˆ‘ä»¬ä½¿ç”¨koa-session-minimal`koa-mysql-sessionæ¥è¿›è¡Œæ•°æ®åº“çš„æ“ä½œ ä½¿ç”¨koa-staticé…ç½®é™æ€èµ„æºï¼Œç›®å½•è®¾ç½®ä¸ºpublicä½¿ç”¨ejsæ¨¡æ¿å¼•æ“ ä½¿ç”¨koa-bodyparseræ¥è§£ææäº¤çš„è¡¨å•ä¿¡æ¯ ä½¿ç”¨koa-routeråšè·¯ç”± ä½¿ç”¨koa-static-cache`æ¥ç¼“å­˜æ–‡ä»¶ä¹‹å‰æˆ‘ä»¬é…ç½®äº†default.jsï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨äº†é¦–å…ˆå¼•å…¥è¿›æ¥ var config = require(â€˜./config/default.jsâ€™);ç„¶ååœ¨æ•°æ®åº“çš„æ“ä½œçš„æ—¶å€™ï¼Œå¦‚config.database.USERNAMEï¼Œå¾—åˆ°çš„å°±æ˜¯rootã€‚ å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¸®åŠ©åˆ°äº†ä½ ï¼Œé‚£å°±èµè„¸ç»™ä¸ªstarå§ï¼Œhttps://github.com/wclimb/Koa2-blog é…ç½®libçš„mysql.jsæ–‡ä»¶å…³äºæ•°æ®åº“çš„ä½¿ç”¨è¿™é‡Œä»‹ç»ä¸€ä¸‹ï¼Œé¦–å…ˆæˆ‘ä»¬å»ºç«‹äº†æ•°æ®åº“çš„è¿æ¥æ± ï¼Œä»¥ä¾¿åé¢çš„æ“ä½œéƒ½å¯ä»¥ä½¿ç”¨åˆ°ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°queryï¼Œé€šè¿‡è¿”å›promiseçš„æ–¹å¼ä»¥ä¾¿å¯ä»¥æ–¹ä¾¿ç”¨.then()æ¥è·å–æ•°æ®åº“è¿”å›çš„æ•°æ®ï¼Œç„¶åæˆ‘ä»¬å®šä¹‰äº†ä¸‰ä¸ªè¡¨çš„å­—æ®µï¼Œé€šè¿‡createTableæ¥åˆ›å»ºæˆ‘ä»¬åé¢æ‰€éœ€çš„ä¸‰ä¸ªè¡¨ï¼ŒåŒ…æ‹¬posts(å­˜å‚¨æ–‡ç« )ï¼Œusers(å­˜å‚¨ç”¨æˆ·)ï¼Œcomment(å­˜å‚¨è¯„è®º)ï¼Œcreate table if not exists users()è¡¨ç¤ºå¦‚æœusersè¡¨ä¸å­˜åœ¨åˆ™åˆ›å»ºè¯¥è¡¨ï¼Œé¿å…æ¯æ¬¡é‡å¤å»ºè¡¨æŠ¥é”™çš„æƒ…å†µã€‚åé¢æˆ‘ä»¬å®šä¹‰äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œæœ€åæŠŠä»–ä»¬exportsæš´éœ²å‡ºå»ã€‚ è¿™é‡Œåªä»‹ç»æ³¨å†Œç”¨æˆ·insertDataï¼Œåç»­çš„å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ï¼Œéƒ½å·®ä¸å¤š 12345// æ³¨å†Œç”¨æˆ·let insertData = function( value ) &#123; let _sql = "insert into users set name=?,pass=?,avator=?,moment=?;" return query( _sql, value )&#125; æˆ‘ä»¬å†™äº†ä¸€ä¸ª_sqlçš„sqlè¯­å¥ï¼Œæ„æ€æ˜¯æ’å…¥åˆ°usersçš„è¡¨ä¸­ï¼ˆåœ¨è¿™ä¹‹å‰æˆ‘ä»¬å·²ç»å»ºç«‹äº†usersè¡¨ï¼‰ç„¶åè¦æ’å…¥çš„æ•°æ®åˆ†åˆ«æ˜¯nameã€passã€avatorã€momentï¼Œå°±æ˜¯ç”¨æˆ·åã€å¯†ç ã€å¤´åƒã€æ³¨å†Œæ—¶é—´ï¼Œæœ€åè°ƒç”¨queryå‡½æ•°æŠŠsqlè¯­å¥ä¼ è¿›å»ï¼ˆä¹‹å‰çš„å†™æ³•æ˜¯&quot;insert into users(name,pass) values(?,?);&quot;,æ¢æˆç°åœ¨å¾—æ›´å®¹æ˜“ç†è§£ï¼‰ lib/mysql.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225var mysql = require('mysql');var config = require('../config/default.js')var pool = mysql.createPool(&#123; host : config.database.HOST, user : config.database.USERNAME, password : config.database.PASSWORD, database : config.database.DATABASE&#125;);let query = function( sql, values ) &#123; return new Promise(( resolve, reject ) =&gt; &#123; pool.getConnection(function(err, connection) &#123; if (err) &#123; reject( err ) &#125; else &#123; connection.query(sql, values, ( err, rows) =&gt; &#123; if ( err ) &#123; reject( err ) &#125; else &#123; resolve( rows ) &#125; connection.release() &#125;) &#125; &#125;) &#125;)&#125;// let query = function( sql, values ) &#123;// pool.getConnection(function(err, connection) &#123;// // ä½¿ç”¨è¿æ¥// connection.query( sql,values, function(err, rows) &#123;// // ä½¿ç”¨è¿æ¥æ‰§è¡ŒæŸ¥è¯¢// console.log(rows)// connection.release();// //è¿æ¥ä¸å†ä½¿ç”¨ï¼Œè¿”å›åˆ°è¿æ¥æ± // &#125;);// &#125;);// &#125;let users = `create table if not exists users( id INT NOT NULL AUTO_INCREMENT, name VARCHAR(100) NOT NULL, pass VARCHAR(100) NOT NULL, avator VARCHAR(100) NOT NULL, moment VARCHAR(100) NOT NULL, PRIMARY KEY ( id ) );`let posts = `create table if not exists posts( id INT NOT NULL AUTO_INCREMENT, name VARCHAR(100) NOT NULL, title TEXT(0) NOT NULL, content TEXT(0) NOT NULL, md TEXT(0) NOT NULL, uid VARCHAR(40) NOT NULL, moment VARCHAR(100) NOT NULL, comments VARCHAR(200) NOT NULL DEFAULT '0', pv VARCHAR(40) NOT NULL DEFAULT '0', avator VARCHAR(100) NOT NULL, PRIMARY KEY ( id ) );`let comment = `create table if not exists comment( id INT NOT NULL AUTO_INCREMENT, name VARCHAR(100) NOT NULL, content TEXT(0) NOT NULL, moment VARCHAR(40) NOT NULL, postid VARCHAR(40) NOT NULL, avator VARCHAR(100) NOT NULL, PRIMARY KEY ( id ) );`let createTable = function( sql ) &#123; return query( sql, [] )&#125;// å»ºè¡¨createTable(users)createTable(posts)createTable(comment)// æ³¨å†Œç”¨æˆ·let insertData = function( value ) &#123; let _sql = "insert into users set name=?,pass=?,avator=?,moment=?;" return query( _sql, value )&#125;// åˆ é™¤ç”¨æˆ·let deleteUserData = function( name ) &#123; let _sql = `delete from users where name="$&#123;name&#125;";` return query( _sql )&#125;// æŸ¥æ‰¾ç”¨æˆ·let findUserData = function( name ) &#123; let _sql = `select * from users where name="$&#123;name&#125;";` return query( _sql )&#125;// å‘è¡¨æ–‡ç« let insertPost = function( value ) &#123; let _sql = "insert into posts set name=?,title=?,content=?,md=?,uid=?,moment=?,avator=?;" return query( _sql, value )&#125;// æ›´æ–°æ–‡ç« è¯„è®ºæ•°let updatePostComment = function( value ) &#123; let _sql = "update posts set comments=? where id=?" return query( _sql, value )&#125;// æ›´æ–°æµè§ˆæ•°let updatePostPv = function( value ) &#123; let _sql = "update posts set pv=? where id=?" return query( _sql, value )&#125;// å‘è¡¨è¯„è®ºlet insertComment = function( value ) &#123; let _sql = "insert into comment set name=?,content=?,moment=?,postid=?,avator=?;" return query( _sql, value )&#125;// é€šè¿‡åå­—æŸ¥æ‰¾ç”¨æˆ·let findDataByName = function ( name ) &#123; let _sql = `select * from users where name="$&#123;name&#125;";` return query( _sql)&#125;// é€šè¿‡æ–‡ç« çš„åå­—æŸ¥æ‰¾ç”¨æˆ·let findDataByUser = function ( name ) &#123; let _sql = `select * from posts where name="$&#123;name&#125;";` return query( _sql)&#125;// é€šè¿‡æ–‡ç« idæŸ¥æ‰¾let findDataById = function ( id ) &#123; let _sql = `select * from posts where id="$&#123;id&#125;";` return query( _sql)&#125;// é€šè¿‡è¯„è®ºidæŸ¥æ‰¾let findCommentById = function ( id ) &#123; let _sql = `select * FROM comment where postid="$&#123;id&#125;";` return query( _sql)&#125;// æŸ¥è¯¢æ‰€æœ‰æ–‡ç« let findAllPost = function () &#123; let _sql = ` select * FROM posts;` return query( _sql)&#125;// æŸ¥è¯¢åˆ†é¡µæ–‡ç« let findPostByPage = function (page) &#123; let _sql = ` select * FROM posts limit $&#123;(page-1)*10&#125;,10;` return query( _sql)&#125;// æŸ¥è¯¢ä¸ªäººåˆ†é¡µæ–‡ç« let findPostByUserPage = function (name,page) &#123; let _sql = ` select * FROM posts where name="$&#123;name&#125;" order by id desc limit $&#123;(page-1)*10&#125;,10 ;` return query( _sql)&#125;// æ›´æ–°ä¿®æ”¹æ–‡ç« let updatePost = function(values)&#123; let _sql = `update posts set title=?,content=?,md=? where id=?` return query(_sql,values)&#125;// åˆ é™¤æ–‡ç« let deletePost = function(id)&#123; let _sql = `delete from posts where id = $&#123;id&#125;` return query(_sql)&#125;// åˆ é™¤è¯„è®ºlet deleteComment = function(id)&#123; let _sql = `delete from comment where id=$&#123;id&#125;` return query(_sql)&#125;// åˆ é™¤æ‰€æœ‰è¯„è®ºlet deleteAllPostComment = function(id)&#123; let _sql = `delete from comment where postid=$&#123;id&#125;` return query(_sql)&#125;// æŸ¥æ‰¾è¯„è®ºæ•°let findCommentLength = function(id)&#123; let _sql = `select content from comment where postid in (select id from posts where id=$&#123;id&#125;)` return query(_sql)&#125;// æ»šåŠ¨æ— é™åŠ è½½æ•°æ®let findPageById = function(page)&#123; let _sql = `select * from posts limit $&#123;(page-1)*5&#125;,5;` return query(_sql)&#125;// è¯„è®ºåˆ†é¡µlet findCommentByPage = function(page,postId)&#123; let _sql = `select * from comment where postid=$&#123;postId&#125; order by id desc limit $&#123;(page-1)*10&#125;,10;` return query(_sql)&#125;module.exports = &#123; query, createTable, insertData, deleteUserData, findUserData, findDataByName, insertPost, findAllPost, findPostByPage, findPostByUserPage, findDataByUser, findDataById, insertComment, findCommentById, updatePost, deletePost, deleteComment, findCommentLength, updatePostComment, deleteAllPostComment, updatePostPv, findPageById, findCommentByPage&#125; ä¸‹é¢æ˜¯æˆ‘ä»¬å»ºçš„è¡¨ users posts comment id id id name name name pass title content avator content moment moment md postid - uid avator - moment - - comments - - pv - - avator - idä¸»é”®é€’å¢ name: ç”¨æˆ·å passï¼šå¯†ç  avatorï¼šå¤´åƒ titleï¼šæ–‡ç« æ ‡é¢˜ contentï¼šæ–‡ç« å†…å®¹å’Œè¯„è®º mdï¼šmarkdownè¯­æ³• uidï¼šå‘è¡¨æ–‡ç« çš„ç”¨æˆ·id momentï¼šåˆ›å»ºæ—¶é—´ commentsï¼šæ–‡ç« è¯„è®ºæ•° pvï¼šæ–‡ç« æµè§ˆæ•° postidï¼šæ–‡ç« id ç°åœ¨æ„Ÿè§‰æœ‰ç‚¹æ¯ç‡¥ï¼Œé‚£æˆ‘ä»¬å…ˆæ¥å®ç°ä¸€ä¸‹æ³¨å†Œå§ å®ç°æ³¨å†Œé¡µé¢routers/singup.js12345678910111213141516const router = require('koa-router')();const userModel = require('../lib/mysql.js');const md5 = require('md5')const checkNotLogin = require('../middlewares/check.js').checkNotLoginconst checkLogin = require('../middlewares/check.js').checkLoginconst moment = require('moment');const fs = require('fs')// æ³¨å†Œé¡µé¢router.get('/signup', async(ctx, next) =&gt; &#123; await checkNotLogin(ctx) await ctx.render('signup', &#123; session: ctx.session, &#125;)&#125;) module.exports = router ä½¿ç”¨getæ–¹å¼å¾—åˆ°â€™/signupâ€™é¡µé¢ï¼Œç„¶åæ¸²æŸ“signupæ¨¡æ¿ï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜æ²¡æœ‰åœ¨å†™signup.ejs views/signup.ejs 1234567891011121314151617181920212223242526272829303132&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt; &lt;meta charset="UTF-8"&gt; &lt;title&gt;æ³¨å†Œ&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;div class="container"&gt; &lt;form class="form create" method="post"&gt; &lt;div&gt; &lt;label&gt;ç”¨æˆ·åï¼š&lt;/label&gt; &lt;input placeholder="è¯·è¾“å…¥ç”¨æˆ·å" type="text" name="name"&gt; &lt;/div&gt; &lt;div&gt; &lt;label&gt;å¯†ç ï¼š&lt;/label&gt; &lt;input placeholder="è¯·è¾“å…¥å¯†ç " class="password" type="password" name="password"&gt; &lt;/div&gt; &lt;div&gt; &lt;label&gt;é‡å¤å¯†ç ï¼š&lt;/label&gt; &lt;input placeholder="è¯·ç¡®è®¤å¯†ç " class="repeatpass" type="password" name="repeatpass"&gt; &lt;/div&gt; &lt;div&gt; &lt;label&gt;ä¸Šä¼ å¤´åƒï¼š&lt;/label&gt; &lt;input type="file" name="avator" id="avator"&gt; &lt;input type="hidden" id="avatorVal"&gt; &lt;img class="preview" alt="é¢„è§ˆå¤´åƒ"&gt; &lt;/div&gt; &lt;div class="submit"&gt;æ³¨å†Œ&lt;/div&gt; &lt;/form&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; æˆ‘ä»¬å…ˆå®‰è£…supervisor 1$ cnpm i supervisor -g supervisorçš„ä½œç”¨æ˜¯ä¼šç›‘å¬æ–‡ä»¶çš„å˜åŒ–ï¼Œè€Œæˆ‘ä»¬ä¿®æ”¹æ–‡ä»¶ä¹‹åä¸å¿…å»é‡å¯ç¨‹åº1supervisor --harmony index ç°åœ¨è®¿é—® localhost:3000/signup çœ‹çœ‹æ•ˆæœå§ã€‚æ³¨æ„æ•°æ®åº“ä¸€å®šè¦æ˜¯å¼€å¯çš„çŠ¶æ€ï¼Œä¸èƒ½å…³é—­ å®Œå–„æ³¨å†ŒåŠŸèƒ½é¦–å…ˆæˆ‘ä»¬æ¥å®Œå–„ä¸€ä¸‹æ ·å¼å§ï¼Œç¨å¾®ç¾åŒ–ä¸€ä¸‹ public/index.css 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360body,header,ul,li,p,div,html,span,h3,a,blockquote &#123; margin: 0; padding: 0; color: #333;&#125;body &#123; margin-bottom: 20px;&#125;ul,li&#123; list-style-type: none;&#125;a &#123; text-decoration: none;&#125;header &#123; width: 60%; margin: 20px auto;&#125;header:after&#123; content: ''; clear: both; display: table;&#125;header .user_right&#123; float: right&#125;header .user_right .active&#123; color: #5FB878; background: #fff; border: 1px solid #5FB878; box-shadow: 0 5px 5px #ccc;&#125;header .user_name &#123; float: left&#125;.user_name &#123; font-size: 20px;&#125;.has_user a,.has_user span,.none_user a &#123; padding: 5px 15px; background: #5FB878; border-radius: 15px; color: #fff; cursor: pointer; border: 1px solid #fff; transition: all 0.3s;&#125;.has_user a:hover,.has_user span:hover&#123; color: #5FB878; background: #fff; border: 1px solid #5FB878; box-shadow: 0 5px 5px #ccc;&#125;.posts&#123; border-radius: 4px; border: 1px solid #ddd;&#125;.posts &gt; li&#123; padding: 10px; position: relative; padding-bottom: 40px;&#125;.posts .comment_pv&#123; position: absolute; bottom: 5px; right: 10px;&#125;.posts .author&#123; position: absolute; left: 10px; bottom: 5px;&#125;.posts .author span&#123; margin-right: 5px;&#125;.posts &gt; li:hover &#123; background: #f2f2f2;&#125;.posts &gt; li:hover pre&#123; border: 1px solid #666;&#125;.posts &gt; li:hover .content&#123; border-top: 1px solid #fff; border-bottom: 1px solid #fff;&#125;.posts &gt; li + li&#123; border-top: 1px solid #ddd;&#125;.posts li .title span&#123; position: absolute; left: 10px; top: 10px; color: #5FB878; font-size: 14px;&#125;.posts li .title&#123; margin-left: 40px; font-size: 20px; color: #222;&#125;.posts .userAvator&#123; position: absolute; left: 3px; top: 3px; width: 40px; height: 40px; border-radius: 5px;&#125;.posts .content&#123; border-top: 1px solid #f2f2f2; border-bottom: 1px solid #f2f2f2; margin: 10px 0 0 0 ; padding: 10px 0; margin-left: 40px;&#125;.userMsg img&#123; width: 40px; height: 40px; border-radius: 5px; margin-right: 10px; vertical-align: middle; display: inline-block;&#125;.userMsg span&#123; font-size: 18px; color:#333; position: relative; top: 2px;&#125;.posts li img&#123; max-width: 100%;&#125;.spost .comment_pv&#123; position: absolute; top: 10px;&#125;.spost .edit &#123; position: absolute; right: 20px; bottom: 5px;&#125;.spost .edit p &#123; display: inline-block; margin-left: 10px;&#125;.comment_wrap &#123; width: 60%; margin: 20px auto;&#125;.submit &#123; display: block; width: 100px; height: 40px; line-height: 40px; text-align: center; border-radius: 4px; background: #5FB878; cursor: pointer; color: #fff; float: left; margin-top: 20px ; border:1px solid #fff;&#125;.submit:hover&#123; background: #fff; color: #5FB878; border:1px solid #5FB878;&#125;.comment_list&#123; border: 1px solid #ddd; border-radius: 4px;&#125;.cmt_lists:hover&#123; background: #f2f2f2;&#125;.cmt_lists + .cmt_lists&#123; border-top: 1px solid #ddd;&#125;.cmt_content &#123; padding: 10px; position: relative; border-radius: 4px; word-break: break-all;&#125;.cmt_detail&#123; margin-left: 48px;&#125;.cmt_content img&#123; max-width: 100%;&#125;/* .cmt_content:after &#123; content: '#content'; position: absolute; top: 5px; right: 5px; color: #aaa; font-size: 13px;&#125; */.cmt_name &#123; position: absolute; right: 8px; bottom: 5px; color: #333;&#125;.cmt_name a &#123; margin-left: 5px; color: #1E9FFF;&#125;.cmt_time&#123; position: absolute; font-size: 12px; right: 5px; top: 5px; color: #aaa&#125;.form &#123; margin: 0 auto; width: 50%; margin-top: 20px;&#125;textarea &#123; width: 100%; height: 150px; padding:10px 0 0 10px; font-size: 20px; border-radius: 4px; border: 1px solid #d7dde4; -webkit-appearance: none; resize: none;&#125;textarea#spContent&#123; width: 98%;&#125;.tips &#123; margin: 20px 0; color: #ec5051; text-align: center;&#125;.container &#123; width: 60%; margin: 0 auto;&#125;.form img.preview &#123; width:100px; height:100px; border-radius: 50%; display: none; margin-top:10px;&#125;input &#123; display: block; width: 100%; height: 35px; font-size: 18px; padding: 6px 7px; border-radius: 4px; border: 1px solid #d7dde4; -webkit-appearance: none;&#125;input:focus,textarea:focus&#123; outline: 0; box-shadow: 0 0 0 2px rgba(51,153,255,.2); border-color: #5cadff;&#125;input:hover,input:active,textarea:hover,textarea:active&#123; border-color: #5cadff;&#125;.create label &#123; display: block; margin: 10px 0;&#125;.comment_wrap form &#123; width: 100%; margin-bottom: 85px;&#125;.delete_comment,.delete_post &#123; cursor: pointer;&#125;.delete_comment:hover,.delete_post:hover,a:hover &#123; color: #ec5051;&#125;.disabled&#123; user-select: none; cursor: not-allowed !important;&#125;.error&#123; color: #ec5051;&#125;.success&#123; color: #1E9FFF;&#125;.container&#123; width: 60%; margin:0 auto;&#125;.message&#123; position: fixed; top: -100%; left: 50%; transform: translateX(-50%); padding: 10px 20px; background: rgba(0, 0, 0, 0.7); color: #fff; border-bottom-left-radius: 15px; border-bottom-right-radius: 15px; z-index: 99999;&#125;.markdown pre&#123; display: block; overflow-x: auto; padding: 0.5em; background: #F0F0F0; border-radius: 3px; border: 1px solid #fff;&#125;.markdown blockquote&#123; padding: 0 1em; color: #6a737d; border-left: 0.25em solid #dfe2e5; margin: 10px 0;&#125;.markdown ul li&#123; list-style: circle; margin-top: 5px;&#125; æˆ‘ä»¬å†æŠŠæ¨¡æ¿å¼•æ“çš„headerå’Œfooterç‹¬ç«‹å‡ºæ¥ /views/header.ejsé¡ºä¾¿å¼•å…¥index.csså’Œjq123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt; &lt;meta charset="UTF-8"&gt; &lt;title&gt;koa2-blog&lt;/title&gt; &lt;link rel="icon" href="http://www.wclimb.site/images/avatar.png"&gt; &lt;link rel="stylesheet" href="/index.css"&gt; &lt;script src="http://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"&gt;&lt;/script&gt; &lt;script&gt; function fade(txt)&#123; $('.message').text(txt) $('.message').animate(&#123; top:0 &#125;) setTimeout(function()&#123; $('.message').animate(&#123; top: '-100%' &#125;) &#125;,1500) &#125; $(function()&#123; $('.signout').click(()=&gt;&#123; $.ajax(&#123; url: "/signout", type: "GET", cache: false, dataType: 'json', success: function (msg) &#123; if (msg) &#123; fade('ç™»å‡ºæˆåŠŸ') setTimeout(()=&gt;&#123; window.location.href = "/posts" &#125;,1500) &#125; &#125;, error: function () &#123; alert('å¼‚å¸¸'); &#125; &#125;) &#125;) &#125;) &lt;/script&gt;&lt;/head&gt;&lt;body&gt; &lt;header&gt; &lt;div class="user_name"&gt; &lt;% if(session.user)&#123; %&gt; Hello,&lt;%= session.user %&gt; &lt;% &#125; %&gt; &lt;% if(!session.user)&#123; %&gt; æ¬¢è¿æ³¨å†Œç™»å½•^_^ &lt;% &#125; %&gt; &lt;/div&gt; &lt;div class="message"&gt;ç™»å½•æˆåŠŸ&lt;/div&gt; &lt;div class="user_right"&gt; &lt;% if(session.user)&#123; %&gt; &lt;div class="has_user"&gt; &lt;a target="__blank" href="https://github.com/wclimb/Koa2-blog"&gt;GitHub&lt;/a&gt; &lt;% if(type == 'all')&#123; %&gt; &lt;a class="active" href="/posts"&gt;å…¨éƒ¨æ–‡ç« &lt;/a&gt; &lt;% &#125;else&#123; %&gt; &lt;a href="/posts"&gt;å…¨éƒ¨æ–‡ç« &lt;/a&gt; &lt;% &#125;%&gt; &lt;% if(type == 'my')&#123; %&gt; &lt;a class="active" href="/posts?author=&lt;%= session.user %&gt;"&gt;æˆ‘çš„æ–‡ç« &lt;/a&gt; &lt;% &#125;else&#123; %&gt; &lt;a href="/posts?author=&lt;%= session.user %&gt;"&gt;æˆ‘çš„æ–‡ç« &lt;/a&gt; &lt;% &#125;%&gt; &lt;% if(type == 'create')&#123; %&gt; &lt;a class="active" href="/create"&gt;å‘è¡¨æ–‡ç« &lt;/a&gt; &lt;% &#125;else&#123; %&gt; &lt;a href="/create"&gt;å‘è¡¨æ–‡ç« &lt;/a&gt; &lt;% &#125;%&gt; &lt;span class="signout"&gt;ç™»å‡º&lt;/span&gt; &lt;/div&gt; &lt;% &#125; %&gt; &lt;% if(!session.user)&#123; %&gt; &lt;div class="none_user has_user"&gt; &lt;a target="__blank" href="https://github.com/wclimb/Koa2-blog"&gt;GitHub&lt;/a&gt; &lt;% if(type == 'all')&#123; %&gt; &lt;a class="active" href="/posts"&gt;å…¨éƒ¨æ–‡ç« &lt;/a&gt; &lt;% &#125;else&#123; %&gt; &lt;a href="/posts"&gt;å…¨éƒ¨æ–‡ç« &lt;/a&gt; &lt;% &#125;%&gt; &lt;% if(type == 'signup')&#123; %&gt; &lt;a class="active" href="/signup"&gt;æ³¨å†Œ&lt;/a&gt; &lt;% &#125;else&#123; %&gt; &lt;a href="/signup"&gt;æ³¨å†Œ&lt;/a&gt; &lt;% &#125;%&gt; &lt;% if(type == 'signin')&#123; %&gt; &lt;a class="active" href="/signin"&gt;ç™»å½•&lt;/a&gt; &lt;% &#125;else&#123; %&gt; &lt;a href="/signin"&gt;ç™»å½•&lt;/a&gt; &lt;% &#125;%&gt; &lt;/div&gt; &lt;% &#125; %&gt; &lt;/div&gt; &lt;/header&gt; é¦–å…ˆæˆ‘ä»¬çœ‹åˆ°ç”¨åˆ°äº†session.userï¼Œè¿™ä¸ªå€¼ä»å“ªæ¥å‘¢ï¼Ÿè¯·çœ‹ä¸‹é¢çš„ä»£ç 1234567// æ³¨å†Œé¡µé¢router.get('/signup', async(ctx, next) =&gt; &#123; await checkNotLogin(ctx) await ctx.render('signup', &#123; session: ctx.session, &#125;)&#125;) æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å‘æ¨¡æ¿ä¼ äº†ä¸€ä¸ªsessionå€¼ï¼Œsession:ctx.sessionï¼Œè¿™ä¸ªå€¼å­˜å–çš„å°±æ˜¯ç”¨æˆ·çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·åã€ç™»å½•ä¹‹åçš„idç­‰ï¼Œsessionä¸€èˆ¬æ˜¯ä½ å…³é—­æµè§ˆå™¨å°±è¿‡æœŸäº†ï¼Œç­‰äºä¸‹æ¬¡æ‰“å¼€æµè§ˆå™¨çš„æ—¶å€™å°±å¾—é‡æ–°ç™»å½•äº†ï¼Œç”¨ifåˆ¤æ–­ä»–å­˜ä¸å­˜åœ¨ï¼Œå°±å¯ä»¥çŸ¥é“ç”¨æˆ·æ˜¯å¦éœ€è¦ç™»å½•ï¼Œå¦‚æœä¸å­˜åœ¨ç”¨æˆ·ï¼Œåˆ™åªæ˜¾ç¤ºå…¨éƒ¨æ–‡ç«  æ³¨å†Œ ç™»å½• ,å¦‚æœsession.userå­˜åœ¨åˆ™æœ‰ç™»å‡ºçš„æŒ‰é’®ã€‚ åœ¨ä¸Šé¢æˆ‘ä»¬ä¼šçœ‹åˆ°æˆ‘ç”¨äº†å¦å¤–ä¸€ä¸ªifåˆ¤æ–­ï¼Œåˆ¤æ–­typeç±»å‹ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯æ¯”å¦‚æˆ‘ä»¬ç™»å½•æ³¨å†Œé¡µé¢ï¼Œæ³¨å†Œé¡µé¢çš„å¯¼èˆªä¼šé«˜äº®ï¼Œå…¶å®å°±æ˜¯æ·»åŠ äº†classï¼šactive;ä¹‹åæˆ‘ä»¬æ¯ä¸ªejsæ–‡ä»¶çš„å¤´éƒ¨ä¼šè¿™æ ·å†™&lt;%- include(&quot;header&quot;,{type:&#39;signup&#39;}) %&gt; ç™»å½•é¡µé¢åˆ™æ˜¯&lt;%- include(&quot;header&quot;,{type:&#39;signin&#39;}) %&gt; /views/footer.ejs123 &lt;/body&gt;&lt;/html&gt; ä¿®æ”¹views/signup.ejs12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697&lt;%- include("header",&#123;type:'signup'&#125;) %&gt; &lt;div class="container"&gt; &lt;form class="form create" method="post"&gt; &lt;div&gt; &lt;label&gt;ç”¨æˆ·åï¼š&lt;/label&gt; &lt;input placeholder="è¯·è¾“å…¥ç”¨æˆ·å" type="text" name="name"&gt; &lt;/div&gt; &lt;div&gt; &lt;label&gt;å¯†ç ï¼š&lt;/label&gt; &lt;input placeholder="è¯·è¾“å…¥å¯†ç " class="password" type="password" name="password"&gt; &lt;/div&gt; &lt;div&gt; &lt;label&gt;é‡å¤å¯†ç ï¼š&lt;/label&gt; &lt;input placeholder="è¯·ç¡®è®¤å¯†ç " class="repeatpass" type="password" name="repeatpass"&gt; &lt;/div&gt; &lt;div&gt; &lt;label&gt;ä¸Šä¼ å¤´åƒï¼š&lt;/label&gt; &lt;input type="file" name="avator" id="avator"&gt; &lt;input type="hidden" id="avatorVal"&gt; &lt;img class="preview" alt="é¢„è§ˆå¤´åƒ"&gt; &lt;/div&gt; &lt;div class="submit"&gt;æ³¨å†Œ&lt;/div&gt; &lt;/form&gt; &lt;/div&gt; &lt;script&gt; $(window).keyup(function (e) &#123; //console.log(e.keyCode) if (e.keyCode == 13) &#123; $('.submit').click() &#125; &#125;) $('#avator').change(function()&#123; if (this.files.length != 0) &#123; var file = this.files[0], reader = new FileReader(); if (!reader) &#123; this.value = ''; return; &#125;; console.log(file.size) if (file.size &gt;= 1024 * 1024 / 2) &#123; fade("è¯·ä¸Šä¼ å°äº512kbçš„å›¾ç‰‡!") return &#125; reader.onload = function (e) &#123; this.value = ''; $('form .preview').attr('src', e.target.result) $('form .preview').fadeIn() $('#avatorVal').val(e.target.result) &#125;; reader.readAsDataURL(file); &#125;; &#125;) $('.submit').click(()=&gt;&#123; // console.log($('.form').serialize()) if ($('input[name=name]').val().trim() == '') &#123; fade('è¯·è¾“å…¥ç”¨æˆ·åï¼') &#125;else if($('input[name=name]').val().match(/[&lt;'"&gt;]/g))&#123; fade('è¯·è¾“å…¥åˆæ³•å­—ç¬¦ï¼') &#125;else if($('#avatorVal').val() == '')&#123; fade('è¯·ä¸Šä¼ å¤´åƒï¼') &#125;else&#123; $.ajax(&#123; url: "/signup", data: &#123; name: $('input[name=name]').val(), password: $('input[name=password]').val(), repeatpass: $('input[name=repeatpass]').val(), avator: $('#avatorVal').val(), &#125;, type: "POST", cache: false, dataType: 'json', success: function (msg) &#123; if (msg.data == 1) &#123; $('input').val('') fade('ç”¨æˆ·åå­˜åœ¨') &#125; else if (msg.data == 2)&#123; fade('è¯·è¾“å…¥é‡å¤çš„å¯†ç ') &#125; else if(msg.data == 3)&#123; fade('æ³¨å†ŒæˆåŠŸ') setTimeout(()=&gt;&#123; window.location.href="/signin" &#125;,1000) &#125; &#125;, error: function () &#123; alert('å¼‚å¸¸'); &#125; &#125;) &#125; &#125;) &lt;/script&gt;&lt;% include footer %&gt; å…ˆçœ‹æˆ‘ä»¬è¯·æ±‚çš„urlåœ°å€ï¼Œæ˜¯â€™/signupâ€™ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªå‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸‹é¢è¿™æ®µä»£ç (åé¢æœ‰å®Œæ•´çš„)12345678910router.post('/signup', async(ctx, next) =&gt; &#123; //console.log(ctx.request.body) let user = &#123; name: ctx.request.body.name, pass: ctx.request.body.password, repeatpass: ctx.request.body.repeatpass, avator: ctx.request.body.avator &#125; ....&#125; æˆ‘ä»¬çš„è¯·æ±‚æ–¹å¼æ˜¯postï¼Œåœ°å€æ˜¯/signupæ‰€ä»¥èµ°äº†è¿™æ®µä»£ç ï¼Œä¹‹åä¼šè·å–æˆ‘ä»¬è¾“å…¥çš„ä¿¡æ¯ï¼Œé€šè¿‡ctx.request.bodyæ‹¿åˆ° è¿™é‡Œé‡ç‚¹å°±åœ¨äºajaxæäº¤äº†ï¼Œæäº¤ä¹‹åæ¢å›æ•°æ® 1 2 3ï¼Œç„¶ååˆ†åˆ«åšæ­£ç¡®é”™è¯¯å¤„ç†ï¼ŒæŠŠä¿¡æ¯å†™åœ¨errorå’Œsuccessä¸­ ä¿®æ”¹routers/signup.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263const router = require('koa-router')();const userModel = require('../lib/mysql.js');const md5 = require('md5')const checkNotLogin = require('../middlewares/check.js').checkNotLoginconst checkLogin = require('../middlewares/check.js').checkLoginconst moment = require('moment');const fs = require('fs')// æ³¨å†Œé¡µé¢router.get('/signup', async(ctx, next) =&gt; &#123; await checkNotLogin(ctx) await ctx.render('signup', &#123; session: ctx.session, &#125;)&#125;)// post æ³¨å†Œrouter.post('/signup', async(ctx, next) =&gt; &#123; //console.log(ctx.request.body) let user = &#123; name: ctx.request.body.name, pass: ctx.request.body.password, repeatpass: ctx.request.body.repeatpass, avator: ctx.request.body.avator &#125; await userModel.findDataByName(user.name) .then(async (result) =&gt; &#123; console.log(result) if (result.length) &#123; try &#123; throw Error('ç”¨æˆ·å·²ç»å­˜åœ¨') &#125; catch (error) &#123; //å¤„ç†err console.log(error) &#125; // ç”¨æˆ·å­˜åœ¨ ctx.body = &#123; data: 1 &#125;;; &#125; else if (user.pass !== user.repeatpass || user.pass === '') &#123; ctx.body = &#123; data: 2 &#125;; &#125; else &#123; // ctx.session.user=ctx.request.body.name let base64Data = user.avator.replace(/^data:image\/\w+;base64,/, ""); let dataBuffer = new Buffer(base64Data, 'base64'); let getName = Number(Math.random().toString().substr(3)).toString(36) + Date.now() await fs.writeFile('./public/images/' + getName + '.png', dataBuffer, err =&gt; &#123; if (err) throw err; console.log('å¤´åƒä¸Šä¼ æˆåŠŸ') &#125;); await userModel.insertData([user.name, md5(user.pass), getName, moment().format('YYYY-MM-DD HH:mm:ss')]) .then(res=&gt;&#123; console.log('æ³¨å†ŒæˆåŠŸ',res) //æ³¨å†ŒæˆåŠŸ ctx.body = &#123; data: 3 &#125;; &#125;) &#125; &#125;)&#125;)module.exports = router æˆ‘ä»¬ä½¿ç”¨md5å®ç°å¯†ç åŠ å¯†ï¼Œé•¿åº¦æ˜¯32ä½çš„ ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰è¯´çš„bodyParseæ¥è§£ææäº¤çš„æ•°æ®ï¼Œé€šè¿‡ctx.request.bodyå¾—åˆ° æˆ‘ä»¬å¼•å…¥äº†æ•°æ®åº“çš„æ“ä½œ findDataByNameå’ŒinsertDataï¼Œå› ä¸ºä¹‹å‰æˆ‘ä»¬åœ¨/lib/mysql.jsä¸­å·²ç»æŠŠä»–ä»¬å†™å¥½ï¼Œå¹¶æš´éœ²å‡ºæ¥äº†ã€‚æ„æ€æ˜¯å…ˆä»æ•°æ®åº“é‡Œé¢æŸ¥æ‰¾æ³¨å†Œçš„ç”¨æˆ·åï¼Œå¦‚æœæ‰¾åˆ°äº†è¯æ˜è¯¥ç”¨æˆ·åå·²ç»è¢«æ³¨å†Œè¿‡äº†ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™ä½¿ç”¨insertDataå¢åŠ åˆ°æ•°æ®åº“ä¸­ ctx.body æ˜¯æˆ‘ä»¬é€šè¿‡ajaxæäº¤ä¹‹åç»™é¡µé¢è¿”å›çš„æ•°æ®ï¼Œæ¯”å¦‚æäº¤ajaxæˆåŠŸä¹‹åmsg.data=1çš„æ—¶å€™å°±ä»£è¡¨ç”¨æˆ·å­˜åœ¨ï¼Œmsg.dataå‡ºç°åœ¨åé¢çš„signup.ejsæ¨¡æ¿ajaxè¯·æ±‚ä¸­ ä¸Šä¼ å¤´åƒä¹‹å‰è¦æ–°å»ºå¥½æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬ajaxå‘é€çš„æ˜¯base64çš„æ ¼å¼ï¼Œç„¶åä½¿ç”¨fs.writeFileæ¥ç”Ÿæˆå›¾ç‰‡ æˆ‘ä»¬ä½¿ç”¨ajaxæ¥æäº¤æ•°æ®ï¼Œæ–¹ä¾¿æ¥åšæˆåŠŸé”™è¯¯çš„å¤„ç† æ¨¡æ¿å¼•æ“ejsæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ejsï¼Œè¯­æ³•å¯ä»¥è§ejs ä¹‹å‰æˆ‘ä»¬å†™äº†è¿™ä¹ˆä¸€æ®µä»£ç 12345router.get('/signup',async (ctx,next)=&gt;&#123; await ctx.render('signup',&#123; session:ctx.session, &#125;)&#125;) è¿™é‡Œå°±ç”¨åˆ°äº†ejsæ‰€éœ€çš„session æˆ‘ä»¬é€šè¿‡æ¸²æŸ“signup.ejsæ¨¡æ¿ï¼Œå°†å€¼ctx.sessionèµ‹å€¼ç»™sessionï¼Œä¹‹åæˆ‘ä»¬å°±å¯ä»¥åœ¨signup.ejsä¸­ä½¿ç”¨äº†ejsçš„å¸¸ç”¨æ ‡ç­¾ä¸ºï¼š &lt;% code %&gt;ï¼šè¿è¡Œ JavaScript ä»£ç ï¼Œä¸è¾“å‡º &lt;%= code %&gt;ï¼šæ˜¾ç¤ºè½¬ä¹‰åçš„ HTMLå†…å®¹ &lt;%- code %&gt;ï¼šæ˜¾ç¤ºåŸå§‹ HTML å†…å®¹ &lt;%= code %&gt;å’Œ&lt;%- code %&gt;çš„åŒºåˆ«åœ¨äºï¼Œ&lt;%= code %&gt;ä¸ç®¡ä½ å†™ä»€ä¹ˆéƒ½ä¼šåŸæ ·è¾“å‡ºï¼Œæ¯”å¦‚codeä¸º &lt;strong&gt;hello&lt;/strong&gt;çš„æ—¶å€™ &lt;%= code %&gt; ä¼šæ˜¾ç¤º&lt;strong&gt;hello&lt;/strong&gt;è€Œ&lt;%- code %&gt;åˆ™æ˜¾ç¤ºåŠ ç²—çš„hello å®ç°ç™»å½•é¡µé¢ ä¿®æ”¹ /routers/signin.js12345678910111213const router = require('koa-router')();const userModel = require('../lib/mysql.js')const md5 = require('md5')const checkNotLogin = require('../middlewares/check.js').checkNotLoginconst checkLogin = require('../middlewares/check.js').checkLoginrouter.get('/signin', async(ctx, next) =&gt; &#123; await checkNotLogin(ctx) await ctx.render('signin', &#123; session: ctx.session, &#125;)&#125;)module.exports=router ä¿®æ”¹ /views/signin.ejs 123456789101112131415&lt;%- include("header",&#123;type:'signin'&#125;) %&gt; &lt;div class="container"&gt; &lt;form class="form create" method="post "&gt; &lt;div&gt; &lt;label&gt;ç”¨æˆ·åï¼š&lt;/label&gt; &lt;input placeholder="ç”¨æˆ·å" type="text" name="name"&gt; &lt;/div&gt; &lt;div&gt; &lt;label&gt;å¯†ç ï¼š&lt;/label&gt; &lt;input placeholder="å¯†ç " type="password" name="password"&gt; &lt;/div&gt; &lt;div class="submit"&gt;ç™»å½•&lt;/div&gt; &lt;/form&gt; &lt;/div&gt;&lt;% include footer %&gt; ä¿®æ”¹ index.js æ–‡ä»¶ æŠŠä¸‹é¢è¿™æ®µä»£ç æ³¨é‡Šå»æ‰ï¼Œä¹‹å‰æ³¨é‡Šæ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å†™signinçš„è·¯ç”±ï¼Œä»¥å…æŠ¥é”™ï¼Œåé¢è¿˜æœ‰æ–‡ç« é¡µå’Œç™»å‡ºé¡µçš„è·¯ç”±ï¼Œå¤§å®¶è®°ä½ä¸€ä¸‹ 1app.use(require('./routers/signin.js').routes()) ç°åœ¨æ³¨å†Œä¸€ä¸‹æ¥çœ‹çœ‹æ•ˆæœå§1$ supervisor --harmony index æˆ‘ä»¬æ€ä¹ˆæŸ¥çœ‹æˆ‘ä»¬æ³¨å†Œå¥½çš„è´¦å·å’Œå¯†ç å‘¢ï¼Ÿæ‰“å¼€mysqlæ§åˆ¶å° 1$ select * from users; è¿™æ ·åˆšåˆšæˆ‘ä»¬æ³¨å†Œçš„ç”¨æˆ·ä¿¡æ¯éƒ½å‡ºç°äº† å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¸®åŠ©åˆ°äº†ä½ ï¼Œé‚£å°±èµè„¸ç»™ä¸ªstarå§ï¼Œhttps://github.com/wclimb/Koa2-blog ç™»å½•é¡µé¢ä¿®æ”¹signinrouters/signin.js123456789101112131415161718192021222324252627282930313233343536373839const router = require('koa-router')();const userModel = require('../lib/mysql.js')const md5 = require('md5')const checkNotLogin = require('../middlewares/check.js').checkNotLoginconst checkLogin = require('../middlewares/check.js').checkLoginrouter.get('/signin', async(ctx, next) =&gt; &#123; await checkNotLogin(ctx) await ctx.render('signin', &#123; session: ctx.session, &#125;)&#125;)router.post('/signin', async(ctx, next) =&gt; &#123; console.log(ctx.request.body) let name = ctx.request.body.name; let pass = ctx.request.body.password; await userModel.findDataByName(name) .then(result =&gt; &#123; let res = result if (name === res[0]['name'] &amp;&amp; md5(pass) === res[0]['pass']) &#123; ctx.body = true ctx.session.user = res[0]['name'] ctx.session.id = res[0]['id'] console.log('ctx.session.id', ctx.session.id) console.log('session', ctx.session) console.log('ç™»å½•æˆåŠŸ') &#125;else&#123; ctx.body = false console.log('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯!') &#125; &#125;).catch(err =&gt; &#123; console.log(err) &#125;)&#125;)module.exports = router æˆ‘ä»¬è¿›è¡Œç™»å½•æ“ä½œï¼Œåˆ¤æ–­ç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æœ‰è¯¯ï¼Œä½¿ç”¨md5åŠ å¯†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç™»å½•æˆåŠŸè¿”å›çš„ç»“æœæ˜¯result ç»“æœæ˜¯è¿™æ ·çš„ä¸€ä¸ªjsonæ•°ç»„ï¼šidï¼š4 nameï¼šrrr passï¼šâ€¦[ RowDataPacket { id: 4, name: â€˜rrrâ€™, pass: â€˜44f437ced647ec3f40fa0841041871cdâ€™ } ] ä¿®æ”¹views/signin.ejssignin.ejs123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt;%- include("header",&#123;type:'signin'&#125;) %&gt; &lt;div class="container"&gt; &lt;form class="form create" method="post "&gt; &lt;div&gt; &lt;label&gt;ç”¨æˆ·åï¼š&lt;/label&gt; &lt;input placeholder="ç”¨æˆ·å" type="text" name="name"&gt; &lt;/div&gt; &lt;div&gt; &lt;label&gt;å¯†ç ï¼š&lt;/label&gt; &lt;input placeholder="å¯†ç " type="password" name="password"&gt; &lt;/div&gt; &lt;div class="submit"&gt;ç™»å½•&lt;/div&gt; &lt;/form&gt; &lt;/div&gt; &lt;script&gt; $(window).keyup(function(e)&#123; //console.log(e.keyCode) if (e.keyCode == 13) &#123; $('.submit').click() &#125; &#125;) $('.submit').click(()=&gt;&#123; if ($('input[name=name]').val().trim() == '' || $('input[name=password]').val().trim() == '' ) &#123; fade('è¯·è¾“å…¥ç”¨æˆ·åæˆ–å¯†ç ') &#125;else&#123; console.log($('.form').serialize()) $.ajax(&#123; url: "/signin", data: $('.form').serialize(), type: "POST", cache: false, dataType: 'json', success: function (msg) &#123; if (!msg) &#123; $('input').val('') fade('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯') &#125; else&#123; fade('ç™»å½•æˆåŠŸ') setTimeout(()=&gt;&#123; window.location.href = "/posts" &#125;,1500) &#125; &#125;, error: function () &#123; alert('å¼‚å¸¸'); &#125; &#125;) &#125; &#125;) &lt;/script&gt;&lt;% include footer %&gt; æˆ‘ä»¬å¢åŠ äº†ajaxè¯·æ±‚ï¼Œåœ¨routers/signin.jsé‡Œï¼Œæˆ‘ä»¬è®¾ç½®å¦‚æœç™»å½•å¤±è´¥å°±è¿”å›falseï¼Œç™»å½•æˆåŠŸè¿”å›true 12ctx.body = falsectx.body = true é‚£æˆ‘ä»¬ç™»å½•æˆåŠŸåè¦åšè·³è½¬ï¼Œå¯ä»¥çœ‹åˆ°window.location.href=&quot;/posts&quot;è·³è½¬åˆ°postsé¡µé¢ å…¨éƒ¨æ–‡ç« ä¿®æ”¹routers/posts.js posts.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172const router = require('koa-router')();const userModel = require('../lib/mysql.js')const moment = require('moment')const checkNotLogin = require('../middlewares/check.js').checkNotLoginconst checkLogin = require('../middlewares/check.js').checkLogin;const md = require('markdown-it')(); // é‡ç½®åˆ°æ–‡ç« é¡µrouter.get('/', async(ctx, next) =&gt; &#123; ctx.redirect('/posts')&#125;)// æ–‡ç« é¡µrouter.get('/posts', async(ctx, next) =&gt; &#123; let res, postsLength, name = decodeURIComponent(ctx.request.querystring.split('=')[1]); if (ctx.request.querystring) &#123; console.log('ctx.request.querystring', name) await userModel.findDataByUser(name) .then(result =&gt; &#123; postsLength = result.length &#125;) await userModel.findPostByUserPage(name,1) .then(result =&gt; &#123; res = result &#125;) await ctx.render('selfPosts', &#123; session: ctx.session, posts: res, postsPageLength:Math.ceil(postsLength / 10), &#125;) &#125; else &#123; await userModel.findPostByPage(1) .then(result =&gt; &#123; //console.log(result) res = result &#125;) await userModel.findAllPost() .then(result=&gt;&#123; postsLength = result.length &#125;) await ctx.render('posts', &#123; session: ctx.session, posts: res, postsLength: postsLength, postsPageLength: Math.ceil(postsLength / 10), &#125;) &#125;&#125;)// é¦–é¡µåˆ†é¡µï¼Œæ¯æ¬¡è¾“å‡º10æ¡router.post('/posts/page', async(ctx, next) =&gt; &#123; let page = ctx.request.body.page; await userModel.findPostByPage(page) .then(result=&gt;&#123; //console.log(result) ctx.body = result &#125;).catch(()=&gt;&#123; ctx.body = 'error' &#125;) &#125;)// ä¸ªäººæ–‡ç« åˆ†é¡µï¼Œæ¯æ¬¡è¾“å‡º10æ¡router.post('/posts/self/page', async(ctx, next) =&gt; &#123; let data = ctx.request.body await userModel.findPostByUserPage(data.name,data.page) .then(result=&gt;&#123; //console.log(result) ctx.body = result &#125;).catch(()=&gt;&#123; ctx.body = 'error' &#125;) &#125;)module.exports = router ä¿®æ”¹ index.js app.use(require(â€˜./routers/posts.jsâ€™).routes())çš„æ³¨é‡Šå»æ‰ ä¿®æ”¹ views/posts.ejs 12345&lt;%- include(&quot;header&quot;,&#123;type:&apos;posts&apos;&#125;) %&gt; posts&lt;% include footer %&gt; ç°åœ¨çœ‹çœ‹ç™»å½•æˆåŠŸä¹‹åçš„é¡µé¢å§ æ¥ä¸‹æ¥æˆ‘ä»¬å®ç°ç™»å‡ºé¡µé¢ ç™»å‡ºé¡µé¢ä¿®æ”¹ router/signout.js signout.js123456789const router = require('koa-router')();router.get('/signout', async(ctx, next) =&gt; &#123; ctx.session = null; console.log('ç™»å‡ºæˆåŠŸ') ctx.body = true&#125;)module.exports = router æŠŠsessionè®¾ç½®ä¸ºnullå³å¯ ä¿®æ”¹ index.js app.use(require(â€˜./routers/posts.jsâ€™).routes())çš„æ³¨é‡Šå»æ‰ï¼Œç°åœ¨æŠŠæ³¨é‡Šçš„è·¯ç”±å…¨éƒ¨å–æ¶ˆæ³¨é‡Šå°±å¯¹äº† ç„¶åæˆ‘ä»¬çœ‹çœ‹ views/header.ejs æˆ‘ä»¬ç‚¹å‡»ç™»å‡ºåçš„ajax çš„æäº¤ï¼ŒæˆåŠŸä¹‹åå›åˆ°postsé¡µé¢ å‘è¡¨æ–‡ç« ä¿®æ”¹router/postsåœ¨åé¢å¢åŠ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647// å‘è¡¨æ–‡ç« é¡µé¢router.get('/create', async(ctx, next) =&gt; &#123; await ctx.render('create', &#123; session: ctx.session, &#125;)&#125;)// post å‘è¡¨æ–‡ç« router.post('/create', async(ctx, next) =&gt; &#123; let title = ctx.request.body.title, content = ctx.request.body.content, id = ctx.session.id, name = ctx.session.user, time = moment().format('YYYY-MM-DD HH:mm:ss'), avator, // ç°åœ¨ä½¿ç”¨markdownä¸éœ€è¦å•ç‹¬è½¬ä¹‰ newContent = content.replace(/[&lt;"&gt;']/g, (target) =&gt; &#123; return &#123; '&lt;': '&amp;lt;', '"': '&amp;quot;', '&gt;': '&amp;gt;', "'": '&amp;#39;' &#125;[target] &#125;), newTitle = title.replace(/[&lt;"&gt;']/g, (target) =&gt; &#123; return &#123; '&lt;': '&amp;lt;', '"': '&amp;quot;', '&gt;': '&amp;gt;', "'": '&amp;#39;' &#125;[target] &#125;); //console.log([name, newTitle, content, id, time]) await userModel.findUserData(ctx.session.user) .then(res =&gt; &#123; console.log(res[0]['avator']) avator = res[0]['avator'] &#125;) await userModel.insertPost([name, newTitle, md.render(content), content, id, time,avator]) .then(() =&gt; &#123; ctx.body = true &#125;).catch(() =&gt; &#123; ctx.body = false &#125;)&#125;) ä¿®æ”¹ views/create.ejs create.ejs123456789101112131415161718192021222324252627282930313233343536373839404142434445&lt;%- include("header",&#123;type:'create'&#125;) %&gt;&lt;div class="container"&gt; &lt;form style="width:100%" method="post" class="form create"&gt; &lt;div&gt; &lt;label&gt;æ ‡é¢˜ï¼š&lt;/label&gt; &lt;input placeholder="è¯·è¾“å…¥æ ‡é¢˜" type="text" name="title"&gt; &lt;/div&gt; &lt;div&gt; &lt;label&gt;å†…å®¹ï¼š&lt;/label&gt; &lt;textarea placeholder="è¯·è¾“å…¥å†…å®¹" name="content" id="" cols="42" rows="10"&gt;&lt;/textarea&gt; &lt;/div&gt; &lt;div class="submit"&gt;å‘è¡¨&lt;/div&gt; &lt;/form&gt;&lt;/div&gt;&lt;script&gt; $('.submit').click(()=&gt;&#123; if ($('input[name=title]').val().trim() == '') &#123; fade('è¯·è¾“å…¥æ ‡é¢˜') &#125;else if ($('textarea').val().trim() == '') &#123; fade('è¯·è¾“å…¥å†…å®¹') &#125;else&#123; $.ajax(&#123; url: "/create", data: $('.form').serialize(), type: "POST", cache: false, dataType: 'json', success: function (msg) &#123; if (msg) &#123; fade('å‘è¡¨æˆåŠŸ') setTimeout(()=&gt;&#123; window.location.href="/posts" &#125;,1000) &#125;else&#123; fade('å‘è¡¨å¤±è´¥') &#125; &#125;, error: function () &#123; alert('å¼‚å¸¸'); &#125; &#125;) &#125; &#125;)&lt;/script&gt;&lt;% include footer %&gt; ç°åœ¨çœ‹çœ‹èƒ½ä¸èƒ½å‘è¡¨å§ å³ä½¿æˆ‘ä»¬å‘è¡¨äº†æ–‡ç« ï¼Œä½†æ˜¯å½“å‰æˆ‘ä»¬çš„postsçš„é¡µé¢æ²¡æœ‰æ˜¾ç¤ºï¼Œå› ä¸ºè¿˜æ²¡æœ‰è·å–åˆ°æ•°æ® æˆ‘ä»¬å¯ä»¥çœ‹æˆ‘ä»¬ä¹‹å‰å†™çš„ä»£ç  router.get(&#39;/posts&#39;, async(ctx, next) =&gt; {}è·¯ç”±1234567891011121314151617181920if (ctx.request.querystring) &#123; ...&#125;else &#123; await userModel.findPostByPage(1) .then(result =&gt; &#123; //console.log(result) res = result &#125;) await userModel.findAllPost() .then(result=&gt;&#123; postsLength = result.length &#125;) await ctx.render('posts', &#123; session: ctx.session, posts: res, postsLength: postsLength, postsPageLength: Math.ceil(postsLength / 10), &#125;) &#125; ifå‰é¢è¿™éƒ¨åˆ†æˆ‘ä»¬å…ˆä¸ç”¨ç®¡ï¼Œåé¢ä¼šè¯´ã€‚åªéœ€è¦çœ‹elseåé¢çš„ä»£ç æˆ‘ä»¬é€šè¿‡userModel.findPostByPage(1)æ¥è·å–ç¬¬ä¸€é¡µçš„æ•°æ®ï¼Œç„¶åæŸ¥æ‰¾æ‰€æœ‰æ–‡ç« çš„æ•°é‡ï¼Œæœ€åé™¤ä»¥10æ‹¿åˆ°é¦–é¡µæ–‡ç« çš„é¡µæ•°ï¼ŒæŠŠæ•°æ®postsPageLengthçš„å€¼ä¼ ç»™æ¨¡æ¿posts.ejsã€‚è¿™æ ·å°±å¯ä»¥æ¸²æŸ“å‡ºæ¥äº† ä¿®æ”¹ views/posts.ejs posts.ejs 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384&lt;%- include("header",&#123;type:'all'&#125;) %&gt; &lt;div class="container"&gt; &lt;ul class="posts"&gt; &lt;% posts.forEach(function(res)&#123; %&gt; &lt;li&gt; &lt;div class="author"&gt; &lt;span title="&lt;%= res.name %&gt;"&gt;&lt;a href="/posts?author=&lt;%= res.name %&gt; "&gt;author: &lt;%= res.name %&gt;&lt;/a&gt;&lt;/span&gt; &lt;span&gt;è¯„è®ºæ•°ï¼š&lt;%= res.comments %&gt;&lt;/span&gt; &lt;span&gt;æµè§ˆé‡ï¼š&lt;%= res.pv %&gt;&lt;/span&gt; &lt;/div&gt; &lt;div class="comment_pv"&gt; &lt;span&gt;&lt;%= res.moment %&gt;&lt;/span&gt; &lt;/div&gt; &lt;a href="/posts/&lt;%= res.id %&gt;"&gt; &lt;div class="title"&gt; &lt;img class="userAvator" src="images/&lt;%= res.avator %&gt;.png"&gt; &lt;%= res.title %&gt; &lt;/div&gt; &lt;div class="content markdown"&gt; &lt;%- res.content %&gt; &lt;/div&gt; &lt;/a&gt; &lt;/li&gt; &lt;% &#125;) %&gt; &lt;/ul&gt; &lt;div style="margin-top: 30px" class="pagination" id="page"&gt;&lt;/div&gt; &lt;/div&gt; &lt;script src="http://www.wclimb.site/pagination/pagination.js"&gt;&lt;/script&gt; &lt;script&gt; pagination(&#123; selector: '#page', totalPage: &lt;%= postsPageLength %&gt;, currentPage: 1, prev: 'ä¸Šä¸€é¡µ', next: 'ä¸‹ä¸€é¡µ', first: true, last: true, showTotalPage: true, count: 2//å½“å‰é¡µå‰åæ˜¾ç¤ºçš„æ•°é‡ &#125;,function(val)&#123; // å½“å‰é¡µ $.ajax(&#123; url: "posts/page", type: 'POST', data:&#123; page: val &#125;, cache: false, success: function (msg) &#123; console.log(msg) if (msg != 'error') &#123; $('.posts').html(' ') $.each(msg,function(i,val)&#123; //console.log(val.content) $('.posts').append( '&lt;li&gt;'+ '&lt;div class=\"author\"&gt;'+ '&lt;span title=\"'+ val.name +'\"&gt;&lt;a href=\"/posts?author='+ val.name +' \"&gt;author: '+ val.name +'&lt;/a&gt;&lt;/span&gt;'+ '&lt;span&gt;è¯„è®ºæ•°ï¼š'+ val.comments +'&lt;/span&gt;'+ '&lt;span&gt;æµè§ˆé‡ï¼š'+ val.pv +'&lt;/span&gt;'+ '&lt;/div&gt;'+ '&lt;div class=\"comment_pv\"&gt;'+ '&lt;span&gt;'+ val.moment +'&lt;/span&gt;'+ '&lt;/div&gt;'+ '&lt;a href=\"/posts/'+ val.id +'\"&gt;'+ '&lt;div class=\"title\"&gt;'+ '&lt;img class="userAvator" src="images/'+ val.avator +'.png"&gt;'+ val.title + '&lt;/div&gt;'+ '&lt;div class=\"content\"&gt;'+ val.content + '&lt;/div&gt;'+ '&lt;/a&gt;'+ '&lt;/li&gt;' ) &#125;) &#125;else&#123; alert('åˆ†é¡µä¸å­˜åœ¨') &#125; &#125; &#125;) &#125;) &lt;/script&gt;&lt;% include footer %&gt; ç°åœ¨çœ‹çœ‹postsé¡µé¢æœ‰æ²¡æœ‰æ–‡ç« å‡ºç°äº† æˆ‘ä»¬çœ‹åˆ°æ˜¯æ‰€ç¬¬ä¸€é¡µçš„æ–‡ç« æ•°æ®ï¼Œåˆå§‹åŒ–çš„ç¨åæˆ‘ä»¬æ˜¯ç”¨æœåŠ¡ç«¯æ¸²æŸ“çš„æ•°æ®ï¼Œä½¿ç”¨äº†åˆ†é¡µï¼Œæ¯é¡µæ˜¾ç¤º10æ¡æ•°æ®ï¼Œç„¶åé€šè¿‡è¯·æ±‚é¡µæ•°ã€‚ä¸‹é¢æ˜¯æœåŠ¡ç«¯è¯·æ±‚æ‹¿åˆ°çš„ç¬¬ä¸€é¡µçš„æ•°æ®1234await userModel.findPostByUserPage(name,1) .then(result =&gt; &#123; res = result &#125;) è¦æ‹¿åˆ°åˆ«çš„é¡µé¢æ•°æ®çš„è¯è¦å‘æœåŠ¡å™¨å‘é€postè¯·æ±‚ï¼Œå¦‚ä¸‹1234567891011// é¦–é¡µåˆ†é¡µï¼Œæ¯æ¬¡è¾“å‡º10æ¡router.post(&apos;/posts/page&apos;, async(ctx, next) =&gt; &#123; let page = ctx.request.body.page; await userModel.findPostByPage(page) .then(result=&gt;&#123; //console.log(result) ctx.body = result &#125;).catch(()=&gt;&#123; ctx.body = &apos;error&apos; &#125;) &#125;) å•ç¯‡æ–‡ç« é¡µé¢ä½†æ˜¯æˆ‘éœ€è¦ç‚¹å‡»å•ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæ˜¾ç¤ºä¸€ç¯‡æ–‡ç« æ€ä¹ˆåŠå‘¢ï¼Ÿ ä¿®æ”¹ routers/posts.js åœ¨posts.jsåé¢å¢åŠ  12345678910111213141516171819202122232425262728293031323334// å•ç¯‡æ–‡ç« é¡µrouter.get('/posts/:postId', async(ctx, next) =&gt; &#123; let comment_res, res, pageOne, res_pv; await userModel.findDataById(ctx.params.postId) .then(result =&gt; &#123; //console.log(result ) res = result res_pv = parseInt(result[0]['pv']) res_pv += 1 // console.log(res_pv) &#125;) await userModel.updatePostPv([res_pv, ctx.params.postId]) await userModel.findCommentByPage(1,ctx.params.postId) .then(result =&gt; &#123; pageOne = result //console.log('comment', comment_res) &#125;) await userModel.findCommentById(ctx.params.postId) .then(result =&gt; &#123; comment_res = result //console.log('comment', comment_res) &#125;) await ctx.render('sPost', &#123; session: ctx.session, posts: res[0], commentLenght: comment_res.length, commentPageLenght: Math.ceil(comment_res.length/10), pageOne:pageOne &#125;)&#125;) ç°åœ¨çš„è®¾è®¡æ˜¯ï¼Œæˆ‘ä»¬ç‚¹è¿›å»å‡ºç°çš„urlæ˜¯ /posts/1 è¿™ç±»çš„ 1ä»£è¡¨è¯¥ç¯‡æ–‡ç« çš„idï¼Œæˆ‘ä»¬åœ¨æ•°æ®åº“å»ºè¡¨çš„æ—¶å€™å°±å¤„ç†äº†ï¼Œè®©idä¸ºä¸»é”®ï¼Œç„¶åé€’å¢ æˆ‘ä»¬é€šè¿‡userModel.findDataById æ–‡ç« çš„idæ¥æŸ¥æ‰¾æ•°æ®åº“æˆ‘ä»¬é€šè¿‡userModel.findCommentById æ–‡ç« çš„idæ¥æŸ¥æ‰¾æ–‡ç« çš„è¯„è®ºï¼Œå› ä¸ºå•ç¯‡æ–‡ç« é‡Œé¢æœ‰è¯„è®ºçš„åŠŸèƒ½æœ€åé€šè¿‡sPost.ejsæ¨¡æ¿æ¸²æŸ“å•ç¯‡æ–‡ç«  ä¿®æ”¹ views/sPost.ejs sPost.ejs 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186&lt;%- include("header",&#123;type:''&#125;) %&gt; &lt;div class="container"&gt; &lt;ul class="posts spost"&gt; &lt;li&gt; &lt;div class="author"&gt; &lt;span title="&lt;%= posts.name %&gt;"&gt;&lt;a href="/posts?author=&lt;%= posts.name %&gt; "&gt;author: &lt;%= posts.name %&gt;&lt;/a&gt;&lt;/span&gt; &lt;span&gt;è¯„è®ºæ•°ï¼š&lt;%= posts.comments %&gt;&lt;/span&gt; &lt;span&gt;æµè§ˆé‡ï¼š&lt;%= posts.pv %&gt;&lt;/span&gt; &lt;/div&gt; &lt;div class="comment_pv"&gt; &lt;span&gt;&lt;%= posts.moment %&gt;&lt;/span&gt; &lt;/div&gt; &lt;a href="/posts/&lt;%= posts.id %&gt;"&gt; &lt;div class="title"&gt; &lt;img class="userAvator" src="../images/&lt;%= posts.avator %&gt;.png"&gt; &lt;%= posts.title %&gt; &lt;/div&gt; &lt;div class="content markdown"&gt; &lt;%- posts.content %&gt; &lt;/div&gt; &lt;/a&gt; &lt;div class="edit"&gt; &lt;% if(session &amp;&amp; session.user === posts.name )&#123; %&gt; &lt;p&gt;&lt;a href="&lt;%= posts['id'] %&gt;/edit"&gt;ç¼–è¾‘&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a class="delete_post"&gt;åˆ é™¤&lt;/a&gt;&lt;/p&gt; &lt;% &#125; %&gt; &lt;/div&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; &lt;div class="comment_wrap"&gt; &lt;% if(session.user)&#123; %&gt; &lt;form class="form" method="post" action="/&lt;%= posts.id %&gt;"&gt; &lt;textarea id="spContent" name="content" cols="82"&gt;&lt;/textarea&gt; &lt;div class="submit"&gt;å‘è¡¨ç•™è¨€&lt;/div&gt; &lt;/form&gt; &lt;% &#125; else&#123; %&gt; &lt;p class="tips"&gt;ç™»å½•ä¹‹åæ‰å¯ä»¥è¯„è®ºå“Ÿ&lt;/p&gt; &lt;% &#125; %&gt; &lt;% if (commentPageLenght &gt; 0) &#123; %&gt; &lt;div class="comment_list markdown"&gt; &lt;% pageOne.forEach(function(res)&#123; %&gt; &lt;div class="cmt_lists"&gt; &lt;div class="cmt_content"&gt; &lt;div class="userMsg"&gt; &lt;img src="../images/&lt;%= res['avator'] %&gt;.png" alt=""&gt;&lt;span&gt;&lt;%= res['name'] %&gt;&lt;/span&gt; &lt;/div&gt; &lt;div class="cmt_detail"&gt; &lt;%- res['content'] %&gt; &lt;/div&gt; &lt;span class="cmt_time"&gt;&lt;%= res['moment'] %&gt;&lt;/span&gt; &lt;span class="cmt_name"&gt; &lt;% if(session &amp;&amp; session.user === res['name'])&#123; %&gt; &lt;a class="delete_comment" href="javascript:delete_comment(&lt;%= res['id'] %&gt;);"&gt; åˆ é™¤&lt;/a&gt; &lt;% &#125; %&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;% &#125;) %&gt; &lt;/div&gt; &lt;% &#125; else&#123; %&gt; &lt;p class="tips"&gt;è¿˜æ²¡æœ‰è¯„è®ºï¼Œèµ¶å¿«å»è¯„è®ºå§ï¼&lt;/p&gt; &lt;% &#125; %&gt; &lt;div style="margin-top: 30px" class="pagination" id="page"&gt;&lt;/div&gt; &lt;/div&gt; &lt;script src="http://www.wclimb.site/pagination/pagination.js"&gt;&lt;/script&gt; &lt;script&gt; var userName = "&lt;%- session.user %&gt;" pagination(&#123; selector: '#page', totalPage: &lt;%= commentPageLenght %&gt;, currentPage: 1, prev: 'ä¸Šä¸€é¡µ', next: 'ä¸‹ä¸€é¡µ', first: true, last: true, showTotalPage:true, count: 2//å½“å‰é¡µå‰é¢æ˜¾ç¤ºçš„æ•°é‡ &#125;,function(val)&#123; // å½“å‰é¡µ var _comment = '' $.ajax(&#123; url: "&lt;%= posts.id %&gt;/commentPage", type: 'POST', data:&#123; page: val &#125;, cache: false, success: function (msg) &#123; //console.log(msg) _comment = '' if (msg != 'error') &#123; $('.comment_list').html(' ') $.each(msg,function(i,val)&#123; //console.log(val.content) _comment += '&lt;div class=\"cmt_lists\"&gt;&lt;div class=\"cmt_content\"&gt;&lt;div class=\"userMsg\"&gt;&lt;img src = \"../images/'+ val.avator +'.png\" &gt;&lt;span&gt;'+ val.name +'&lt;/span&gt;&lt;/div &gt;&lt;div class="cmt_detail"&gt;'+ val.content + '&lt;/div&gt;&lt;span class=\"cmt_time\"&gt;'+ val.moment +'&lt;/span&gt;&lt;span class=\"cmt_name\"&gt;'; if (val.name == userName) &#123; _comment += '&lt;a class=\"delete_comment\" href=\"javascript:delete_comment('+ val.id +');\"&gt; åˆ é™¤&lt;/a&gt;' &#125; _comment += '&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;' &#125;) $('.comment_list').append(_comment) &#125;else&#123; alert('åˆ†é¡µä¸å­˜åœ¨') &#125; &#125; &#125;) &#125;) // åˆ é™¤æ–‡ç«  $('.delete_post').click(() =&gt; &#123; $.ajax(&#123; url: "&lt;%= posts.id %&gt;/remove", type: 'POST', cache: false, success: function (msg) &#123; if (msg.data == 1) &#123; fade('åˆ é™¤æ–‡ç« æˆåŠŸ') setTimeout(() =&gt; &#123; window.location.href = "/posts" &#125;, 1000) &#125; else if (msg.data == 2) &#123; fade('åˆ é™¤æ–‡ç« å¤±è´¥'); setTimeout(() =&gt; &#123; window.location.reload() &#125;, 1000) &#125; &#125; &#125;) &#125;) // è¯„è®º var isAllow = true $('.submit').click(function()&#123; if (!isAllow) return isAllow = false if ($('textarea').val().trim() == '') &#123; fade('è¯·è¾“å…¥è¯„è®ºï¼') &#125;else&#123; $.ajax(&#123; url: '/' + location.pathname.split('/')[2], data:$('.form').serialize(), type: "POST", cache: false, dataType: 'json', success: function (msg) &#123; if (msg) &#123; fade('å‘è¡¨ç•™è¨€æˆåŠŸ') setTimeout(()=&gt;&#123; isAllow = true window.location.reload() &#125;,1500) &#125; &#125;, error: function () &#123; alert('å¼‚å¸¸'); &#125; &#125;) &#125; &#125;) // åˆ é™¤è¯„è®º function delete_comment(id) &#123; $.ajax(&#123; url: "&lt;%= posts.id %&gt;/comment/" + id + "/remove", type: 'POST', cache: false, success: function (msg) &#123; if (msg.data == 1) &#123; fade('åˆ é™¤ç•™è¨€æˆåŠŸ') setTimeout(() =&gt; &#123; window.location.reload() &#125;, 1000) &#125; else if (msg.data == 2) &#123; fade('åˆ é™¤ç•™è¨€å¤±è´¥'); setTimeout(() =&gt; &#123; window.location.reload() &#125;, 1500) &#125; &#125;, error: function () &#123; alert('å¼‚å¸¸') &#125; &#125;) &#125; &lt;/script&gt;&lt;% include footer %&gt; ç°åœ¨ç‚¹å‡»å•ç¯‡æ–‡ç« è¯•è¯•ï¼Œè¿›å…¥å•ç¯‡æ–‡ç« é¡µé¢ï¼Œä½†æ˜¯ç¼–è¾‘ã€åˆ é™¤ã€è¯„è®ºéƒ½è¿˜æ²¡æœ‰åšï¼Œç‚¹å‡»æ— æ•ˆï¼Œæˆ‘ä»¬å…ˆä¸åšï¼Œå…ˆå®ç°æ¯ä¸ªç”¨æˆ·è‡ªå·±å‘è¡¨çš„æ–‡ç« åˆ—è¡¨ï¼Œæˆ‘ä»¬ä¹‹å‰åœ¨ get â€˜/postsâ€™ é‡Œé¢è¯´å…ˆå¿½ç•¥if (ctx.request.querystring) {}é‡Œé¢çš„ä»£ç ï¼Œè¿™é‡Œæ˜¯åšäº†ä¸€ä¸ªå¤„ç†ï¼Œå‡å¦‚ç”¨æˆ·ç‚¹å‡»äº†æŸä¸ªç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·å‘è¡¨äº†å‡ ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬éœ€è¦åªæ˜¾ç¤ºè¯¥ç”¨æˆ·å‘è¡¨çš„æ–‡ç« ï¼Œé‚£ä¹ˆè¿›å…¥çš„urlåº”è¯¥æ˜¯ /posts?author=xxx ,è¿™ä¸ªå¤„ç†åœ¨posts.ejs å°±å·²ç»åŠ ä¸Šäº†ï¼Œå°±åœ¨æ–‡ç« çš„å·¦ä¸‹è§’ï¼Œä½œè€…ï¼šxxxå°±æ˜¯ä¸€ä¸ªé“¾æ¥ã€‚æˆ‘ä»¬é€šè¿‡åˆ¤æ–­ç”¨æˆ·æ¥æŸ¥æ‰¾æ–‡ç« ï¼Œç»§è€Œæœ‰äº†ctx.request.querystring è·å–åˆ°çš„æ˜¯ï¼šauthor=xxx æ³¨ï¼šè¿™é‡Œæˆ‘ä»¬å¤„ç†äº†ï¼Œé€šè¿‡åˆ¤æ–­ session.user === res[&#39;name&#39;] å¦‚æœä¸æ˜¯è¯¥ç”¨æˆ·å‘çš„æ–‡ç« ï¼Œä¸èƒ½ç¼–è¾‘å’Œåˆ é™¤ï¼Œè¯„è®ºä¹Ÿæ˜¯ã€‚è¿™é‡Œé¢ä¹Ÿå¯ä»¥æ³¨æ„ä¸€ä¸‹åŒ…è£¹çš„&lt;a href=&quot;&quot;&gt;&lt;/a&gt;æ ‡ç­¾ ä¸ªäººå·²å‘è¡¨æ–‡ç« åˆ—è¡¨é‡Œé¢è¿˜è®°å¾—ä¹‹å‰åœ¨ get â€˜/postâ€™ é‡Œé¢çš„ä»£ç å—ï¼Ÿä¸‹é¢çš„ä»£ç å°±æ˜¯ä¹‹å‰è¯´å…ˆä¸å¤„ç†çš„ä»£ç ç‰‡æ®µï¼Œä¸è¿‡è¿™ä¸ªä¸ç”¨å†æ¬¡æ·»åŠ ï¼Œä¹‹å‰å·²ç»æ·»åŠ å¥½äº†ï¼Œè¿™æ®µä»£ç å¤„ç†ä¸ªäººå‘å¸ƒçš„æ–‡ç« åˆ—è¡¨ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡selfPosts.ejsæ¨¡æ¿æ¥æ¸²æŸ“çš„ï¼Œæ ·å¼å’Œå…¨éƒ¨æ–‡ç« åˆ—è¡¨ä¸€æ ·ï¼Œä½†æ˜¯ç‰µæ‰¯åˆ°åˆ†é¡µçš„é—®é¢˜ï¼Œåˆ†é¡µè¯·æ±‚çš„æ˜¯ä¸åŒçš„æ¥å£åœ°å€ 12345678910111213141516if (ctx.request.querystring) &#123; console.log('ctx.request.querystring', name) await userModel.findDataByUser(name) .then(result =&gt; &#123; postsLength = result.length &#125;) await userModel.findPostByUserPage(name,1) .then(result =&gt; &#123; res = result &#125;) await ctx.render('selfPosts', &#123; session: ctx.session, posts: res, postsPageLength:Math.ceil(postsLength / 10), &#125;) &#125; ä¿®æ”¹ selfPost.ejs 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586&lt;%- include("header",&#123;type:'my'&#125;) %&gt; &lt;div class="container"&gt; &lt;ul class="posts"&gt; &lt;% posts.forEach(function(res)&#123; %&gt; &lt;li&gt; &lt;div class="author"&gt; &lt;span title="&lt;%= res.name %&gt;"&gt;&lt;a href="/posts?author=&lt;%= res.name %&gt; "&gt;author: &lt;%= res.name %&gt;&lt;/a&gt;&lt;/span&gt; &lt;span&gt;è¯„è®ºæ•°ï¼š&lt;%= res.comments %&gt;&lt;/span&gt; &lt;span&gt;æµè§ˆé‡ï¼š&lt;%= res.pv %&gt;&lt;/span&gt; &lt;/div&gt; &lt;div class="comment_pv"&gt; &lt;span&gt;&lt;%= res.moment %&gt;&lt;/span&gt; &lt;/div&gt; &lt;a href="/posts/&lt;%= res.id %&gt;"&gt; &lt;div class="title"&gt; &lt;img class="userAvator" src="images/&lt;%= res.avator %&gt;.png"&gt; &lt;%= res.title %&gt; &lt;/div&gt; &lt;div class="content markdown"&gt; &lt;%- res.content %&gt; &lt;/div&gt; &lt;/a&gt; &lt;/li&gt; &lt;% &#125;) %&gt; &lt;/ul&gt; &lt;div style="margin-top: 30px" class="pagination" id="page"&gt;&lt;/div&gt; &lt;/div&gt; &lt;script src="http://www.wclimb.site/pagination/pagination.js"&gt;&lt;/script&gt; &lt;script&gt; pagination(&#123; selector: '#page', totalPage: &lt;%= postsPageLength %&gt;, currentPage: 1, prev: 'ä¸Šä¸€é¡µ', next: 'ä¸‹ä¸€é¡µ', first: true, last: true, showTotalPage: true, count: 2//å½“å‰é¡µå‰åæ˜¾ç¤ºçš„æ•°é‡ &#125;,function(val)&#123; // å½“å‰é¡µ $.ajax(&#123; url: "posts/self/page", type: 'POST', data:&#123; page: val, name: location.search.slice(1).split('=')[1] &#125;, cache: false, success: function (msg) &#123; //console.log(msg) if (msg != 'error') &#123; $('.posts').html(' ') $.each(msg,function(i,val)&#123; //console.log(val.content) $('.posts').append( '&lt;li&gt;'+ '&lt;div class=\"author\"&gt;'+ '&lt;span title=\"'+ val.name +'\"&gt;&lt;a href=\"/posts?author='+ val.name +' \"&gt;author: '+ val.name +'&lt;/a&gt;&lt;/span&gt;'+ '&lt;span&gt;è¯„è®ºæ•°ï¼š'+ val.comments +'&lt;/span&gt;'+ '&lt;span&gt;æµè§ˆé‡ï¼š'+ val.pv +'&lt;/span&gt;'+ '&lt;/div&gt;'+ '&lt;div class=\"comment_pv\"&gt;'+ '&lt;span&gt;'+ val.moment +'&lt;/span&gt;'+ '&lt;/div&gt;'+ '&lt;a href=\"/posts/'+ val.id +'\"&gt;'+ '&lt;div class=\"title\"&gt;'+ '&lt;img class="userAvator" src="images/' + val.avator + '.png"&gt;' + val.title + '&lt;/div&gt;'+ '&lt;div class=\"content\"&gt;'+ val.content + '&lt;/div&gt;'+ '&lt;/a&gt;'+ '&lt;/li&gt;' ) &#125;) &#125;else&#123; alert('åˆ†é¡µä¸å­˜åœ¨') &#125; &#125; &#125;) &#125;) &lt;/script&gt;&lt;% include footer %&gt; ç¼–è¾‘æ–‡ç« ã€åˆ é™¤æ–‡ç« ã€è¯„è®ºã€åˆ é™¤è¯„è®º è¯„è®º ä¿®æ”¹routers/posts.js åœ¨post.js åé¢å¢åŠ  12345678910111213141516171819202122232425262728293031323334353637// å‘è¡¨è¯„è®ºrouter.post('/:postId', async(ctx, next) =&gt; &#123; let name = ctx.session.user, content = ctx.request.body.content, postId = ctx.params.postId, res_comments, time = moment().format('YYYY-MM-DD HH:mm:ss'), avator; await userModel.findUserData(ctx.session.user) .then(res =&gt; &#123; console.log(res[0]['avator']) avator = res[0]['avator'] &#125;) await userModel.insertComment([name, md.render(content),time, postId,avator]) await userModel.findDataById(postId) .then(result =&gt; &#123; res_comments = parseInt(result[0]['comments']) res_comments += 1 &#125;) await userModel.updatePostComment([res_comments, postId]) .then(() =&gt; &#123; ctx.body = true &#125;).catch(() =&gt; &#123; ctx.body = false &#125;)&#125;)// è¯„è®ºåˆ†é¡µrouter.post('/posts/:postId/commentPage', async function(ctx)&#123; let postId = ctx.params.postId, page = ctx.request.body.page; await userModel.findCommentByPage(page,postId) .then(res=&gt;&#123; ctx.body = res &#125;).catch(()=&gt;&#123; ctx.body = 'error' &#125;) &#125;) ç°åœ¨è¯•è¯•å‘è¡¨è¯„è®ºçš„åŠŸèƒ½å§ï¼Œä¹‹æ‰€ä»¥è¿™æ ·ç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰å°±åœ¨sPost.ejsåšäº†å¥½å‡ ä¸ªajaxçš„å¤„ç†ï¼Œåˆ é™¤æ–‡ç« å’Œè¯„è®ºä¹Ÿæ˜¯å¦‚æ­¤è¯„è®ºæˆ‘ä»¬ä¹Ÿåšäº†åˆ†é¡µï¼Œæ‰€ä»¥åé¢ä¼šæœ‰ä¸€ä¸ªè¯„è®ºçš„åˆ†é¡µçš„æ¥å£ï¼Œæˆ‘ä»¬å·²ç»åœ¨sPost.ejsé‡Œé¢å†™å¥½äº†ajaxè¯·æ±‚ åˆ é™¤è¯„è®º ä¿®æ”¹routers/posts.js ç»§ç»­åœ¨post.js åé¢å¢åŠ  12345678910111213141516171819202122232425// åˆ é™¤è¯„è®ºrouter.post('/posts/:postId/comment/:commentId/remove', async(ctx, next) =&gt; &#123; let postId = ctx.params.postId, commentId = ctx.params.commentId, res_comments; await userModel.findDataById(postId) .then(result =&gt; &#123; res_comments = parseInt(result[0]['comments']) //console.log('res', res_comments) res_comments -= 1 //console.log(res_comments) &#125;) await userModel.updatePostComment([res_comments, postId]) await userModel.deleteComment(commentId) .then(() =&gt; &#123; ctx.body = &#123; data: 1 &#125; &#125;).catch(() =&gt; &#123; ctx.body = &#123; data: 2 &#125; &#125;)&#125;) ç°åœ¨è¯•è¯•åˆ é™¤è¯„è®ºçš„åŠŸèƒ½å§ åˆ é™¤æ–‡ç«  åªæœ‰è‡ªå·±å‘è¡¨çš„æ–‡å­—åˆ é™¤çš„æ–‡å­—æ‰ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œæ‰èƒ½è¢«åˆ é™¤ï¼Œ ä¿®æ”¹routers/posts.js ç»§ç»­åœ¨post.js åé¢å¢åŠ  123456789101112131415// åˆ é™¤å•ç¯‡æ–‡ç« router.post('/posts/:postId/remove', async(ctx, next) =&gt; &#123; let postId = ctx.params.postId await userModel.deleteAllPostComment(postId) await userModel.deletePost(postId) .then(() =&gt; &#123; ctx.body = &#123; data: 1 &#125; &#125;).catch(() =&gt; &#123; ctx.body = &#123; data: 2 &#125; &#125;)&#125;) ç°åœ¨è¯•è¯•åˆ é™¤æ–‡ç« çš„åŠŸèƒ½å§ ç¼–è¾‘æ–‡ç«  ä¿®æ”¹routers/posts.js ç»§ç»­åœ¨post.js åé¢å¢åŠ  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748// ç¼–è¾‘å•ç¯‡æ–‡ç« é¡µé¢router.get('/posts/:postId/edit', async(ctx, next) =&gt; &#123; let name = ctx.session.user, postId = ctx.params.postId, res; await userModel.findDataById(postId) .then(result =&gt; &#123; res = result[0] //console.log('ä¿®æ”¹æ–‡ç« ', res) &#125;) await ctx.render('edit', &#123; session: ctx.session, postsContent: res.md, postsTitle: res.title &#125;)&#125;)// post ç¼–è¾‘å•ç¯‡æ–‡ç« router.post('/posts/:postId/edit', async(ctx, next) =&gt; &#123; let title = ctx.request.body.title, content = ctx.request.body.content, id = ctx.session.id, postId = ctx.params.postId, // ç°åœ¨ä½¿ç”¨markdownä¸éœ€è¦å•ç‹¬è½¬ä¹‰ newTitle = title.replace(/[&lt;"&gt;']/g, (target) =&gt; &#123; return &#123; '&lt;': '&amp;lt;', '"': '&amp;quot;', '&gt;': '&amp;gt;', "'": '&amp;#39;' &#125;[target] &#125;), newContent = content.replace(/[&lt;"&gt;']/g, (target) =&gt; &#123; return &#123; '&lt;': '&amp;lt;', '"': '&amp;quot;', '&gt;': '&amp;gt;', "'": '&amp;#39;' &#125;[target] &#125;); await userModel.updatePost([newTitle, md.render(content), content, postId]) .then(() =&gt; &#123; ctx.body = true &#125;).catch(() =&gt; &#123; ctx.body = false &#125;)&#125;) ä¿®æ”¹views/edit.js 12345678910111213141516171819202122232425262728293031323334353637&lt;%- include("header",&#123;type:''&#125;) %&gt;&lt;div class="container"&gt; &lt;form style="width:100%" class="form create" method="post"&gt; &lt;div&gt; &lt;label&gt;æ ‡é¢˜ï¼š&lt;/label&gt; &lt;input placeholder="æ ‡é¢˜" type="text" name="title" value="&lt;%- postsTitle %&gt;"&gt; &lt;/div&gt; &lt;div&gt; &lt;label&gt;å†…å®¹ï¼š&lt;/label&gt; &lt;textarea name="content" id="" cols="42" rows="10"&gt;&lt;%= postsContent %&gt;&lt;/textarea&gt; &lt;/div&gt; &lt;div class="submit"&gt;ä¿®æ”¹&lt;/div&gt; &lt;/form&gt;&lt;/div&gt;&lt;script&gt; $('.submit').click(()=&gt;&#123; $.ajax(&#123; url: '', data: $('.form').serialize(), type: "POST", cache: false, dataType: 'json', success: function (msg) &#123; if (msg) &#123; fade('ä¿®æ”¹æˆåŠŸ') setTimeout(()=&gt;&#123; window.location.href="/posts" &#125;,1000) &#125; &#125;, error: function () &#123; alert('å¼‚å¸¸'); &#125; &#125;) &#125;)&lt;/script&gt;&lt;% include footer %&gt; ç°åœ¨è¯•è¯•ç¼–è¾‘æ–‡å­—ç„¶åä¿®æ”¹æäº¤å§ ç»“è¯­è‡³æ­¤ä¸€ä¸ªç®€å•çš„blogå°±å·²ç»åˆ¶ä½œå¥½äº†ï¼Œå…¶ä»–æ‰©å±•åŠŸèƒ½ç›¸ä¿¡ä½ å·²ç»ä¼šäº†å§ï¼å¦‚æœå‡ºç°é—®é¢˜ï¼Œè¿˜æœ›ç§¯ææé—®å“ˆï¼Œæˆ‘ä¼šå°½å¿«å¤„ç†çš„ æ‰€æœ‰çš„ä»£ç éƒ½åœ¨ https://github.com/wclimb/Koa2-blog é‡Œé¢ï¼Œå¦‚æœè§‰å¾—ä¸é”™å°±starä¸€ä¸‹å§ã€‚æœ‰é—®é¢˜å¯ä»¥æé—®å“Ÿä¸‹ä¸€ç¯‡å¯èƒ½æ˜¯ Node + express + mongoose æˆ– zeptoæºç ç³»åˆ—æ„Ÿè°¢æ‚¨çš„é˜…è¯»^_^ ä¸ªäººå°ç¨‹åº]]></content>
      <categories>
        <category>Node</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>Mysql</tag>
        <tag>javascript</tag>
        <tag>Koa</tag>
        <tag>Node</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¯»zeptoæºç ï¼Œå°è£…è‡ªå·±çš„zeptoåº“ï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2017%2F06%2F29%2F%E8%AF%BBzepto%E6%BA%90%E7%A0%81%EF%BC%8C%E5%B0%81%E8%A3%85%E8%87%AA%E5%B7%B1%E7%9A%84zepto%E5%BA%93%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[å†™åœ¨å‰é¢ è¯»zeptoæºç ï¼Œå°è£…è‡ªå·±çš„zeptoåº“ç³»åˆ—æ˜¯è‡ªå·±åœ¨è¯»zeptoæºç çš„ä¸€äº›ç†è§£ï¼Œæœ‰é”™è¯¯çš„åœ°æ–¹è¿˜æœ›æŒ‡å‡ºã€‚å¦‚æœè§‰å¾—æœ¬ç³»åˆ—å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¿˜è¯·æŒç»­å…³æ³¨wclimbï¼Œè°¢è°¢ã€‚ zeptoçš„æ•´ä½“æ¶æ„é¦–å…ˆæ¥çœ‹çœ‹æ•´ä½“ä»£ç ç»“æ„ 123456789101112131415161718192021222324252627282930313233(function()&#123; var wclimb = &#123;&#125;,$ $ = function(selector)&#123; return wclimb.init(selector) &#125; wclimb.init = function(selector)&#123; var dom; dom = document.querySelectorAll(selector); return wclimb.Z(dom,selector) &#125; wclimb.Z = function(dom,selector)&#123; return new Z(dom,selector) &#125; wclimb.Z.prototype = Z.prototype = &#123; test:function()&#123; alert(1) &#125; &#125; function Z(dom,selector) &#123; for (var i = 0; i &lt; dom.length; i++) &#123; this[i] = dom[i] &#125; this.selector = selector; this.length = dom.length &#125; window.$ = window.wclimb = $&#125;)() é¦–å…ˆæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªé—­åŒ…ï¼Œé¿å…äº§ç”Ÿå…¨å±€å˜é‡123(function()&#123; ...&#125;)() æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå¯¹è±¡wclimbå’Œ$ï¼Œä»¥ä¾¿åé¢ä½¿ç”¨ 1var wclimb = &#123;&#125;,$ $å‡½æ•°è¿”å›äº†wclimb.init(selector),æˆ‘ä»¬çŸ¥é“ä½¿ç”¨zeptoçš„æ—¶å€™ï¼Œä¸€èˆ¬æ˜¯$(â€˜pâ€™)ï¼Œè€Œselectorå°±æ˜¯på…ƒç´ ï¼Œå½“ç„¶ä¸æ­¢è¿™ä¸€ç§æƒ…å†µå¦‚$(function(){}),æ‰€ä»¥å¯¹é€‰æ‹©å™¨åé¢æˆ‘ä»¬è¦åšåˆ¤æ–­123$ = function(selector)&#123; return wclimb.init(selector)&#125; è€Œwclimb.inité¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªdomï¼Œé€šè¿‡é€‰æ‹©å™¨é€‰å–çš„å…ƒç´ èµ‹å€¼ç»™domï¼Œæœ€åè¿”å›wclimb.initï¼Œä¼ å…¥domå’Œé€‰æ‹©å…ƒç´ selector 12345wclimb.init = function(selector)&#123; var dom; dom = document.querySelector(selector); return wclimb.Z(dom,selector)&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¹‹å‰æˆ‘ä»¬å®šä¹‰äº†å¯¹è±¡wclimbï¼Œè€Œåæˆ‘ä»¬å°±å¾€é‡Œé¢æ·»åŠ äº†ä¸€äº›æ–¹æ³•ï¼Œå°±åƒï¼š 12345678910wclimb = &#123; initï¼šfunction(selector)&#123; var dom; dom = document.querySelector(selector); return wclimb.Z(dom,selector) &#125;, Z: function(dom,selector)&#123; return new Z(dom,selector) &#125;&#125; é€šè¿‡wclimb.Zï¼Œå¦‚æœæœ‰çœ‹è¿‡zeptoæºç çš„åŒå­¦åº”è¯¥å¯¹æ­¤æœ‰äº†è§£.æ¯æ¬¡ç”¨$è°ƒç”¨çš„æ—¶å€™,å°†ç›´æ¥è¿”å›ä¸€ä¸ªZçš„å®ä¾‹.è¾¾åˆ°æ— newè°ƒç”¨çš„æ•ˆæœ,$(â€˜pâ€™)è¿”å›ä¸€ä¸ªå®ä¾‹ï¼Œç„¶å$(â€˜pâ€™).test()è°ƒç”¨ä»–çš„åŸå½¢æ–¹æ³•ï¼Œè¿™é‡Œçš„æ–¹æ³•æ˜¯test 1234567891011wclimb.Z = function(dom,selector)&#123; return new Z(dom,selector)&#125;function Z(dom,selector) &#123; for (var i = 0; i &lt; dom.length; i++) &#123; this[i] = dom[i] &#125; this.selector = selector; this.length = dom.length&#125; ç”±äºæˆ‘ä»¬æ˜¯return new Z(dom,selector),é‚£è‡ªç„¶,æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨çš„æŠŠwclimb.Zçš„prototypeæŒ‡å‘Zçš„prototype 123456789wclimb.Z.prototype = Z.prototype&#123;&#125;æˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢æ·»åŠ æ–¹æ³•äº†ï¼Œå¦‚addClass eqç­‰ï¼Œæˆ‘ä»¬è¯•è¯•åŠ ä¸€ä¸ªtestwclimb.Z.prototype = Z.prototype&#123; test: function()&#123; console.log('test') &#125;&#125; Zå‡½æ•°æ˜¯è¿™æ ·çš„ï¼Œå› ä¸ºæˆ‘ä»¬é€‰æ‹©å™¨é€‰æ‹©çš„å…ƒç´ æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆå…¶å®ä¸æ˜¯ï¼‰æˆ‘ä»¬æŠŠthisæŒ‡å‘é€‰æ‹©çš„å…ƒç´ ï¼Œç„¶åæ·»åŠ ä¸¤ä¸ªå…ƒç´ selectorå’Œlengthï¼Œåˆ†åˆ«ä»£è¡¨é€‰æ‹©çš„å…ƒç´ åå’Œå…ƒç´ çš„é•¿åº¦ 1234567function Z(dom,selector) &#123; for (var i = 0; i &lt; dom.length; i++) &#123; this[i] = dom[i] &#125; this.selector = selector; this.length = dom.length&#125; æœ€åæˆ‘ä»¬åœ¨windowä¸Šå¯¹å¤–æš´éœ²ä¸€ä¸ªæ¥å£,æˆ‘ä»¬å°±å¯ä»¥ç”¨ $(â€˜pâ€™) æˆ–è€…wclimb(â€˜pâ€™) å³å¯è°ƒç”¨. 1window.$ = window.wclimb = $ ç°åœ¨å¯ä»¥è¯•è¯•èƒ½ä¸èƒ½è¿è¡Œ 123htmlï¼š&lt;p&gt;test&lt;/p&gt;jsï¼š$('p') è°ƒç”¨æ–¹æ³•è¯•è¯• $('p').test() æˆ‘ä»¬çš„zeptoå·²ç»å®Œæˆäº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿéª—ä½ çš„ï¼Œè¿˜å·®å¾—è¿œå‘¢ï¼Œåé¢ä¼šæ…¢æ…¢å®Œå–„ã€‚å¾…ç»­ã€‚ã€‚ã€‚å¦‚æœä½ è§‰å¾—è¯¥æ–‡ç« å¸®åŠ©åˆ°äº†ä½ ï¼Œä¸å¦¨starä¸€ä¸‹https://github.com/wclimb/wclimb.github.io ï¼Œæ„Ÿè°¢]]></content>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>javascript</tag>
        <tag>zepto</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[canvasä»¿å¾®ä¿¡çº¢åŒ…ç…§ç‰‡]]></title>
    <url>%2F2017%2F06%2F28%2Fcanvas%E5%BE%AE%E4%BF%A1%E7%BA%A2%E5%8C%85%E7%85%A7%E7%89%87%2F</url>
    <content type="text"><![CDATA[canvasä»¿å¾®ä¿¡çº¢åŒ…ç…§ç‰‡ By wclimbHTML1&lt;canvas id=&quot;cav&quot; width=&quot;500&quot; height=&quot;500&quot;&gt;&lt;/canvas&gt; CSS è®¾ç½®canvasçš„èƒŒæ™¯å›¾ 1234canvas&#123; background:url(https://b-ssl.duitang.com/uploads/item/201501/22/20150122203239_Cfr58.thumb.700_0.jpeg) no-repeat; background-size:100% 100%;&#125; JS12345678910111213141516171819202122232425262728293031323334353637var canvas = document.querySelector("#cav")var context = canvas.getContext("2d");var randomX = Math.floor(Math.random()*440+30)var randomY = Math.floor(Math.random()*440+30)context.globalAlpha = 0.96;context.fillStyle = '#333'context.rect(0,0,canvas.width,canvas.height);context.fill();context.save()context.beginPath()context.arc(randomX,randomY,30,0,Math.PI*2,false);context.clip();context.clearRect(0,0,canvas.width,canvas.height)context.restore();var num = 30;var time = null;document.body.onclick = function()&#123; function circle()&#123; num += 5 context.save() context.beginPath() context.arc(randomX,randomY,num,0,Math.PI*2,false); context.clip(); context.clearRect(0,0,canvas.width,canvas.height) context.restore(); console.log(num) if (num &gt;= 677)&#123; clearInterval(timer) &#125; &#125; timer = setInterval(circle,10)&#125; è§£æ éšæœºå‡ºç°åœ†å¿ƒçš„ä½ç½®ï¼Œå› ä¸ºcanvasä¸º500*500 åœ†å¿ƒä¸º30 æ‰€ä»¥åœ†å¿ƒçš„èŒƒå›´ä¸º X(30,470) Y(470,30) 12var randomX = Math.floor(Math.random()*440+30)var randomY = Math.floor(Math.random()*440+30) ç»˜åˆ¶çŸ©å½¢ é€æ˜åº¦ä¸º0.96 å¡«å……é¢œè‰²#333 å®½é«˜ä¸ºcanvasçš„å®½é«˜ æœ€åç”¨fillå¡«å…… 1234context.globalAlpha = 0.96;context.fillStyle = '#333'context.rect(0,0,canvas.width,canvas.height);context.fill(); åˆå§‹åŒ–åœ†å¿ƒçš„ä½ç½®ï¼Œç”¨arcç»˜åˆ¶åœ†ï¼Œé»˜è®¤åŠå¾„ä¸º30ï¼Œç”¨clipå‰ªåˆ‡ï¼Œåªæœ‰è¢«å‰ªåˆ‡åŒºåŸŸå†…æ˜¯å¯è§çš„ 123456context.save()context.beginPath()context.arc(randomX,randomY,30,0,Math.PI*2,false);context.clip();context.clearRect(0,0,canvas.width,canvas.height)context.restore(); ç‚¹å‡»bodyçš„æ—¶å€™ï¼Œè®¾ç½®å®šæ—¶å™¨ï¼Œè®©åœ†çš„åŠå¾„æ¯éš”10æ¯«ç§’å¢åŠ 5ï¼Œå½“numåŠå¾„å¤§äº677å…³é—­å®šæ—¶å™¨ï¼Œ677ä¸ºcanvaså¯¹è§’çš„é•¿åº¦ 1document.body.onclick = function()&#123;&#125; æ•ˆæœé¢„è§ˆ]]></content>
      <categories>
        <category>javascript</category>
        <category>canvas</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>canvas</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[gulpåŸºç¡€æ•™ç¨‹]]></title>
    <url>%2F2017%2F06%2F27%2Fgulp%2F</url>
    <content type="text"><![CDATA[å…¥é—¨æŒ‡å—â€“å¼•ç”¨gulpå®˜ç½‘ç¤ºä¾‹ å…¨å±€å®‰è£… gulpï¼š 1$ npm install --global gulp ä½œä¸ºé¡¹ç›®çš„å¼€å‘ä¾èµ–ï¼ˆdevDependenciesï¼‰å®‰è£…ï¼š 1$ npm install --save-dev gulp åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º gulpfile.js çš„æ–‡ä»¶ï¼š 12345var gulp = require('gulp');gulp.task('default', function() &#123; // å°†ä½ çš„é»˜è®¤çš„ä»»åŠ¡ä»£ç æ”¾åœ¨è¿™&#125;); è¿è¡Œ gulp 1$ gulp //é»˜è®¤çš„åä¸º default çš„ä»»åŠ¡ï¼ˆtaskï¼‰å°†ä¼šè¢«è¿è¡Œï¼Œåœ¨è¿™é‡Œï¼Œè¿™ä¸ªä»»åŠ¡å¹¶æœªåšä»»ä½•äº‹æƒ…ã€‚ è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„gulpå·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥å®Œå–„éƒ¨åˆ†åŠŸèƒ½ gulpåŠŸèƒ½å®Œå–„ç”Ÿæˆpackage.jsonæ–‡ä»¶1$ npm init //ä¸€ç›´å›è½¦ï¼Œæœ‰éœ€è¦çš„å¯ä»¥è®¾ç½® å®‰è£…æ‰€éœ€åŒ… ä½¿ç”¨æ·˜å®é•œåƒ 12$ npm install -g cnpm --registry=https://registry.npm.taobao.orgç¤ºä¾‹ $ cnpm install [name] æ¥ç€1$ cnpm i browser-sync gulp gulp-clean-css gulp-imagemin gulp-rename gulp-sass gulp-uglify gulp.spritesmith gulp-autoprefixer --save æ–°å»ºgulpfile.jsæ–‡ä»¶æ·»åŠ 123456789var gulp = require('gulp'); var browserSync = require('browser-sync').create(); //é€šè¿‡æµçš„æ–¹å¼åˆ›å»ºä»»åŠ¡æµç¨‹, è¿™æ ·æ‚¨å°±å¯ä»¥åœ¨æ‚¨çš„ä»»åŠ¡å®Œæˆåè°ƒç”¨reloadï¼Œæ‰€æœ‰çš„æµè§ˆå™¨å°†è¢«å‘ŠçŸ¥çš„å˜åŒ–å¹¶å®æ—¶æ›´æ–°var sass = require('gulp-sass'); //sassè½¬cssvar reload = browserSync.reload; var minifyCSS = require('gulp-clean-css') //csså‹ç¼©var uglify = require('gulp-uglify') //jså‹ç¼©var imagemin = require('gulp-imagemin') //å›¾ç‰‡å‹ç¼©var rename = require('gulp-rename') //æ–‡ä»¶é‡å‘½åvar autoprefixer = require('gulp-autoprefixer') //è‡ªåŠ¨æ·»åŠ å‰ç¼€ è®¾ç½®é»˜è®¤æ–‡ä»¶åœ°å€12345678codeä¸ºæ–‡ä»¶å¤¹ï¼Œé‡Œé¢å­˜æ”¾html css jsæ–‡ä»¶var src = &#123; scss: 'code/scss/*.scss', css: 'code/css/*.css', html: 'code/*.html', js: 'code/js/*.js', images: 'code/images/*.&#123;png,jpg,gif,ico&#125;'&#125;; gulp.task(name[, deps], fn)1234567891011121314151617name: ä»»åŠ¡çš„åå­—deps: ä¸€ä¸ªåŒ…å«ä»»åŠ¡åˆ—è¡¨çš„æ•°ç»„ï¼Œè¿™äº›ä»»åŠ¡ä¼šåœ¨ä½ å½“å‰ä»»åŠ¡è¿è¡Œä¹‹å‰å®Œæˆã€‚fn: è¯¥å‡½æ•°å®šä¹‰ä»»åŠ¡æ‰€è¦æ‰§è¡Œçš„ä¸€äº›æ“ä½œã€‚é€šå¸¸æ¥è¯´ï¼Œå®ƒä¼šæ˜¯è¿™ç§å½¢å¼ï¼šgulp.src().pipe(someplugin())ã€‚// é™æ€æœåŠ¡å™¨ + ç›‘å¬ scss/html æ–‡ä»¶ gulp.task('serve', ['sass'], function() &#123; browserSync.init(&#123; server: "./code" &#125;); gulp.watch(src.scss, ['sass']); gulp.watch(src.css, ['css']); gulp.watch(src.images, ['images']) gulp.watch(src.js, ['js']); gulp.watch(src.html).on('change', reload);&#125;); scssç¼–è¯‘åçš„csså°†æ³¨å…¥åˆ°æµè§ˆå™¨é‡Œå®ç°æ›´æ–°123456789101112131415gulp.task('sass', function() &#123; return gulp.src(src.scss) .pipe(sass()) .pipe(minifyCSS(&#123; advanced: false,//ç±»å‹ï¼šBoolean é»˜è®¤ï¼štrue [æ˜¯å¦å¼€å¯é«˜çº§ä¼˜åŒ–ï¼ˆåˆå¹¶é€‰æ‹©å™¨ç­‰ï¼‰] compatibility: 'ie7',//ä¿ç•™ie7åŠä»¥ä¸‹å…¼å®¹å†™æ³• ç±»å‹ï¼šString é»˜è®¤ï¼š''or'*' [å¯ç”¨å…¼å®¹æ¨¡å¼ï¼› 'ie7'ï¼šIE7å…¼å®¹æ¨¡å¼ï¼Œ'ie8'ï¼šIE8å…¼å®¹æ¨¡å¼ï¼Œ'*'ï¼šIE9+å…¼å®¹æ¨¡å¼] keepBreaks: true,//ç±»å‹ï¼šBoolean é»˜è®¤ï¼šfalse [æ˜¯å¦ä¿ç•™æ¢è¡Œ] keepSpecialComments: '*' //ä¿ç•™æ‰€æœ‰ç‰¹æ®Šå‰ç¼€ å½“ä½ ç”¨autoprefixerç”Ÿæˆçš„æµè§ˆå™¨å‰ç¼€ï¼Œå¦‚æœä¸åŠ è¿™ä¸ªå‚æ•°ï¼Œæœ‰å¯èƒ½å°†ä¼šåˆ é™¤ä½ çš„éƒ¨åˆ†å‰ç¼€ &#125;)) .pipe(autoprefixer()) .pipe(rename(&#123;suffix: '.min'&#125;)) .pipe(gulp.dest("code/css")) .pipe(reload(&#123;stream: true&#125;));&#125;); é›ªç¢§å›¾ï¼ˆæœ‰éœ€è¦å¯ä»¥å°è¯•ï¼‰123456789101112var spritesmith = require('gulp.spritesmith'); gulp.task('sprite', function () &#123; return gulp.src('code/images/*.png') .pipe(spritesmith(&#123; imgName:'images/sprite20161010.png', //ä¿å­˜åˆå¹¶åå›¾ç‰‡çš„åœ°å€ cssName:'css/sprite.css', //ä¿å­˜åˆå¹¶åå¯¹äºcssæ ·å¼çš„åœ°å€ padding:20, algorithm:'binary-tree', &#125;)) .pipe(gulp.dest('code/scss')); &#125;); ç›‘å¬cssæ–‡ä»¶1234567gulp.task('css', function() &#123; return gulp.src(src.css) .pipe(minifyCSS()) .pipe(rename(&#123;suffix: '.min'&#125;)) .pipe(gulp.dest("code/css")) .pipe(reload(&#123;stream: true&#125;));&#125;); ç›‘å¬jsæ–‡ä»¶12345678910gulp.task('js', function() &#123; // 1. æ‰¾åˆ°æ–‡ä»¶ return gulp.src(src.js) //2. å‹ç¼©æ–‡ä»¶ .pipe(uglify()) .pipe(rename(&#123;suffix: '.min'&#125;)) //3. å¦å­˜å‹ç¼©åçš„æ–‡ä»¶ .pipe(gulp.dest('code/dest')) .pipe(reload(&#123;stream: true&#125;));&#125;) å‹ç¼©å›¾ç‰‡ä»»åŠ¡12345678910// åœ¨å‘½ä»¤è¡Œè¾“å…¥ gulp images å¯åŠ¨æ­¤ä»»åŠ¡gulp.task('images', function () &#123; // 1. æ‰¾åˆ°å›¾ç‰‡ gulp.src(src.images) // 2. å‹ç¼©å›¾ç‰‡ .pipe($.imagemin()) // 3. å¦å­˜å›¾ç‰‡ .pipe(gulp.dest('images')) .pipe(reload(&#123;stream: true&#125;));&#125;); æœ€åæ§åˆ¶å°è¾“å…¥gulpæ‰§è¡Œ1gulp.task('default', ['serve']); å¦‚æœè§‰å¾—å¸®åŠ©åˆ°äº†ä½ ï¼Œæ¬¢è¿star -&gt; https://github.com/wclimb/wclimb.github.io å®Œæ•´ä»£ç æ–‡ä»¶ç›®å½•123456789101112-code -imgage 1.png -css default.css -scss default.scss -js default.js index.htmlgulpfile.jspackage.json package.json12345678910111213141516171819202122232425&#123; "name": "gulp-test", "version": "1.0.0", "description": "Gulp &amp; SASS", "main": "gulpfile.js", "scripts": &#123; "start": "gulp" &#125;, "author": "", "license": "ISC", "devDependencies": &#123; "browser-sync": "^2.2.0", "gulp": "^3.9.1", "gulp-clean-css": "^3.0.3", "gulp-imagemin": "^3.1.1", "gulp-rename": "^1.2.2", "gulp-sass": "^3.1.0", "gulp-uglify": "^2.0.1", "gulp.spritesmith": "^6.4.0", "gulp-autoprefixer": "^4.0.0" &#125;, "dependencies": &#123; &#125;&#125; gulpfile.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103var gulp = require('gulp'); var browserSync = require('browser-sync').create(); //é€šè¿‡æµçš„æ–¹å¼åˆ›å»ºä»»åŠ¡æµç¨‹, è¿™æ ·æ‚¨å°±å¯ä»¥åœ¨æ‚¨çš„ä»»åŠ¡å®Œæˆåè°ƒç”¨reloadï¼Œæ‰€æœ‰çš„æµè§ˆå™¨å°†è¢«å‘ŠçŸ¥çš„å˜åŒ–å¹¶å®æ—¶æ›´æ–°var sass = require('gulp-sass'); //sassè½¬cssvar reload = browserSync.reload; var minifyCSS = require('gulp-clean-css') //csså‹ç¼©var uglify = require('gulp-uglify') //jså‹ç¼©var imagemin = require('gulp-imagemin') //å›¾ç‰‡å‹ç¼©var rename = require('gulp-rename') //æ–‡ä»¶é‡å‘½åvar autoprefixer = require('gulp-autoprefixer') //è‡ªåŠ¨æ·»åŠ å‰ç¼€var src = &#123; scss: 'code/scss/*.scss', css: 'code/css/*.css', html: 'code/*.html', js: 'code/js/*.js', images: 'code/images/*.&#123;png,jpg,gif,ico&#125;'&#125;;// é™æ€æœåŠ¡å™¨ + ç›‘å¬ scss/html æ–‡ä»¶ gulp.task('serve', ['sass'], function() &#123; browserSync.init(&#123; server: "./code" &#125;); gulp.watch(src.scss, ['sass']); gulp.watch(src.css, ['css']); gulp.watch(src.images, ['images']) gulp.watch(src.js, ['js']); gulp.watch(src.html).on('change', reload);&#125;);// scssç¼–è¯‘åçš„csså°†æ³¨å…¥åˆ°æµè§ˆå™¨é‡Œå®ç°æ›´æ–°gulp.task('sass', function() &#123; return gulp.src(src.scss) .pipe(sass()) .pipe(minifyCSS(&#123; advanced: false,//ç±»å‹ï¼šBoolean é»˜è®¤ï¼štrue [æ˜¯å¦å¼€å¯é«˜çº§ä¼˜åŒ–ï¼ˆåˆå¹¶é€‰æ‹©å™¨ç­‰ï¼‰] compatibility: 'ie7',//ä¿ç•™ie7åŠä»¥ä¸‹å…¼å®¹å†™æ³• ç±»å‹ï¼šString é»˜è®¤ï¼š''or'*' [å¯ç”¨å…¼å®¹æ¨¡å¼ï¼› 'ie7'ï¼šIE7å…¼å®¹æ¨¡å¼ï¼Œ'ie8'ï¼šIE8å…¼å®¹æ¨¡å¼ï¼Œ'*'ï¼šIE9+å…¼å®¹æ¨¡å¼] keepBreaks: true,//ç±»å‹ï¼šBoolean é»˜è®¤ï¼šfalse [æ˜¯å¦ä¿ç•™æ¢è¡Œ] keepSpecialComments: '*' //ä¿ç•™æ‰€æœ‰ç‰¹æ®Šå‰ç¼€ å½“ä½ ç”¨autoprefixerç”Ÿæˆçš„æµè§ˆå™¨å‰ç¼€ï¼Œå¦‚æœä¸åŠ è¿™ä¸ªå‚æ•°ï¼Œæœ‰å¯èƒ½å°†ä¼šåˆ é™¤ä½ çš„éƒ¨åˆ†å‰ç¼€ &#125;)) .pipe(autoprefixer()) .pipe(rename(&#123;suffix: '.min'&#125;)) .pipe(gulp.dest("code/css")) //é‡æ–°è¾“å‡ºæ•°æ®åˆ°æŸä¸ªæ–‡ä»¶å¤¹ï¼Œå¦‚æœæ²¡æœ‰å°±ä¼šè‡ªåŠ¨åˆ›å»º .pipe(reload(&#123;stream: true&#125;));&#125;);// é›ªç¢§å›¾ï¼ˆæœ‰éœ€è¦å¯ä»¥å°è¯•ï¼‰//var spritesmith = require('gulp.spritesmith'); // gulp.task('sprite', function () &#123;// return gulp.src('code/images/*.png')// .pipe(spritesmith(&#123;// imgName:'images/sprite20161010.png', //ä¿å­˜åˆå¹¶åå›¾ç‰‡çš„åœ°å€// cssName:'css/sprite.css', //ä¿å­˜åˆå¹¶åå¯¹äºcssæ ·å¼çš„åœ°å€// padding:20,// algorithm:'binary-tree',// &#125;))// .pipe(gulp.dest('code/scss'));// &#125;);gulp.task('css', function() &#123; return gulp.src(src.css) .pipe(minifyCSS()) .pipe(rename(&#123;suffix: '.min'&#125;)) .pipe(gulp.dest("code/css")) .pipe(reload(&#123;stream: true&#125;));&#125;);gulp.task('js', function() &#123; // 1. æ‰¾åˆ°æ–‡ä»¶ return gulp.src(src.js) //2. å‹ç¼©æ–‡ä»¶ .pipe(uglify()) .pipe(rename(&#123;suffix: '.min'&#125;)) //3. å¦å­˜å‹ç¼©åçš„æ–‡ä»¶ .pipe(gulp.dest('code/dest')) .pipe(reload(&#123;stream: true&#125;));&#125;)// å‹ç¼©å›¾ç‰‡ä»»åŠ¡// åœ¨å‘½ä»¤è¡Œè¾“å…¥ gulp images å¯åŠ¨æ­¤ä»»åŠ¡gulp.task('images', function () &#123; // 1. æ‰¾åˆ°å›¾ç‰‡ gulp.src(src.images) // 2. å‹ç¼©å›¾ç‰‡ .pipe($.imagemin()) // 3. å¦å­˜å›¾ç‰‡ .pipe(gulp.dest('images')) .pipe(reload(&#123;stream: true&#125;));&#125;);gulp.task('default', ['serve']);]]></content>
      <categories>
        <category>javascript</category>
        <category>gulp</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>gulp</tag>
      </tags>
  </entry>
</search>
